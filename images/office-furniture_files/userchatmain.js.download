!function(e,t){"object"==typeof exports?exports.SDK=t():e.SDK=t()}(window,function(){return function(n){var r={};function s(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,s),t.l=!0,t)).exports}return s.m=n,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=498)}([function(e,t,n){"use strict";var r=n(9),s=r&&r.__esModule?r:{default:r},o=n(76),a=n(70);n(91);var i,c,u,l,m=n(13),r=m.getGlobal(),d=/\s+/;m.deduplicate=function(e){var t=[];return e.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),t},m.capFirstLetter=function(e){return e?(e=""+e).slice(0,1).toUpperCase()+e.slice(1):""},m.guid=(i=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return i()+i()+i()+i()+i()+i()+i()+i()}),m.extend=function(e,t,n){for(var r in t)void 0!==e[r]&&!0!==n||(e[r]=t[r])},m.filterObj=function(t,e){var n={};return(e=m.isString(e)?e.split(d):e).forEach(function(e){t.hasOwnProperty(e)&&(n[e]=t[e])}),n},m.copy=function(t,n){return n=n||{},t&&Object.keys(t).forEach(function(e){m.exist(t[e])&&(n[e]=t[e])}),n},m.copyWithNull=function(t,n){return n=n||{},t&&Object.keys(t).forEach(function(e){(m.exist(t[e])||m.isnull(t[e]))&&(n[e]=t[e])}),n},m.findObjIndexInArray=function(e,n){var r=n.keyPath||"id",s=-1;return(e=e||[]).some(function(e,t){if(a(e,r)===n.value)return s=t,!0}),s},m.findObjInArray=function(e,t){t=m.findObjIndexInArray(e,t);return-1===t?null:e[t]},m.mergeObjArray=function(){var t=[],e=[].slice.call(arguments,0,-1),n=arguments[arguments.length-1];m.isArray(n)&&(e.push(n),n={});var r,s=n.keyPath=n.keyPath||"id";for(n.sortPath=n.sortPath||s;!t.length&&e.length;)t=(t=e.shift()||[]).slice(0);return e.forEach(function(e){e&&e.forEach(function(e){-1!==(r=m.findObjIndexInArray(t,{keyPath:s,value:a(e,s)}))?t[r]=m.merge({},t[r],e):t.push(e)})}),t=n.notSort?t:m.sortObjArray(t,n)},m.cutObjArray=function(e){var t=e.slice(0),e=arguments.length,n=[].slice.call(arguments,1,e-1),r=arguments[e-1];m.isObject(r)||(n.push(r),r={});var s,i=r.keyPath=r.keyPath||"id";return n.forEach(function(e){(e=m.isArray(e)?e:[e]).forEach(function(e){e&&(r.value=a(e,i),-1!==(s=m.findObjIndexInArray(t,r)))&&t.splice(s,1)})}),t},m.sortObjArray=function(e,t){var n=(t=t||{}).sortPath||"id";o.insensitive=!!t.insensitive;var r,s,i=!!t.desc,t=m.isFunction(t.compare)?t.compare:function(e,t){return r=a(e,n),s=a(t,n),i?o(s,r):o(r,s)};return e.sort(t)},m.emptyFunc=function(){},m.isEmptyFunc=function(e){return e===m.emptyFunc},m.notEmptyFunc=function(e){return e!==m.emptyFunc},m.splice=function(e,t,n){return[].splice.call(e,t,n)},m.reshape2d=function(e,t){if(Array.isArray(e)){m.verifyParamType("type",t,"number","util::reshape2d");var n=e.length;if(n<=t)return[e];for(var r=Math.ceil(n/t),s=[],i=0;i<r;i++)s.push(e.slice(i*t,(i+1)*t));return s}return e},m.flatten2d=function(e){var t;return Array.isArray(e)?(t=[],e.forEach(function(e){t=t.concat(e)}),t):e},m.dropArrayDuplicates=function(e){if(Array.isArray(e)){for(var t,n={},r=[];0<e.length;)n[e.shift()]=!0;for(t in n)!0===n[t]&&r.push(t);return r}return e},m.onError=function(e){throw new function(e){"object"===(void 0===e?"undefined":(0,s.default)(e))?(this.callFunc=e.callFunc||null,this.message=e.message||"UNKNOW ERROR"):this.message=e,this.time=new Date,this.timetag=+this.time}(e)},m.verifyParamPresent=function(e,t,n,r){n=n||"";var s=!1;switch(m.typeOf(t)){case"undefined":case"null":s=!0;break;case"string":""===t&&(s=!0);break;case"StrStrMap":case"object":Object.keys(t).length||(s=!0);break;case"array":t.length?t.some(function(e){if(m.notexist(e))return s=!0}):s=!0}s&&m.onParamAbsent(n+e,r)},m.onParamAbsent=function(e,t){m.onParamError("缺少参数 "+e+", 请确保参数不是 空字符串、空对象、空数组、null或undefined, 或数组的内容不是 null/undefined",t)},m.verifyParamAbsent=function(e,t,n,r){n=n||"",void 0!==t&&m.onParamPresent(n+e,r)},m.onParamPresent=function(e,t){m.onParamError("多余的参数 "+e,t)},m.verifyParamType=function(e,t,n,r){var s=m.typeOf(t).toLowerCase(),i=!0;switch(-1===(n=(n=m.isArray(n)?n:[n]).map(function(e){return e.toLowerCase()})).indexOf(s)&&(i=!1),s){case"number":isNaN(t)&&(i=!1);break;case"string":"numeric or numeric string"===n.join("")&&(i=!!/^[0-9]+$/.test(t))}i||m.onParamInvalidType(e,n,"",r)},m.onParamInvalidType=function(e,t,n,r){n=n||"",t=m.isArray(t)?(t=t.map(function(e){return'"'+e+'"'})).join(", "):'"'+t+'"',m.onParamError('参数"'+n+e+'"类型错误, 合法的类型包括: ['+t+"]",r)},m.verifyParamValid=function(e,t,n,r){-1===(n=m.isArray(n)?n:[n]).indexOf(t)&&m.onParamInvalidValue(e,n,r)},m.onParamInvalidValue=function(e,t,n){t=(t=m.isArray(t)?t:[t]).map(function(e){return'"'+e+'"'}),m.isArray(t)&&(t=t.join(", ")),m.onParamError("参数 "+e+"值错误, 合法的值包括: ["+JSON.stringify(t)+"]",n)},m.verifyParamMin=function(e,t,n,r){t<n&&m.onParamError("参数"+e+"的值不能小于"+n,r)},m.verifyParamMax=function(e,t,n,r){n<t&&m.onParamError("参数"+e+"的值不能大于"+n,r)},m.verifyArrayMax=function(e,t,n,r){t.length>n&&m.onParamError("参数"+e+"的长度不能大于"+n,r)},m.verifyEmail=(c=/^\S+@\S+$/,function(e,t,n){c.test(t)||m.onParamError("参数"+e+"邮箱格式错误, 合法格式必须包含@符号, @符号前后至少要各有一个字符",n)}),m.verifyTel=(l=/^[+\-()\d]+$/,function(e,t,n){l.test(t)||m.onParamError("参数"+e+"电话号码格式错误, 合法字符包括+、-、英文括号和数字",n)}),m.verifyBirth=(u=/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,function(e,t,n){u.test(t)||m.onParamError("参数"+e+'生日格式错误, 合法为"yyyy-MM-dd"',n)}),m.onParamError=function(e,t){m.onError({message:e,callFunc:t})},m.verifyOptions=function(t,e,n,r,s){var i;return t=t||{},e&&(m.isString(e)&&(e=e.split(d)),m.isArray(e))&&("boolean"!=typeof n&&(s=n||null,n=!0,r=""),i=n?m.verifyParamPresent:m.verifyParamAbsent,e.forEach(function(e){i.call(m,e,t[e],r,s)})),t},m.verifyParamAtLeastPresentOne=function(t,e,n){e&&(m.isString(e)&&(e=e.split(d)),m.isArray(e))&&(e.some(function(e){return m.exist(t[e])})||m.onParamError("以下参数["+e.join(", ")+"]至少需要传入一个",n))},m.verifyParamPresentJustOne=function(n,e,t){e&&(m.isString(e)&&(e=e.split(d)),m.isArray(e))&&1!==e.reduce(function(e,t){return m.exist(n[t])&&e++,e},0)&&m.onParamError("以下参数["+e.join(", ")+"]必须且只能传入一个",t)},m.verifyBooleanWithDefault=function(t,e,n,r,s){m.undef(n)&&(n=!0),d.test(e)&&(e=e.split(d)),m.isArray(e)?e.forEach(function(e){m.verifyBooleanWithDefault(t,e,n,r,s)}):void 0===t[e]?t[e]=n:m.isBoolean(t[e])||m.onParamInvalidType(e,"boolean",r,s)},m.verifyFileInput=function(e,t){return m.verifyParamPresent("fileInput",e,"",t),!m.isString(e)||(e="undefined"==typeof document?void 0:document.getElementById(e))||m.onParamError("找不到要上传的文件对应的input, 请检查fileInput id "+e,t),e.tagName&&"input"===e.tagName.toLowerCase()&&"file"===e.type.toLowerCase()||m.onParamError("请提供正确的 fileInput, 必须为 file 类型的 input 节点 tagname:"+e.tagName+", filetype:"+e.type,t),e},m.verifyFileType=function(e,t){m.verifyParamValid("type",e,m.validFileTypes,t)},m.verifyCallback=function(t,e,n){d.test(e)&&(e=e.split(d)),m.isArray(e)?e.forEach(function(e){m.verifyCallback(t,e,n)}):t[e]?m.isFunction(t[e])||m.onParamInvalidType(e,"function","",n):t[e]=m.emptyFunc},m.verifyFileUploadCallback=function(e,t){m.verifyCallback(e,"uploadprogress uploaddone uploaderror uploadcancel",t)},m.validFileTypes=["image","audio","video","file"],m.validFileExts={image:["bmp","gif","jpg","jpeg","jng","png","webp"],audio:["mp3","wav","aac","wma","wmv","amr","mp2","flac","vorbis","ac3"],video:["mp4","rm","rmvb","wmv","avi","mpg","mpeg"]},m.filterFiles=function(e,t){var n,r,s="file"===(t=t.toLowerCase()),i=[];return[].forEach.call(e,function(e){s?i.push(e):(n=e.name.slice(e.name.lastIndexOf(".")+1),(r=e.type.split("/"))[0]&&r[1]&&(r[0].toLowerCase()!==t&&-1===m.validFileExts[t].indexOf(n)||i.push(e)))}),i};var p,f,g=m.supportFormData=m.notundef(r.FormData);m.getFileName=function(e){return e=m.verifyFileInput(e),g?e.files[0].name:e.value.slice(e.value.lastIndexOf("\\")+1)},m.getFileInfo=(p={ppt:1,pptx:2,pdf:3},function(e){var t={};return(e=m.verifyFileInput(e)).files&&(e=e.files[0],g)&&(t.name=e.name,t.size=e.size,t.type=e.name.match(/\.(\w+)$/),t.type=t.type&&t.type[1].toLowerCase(),t.transcodeType=p[t.type]||0),t}),m.sizeText=(f=["B","KB","MB","GB","TB","PB","EB","ZB","BB"],function(e){for(var t,n=0;t=(e=Math.floor(100*e)/100)+f[n],n++,1<(e/=1024););return t}),m.promises2cmds=function(e){return e.map(function(e){return e.cmd})},m.objs2accounts=function(e){return e.map(function(e){return e.account})},m.teams2ids=function(e){return e.map(function(e){return e.teamId})},m.objs2ids=function(e){return e.map(function(e){return e.id})},m.getMaxUpdateTime=function(e){e=e.map(function(e){return+e.updateTime});return Math.max.apply(Math,e)},m.genCheckUniqueFunc=function(n,e){return n=n||"id",function(e){this.uniqueSet=this.uniqueSet||{},this.uniqueSet[n]=this.uniqueSet[n]||{};var t=this.uniqueSet[n],e=e[n];return!t[e]&&(t[e]=!0)}},m.fillPropertyWithDefault=function(e,t,n){return!!m.undef(e[t])&&(e[t]=n,!0)},e.exports=m},,,,,function(e,t,n){"use strict";var s={info:{hash:"'e7b4b6715f0b7c292ab44d9e86d4f7c447e20434",shortHash:"e7b4b671'",version:"6.8.0",sdkVersion:"70",nrtcVersion:"4.8.0",nrtcSdkVersion:"1",protocolVersion:1},agentVersion:"2.8.0.906",lbsUrl:"https://lbs.netease.im/lbs/webconf.jsp",roomserver:"roomserver.netease.im",connectTimeout:8e3,xhrTimeout:8e3,socketTimeout:8e3,reconnectionDelay:1600,reconnectionDelayMax:8e3,reconnectionJitter:.01,reconnectiontimer:null,heartbeatInterval:8e3,cmdTimeout:8e3,defaultReportUrl:"https://dr.netease.im/1.gif",isWeixinApp:!1,isNodejs:!1,isRN:!1,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,PushPermissionAsked:!1,iosPushConfig:null,androidPushConfig:null,netDetectAddr:"https://roomserver-dev.netease.im/v1/sdk/detect/local",optionDefaultLinkUrl:"",defaultLinkUrl:"weblink.netease.im",wxDefaultLinkUrl:"wlnimsc0.netease.im",getDefaultLinkUrl:function(e){var t,n,r=s.optionDefaultLinkUrl||(s.isWeixinApp?s.wxDefaultLinkUrl:s.defaultLinkUrl);return!!r&&(t=e?"https":"http",e=e?"443":"80",-1===(n=r).indexOf("http")&&(n=t+"://"+n),-1===r.indexOf(":")?n+":"+e:n)}};s.weixinNetcall=s.nrtcNetcall={checkSumUrl:"https://nrtc.netease.im/demo/getChecksum.action",getChannelInfoUrl:"https://nrtc.netease.im/nrtc/getChannelInfos.action"},s.formatSocketUrl=function(e){var t=e.url,e=e.secure?"https":"http";return-1===t.indexOf("http")?e+"://"+t:t},s.uploadUrl="https://nos.netease.com",s.chunkUploadUrl=null,s.commonMaxSize=104857600,s.chunkSize=4194304,s.chunkMaxSize=4194304e4,s.replaceUrl="https://{bucket}-nosdn.netease.im/{object}",s.downloadHost="nos.netease.com",s.downloadUrl="https://{bucket}-nosdn.netease.im/{object}",s.httpsEnabled=!1,s.threshold=0,s.genUploadUrl=function(e){return s.uploadUrl+"/"+e},s.genChunkUploadUrl=function(e){return s.chunkUploadUrl?s.chunkUploadUrl+"/"+e.bucket+"/"+e.objectName:""},s.genDownloadUrl=function(e,t){var n=e.bucket,e=(e.tag,e.expireSec),r=+new Date,r=s.replaceUrl+"?createTime="+r+(e?"&survivalTime="+e:"");return(r=s.genNosProtocolUrl(r)).replace("{bucket}",n).replace("{object}",t)},s.genFileUrl=function(e){var t=e.bucket,e=e.objectName;return s.genNosProtocolUrl(s.replaceUrl).replace("{bucket}",t).replace("{object}",e)},s.genNosProtocolUrl=function(e){return/^http/.test(e)?s.httpsEnabled&&0!==e.indexOf("https://")&&(e=e.replace("http","https")):e=s.httpsEnabled?"https://"+e:"http://"+e,e},e.exports=s},function(e,t){e=e.exports={version:"2.5.5"};"number"==typeof __e&&(__e=e)},function(e,t,n){var r=n(45)("wks"),s=n(31),i=n(8).Symbol,o="function"==typeof i;(e.exports=function(e){return r[e]||(r[e]=o&&i[e]||(o?i:s)("Symbol."+e))}).store=r},function(e,t){e=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(e,t,n){"use strict";t.__esModule=!0;var r=o(n(110)),s=o(n(100)),i="function"==typeof s.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof s.default&&"symbol"===i(r.default)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":void 0===e?"undefined":i(e)}},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,p="~";function c(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){this._events=new c,this._eventsCount=0}Object.create&&(c.prototype=Object.create(null),(new c).__proto__||(p=!1)),i.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(p?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},i.prototype.listeners=function(e,t){var e=p?p+e:e,n=this._events[e];if(t)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,i=new Array(s);r<s;r++)i[r]=n[r].fn;return i},i.prototype.emit=function(e,t,n,r,s,i){var o=p?p+e:e;if(!this._events[o])return!1;var a,c=this._events[o],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,s),!0;case 6:return c.fn.call(c.context,t,n,r,s,i),!0}for(d=1,a=new Array(u-1);d<u;d++)a[d-1]=arguments[d];c.fn.apply(c.context,a)}else for(var l,m=c.length,d=0;d<m;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),u){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,n);break;case 4:c[d].fn.call(c[d].context,t,n,r);break;default:if(!a)for(l=1,a=new Array(u-1);l<u;l++)a[l-1]=arguments[l];c[d].fn.apply(c[d].context,a)}return!0},i.prototype.on=function(e,t,n){t=new s(t,n||this),n=p?p+e:e;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],t]:this._events[n].push(t):(this._events[n]=t,this._eventsCount++),this},i.prototype.once=function(e,t,n){t=new s(t,n||this,!0),n=p?p+e:e;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],t]:this._events[n].push(t):(this._events[n]=t,this._eventsCount++),this},i.prototype.removeListener=function(e,t,n,r){e=p?p+e:e;if(this._events[e])if(t){var s=this._events[e];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||(0==--this._eventsCount?this._events=new c:delete this._events[e]);else{for(var i=0,o=[],a=s.length;i<a;i++)(s[i].fn!==t||r&&!s[i].once||n&&s[i].context!==n)&&o.push(s[i]);o.length?this._events[e]=1===o.length?o[0]:o:0==--this._eventsCount?this._events=new c:delete this._events[e]}}else 0==--this._eventsCount?this._events=new c:delete this._events[e];return this},i.prototype.removeAllListeners=function(e){return e?(e=p?p+e:e,this._events[e]&&(0==--this._eventsCount?this._events=new c:delete this._events[e])):(this._events=new c,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=p,e.exports=i.EventEmitter=i},function(e,t,n){var r=n(14),s=n(66),i=n(47),o=Object.defineProperty;t.f=n(17)?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),s)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},,function(e,N,F){"use strict";!function(e){Object.defineProperty(N,"__esModule",{value:!0}),N.url2origin=N.uniqueID=N.off=N.removeEventListener=N.on=N.addEventListener=N.format=N.regWhiteSpace=N.regBlank=N.emptyFunc=N.f=N.emptyObj=N.o=void 0;var n,r,t=F(9),s=t&&t.__esModule?t:{default:t};function i(){return"undefined"!=typeof window?window:void 0!==e?e:{}}function o(e,t){t=t||2;for(var n=""+e;n.length<t;)n="0"+n;return n}function a(e){return""+e.getFullYear()}function c(e){return o(e.getMonth()+1)}function u(e){return o(e.getDate())}function l(e){return o(e.getHours())}function m(e){return o(e.getMinutes())}function d(e){return o(e.getSeconds())}function p(e){return o(e.getMilliseconds(),3)}function f(e){return Object.prototype.toString.call(e).slice(8,-1)}function g(e){return f(e).toLowerCase()}function h(e){return"string"===g(e)}function y(e){return"array"===g(e)}function v(e){return"function"===g(e)}function b(e){return"date"===g(e)}function T(e){return null===e}function M(e){return null!==e}function S(e){return void 0===e}function k(e){return void 0!==e}function x(e){return k(e)&&M(e)}function C(e){return S(e)||T(e)}function I(e){return x(e)&&"object"===g(e)}N.getGlobal=i,N.detectCSSFeature=function(e){var t=!1,n="Webkit Moz ms O".split(" ");if("undefined"!=typeof document){var r=document.createElement("div");if(e=e.toLowerCase(),!1===(t=void 0!==r.style[e]?!0:t))for(var s=e.charAt(0).toUpperCase()+e.substr(1),i=0;i<n.length;i++)if(void 0!==r.style[n[i]+s]){t=!0;break}return t}},N.fix=o,N.getYearStr=a,N.getMonthStr=c,N.getDayStr=u,N.getHourStr=l,N.getMinuteStr=m,N.getSecondStr=d,N.getMillisecondStr=p,N.dateFromDateTimeLocal=function(e){return e=""+e,new Date(e.replace(/-/g,"/").replace("T"," "))},N.getClass=f,N.typeOf=g,N.isString=h,N.isNumber=function(e){return"number"===g(e)},N.isBoolean=function(e){return"boolean"===g(e)},N.isArray=y,N.isFunction=v,N.isDate=b,N.isRegExp=function(e){return"regexp"===g(e)},N.isError=function(e){return"error"===g(e)},N.isnull=T,N.notnull=M,N.undef=S,N.notundef=k,N.exist=x,N.notexist=C,N.isObject=I,N.isEmpty=function(e){return C(e)||(h(e)||y(e))&&0===e.length},N.containsNode=function(e,t){if(e===t)return!0;for(;t.parentNode;){if(t.parentNode===e)return!0;t=t.parentNode}return!1},N.calcHeight=function(e){var t=e.parentNode||("undefined"==typeof document?null:document.body);if(!t)return 0;(e=e.cloneNode(!0)).style.display="block",e.style.opacity=0,e.style.height="auto",t.appendChild(e);var n=e.offsetHeight;return t.removeChild(e),n},N.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},N.dataset=function(e,t,n){if(!x(n))return e.getAttribute("data-"+t);e.setAttribute("data-"+t,n)},N.target=function(e){return e.target||e.srcElement},N.createIframe=function(n){if("undefined"!=typeof document){var r;if((n=n||{}).name)try{(r=document.createElement('<iframe name="'+n.name+'"></iframe>')).frameBorder=0}catch(e){(r=document.createElement("iframe")).name=n.name}else r=document.createElement("iframe");n.visible||(r.style.display="none"),v(n.onload)&&O(r,"load",function e(t){r.src&&(n.multi||A(r,"load",e),n.onload(t))}),(n.parent||document.body).appendChild(r);var e=n.src||"about:blank";return setTimeout(function(){r.src=e},0),r}},N.html2node=function(e){if("undefined"!=typeof document){var t=document.createElement("div"),n=(t.innerHTML=e,[]),r=void 0,s=void 0;if(t.children)for(r=0,s=t.children.length;r<s;r++)n.push(t.children[r]);else for(r=0,s=t.childNodes.length;r<s;r++){var i=t.childNodes[r];1===i.nodeType&&n.push(i)}return 1<n.length?t:n[0]}},N.scrollTop=function(e){return"undefined"!=typeof document&&x(e)&&(document.documentElement.scrollTop=document.body.scrollTop=e),window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},N.forOwn=_,N.mixin=E,N.isJSON=R,N.parseJSON=function n(r){try{I(r=R(r)?JSON.parse(r):r)&&_(r,function(e,t){switch(g(t)){case"string":case"object":r[e]=n(t)}})}catch(n){}return r},N.simpleClone=function(e){var n=[],e=JSON.stringify(e,function(e,t){if("object"===(void 0===t?"undefined":(0,s.default)(t))&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t});return JSON.parse(e)},N.merge=function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.forEach(function(e){E(t,e)}),t},N.fillUndef=function(n,e){return _(e,function(e,t){S(n[e])&&(n[e]=t)}),n},N.checkWithDefault=function(e,t,n){var r=e[t]||e[t.toLowerCase()];return C(r)&&(e[t]=r=n),r},N.fetch=function(n,r){return _(n,function(e,t){x(r[e])&&(n[e]=r[e])}),n},N.string2object=function(){var n={};return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").split(1<arguments.length&&void 0!==arguments[1]?arguments[1]:",").forEach(function(e){var e=e.split("="),t=e.shift();t&&(n[decodeURIComponent(t)]=decodeURIComponent(e.join("=")))}),n},N.object2string=U,N.genUrlSep=function(e){return e.indexOf("?")<0?"?":"&"},N.object2query=function(e){return U(e,"&",!0)},N.isFileInput=j,N.getKeys=function(n,e){var t=Object.keys(n);return e&&t.sort(function(e,t){e=j(n[e]);return e===j(n[t])?0:e?1:-1}),t},N.o={},N.emptyObj={},N.f=function(){},N.emptyFunc=function(){},N.regBlank=/\s+/gi,N.regWhiteSpace=/\s+/gi,N.format=(n=/yyyy|MM|dd|hh|mm|ss|SSS/g,r={yyyy:a,MM:c,dd:u,hh:l,mm:m,ss:d,SSS:p},function(t,e){return t=new Date(t),isNaN(+t)?"invalid date":(e=e||"yyyy-MM-dd").replace(n,function(e){return r[e](t)})});var w,P,t=N.addEventListener=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},O=N.on=t,t=N.removeEventListener=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},A=N.off=t;function _(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments[2];for(e in t)t.hasOwnProperty(e)&&n.call(r,e,t[e])}function E(n,e){_(e,function(e,t){n[e]=t})}function R(e){return h(e)&&0===e.indexOf("{")&&e.lastIndexOf("}")===e.length-1}function U(e,t,n){var r;return e?(r=[],_(e,function(e,t){v(t)||(b(t)?t=t.getTime():y(t)?t=t.join(","):I(t)&&(t=JSON.stringify(t)),n&&(t=encodeURIComponent(t)),r.push(encodeURIComponent(e)+"="+t))}),r.join(t||",")):""}function j(e){var t=i();return e.tagName&&"INPUT"===e.tagName.toUpperCase()||t.Blob&&e instanceof t.Blob}N.uniqueID=(w=0,function(){return""+w++}),N.url2origin=(P=/^([\w]+?:\/\/.*?(?=\/|$))/i,function(e){return P.test(e||"")?RegExp.$1.toLowerCase():""})}.call(this,F(33))},function(e,t,n){var r=n(19);e.exports=function(e){if(r(e))return e;throw TypeError(e+" is not an object!")}},function(e,t,n){function g(e,t,n){var r,s,i,o=e&g.F,a=e&g.G,c=e&g.S,u=e&g.P,l=e&g.B,m=e&g.W,d=a?y:y[t]||(y[t]={}),p=d.prototype,f=a?h:c?h[t]:(h[t]||{}).prototype;for(r in n=a?t:n)(s=!o&&f&&void 0!==f[r])&&T(d,r)||(i=(s?f:n)[r],d[r]=a&&"function"!=typeof f[r]?n[r]:l&&s?v(i,h):m&&f[r]==i?function(r){function e(e,t,n){if(this instanceof r){switch(arguments.length){case 0:return new r;case 1:return new r(e);case 2:return new r(e,t)}return new r(e,t,n)}return r.apply(this,arguments)}return e.prototype=r.prototype,e}(i):u&&"function"==typeof i?v(Function.call,i):i,u&&((d.virtual||(d.virtual={}))[r]=i,e&g.R)&&p&&!p[r]&&b(p,r,i))}var h=n(8),y=n(6),v=n(35),b=n(20),T=n(16);g.F=1,g.G=2,g.S=4,g.P=8,g.B=16,g.W=32,g.U=64,g.R=128,e.exports=g},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){e.exports=!n(22)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(63),s=n(48);e.exports=function(e){return r(s(e))}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(11),s=n(27);e.exports=n(17)?function(e,t,n){return r.f(e,t,s(1,n))}:function(e,t,n){return e[t]=n,e}},function(s,e,i){"use strict";!function(e){var O,a,A,r,_,t=i(9),E=t&&t.__esModule?t:{default:t},e=(O="object"===(void 0===e?"undefined":(0,E.default)(e))?e:window,a=Math.pow(2,53)-1,A=/\bOpera/,t=Object.prototype,r=t.hasOwnProperty,_=t.toString,function e(i){var t=O,n=i&&"object"===(void 0===i?"undefined":(0,E.default)(i))&&"String"!=j(i),r=(n&&(t=i,i=null),t.navigator||{}),s=r.userAgent||"";i=i||s;var o,a,c,u=n?!!r.likeChrome:/\bChrome\b/.test(i)&&!/internal|\n/i.test(_.toString()),l=n?"Object":"ScriptBridgingProxyObject",m=n?"Object":"Environment",d=n&&t.java?"JavaPackage":j(t.java),p=n?"Object":"RuntimeObject",d=/\bJava/.test(d)&&t.java,m=d&&j(t.environment)==m,f=d?"a":"α",g=d?"b":"β",h=t.document||{},y=t.operamini||t.opera,n=A.test(n=n&&y?y["[[Class]]"]:j(y))?n:y=null,v=i,b=[],T=null,s=i==s,M=s&&y&&"function"==typeof y.version&&y.version(),S=F([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,t){return e||RegExp("\\b"+(t.pattern||N(t))+"\\b","i").exec(i)&&(t.label||t)}),k=F(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],function(e,t){return e||RegExp("\\b"+(t.pattern||N(t))+"\\b","i").exec(i)&&(t.label||t)}),x=w([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),C=F({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},function(e,t,n){return e||(t[x]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(x)]||RegExp("\\b"+N(n)+"(?:\\b|\\w*\\d)","i").exec(i))&&n}),I=F(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],function(e,t){var n,r,s=t.pattern||N(t);return!e&&(e=RegExp("\\b"+s+"(?:/[\\d.]+|[ \\w.]*)","i").exec(i))&&(n=e,s=s,t=t.label||t,r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},s&&t&&/^Win/i.test(n)&&!/^Windows Phone /i.test(n)&&(r=r[/[\d.]+$/.exec(n)])&&(n="Windows "+r),n=String(n),e=R((n=s&&t?n.replace(RegExp(s,"i"),t):n).replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])),e});function w(e){return F(e,function(e,t){var n=t.pattern||N(t);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(i)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(i)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(i))&&((e=String(t.label&&!RegExp(n,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=R(e[0].replace(RegExp(n,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e})}if(S=S&&[S],C&&!x&&(x=w([C])),(o=/\bGoogle TV\b/.exec(x))&&(x=o[0]),/\bSimulator\b/i.test(i)&&(x=(x?x+" ":"")+"Simulator"),"Opera Mini"==k&&/\bOPiOS\b/.test(i)&&b.push("running in Turbo/Uncompressed mode"),"IE"==k&&/\blike iPhone OS\b/.test(i)?(C=(o=e(i.replace(/like iPhone OS/,""))).manufacturer,x=o.product):/^iP/.test(x)?(k=k||"Safari",I="iOS"+((o=/ OS ([\d_]+)/i.exec(i))?" "+o[1].replace(/_/g,"."):"")):"Konqueror"!=k||/buntu/i.test(I)?C&&"Google"!=C&&(/Chrome/.test(k)&&!/\bMobile Safari\b/i.test(i)||/\bVita\b/.test(x))||/\bAndroid\b/.test(I)&&/^Chrome/.test(k)&&/\bVersion\//i.test(i)?(k="Android Browser",I=/\bAndroid\b/.test(I)?I:"Android"):"Silk"==k?(/\bMobi/i.test(i)||(I="Android",b.unshift("desktop mode")),/Accelerated *= *true/i.test(i)&&b.unshift("accelerated")):"PaleMoon"==k&&(o=/\bFirefox\/([\d.]+)\b/.exec(i))?b.push("identifying as Firefox "+o[1]):"Firefox"==k&&(o=/\b(Mobile|Tablet|TV)\b/i.exec(i))?(I=I||"Firefox OS",x=x||o[1]):!k||(o=!/\bMinefield\b/i.test(i)&&/\b(?:Firefox|Safari)\b/.exec(k))?(k&&!x&&/[\/,]|^[^(]+?\)/.test(i.slice(i.indexOf(o+"/")+8))&&(k=null),(o=x||C||I)&&(x||C||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(I))&&(k=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(I)?I:o)+" Browser")):"Electron"==k&&(o=(/\bChrome\/([\d.]+)\b/.exec(i)||0)[1])&&b.push("Chromium "+o):I="Kubuntu",M=M||F(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",N(k),"(?:Firefox|Minefield|NetFront)"],function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(i)||0)[1]||null}),(o=("iCab"==S&&3<parseFloat(M)?"WebKit":/\bOpera\b/.test(k)&&(/\bOPR\b/.test(i)?"Blink":"Presto"))||(/\b(?:Midori|Nook|Safari)\b/i.test(i)&&!/^(?:Trident|EdgeHTML)$/.test(S)?"WebKit":!S&&/\bMSIE\b/i.test(i)&&("Mac OS"==I?"Tasman":"Trident"))||"WebKit"==S&&/\bPlayStation\b(?! Vita\b)/i.test(k)&&"NetFront")&&(S=[o]),"IE"==k&&(o=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(i)||0)[1])?(k+=" Mobile",I="Windows Phone "+(/\+$/.test(o)?o:o+".x"),b.unshift("desktop mode")):/\bWPDesktop\b/i.test(i)?(k="IE Mobile",I="Windows Phone 8.x",b.unshift("desktop mode"),M=M||(/\brv:([\d.]+)/.exec(i)||0)[1]):"IE"!=k&&"Trident"==S&&(o=/\brv:([\d.]+)/.exec(i))&&(k&&b.push("identifying as "+k+(M?" "+M:"")),k="IE",M=o[1]),s){if(P=null!=(c=t)?(0,E.default)(c.global):"number",/^(?:boolean|number|string|undefined)$/.test(P)||"object"==P&&!c.global)j(o=t.runtime)==l?(k="Adobe AIR",I=o.flash.system.Capabilities.os):j(o=t.phantom)==p?(k="PhantomJS",M=(o=o.version||null)&&o.major+"."+o.minor+"."+o.patch):"number"==typeof h.documentMode&&(o=/\bTrident\/(\d+)/i.exec(i))?(M=[M,h.documentMode],(o=+o[1]+4)!=M[1]&&(b.push("IE "+M[1]+" mode"),S&&(S[1]=""),M[1]=o),M="IE"==k?String(M[1].toFixed(1)):M[0]):"number"==typeof h.documentMode&&/^(?:Chrome|Firefox)\b/.test(k)&&(b.push("masking as "+k+" "+M),k="IE",M="11.0",S=["Trident"],I="Windows");else if(d&&(v=(o=d.lang.System).getProperty("os.arch"),I=I||o.getProperty("os.name")+" "+o.getProperty("os.version")),m){try{M=t.require("ringo/engine").version.join("."),k="RingoJS"}catch(e){(o=t.system)&&o.global.system==t.system&&(k="Narwhal",I=I||o[0].os||null)}k=k||"Rhino"}else"object"===(0,E.default)(t.process)&&!t.process.browser&&(o=t.process)&&("object"===(0,E.default)(o.versions)&&("string"==typeof o.versions.electron?(b.push("Node "+o.versions.node),k="Electron",M=o.versions.electron):"string"==typeof o.versions.nw&&(b.push("Chromium "+M,"Node "+o.versions.node),k="NW.js",M=o.versions.nw)),k||(k="Node.js",v=o.arch,I=o.platform,M=(M=/[\d.]+/.exec(o.version))?M[0]:null));I=I&&R(I)}if(M&&(o=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(M)||/(?:alpha|beta)(?: ?\d)?/i.exec(i+";"+(s&&r.appMinorVersion))||/\bMinefield\b/i.test(i)&&"a")&&(T=/b/i.test(o)?"beta":"alpha",M=M.replace(RegExp(o+"\\+?$"),"")+("beta"==T?g:f)+(/\d+\+?/.exec(o)||"")),"Fennec"==k||"Firefox"==k&&/\b(?:Android|Firefox OS)\b/.test(I))k="Firefox Mobile";else if("Maxthon"==k&&M)M=M.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(x))"Xbox 360"==x&&(I=null),"Xbox 360"==x&&/\bIEMobile\b/.test(i)&&b.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(k)&&(!k||x||/Browser|Mobi/.test(k))||"Windows CE"!=I&&!/Mobi/i.test(i))if("IE"==k&&s)try{null===t.external&&b.unshift("platform preview")}catch(e){b.unshift("embedded")}else(/\bBlackBerry\b/.test(x)||/\bBB10\b/.test(i))&&(o=(RegExp(x.replace(/ +/g," *")+"/([.\\d]+)","i").exec(i)||0)[1]||M)?(I=((o=[o,/BB10/.test(i)])[1]?(x=null,C="BlackBerry"):"Device Software")+" "+o[0],M=null):this!=U&&"Wii"!=x&&(s&&y||/Opera/.test(k)&&/\b(?:MSIE|Firefox)\b/i.test(i)||"Firefox"==k&&/\bOS X (?:\d+\.){2,}/.test(I)||"IE"==k&&(I&&!/^Win/.test(I)&&5.5<M||/\bWindows XP\b/.test(I)&&8<M||8==M&&!/\bTrident\b/.test(i)))&&!A.test(o=e.call(U,i.replace(A,"")+";"))&&o.name&&(o="ing as "+o.name+((o=o.version)?" "+o:""),A.test(k)?(/\bIE\b/.test(o)&&"Mac OS"==I&&(I=null),o="identify"+o):(o="mask"+o,k=n?R(n.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(o)&&(I=null),s||(M=null)),S=["Presto"],b.push(o));else k+=" Mobile";(o=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(i)||0)[1])&&(o=[parseFloat(o.replace(/\.(\d)$/,".0$1")),o],"Safari"==k&&"+"==o[1].slice(-1)?(k="WebKit Nightly",T="alpha",M=o[1].slice(0,-1)):M!=o[1]&&M!=(o[2]=(/\bSafari\/([\d.]+\+?)/i.exec(i)||0)[1])||(M=null),o[1]=(/\bChrome\/([\d.]+)/i.exec(i)||0)[1],537.36==o[0]&&537.36==o[2]&&28<=parseFloat(o[1])&&"WebKit"==S&&(S=["Blink"]),o=s&&(u||o[1])?(S&&(S[1]="like Chrome"),o[1]||((o=o[0])<530?1:o<532?2:o<532.05?3:o<533?4:o<534.03?5:o<534.07?6:o<534.1?7:o<534.13?8:o<534.16?9:o<534.24?10:o<534.3?11:o<535.01?12:o<535.02?"13+":o<535.07?15:o<535.11?16:o<535.19?17:o<536.05?18:o<536.1?19:o<537.01?20:o<537.11?"21+":o<537.13?23:o<537.18?24:o<537.24?25:o<537.36?26:"Blink"!=S?"27":"28")):(S&&(S[1]="like Safari"),(o=o[0])<400?1:o<500?2:o<526?3:o<533?4:o<534?"4+":o<535?5:o<537?6:o<538?7:o<601?8:"8"),S&&(S[1]+=" "+(o+="number"==typeof o?".x":/[.+]/.test(o)?"":"+")),"Safari"==k)&&(!M||45<parseInt(M))&&(M=o),"Opera"==k&&(o=/\bzbov|zvav$/.exec(I))?(k+=" ",b.unshift("desktop mode"),"zvav"==o?(k+="Mini",M=null):k+="Mobile",I=I.replace(RegExp(" *"+o+"$"),"")):"Safari"==k&&/\bChrome\b/.exec(S&&S[1])&&(b.unshift("desktop mode"),k="Chrome Mobile",M=null,I=/\bOS X\b/.test(I)?(C="Apple","iOS 4.3+"):null),M&&0==M.indexOf(o=/[\d.]+$/.exec(I))&&-1<i.indexOf("/"+o+"-")&&(I=L(I.replace(o,""))),S&&!/\b(?:Avant|Nook)\b/.test(k)&&(/Browser|Lunascape|Maxthon/.test(k)||"Safari"!=k&&/^iOS/.test(I)&&/\bSafari\b/.test(S[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(k)&&S[1])&&(o=S[S.length-1])&&b.push(o),b.length&&(b=["("+b.join("; ")+")"]),C&&x&&x.indexOf(C)<0&&b.push("on "+C),x&&b.push((/^on /.test(b[b.length-1])?"":"on ")+x),I&&(o=/ ([\d.+]+)$/.exec(I),a=o&&"/"==I.charAt(I.length-o[0].length-1),I={architecture:32,family:o&&!a?I.replace(o[0],""):I,version:o?o[1]:null,toString:function(){var e=this.version;return this.family+(e&&!a?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(o=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(v))&&!/\bi686\b/i.test(v)?(I&&(I.architecture=64,I.family=I.family.replace(RegExp(" *"+o),"")),k&&(/\bWOW64\b/i.test(i)||s&&/\w(?:86|32)$/.test(r.cpuClass||r.platform)&&!/\bWin64; x64\b/i.test(i))&&b.unshift("32-bit")):I&&/^OS X/.test(I.family)&&"Chrome"==k&&39<=parseFloat(M)&&(I.architecture=64),i=i||null;var P={};return P.description=i,P.layout=S&&S[0],P.manufacturer=C,P.name=k,P.prerelease=T,P.product=x,P.ua=i,P.version=k&&M,P.os=I||{architecture:null,family:null,version:null,toString:function(){return"null"}},P.parse=e,P.toString=function(){return this.description||""},P.version&&b.unshift(M),P.name&&b.unshift(k),I&&k&&(I!=String(I).split(" ")[0]||I!=k.split(" ")[0]&&!x)&&b.push(x?"("+I+")":"on "+I),b.length&&(P.description=b.join(" ")),P}());function n(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function R(e){return e=L(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:n(e)}function U(e,t){for(var n in e)r.call(e,n)&&t(e[n],n,e)}function j(e){return null==e?n(e):_.call(e).slice(8,-1)}function N(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function F(n,r){function e(e,t){s=r(s,e,t,n)}var s=null,t=n,i=-1,o=t?t.length:0;if("number"==typeof o&&-1<o&&o<=a)for(;++i<o;)e(t[i],i);else U(t,e);return s}function L(e){return String(e).replace(/^ +| +$/g,"")}s.exports=e}.call(this,i(33))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports={}},,function(e,t,n){"use strict";var r=n(52),s=n(58),i=(n(26),n(5)),o=n(0),a=o.undef,c=n(187),u=n(84),l=n(124);function m(e){o.verifyOptions(e,"appKey account token","protocol::IMProtocol"),o.verifyCallback(e,["onconnect","onerror","onwillreconnect","ondisconnect","onloginportschange","onmyinfo","onblacklist","onmutelist","onfriends","onusers","onrobots","onteams","onSuperTeams","onsessions","onroamingmsgs","onofflinemsgs","onofflinefiltermsgs","onroamingsysmsgs","onofflinesysmsgs","onofflinefiltersysmsgs","onofflinecustomsysmsgs","onofflinefiltercustomsysmsgs","onbroadcastmsg","onbroadcastmsgs","onsysmsgunread","onsyncdone","onteammembers","onsyncteammembersdone","onmsg","onsysmsg","oncustomsysmsg","onupdatemyinfo","onupdateuser","onUpdateSuperTeamMember","onCreateSuperTeam","onUpdateSuperTeam","onAddSuperTeamMembers","onRemoveSuperTeamMembers","onUpdateSuperTeamManagers","onDismissSuperTeam","onTransferSuperTeam","onUpdateSuperTeamManagers","onUpdateSuperTeamMembersMute","onupdateteammember","onCreateTeam","onUpdateTeam","onAddTeamMembers","onRemoveTeamMembers","onUpdateTeamManagers","onDismissTeam","onTransferTeam","onUpdateTeamMembersMute","onTeamMsgReceipt","onupdatesession","onupdatesysmsgunread","onupdatesysmsg","onsynccreateteam","onsyncsupercreateteam","onsyncmarkinblacklist","onsyncmarkinmutelist","onsyncfriendaction","shouldIgnoreNotification","shouldCountNotifyUnread","onPushNotificationMultiportConfig","onPushNotificationMultiportConfigUpdate","onpushevents"],"protocol::IMProtocol"),this.db=e.api.db=new r({logger:e.logger}),s.call(this,e)}var d=s.fn,p=m.fn=m.prototype=Object.create(d);p.init=function(){d.init.call(this),u.IM.setProtocol(this),this.parser=u.IM,this.sendCmd.bind(this),this.socketUrls=[],this.syncing=!0,this.hasSynced=!1,this.hasSyncedTeamMembers=!1,this.syncPromiseArray=[],this.syncResult={},this.syncTeamMembersPromiseArray=[],this.syncSuperTeamMembersPromiseArray=[],this.syncTeamMembersResult={},this.timetags={},this.superTeamMembersData={},this.sysMsgUnread=l.completeUnread({}),this.resetUnsettledMsgs(),this.resetUnsettledSysMsgs(),this.msgPromise=Promise.resolve(),this.sysMsgPromise=Promise.resolve(),this.sessionSet={},this.msgReceiptTasks={},this.userSet={},this.pushNotificationMultiportConfig=c.getDefaultConfig()},p.reset=function(){d.reset.call(this);var e=this.options;this.db.reset(e.db),a(e.lbsUrl)&&(e.lbsUrl=i.lbsUrl),this.resetAutoMarkRead()},p.resetAutoMarkRead=function(){var e=this.options;o.verifyBooleanWithDefault(e,"autoMarkRead",!0,"","protocol::resetAutoMarkRead")},p.resetUnsettledMsgs=function(){this.unhandledMsgs=[],this.unupdatedMsgs=[]},p.resetUnsettledSysMsgs=function(){this.unhandledSysMsgs=[],this.unupdatedSysMsgs=[]},p.packetFromSync=function(e){return!e.obj||!!e.obj.sync},e.exports=m,n(451),n(450),n(449),n(448),n(446),n(445),n(444),n(443),n(442),n(441),n(440),n(439),n(438),n(437),n(436),n(435),n(434),n(433)},function(e,t,n){"use strict";var n=n(9),r=n&&n.__esModule?n:{default:n};function s(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.message=e||n.message||"","object"===(void 0===t?"undefined":(0,r.default)(t))?(this.event=t,this.code="Other_Error"):void 0!==t&&(this.code=t),this.timetag=+new Date,void 0!==n&&(this.event=n),this.event&&(this.callFunc=this.event.callFunc||null,delete this.event.callFunc)}(s.prototype=Object.create(Error.prototype)).name="NIMError";var i={201:"客户端版本不对, 需升级sdk",302:"用户名或密码错误, 请检查appKey和token是否有效, account和token是否匹配",403:"非法操作或没有权限",404:"对象(用户/群/聊天室)不存在",405:"参数长度过长",408:"客户端请求超时",414:"参数错误",415:"服务不可用/没有聊天室服务器可分配",416:"频率控制",417:"重复操作",422:"帐号被禁用",500:"服务器内部错误",501:"数据库操作失败",503:"服务器繁忙",508:"删除有效期过了",509:"已失效",7101:"被拉黑",801:"群人数达到上限",802:"没有权限",803:"群不存在或未发生变化",804:"用户不在群里面",805:"群类型不匹配",806:"创建群数量达到限制",807:"群成员状态不对",809:"已经在群里",811:"强推列表中帐号数量超限",812:"群被禁言",813:"因群数量限制，部分拉人成功",814:"禁止使用群组消息已读服务",815:"群管理员人数上限",997:"协议已失效",998:"解包错误",999:"打包错误",9102:"通道失效",9103:"已经在其他端接听/拒绝过这通电话",11001:"对方离线, 通话不可送达",13002:"聊天室状态异常",13003:"在黑名单中",13004:"在禁言名单中",13006:"聊天室处于整体禁言状态,只有管理员能发言",Connect_Failed:"无法建立连接, 请确保能 ping/telnet 到云信服务器; 如果是IE8/9, 请确保项目部署在 HTTPS 环境下",Error_Internet_Disconnected:"网断了",Error_Connection_is_not_Established:"连接未建立",Error_Connection_Socket_State_not_Match:"socket状态不对",Error_Timeout:"超时",Param_Error:"参数错误",No_File_Selected:"请选择文件",Wrong_File_Type:"文件类型错误",File_Too_Large:"文件过大",Cross_Origin_Iframe:"不能获取跨域Iframe的内容",Not_Support:"不支持",NO_DB:"无数据库",DB:"数据库错误",Still_In_Team:"还在群里",Session_Exist:"会话已存在",Session_Not_Exist:"会话不存在",Error_Unknown:"未知错误",Operation_Canceled:"操作取消"};[200,406,808,810].forEach(function(e){i[e]=null}),s.genError=function(e){var t=i[e];return null===(t=void 0===t?"操作失败":t)?null:new s(t,e)},s.multiInstance=function(e){return new s("不允许初始化多个实例","Not_Allow_Multi_Instance",e)},s.newNetworkError=function(e){var t="Error_Internet_Disconnected";return new s(i[t],t,e)},s.newConnectError=function(e){var t="Connect_Failed";return new s(i[t]||null,t,e)},s.newConnectionError=function(e){var t="Error_Connection_is_not_Established";return new s(i[t],t,e)},s.newSocketStateError=function(e){var t="Error_Connection_Socket_State_not_Match";return new s(i[t],t,e)},s.newTimeoutError=function(e){var t="Error_Timeout";return new s(i[t],t,e)},s.newFrequencyControlError=function(e){e=new s(i[416],416,e);return e.from="local",e},s.newParamError=function(e,t){return new s(e||i.Param_Error,"Param_Error",t)},s.newNoFileError=function(e,t){var n="No_File_Selected";return new s(e||i[n],n,t)},s.newWrongFileTypeError=function(e,t){var n="Wrong_File_Type";return new s(e||i[n],n,t)},s.newFileTooLargeError=function(e,t){var n="File_Too_Large";return new s(e||i[n],n,t)},s.newCORSIframeError=function(e){var t="Cross_Origin_Iframe";return new s(i[t],t,e)},s.newSupportError=function(e,t,n){return new s("不支持"+e,"Not_Support_"+t,n)},s.newSupportDBError=function(e){return s.newSupportError("数据库","DB",e)},s.noDBError=function(e){return new s(i.NO_DB,"NO_DB",e)},s.newDBError=function(e){return new s(i.DB,"DB",e)},s.newUnknownError=function(e){var t="Error_Unknown";return new s(i[t],t,e)},s.stillInTeamError=function(e){var t="Still_In_Team";return new s(i[t],t,e)},s.sessionExist=function(e){var t="Session_Exist";return new s(i[t],t,e)},s.sessionNotExist=function(e){var t="Session_Not_Exist";return new s(i[t],t,e)},s.cancel=function(e){var t="Operation_Canceled";return new s(i[t],t,e)},s.customError=function(e,t){e=e||"Other_Error";var n="";return(t=t||{}).message||(n=i[e]||e),"object"!==(void 0===e?"undefined":(0,r.default)(e))?new s(n,e,t):new s(n,"Other_Error",void 0===t?e:t)},e.exports=s},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},,function(e,t,n){"use strict";var r=n(50),s=n(25),i=n(5),o=n(432),a=n(84).IM;function c(e){return this.subType="im",this.nosScene=e.nosScene||"im",this.nosSurvivalTime=e.nosSurvivalTime,e.Protocol=s,e.Message=o,e.constructor=c,this.init(e)}c.Protocol=s,c.parser=a,c.use=r.use,c.getInstance=r.getInstance,c.rmAllInstances=r.rmAllInstances,c.genInstanceName=function(e){return"NIM-account-"+e.account};a=c.fn=c.prototype=Object.create(r.prototype);c.info=a.info=i.info,e.exports=c,n(422),n(421),n(420),n(419),n(418),n(417),n(416),n(415),n(414),n(413),n(412),n(411),n(410),n(409),n(408),n(407),n(406),n(405)},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t,n){var r=n(64),s=n(44);e.exports=Object.keys||function(e){return r(e,s)}},function(e,t){var n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var i=n(57);e.exports=function(r,s,e){if(i(r),void 0===s)return r;switch(e){case 1:return function(e){return r.call(s,e)};case 2:return function(e,t){return r.call(s,e,t)};case 3:return function(e,t,n){return r.call(s,e,t,n)}}return function(){return r.apply(s,arguments)}}},function(e,t,n){"use strict";var r=n(108)(!0);n(67)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e=this._t,t=this._i;return t>=e.length?{value:void 0,done:!0}:(e=r(e,t),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(11).f,s=n(16),i=n(7)("toStringTag");e.exports=function(e,t,n){e&&!s(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t){e.exports=!0},function(e,t,n){"use strict";var r=n(53),s=n(149),i=n(148),n=n(147);r.json=s,r.upload=i,r.chunkUpload=n,e.exports=r},function(e,t,n){var r=n(48);e.exports=function(e){return Object(r(e))}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(8),s=n(6),i=n(38),o=n(43),a=n(11).f;e.exports=function(e){var t=s.Symbol||(s.Symbol=!i&&r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:o.f(e)})}},function(e,t,n){t.f=n(7)},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var n=n(8),r=n["__core-js_shared__"]||(n["__core-js_shared__"]={});e.exports=function(e){return r[e]||(r[e]={})}},function(e,t,n){var r=n(45)("keys"),s=n(31);e.exports=function(e){return r[e]||(r[e]=s(e))}},function(e,t,n){var s=n(19);e.exports=function(e,t){if(!s(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!s(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!s(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!s(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?r:n)(e)}},function(e,t,n){"use strict";var r=n(9),s=r&&r.__esModule?r:{default:r},r=n(10),l=n(0),m=l.notundef,i=n(320),o=n(5);function a(){}var c={},r=(a.getInstance=function(e){e=u(e),l.verifyOptions(e,"account","api::Base.getInstance");var t=this.genInstanceName(e),n=c[t];return n?a.updateInstance(n,e):n=c[t]=new this(e),n},a.updateInstance=function(e,t){e.setOptions(t),e.connect()},a.fn=a.prototype=Object.create(new r)),u=function(e){return e.nosSurvivalTime?(l.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance"),l.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")):e.nosSurvivalTime=1/0,e},d=(r.updatePrivateConf=function(e){var t;return e&&"object"===(0,s.default)(e.privateConf)&&("string"==typeof(t=e.privateConf).lbs_web&&(e.lbsUrl=t.lbs_web),"boolean"==typeof t.link_ssl_web&&(e.secure=t.link_ssl_web),"boolean"==typeof t.https_enabled&&(e.httpsEnabled=t.https_enabled),e.uploadUrl=t.nos_uploader_web||null,e.chunkUploadUrl=t.nos_uploader_web||null,e.replaceUrl=t.nos_downloader||null,e.downloadUrl=t.nos_accelerate||null,e.downloadHost=t.nos_accelerate_host||null,e.ntServerAddress=t.nt_server||null,e.kibanaServer=t.kibana_server,e.statisticServer=t.statistic_server,e.reportGlobalServer=t.report_global_server),null===e.ntServerAddress||""===e.ntServerAddress?o.ntServerAddress=null:o.ntServerAddress=e.ntServerAddress||o.defaultReportUrl,o.uploadUrl=e.uploadUrl||o.uploadUrl,o.chunkUploadUrl=e.chunkUploadUrl||o.chunkUploadUrl,o.downloadUrl=e.downloadUrl||o.downloadUrl,o.downloadHost=e.downloadHost||o.downloadHost,o.replaceUrl=e.replaceUrl||o.replaceUrl,o.httpsEnabled=e.httpsEnabled||o.httpsEnabled,e},r.init=function(e){l.verifyOptions(e,"account","api::Base.init"),e=this.updatePrivateConf(e);var t=this.account=e.account=e.account+"",n=e.constructor.genInstanceName(e),r=c[n];if(r=e._disableSingleton?null:r)return a.updateInstance(r,e),r;this.name=n,(c[n]=this).logger=e.logger=new i({debug:e.debug,logFunc:e.logFunc,prefix:this.subType});r=(e.api=this).protocol=new e.Protocol(e);return r.name="Protocol-"+n,r.account=t,r.api=this,r.message=this.message=new e.Message({account:t}),this.options=l.copy(e),this.reset(),this},r.destroy=function(t){var n=this,r=this.protocol.reconnectTimer,s=(t=t||{},this.name);s&&(this.protocol&&this.protocol.resetPush&&this.protocol.resetPush(),this.disconnect({done:function(e){n.logger.warn("ApiBase::destroy: instance destroyed ..."),Object.getOwnPropertyNames(n).forEach(function(e){delete n[e]}),c&&(delete c[s],c[s]=null,clearTimeout(r)),t.done instanceof Function&&t.done(e)}}))},r.reset=function(){var e=this.updatePrivateConf(this.options);l.verifyBooleanWithDefault(e,"exifOrientation",!0,"","api::Base.reset")},r.setOptions=function(e){this.reset(),this.protocol.setOptions(e)},r.processCallback=function(e,t){d(e,t)},r.processCallbackPromise=function(n,r){return new Promise(function(e,t){d(n,r,!0,e,t)})},function(s,i,o,a,c){var u=o?"api::processCallbackPromise":"api::processCallback";l.verifyCallback(s,"done",u),s.callback=function(e,t,n){var r=s.callback.options,r=(t=i?r:t||r,l.isFunction(s.cbaop)&&(r=s.cbaop(e,t),m(r))&&(t=r),s.done);l.isObject(t)&&(delete t.done,delete t.cb,delete t.callback),o?e?c({message:"生成接口回调错误",callFunc:u,event:e}):a(t):r(e,t,n)},s.callback.options=l.copy(s)});r.processPs=function(e){l.notexist(e.ps)&&(e.ps="")},r.processCustom=function(e){l.notexist(e.custom)&&(e.custom="")},r.sendCmd=function(){this.protocol.sendCmd.apply(this.protocol,arguments)},r.sendCmdWithResp=function(e,t,r){this.sendCmd(e,t,function(e,t,n){l.isFunction(r)&&(e?r(e,t):r(null,n))})},r.cbAndSendCmd=function(e,t){var n=this.processCallbackPromise(t);return this.sendCmd(e,t),n},r.sendCmdUsePromise=function(e,t){var n=this;return new Promise(function(r,s){n.sendCmd(e,t,function(e,t,n){e?s(e):(e=l.merge({},t,n),r(e))})})},a.use=function(e,t){e&&e.install&&l.isFunction(e.install)&&e.install(this,t)},a.rmAllInstances=function(){for(var e in c)c[e].destroy();c={}},r.logout=function(e){this.protocol.shouldReconnect=!1,this.protocol.doLogout=!0,this.processCallback(e),this.sendCmd("logout",e,e.callback)},e.exports=a,n(319),n(318),n(315),n(314),n(313),n(312),n(311)},function(e,t,n){n(103);for(var r=n(8),s=n(20),i=n(23),o=n(7)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var u=a[c],l=r[u],l=l&&l.prototype;l&&!l[o]&&s(l,o,u),i[u]=i.Array}},function(e,t,n){"use strict";var r=n(465);r.fn=r.prototype,e.exports=r,n(462),n(461),n(460),n(459),n(458),n(457),n(456),n(455),n(454),n(453),n(452)},function(e,t,n){"use strict";var i=n(13),o=n(153),a=n(151),c=n(150),u={},l=i.f;function m(e,t,n){var r,s,i,o=u[e];o&&("onload"===t&&o.result&&(s={data:s=n},(i=(r=o).result.headers)&&(s.headers=r.req.header(i)),n=s),(i=u[r=e])&&(i.req.destroy(),delete u[r]),l(s={type:t,result:n}),s.stopped||o[t](s.result))}function d(e,t){var n=i.genUrlSep(e);return(t=i.isObject(t=t||"")?i.object2query(t):t)&&(e+=n+t),e}function r(e,t){t=t||{};var n=i.uniqueID(),r={result:t.result,onload:t.onload||i.f,onerror:t.onerror||i.f},s=(u[n]=r,t.onload=function(e,t){m(e,"onload",t)}.bind(null,n),t.onerror=function(e,t){m(e,"onerror",t)}.bind(null,n),t.query&&(e=d(e,t.query)),t.method||"");return s&&!/get/i.test(s)||!t.data||(e=d(e,t.data),t.data=null),t.url=e,r.req=function(e){var t,n,r=e.upload="multipart/form-data"===(e.headers||i.o)["Content-Type"],s=!1;try{s=(location.protocol+"//"+location.host).toLowerCase()!==i.url2origin(e.url)}catch(e){}return e.cors=s,r||s||e.mode?(s=(r=e).mode,t=o,n=i.getGlobal(),new(t="iframe"===(s=!n.FormData&&n.document?"iframe":s)?r.upload?a:c:t)(r)):new o(e)}(t),n}r.filter=function(e){i.isFunction(e)&&(l=e)},r.abort=function(e){e=u[e];e&&e.req&&e.req.abort()},e.exports=r},function(e,t,n){function r(){}var s=n(14),i=n(106),o=n(44),a=n(46)("IE_PROTO"),c=function(){var e=n(55)("iframe"),t=o.length;for(e.style.display="none",n(79).appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;t--;)delete c.prototype[o[t]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(r.prototype=s(e),n=new r,r.prototype=null,n[a]=e):n=c(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(19),s=n(8).document,i=r(s)&&r(s.createElement);e.exports=function(e){return i?s.createElement(e):{}}},function(e,t,n){"use strict";var r=n(0),s={init:function(){s.deviceId=r.guid()}};s.init(),s.clientTypeMap={1:"Android",2:"iOS",4:"PC",8:"WindowsPhone",16:"Web",32:"Server",64:"Mac"},s.db={open:function(){}},e.exports=s},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){"use strict";var o=n(0),s=n(5),a=n(26);function r(e){o.undef(e.secure)&&(e.secure=!0),this.options=o.copy(e),this.keepNosSafeUrl=this.options.keepNosSafeUrl||!1,o.notundef(e.defaultLinkUrl)&&o.isString(e.defaultLinkUrl)?s.optionDefaultLinkUrl=this.options.defaultLinkUrl.trim():s.optionDefaultLinkUrl="",this.init(),this.connect(),this.initConnecting=!0}var i=r.fn=r.prototype;i.init=function(){this.logger=this.options.logger,this.getNosOriginUrlReqNum=0,this.checkNosReqNum=0,this.cmdTaskArray=[],this.timerMap={},this.cmdCallbackMap={},this.cmdContentMap={},this.initConnect(),this.reset()},i.reset=function(){this.resetConnect()},i.setOptions=function(e){var t=this.options,n=Object.keys(t),r=n.indexOf("account");-1!==r&&n.splice(r,1),e=o.filterObj(e,n),this.options=o.merge(t,e),this.reset()},i.sendCmd=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=arguments[2];this.heartbeat(),"heartbeat"!==e&&this.logger.warn("protocol::sendCmd: "+e,t);var r,s=e,i=(e=this.parser.createCmd(e,t)).SER,t=t||{};(this.cmdContentMap[i]=t).single&&(delete t.single,1===(r=Object.keys(t)).length)&&(this.cmdContentMap[i]=t[r[0]]),t.NOTSTORE&&((r=t.NOTSTORE.split(" ")).forEach(function(e){delete t[e]}),delete t.NOTSTORE),(n=n||t.callback)&&(this.cmdCallbackMap[i]=n),this.cmdTaskArray.push({cmdName:s,cmd:JSON.stringify(e)}),this.startCmdTaskTimer()},i.startCmdTaskTimer=function(){var t=this;t.cmdTaskTimer||(t.cmdTaskTimer=setTimeout(function(){var e=t.cmdTaskArray.shift();t.cmdTaskTimer=null,e&&t.executeCmdTask(e),t.cmdTaskArray.length&&t.startCmdTaskTimer()},0))},i.executeCmdTask=function(e){var t=e.cmdName,e=e.cmd,n=(e=JSON.parse(e)).SER;this.isFrequencyControlled(t)?(this.logger.warn("protocol::executeCmdTask: "+t+" hit freq control"),this.markCallbackInvalid(n,a.newFrequencyControlError({callFunc:"protocol::executeCmdTask",message:t+" hit freq control"}))):this.isConnected()?("heartbeat"!==t&&this.logger.log("protocol::sendCmd: "+t+" "+JSON.stringify(e)),this.doSendCmd(e)):(this.logger.warn("protocol::executeCmdTask: "+t+" not connected"),this.markCallbackInvalid(n,a.newSocketStateError({callFunc:"protocol::executeCmdTask",message:t+" not connected"})))},i.isFrequencyControlled=function(e){var t=this.frequencyControlMap&&this.frequencyControlMap[e];if(t){if(Date.now()<t.from+t.duration)return!0;delete this.frequencyControlMap[e]}},i.doSendCmd=function(e){var t=this,n=e.SER;function r(){t.markCallbackInvalid(n,a.newSocketStateError({callFunc:"protocol::doSendCmd",message:"ser "+n+" socketSendJson Error"})),t.onDisconnect(!0,"protocol::doSendCmd:socketSendJson")}t.timerMap[n]=setTimeout(function(){t.markCallbackInvalid(n,a.newTimeoutError({callFunc:"protocol::doSendCmd",message:"ser "+n+" Timeout Error"}))},s.cmdTimeout);try{t.socket&&t.socket.send?t.socket.send(JSON.stringify(e)):r()}catch(e){r()}},i.getObjWithSer=function(e){var t=this.cmdContentMap[e];return t&&!t.isImSyncDataObj&&delete this.cmdContentMap[e],t&&o.copy(t)},i.getCallbackWithSer=function(e){var t=this.cmdCallbackMap[e];return t&&!t.isImSyncDataCb&&delete this.cmdCallbackMap[e],t},i.getTimerWithSer=function(e){var t=this.timerMap[e];return delete this.timerMap[e],t},i.clearTimerWithSer=function(e){e=this.getTimerWithSer(e);e&&clearTimeout(e)},i.markCallbackInvalid=function(e,t){this.getObjWithSer(e),this.clearTimerWithSer(e);var n,r=this.getCallbackWithSer(e);r&&(n=r.options,setTimeout(function(){r(t||a.newUnknownError({ser:e}),n)},0))},i.markAllCallbackInvalid=function(t){var n=this;Object.keys(this.cmdCallbackMap).forEach(function(e){n.markCallbackInvalid(e,t)})},i.getPacketObj=function(e){var t=null;return t=e&&e.raw&&(e=e.raw.ser,o.notundef(e))?this.getObjWithSer(e):t},i.callPacketAckCallback=function(n){var r,s,i=this;n&&n.raw&&(r=n.raw.ser,o.notundef(r))&&(i.clearTimerWithSer(r),s=i.getCallbackWithSer(r))&&(s.originUrl&&n.obj&&n.obj.file&&(n.obj.file._url_safe=n.obj.file.url,n.obj.file.url=s.originUrl,"audio"===n.obj.type)&&(n.obj.file.mp3Url=s.originUrl+(~s.originUrl.indexOf("?")?"&":"?")+"audioTrans&type=mp3"),n.promise?n.promise.then(function(){s(n.error,n.obj)},function(e){e.callFunc="protocol::callPacketAckCallback",e.message="Resp Promoise Error: cmd: "+n.cmd+", ser: "+r;var t=a.customError("CALLBACK_ACK_ERR",e);i.logger.error("protocol::callPacketAckCallback: promise error "+JSON.stringify(e)),s(t,n.obj,n.content)}):s(n.error,n.obj,n.content))},i.onMessage=function(e){var r=this;r.heartbeat(),r.parser.parseResponse(e).then(function(e){e.notFound&&r.logger.warn("protocol::onMessage: packet not found "+JSON.stringify(e)),e.error?(e.error.message=e.cmd+" error: "+e.error.message,r.logger.error("protocol::onMessage: packet error "+JSON.stringify(e.error))):e.content||"heartbeat"===e.cmd||r.logger.warn("protocol::onMessage: packet.content undefined "+JSON.stringify(e)),e.frequencyControlDuration&&(r.logger.error("protocol::onMessage: server freq control "+JSON.stringify(e.cmd)),r.frequencyControlMap=r.frequencyControlMap||{},r.frequencyControlMap[e.cmd]={from:+new Date,duration:e.frequencyControlDuration}),e.obj=r.getPacketObj(e),"heartbeat"!==e.cmd&&"getClientAntispam"!==e.cmd&&r.logger.log("protocol::recvCmd: "+e.cmd+" "+e.rawStr);var n,t="process"+o.capFirstLetter(e.service);r[t]?("heartbeat"!==e.cmd&&r.logger.warn("protocol::recvCmd: "+e.cmd+" "+t,e.content),"syncDone"===e.cmd?r.cmdCallbackMap[e.raw.ser]&&r.cmdCallbackMap[e.raw.ser].isImSyncDataCb&&(r.cmdCallbackMap[e.raw.ser].isImSyncDataCb=!1,(n=function(e,t){this.checkNosReqNum++,this.getNosOriginUrlReqNum<=0||10<=this.checkNosReqNum?this[e](t):setTimeout(n,300)}.bind(r,t,e)).call(r,t,e)):r[t](e)):r.logger.warn("protocol::onMessage: "+t+" not found"),r.callPacketAckCallback(e)})},i.onMiscError=function(e,t,n){t&&this.notifyError(e,t,n)},i.onCustomError=function(e,t){e=a.customError(e,t),t=t.message||"未知错误";this.onMiscError(t,e)},i.notifyError=function(e,t,n){this.isConnected()&&(this.logger.error((e||"")+" "+this.name,t,n),this.options.onerror(t,n))},i.emitAPI=function(e){var t=e.type,e=e.obj;this.api.emit(t,e)},e.exports=r,n(310),n(308),n(307),n(306),n(305)},function(e,t,n){var r=n(49),s=Math.min;e.exports=function(e){return 0<e?s(r(e),9007199254740991):0}},function(e,t,n){"use strict";t.__esModule=!0;n=n(89),n=n&&n.__esModule?n:{default:n};t.default=n.default||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},function(e,t,n){var r=n(30),s=n(27),i=n(18),o=n(47),a=n(16),c=n(66),u=Object.getOwnPropertyDescriptor;t.f=n(17)?u:function(e,t){if(e=i(e),t=o(t,!0),c)try{return u(e,t)}catch(e){}if(a(e,t))return s(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(64),s=n(44).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,s)}},function(e,t,n){var r=n(34);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var o=n(16),a=n(18),c=n(105)(!1),u=n(46)("IE_PROTO");e.exports=function(e,t){var n,r=a(e),s=0,i=[];for(n in r)n!=u&&o(r,n)&&i.push(n);for(;t.length>s;)!o(r,n=t[s++])||~c(i,n)||i.push(n);return i}},function(e,t,n){e.exports=n(20)},function(e,t,n){e.exports=!n(17)&&!n(22)(function(){return 7!=Object.defineProperty(n(55)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";function y(){return this}var v=n(38),b=n(15),T=n(65),M=n(20),S=n(23),k=n(107),x=n(37),C=n(78),I=n(7)("iterator"),w=!([].keys&&"next"in[].keys());e.exports=function(e,t,n,r,s,i,o){k(n,t,r);function a(e){if(!w&&e in d)return d[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}}var c,u,r=t+" Iterator",l="values"==s,m=!1,d=e.prototype,p=d[I]||d["@@iterator"]||s&&d[s],f=p||a(s),g=s?l?a("entries"):f:void 0,h="Array"==t&&d.entries||p;if(h&&(h=C(h.call(new e)))!==Object.prototype&&h.next&&(x(h,r,!0),v||"function"==typeof h[I]||M(h,I,y)),l&&p&&"values"!==p.name&&(m=!0,f=function(){return p.call(this)}),v&&!o||!w&&!m&&d[I]||M(d,I,f),S[t]=f,S[r]=y,s)if(c={values:l?f:a("values"),keys:i?f:a("keys"),entries:g},o)for(u in c)u in d||T(d,u,c[u]);else b(b.P+b.F*(w||m),t,c);return c}},function(e,t,n){"use strict";var r=n(13),s=r.f,n=n(152);function i(e){e.onload&&this.once("load",e.onload),e.onerror&&this.once("error",e.onerror),e.onbeforesend&&this.once("beforesend",e.onbeforesend),e.onaftersend&&this.once("aftersend",e.onaftersend);e=(e=this.options=r.fetch({method:"GET",url:"",sync:!1,data:null,headers:{},cookie:!1,timeout:6e4,type:"text",form:null,input:null,putFileAtEnd:!1,proxyUrl:""},e)).headers;r.notexist(e["Content-Type"])&&(e["Content-Type"]="application/x-www-form-urlencoded"),this.send()}n=i.prototype=Object.create(n.prototype);n.send=function(){var t=this,e=t.options;setTimeout(function(){try{try{t.emit("beforesend",e)}catch(e){}t.doSend()}catch(e){t.onError("serverError","请求失败:"+e.message)}},0)},n.doSend=s,n.afterSend=function(){var e=this;setTimeout(function(){e.emit("aftersend",e.options)},0)},n.onLoad=function(e){var t=this.options,n=e.status,r=e.result;if(0===(""+n).indexOf("2")){if("json"===t.type)try{r=JSON.parse(r)}catch(e){return void this.onError("parseError",r)}this.emit("load",r)}else this.onError("serverError","服务器返回异常状态",{status:n,result:r})},n.onError=function(e,t,n){n=r.isObject(n)?n:{};n.code=e||"error",n.message=t||"发生错误",this.emit("error",n)},n.onTimeout=function(){this.onError("timeout","请求超时")},n.abort=function(){this.onError("abort","客户端中止")},n.header=function(e){var t,n=this;return r.isArray(e)?(t={},e.forEach(function(e){t[e]=n.header(e)}),t):n.getResponseHeader(e||"")},n.getResponseHeader=s,n.destroy=s,e.exports=i},function(e,t,n){"use strict";var c=n(5),u={genUrlSep:function(e){return-1===(e=""+e).indexOf("?")?"?imageView&":"&"},urlQuery2Object:function(e){var t,n;return"[object String]"!==Object.prototype.toString.call(e)||""===e?{}:-1!==(t=e.indexOf("?"))?(e=e.slice(t+1).split("&"),n={},e.forEach(function(e){var t;~e.indexOf("=")?(t=e.split("="),n[t[0]]=decodeURIComponent(t[1])):n[e]=""}),n):void 0},url2object:function(e){var n,t=0<=(e=(e="[object String]"!==Object.prototype.toString.call(e)?"":e)||"").indexOf("https")?"https://":"http://",r=(s=0<=(s=e.replace(t,"")).indexOf("?")?s.substring(0,s.indexOf("?")):s).split("/"),s=r[0],i="";return 0<r.length&&(i=r.slice(1).join("/")),-1===e.indexOf("?")?{protocol:t,hostname:s,path:i,query:{}}:(r=e.substr(e.indexOf("?")+1).split("&"),n={},r.forEach(function(e){var t;0<e.indexOf("=")?(t=e.split("="),n[t[0]]=decodeURIComponent(t[1])):n[e]=""}),{protocol:t,hostname:s,path:i,query:n})},object2url:function(e){var t=e.protocol,n=e.hostname,r=e.path,t=t||"http://",n=n||"";r&&(n=n+"/"+r);var s,i,o=[];for(i in s=e.query||{})"imageView"!==i&&o.push(i+"="+encodeURIComponent(s[i]));return 0<o.length?""+t+n+"?imageView&"+o.join("&"):""+t+n},genPrivateUrl:function(e){var t=u.url2object(e),n=t.hostname,r=t.path,s=c.downloadHost,i=c.downloadUrl;if(n===s){var o=r.indexOf("/");if(-1!==o)return a=r.substring(0,o),r=r.substring(o+1),i.replace("{bucket}",a).replace("{object}",r)}else if(n&&"[object String]"==Object.prototype.toString.call(n)&&~n.indexOf(s)){var o=t.path,a=o.indexOf(".");if(-1!==a)return r=o.substring(0,a),n=o,i.replace("{bucket}",r).replace("{object}",n)}return e}};e.exports=u},function(e,t){e.exports=function(e,t){for(var n=t.split(".");n.length;){var r=n.shift(),s=!1;if("?"==r[r.length-1]&&(r=r.slice(0,-1),s=!0),!(e=e[r])&&s)return e}return e}},,function(e,t,n){"use strict";var r=n(9),s=r&&r.__esModule?r:{default:r},i=n(69),o=n(0),a=o.notundef,c=o.exist,u=n(125),l=n(167),m=l.typeMap;function d(e){e.resend?(o.verifyOptions(e,"idClient","msg::Message"),this.idClient=e.idClient):this.idClient=o.guid(),this.type=m[e.type],this.resend=e.resend?1:0,a(e.custom)&&("object"===(0,s.default)(e.custom)?this.custom=JSON.stringify(e.custom):this.custom=""+e.custom),a(e.text)&&(this.body=""+e.text),a(e.body)&&(this.body=""+e.body),a(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),a(e.antiSpamUsingYidun)&&(this.antiSpamUsingYidun=e.antiSpamUsingYidun?1:0),a(e.antiSpamContent)&&("object"===(0,s.default)(e.antiSpamContent)?this.antiSpamContent=JSON.stringify(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),a(e.antiSpamBusinessId)&&("object"===(0,s.default)(e.antiSpamBusinessId)?this.antiSpamBusinessId=JSON.stringify(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId),a(e.skipHistory)&&(this.skipHistory=e.skipHistory?1:0),a(e.highPriority)&&(this.highPriority=e.highPriority?1:0),a(e.clientAntiSpam)&&(this.clientAntiSpam=e.clientAntiSpam?1:0)}d.validTypes=l.validTypes,o.merge(d.prototype,l.prototype),d.getType=l.getType,d.reverse=function(e){var t=o.filterObj(e,"chatroomId idClient from fromNick fromAvatar _fromAvatar_safe fromCustom userUpdateTime custom status");return a(t.fromAvatar)&&(t.fromAvatar=(0,i.genPrivateUrl)(t.fromAvatar)),t=o.merge(t,{fromClientType:u.reverseType(e.fromClientType),time:+e.time,type:d.getType(e),text:c(e.body)?e.body:"",resend:1==+e.resend}),a(t.userUpdateTime)&&(t.userUpdateTime=+t.userUpdateTime),t.status=t.status||"success",t},d.setExtra=function(e,t){l.setFlow(e,t)},e.exports=d},function(e,t,n){"use strict";var r=n(9),s=r&&r.__esModule?r:{default:r},i=n(0),o=i.undef,a=i.notundef,c=i.exist,u=n(125),l=n(167),m="#%@all@%#",d={p2p:0,team:1,superTeam:5},p={0:"p2p",1:"team",5:"superTeam"},f=Object.keys(d),g=l.typeMap,r=l.validTypes;function h(e){i.verifyOptions(e,"scene to type","msg::Message"),i.verifyParamValid("scene",e.scene,f,"msg::Message"),this.scene=d[e.scene],this.to=""+e.to,this.type=g[e.type],this.resend=e.resend?1:0,e.resend?(i.verifyOptions(e,"idClient","msg::Message"),this.idClient=e.idClient):this.idClient=i.guid(),a(e.text)&&(this.body=""+e.text),a(e.custom)&&("object"===(0,s.default)(e.custom)?this.custom=JSON.stringify(e.custom):this.custom=""+e.custom),a(e.body)&&(this.body=""+e.body),a(e.pushContent)&&(this.pushContent=""+e.pushContent),a(e.pushPayload)&&(this.pushPayload=""+e.pushPayload);var t,n=e.apns;a(n)&&"team"===e.scene&&(t=n.accounts,a(t)&&i.verifyParamType("apns.accounts",t,"array","msg::Message"),this.apnsAccounts=t?JSON.stringify(t):m,this.apnsContent=n.content||e.pushContent||"",i.verifyBooleanWithDefault(n,"forcePush",!0,"options.apns","msg::Message"),this.apnsForcePush=n.forcePush?1:0),a(e.isHistoryable)&&(this.isHistoryable=e.isHistoryable?1:0),a(e.isRoamingable)&&(this.isRoamingable=e.isRoamingable?1:0),a(e.isSyncable)&&(this.isSyncable=e.isSyncable?1:0),a(e.cc)&&(this.cc=e.cc?1:0),a(e.isPushable)&&(this.isPushable=e.isPushable?1:0),a(e.isOfflinable)&&(this.isOfflinable=e.isOfflinable?1:0),a(e.isUnreadable)&&(this.isUnreadable=e.isUnreadable?1:0),a(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0),a(e.needMsgReceipt)&&(this.needMsgReceipt=e.needMsgReceipt?1:0),a(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),a(e.antiSpamUsingYidun)&&(this.antiSpamUsingYidun=e.antiSpamUsingYidun?1:0),a(e.clientAntiSpam)&&(this.clientAntiSpam=e.clientAntiSpam?1:0),a(e.antiSpamContent)&&("object"===(0,s.default)(e.antiSpamContent)?this.antiSpamContent=JSON.stringify(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),a(e.antiSpamBusinessId)&&("object"===(0,s.default)(e.antiSpamBusinessId)?this.antiSpamBusinessId=JSON.stringify(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId)}i.merge(h.prototype,l.prototype),h.prototype.getScene=function(){return p[this.scene]},h.getType=l.getType,h.reverse=function(e){var t={scene:p[e.scene]||e.scene,from:e.from,fromNick:e.fromNick,fromClientType:u.reverseType(e.fromClientType),fromDeviceId:e.fromDeviceId,to:""+e.to,time:+e.time,type:h.getType(e),text:c(e.body)?e.body:"",isHistoryable:o(e.isHistoryable)||1==+e.isHistoryable,isRoamingable:o(e.isRoamingable)||1==+e.isRoamingable,isSyncable:o(e.isSyncable)||1==+e.isSyncable,cc:o(e.cc)||1==+e.cc,isPushable:o(e.isPushable)||1==+e.isPushable,isOfflinable:o(e.isOfflinable)||1==+e.isOfflinable,isUnreadable:o(e.isUnreadable)||1==+e.isUnreadable,isReplyMsg:o(e.isReplyMsg)||1==+e.isReplyMsg,needPushNick:o(e.needPushNick)||1==+e.needPushNick,needMsgReceipt:1==+e.needMsgReceipt,isLocal:!1};if(e.isInBlackList&&(t.isInBlackList=1==+e.isInBlackList),a(e.isMuted)&&(t.isMuted=1==+e.isMuted),a(e.resend)&&(t.resend=1==+e.resend),a(e.idClient)&&(t.idClient=e.idClient),a(e.idServer)&&(t.idServer=""+e.idServer),a(e.userUpdateTime)&&(t.userUpdateTime=+e.userUpdateTime),a(e.custom)&&(t.custom=e.custom),a(e.pushContent)&&(t.pushContent=e.pushContent),a(e.pushPayload)&&(t.pushPayload=e.pushPayload),a(e.tempTeamMemberCount)&&(t.tempTeamMemberCount=+e.tempTeamMemberCount),a(e.apnsAccounts)){if(t.apns={},e.apnsAccounts!==m){var n=e.apnsAccounts;try{t.apns.accounts=JSON.parse(n)}catch(e){t.apns.accounts=[]}}t.apns.content=e.apnsContent||"",t.apns.forcePush=1==+e.apnsForcePush}return t.status=e.status||"success",a(e.filter)&&(t.filter=e.filter),t},h.setExtra=function(e,t){e.target=h.getMsgTarget(e,t),e.sessionId=e.scene+"-"+e.target,l.setFlow(e,t)},h.getMsgTarget=function(e,t){return"p2p"===e.scene?e.to===t?e.from:e.to:"team"===e.scene||"superTeam"===e.scene?e.to:void 0},h.deduplication=function(e){var t,n={},r=[];return e.forEach(function(e){t=e.idClient,n[t]||(n[t]=!0,r.push(e))}),r},h.sortMsgs=function(e){return e=e.slice(0),i.sortObjArray(e,{sortPath:"time"}),e},h.getLastMsg=function(e){return(e=h.sortMsgs(e))[e.length-1]},h.getLastNotIgnoredMsg=function(e){for(var t,n=(e=h.sortMsgs(e)).length-1;0<=n;n--)if(!(t=e[n]).ignore)return t;return null},h.getMaxTimetag=function(e){return h.getLastMsg(e).time},h.validScenes=f,h.validTypes=r,e.exports=h},function(e,t,n){var r=n(34),s=n(7)("toStringTag"),i="Arguments"==r(function(){return arguments}());e.exports=function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(t=function(e,t){try{return e[t]}catch(e){}}(e=Object(e),s))?t:i?r(e):"Object"==(t=r(e))&&"function"==typeof e.callee?"Arguments":t}},function(e,t,n){var r=n(74),s=n(7)("iterator"),i=n(23);e.exports=n(6).getIteratorMethod=function(e){if(null!=e)return e[s]||e["@@iterator"]||i[r(e)]}},function(e,t){e.exports=function t(e,n){"use strict";function r(e){return t.insensitive&&(""+e).toLowerCase()||""+e}var s,i,o=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,a=/(^[ ]*|[ ]*$)/g,c=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=/^0x[0-9a-f]+$/i,l=/^0/,e=r(e).replace(a,"")||"",n=r(n).replace(a,"")||"",m=e.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),d=n.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),a=parseInt(e.match(u),16)||1!==m.length&&e.match(c)&&Date.parse(e),o=parseInt(n.match(u),16)||a&&n.match(c)&&Date.parse(n)||null;if(o){if(a<o)return-1;if(o<a)return 1}for(var p=0,f=Math.max(m.length,d.length);p<f;p++){if(s=!(m[p]||"").match(l)&&parseFloat(m[p])||m[p]||0,i=!(d[p]||"").match(l)&&parseFloat(d[p])||d[p]||0,isNaN(s)!==isNaN(i))return isNaN(s)?1:-1;if(typeof s!=typeof i&&(s+="",i+=""),s<i)return-1;if(i<s)return 1}return 0}},function(e,t){},function(e,t,n){var r=n(16),s=n(40),i=n(46)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=s(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){n=n(8).document;e.exports=n&&n.documentElement},,,function(e,t,n){"use strict";var r={link:{id:1,heartbeat:2},sync:{id:5,sync:1,syncTeamMembers:2},misc:{id:6,getSimpleNosToken:1,getNosToken:2,notifyUploadLog:3,uploadSdkLogUrl:4,audioToText:5,processImage:6,getNosTokenTrans:7,notifyTransLog:8,fetchFile:9,fetchFileList:10,removeFile:11,getClientAntispam:17,fileQuickTransfer:18,getNosOriginUrl:22,getServerTime:23},avSignal:{id:15,signalingCreate:1,signalingDelay:2,signalingClose:3,signalingJoin:4,signalingLeave:5,signalingInvite:6,signalingCancel:7,signalingReject:8,signalingAccept:9,signalingControl:10,signalingNotify:11,signalingMutilClientSyncNotify:12,signalingUnreadMessageSyncNotify:13,signalingChannelsSyncNotify:14,signalingGetChannelInfo:15}},s={heartbeat:{sid:r.link.id,cid:r.link.heartbeat},getSimpleNosToken:{sid:r.misc.id,cid:r.misc.getSimpleNosToken,params:[{type:"int",name:"num"}]},getNosToken:{sid:r.misc.id,cid:r.misc.getNosToken,params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken"}]},uploadSdkLogUrl:{sid:r.misc.id,cid:r.misc.uploadSdkLogUrl,params:[{type:"string",name:"url"}]},audioToText:{sid:r.misc.id,cid:r.misc.audioToText,params:[{type:"Property",name:"audioToText"}]},processImage:{sid:r.misc.id,cid:r.misc.processImage,params:[{type:"String",name:"url"},{type:"PropertyArray",name:"imageOps",entity:"imageOp"}]},getClientAntispam:{sid:r.misc.id,cid:r.misc.getClientAntispam,params:[{type:"Property",name:"clientAntispam"}]},fileQuickTransfer:{sid:r.misc.id,cid:r.misc.fileQuickTransfer,params:[{type:"Property",name:"fileQuickTransfer"}]},getNosOriginUrl:{sid:r.misc.id,cid:r.misc.getNosOriginUrl,params:[{type:"Property",name:"nosFileUrlTag"}]},getServerTime:{sid:r.misc.id,cid:r.misc.getServerTime,params:[]},getNosTokenTrans:{sid:r.misc.id,cid:r.misc.getNosTokenTrans,params:[{type:"Property",name:"transToken"}]},fetchFile:{sid:r.misc.id,cid:r.misc.fetchFile,params:[{type:"String",name:"docId"}]},fetchFileList:{sid:r.misc.id,cid:r.misc.fetchFileList,params:[{type:"Property",name:"fileListParam"}]},removeFile:{sid:r.misc.id,cid:r.misc.removeFile,params:[{type:"String",name:"docId"}]},signalingCreate:{sid:r.avSignal.id,cid:r.avSignal.signalingCreate,params:[{type:"Property",name:"avSignalTag"}]},signalingDelay:{sid:r.avSignal.id,cid:r.avSignal.signalingDelay,params:[{type:"Property",name:"avSignalTag"}]},signalingClose:{sid:r.avSignal.id,cid:r.avSignal.signalingClose,params:[{type:"Property",name:"avSignalTag"}]},signalingJoin:{sid:r.avSignal.id,cid:r.avSignal.signalingJoin,params:[{type:"Property",name:"avSignalTag"}]},signalingLeave:{sid:r.avSignal.id,cid:r.avSignal.signalingLeave,params:[{type:"Property",name:"avSignalTag"}]},signalingInvite:{sid:r.avSignal.id,cid:r.avSignal.signalingInvite,params:[{type:"Property",name:"avSignalTag"}]},signalingCancel:{sid:r.avSignal.id,cid:r.avSignal.signalingCancel,params:[{type:"Property",name:"avSignalTag"}]},signalingReject:{sid:r.avSignal.id,cid:r.avSignal.signalingReject,params:[{type:"Property",name:"avSignalTag"}]},signalingAccept:{sid:r.avSignal.id,cid:r.avSignal.signalingAccept,params:[{type:"Property",name:"avSignalTag"}]},signalingControl:{sid:r.avSignal.id,cid:r.avSignal.signalingControl,params:[{type:"Property",name:"avSignalTag"}]},signalingGetChannelInfo:{sid:r.avSignal.id,cid:r.avSignal.signalingGetChannelInfo,params:[{type:"Property",name:"avSignalTag"}]}};e.exports={idMap:r,cmdConfig:s,packetConfig:{"1_2":{service:"link",cmd:"heartbeat"},"6_1":{service:"misc",cmd:"getSimpleNosToken",response:[{type:"PropertyArray",name:"nosTokens",entity:"nosToken"}]},"6_2":{service:"misc",cmd:"getNosToken",response:[{type:"Property",name:"nosToken"}]},"6_3":{service:"misc",cmd:"notifyUploadLog"},"6_5":{service:"misc",cmd:"audioToText",response:[{type:"String",name:"text"}]},"6_6":{service:"misc",cmd:"processImage",response:[{type:"String",name:"url"}]},"6_7":{service:"misc",cmd:"getNosTokenTrans",response:[{type:"Property",name:"nosToken"},{type:"String",name:"docId"}]},"6_8":{service:"misc",cmd:"notifyTransLog",response:[{type:"Property",name:"transInfo"}]},"6_9":{service:"misc",cmd:"fetchFile",response:[{type:"Property",name:"info",entity:"transInfo"}]},"6_10":{service:"misc",cmd:"fetchFileList",response:[{type:"PropertyArray",name:"list",entity:"transInfo"},{type:"Number",name:"totalCount"}]},"6_11":{service:"misc",cmd:"removeFile",response:[{type:"String",name:"res"}]},"6_17":{service:"misc",cmd:"getClientAntispam",response:[{type:"Property",name:"clientAntispam"}]},"6_18":{service:"misc",cmd:"fileQuickTransfer",response:[{type:"Property",name:"fileQuickTransfer"}]},"6_22":{service:"misc",cmd:"getNosOriginUrl",response:[{type:"Property",name:"nosFileUrlTag"}]},"6_23":{service:"misc",cmd:"getServerTime",response:[{type:"Number",name:"time"}]},"15_1":{service:"avSignal",cmd:"signalingCreate",response:[{type:"Property",name:"avSignalTag"}]},"15_2":{service:"avSignal",cmd:"signalingDelay",response:[{type:"Property",name:"avSignalTag"}]},"15_3":{service:"avSignal",cmd:"signalingClose",response:[{type:"Property",name:"avSignalTag"}]},"15_4":{service:"avSignal",cmd:"signalingJoin",response:[{type:"Property",name:"avSignalTag"}]},"15_5":{service:"avSignal",cmd:"signalingLeave",response:[]},"15_6":{service:"avSignal",cmd:"signalingInvite",response:[]},"15_7":{service:"avSignal",cmd:"signalingCancel",response:[]},"15_8":{service:"avSignal",cmd:"signalingReject",response:[]},"15_9":{service:"avSignal",cmd:"signalingAccept",response:[]},"15_10":{service:"avSignal",cmd:"signalingControl",response:[]},"15_11":{service:"avSignal",cmd:"signalingNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_12":{service:"avSignal",cmd:"signalingMutilClientSyncNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_13":{service:"avSignal",cmd:"signalingUnreadMessageSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_14":{service:"avSignal",cmd:"signalingChannelsSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_15":{service:"avSignal",cmd:"signalingGetChannelInfo",response:[{type:"Property",name:"avSignalTag"}]}}}},,function(e,t,n){"use strict";var r,s=n(69),p=n(0),f=n(26),i=n(186),o=n(304),a=n(303),c=n(302),u=n(301),n=n(300);function l(e){this.mixin(e)}(l.prototype=Object.create(function(){}.prototype,{protocol:{value:null,writable:!0,enumerable:!0,configurable:!0}})).setProtocol=function(e){this.protocol=e},l.prototype.mixin=function(t){var n=this;this.configMap=this.configMap||{},["idMap","cmdConfig","packetConfig"].forEach(function(e){n.configMap[e]=p.merge({},n.configMap[e],t.configMap&&t.configMap[e])}),["serializeMap","unserializeMap"].forEach(function(e){n[e]=p.merge({},n[e],t[e])})},l.prototype.createCmd=(r=1,function(i,o){var a=this,e=this.configMap.cmdConfig[i],t="heartbeat"===i?0:r++;return 32767<t&&(t=1,r=2),i={SID:e.sid,CID:e.cid,SER:t},e.params&&(i.Q=[],e.params.forEach(function(e){var t=e.type,n=e.name,r=e.entity,s=o[n];if(!p.undef(s)){switch(t){case"PropertyArray":t="ArrayMable",s=s.map(function(e){return{t:"Property",v:a.serialize(e,r)}});break;case"Property":s=a.serialize(s,n);break;case"bool":s=s?"true":"false"}i.Q.push({t:t,v:s})}})),i}),l.prototype.parseResponse=function(m){var d=this;return new Promise(function(e,t){var i=JSON.parse(m),o={raw:i,rawStr:m,error:f.genError(i.code)};if(r=d.configMap.packetConfig[i.sid+"_"+i.cid]){var a=i.r,c="notify"===r.service&&!r.cmd;if(o.isNotify=c){var n=i.r[1].headerPacket,r=d.configMap.packetConfig[n.sid+"_"+n.cid],a=i.r[1].body;if(!r)return o.notFound={sid:n.sid,cid:n.cid},void e(o)}o.service=r.service,o.cmd=r.cmd,o.error&&(s=i.sid+"_"+i.cid,c&&(s=n.sid+"_"+n.cid),o.error.cmd=o.cmd,o.error.callFunc="protocol::parseResponse: "+s,416===o.error.code)&&(n=a[0])&&(o.frequencyControlDuration=1e3*n);var u,s=!1,l=(o.error&&r.trivialErrorCodes&&(s=-1!==r.trivialErrorCodes.indexOf(o.error.code)),[]);o.error&&!s||!r.response||(o.content={},u=function(e,t,n,r){(e&&"msg"===r||"sysMsg"===r)&&(e=n.content[r],p.isObject(e))&&!e.idServer&&(e.idServer=""+t.r[0])},r.response.forEach(function(e,t){var n=a[t];if(!p.undef(n)){var t=e.type,r=e.name,s=e.entity||r;switch(t){case"Property":l.push(d.unserialize(n,s).then(function(e,t,n,r,s){n.content[r]=s,u(e,t,n,r)}.bind(this,c,i,o,r)));break;case"PropertyArray":o.content[r]=[],n.forEach(function(e){l.push(d.unserialize(e,s).then(function(e,t,n){e.content[t].push(n)}.bind(this,o,r)))});break;case"KVArray":o.content[r]=n,u(c,i,o,r);break;case"long":case"Long":case"byte":case"Byte":case"Number":o.content[r]=+n;break;default:o.content[r]=n,u(c,i,o,r)}}})),Promise.all(l).then(function(){e(o)})}else o.notFound={sid:i.sid,cid:i.cid},e(o)})},l.prototype.serialize=function(e,t){var n,r=this.serializeMap[t],s={};for(n in r)e.hasOwnProperty(n)&&(s[r[n]]=e[n]);return s},l.prototype.matchNosSafeUrl=function(e){return!!(p.isString(e)&&~e.indexOf("_im_url=1")&&(e=(0,s.urlQuery2Object)(e))&&e._im_url&&1==e._im_url)},l.prototype.getOneNosOriginUrl=function(t,s,i){var o=this;return new Promise(function(r,e){o.protocol.getNosOriginUrlReqNum++,o.protocol.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:t}},function(e,t,n){o.protocol.getNosOriginUrlReqNum--,e||(s["_"+i+"_safe"]=s[i],s[i]=n.nosFileUrlTag&&n.nosFileUrlTag.originUrl),r()})})},l.prototype.checkObjSafeUrl=function(e,t,n){var r,s,i,o=this;for(r in e)e.hasOwnProperty(r)&&(s=e[r],p.isString(s)?this.matchNosSafeUrl(s)&&(i=this.getOneNosOriginUrl(s,e,r),t.push(i),n.push(i)):p.isObject(s)?this.checkObjSafeUrl(s,t,n):p.isArray(s)&&s.forEach(function(e){p.isObject(e)&&o.checkObjSafeUrl(e,t,n)}))};var m=["url","avatar","fromAvatar","chatroomAvatar"],i=(l.prototype.unserialize=function(c,u){var l=this;return new Promise(function(t,e){var n=l.unserializeMap[u],r={},s=[];if(c)for(var i in n){var o=[];if(c.hasOwnProperty(i)&&(r[n[i]]=c[i],!l.protocol.keepNosSafeUrl))if("attach"===n[i]&&c[i]&&c[i].indexOf&&~c[i].indexOf("_im_url=1"))try{var a=JSON.parse(c[i]);l.checkObjSafeUrl(a,o,s),Promise.all(o).then(function(e,t){e.attach=JSON.stringify(t)}.bind(l,r,a))}catch(e){}else~m.indexOf(n[i])&&c[i]&&l.matchNosSafeUrl(c[i])&&s.push(l.getOneNosOriginUrl(c[i],r,n[i]))}Promise.all(s).then(function(e){t(r)})})},l.prototype.syncUnserialize=function(e,t){var n=this.unserializeMap[t],r={};if(e)for(var s in n)e.hasOwnProperty(s)&&(r[n[s]]=e[s]);return r},new l({configMap:i,serializeMap:o,unserializeMap:a})),o=new l({configMap:c,serializeMap:u,unserializeMap:n});e.exports={IM:i,Chatroom:o}},function(e,t,n){"use strict";var i=n(13),o=i.getGlobal(),n={},r=o.name||"_parent",a=[],s=[];n.addMsgListener=function(e){a.push(e)};function c(){if((e=unescape(o.name||"").trim())&&0===e.indexOf("MSG|")){o.name="";var e=i.string2object(e.replace("MSG|",""),"|"),t=(e.origin||"").toLowerCase();if(!t||"*"===t||0===location.href.toLowerCase().indexOf(t))for(var n={data:JSON.parse(e.data||"null"),source:o.frames[e.self]||e.self,origin:(t=e.ref||("undefined"==typeof document?"":document.referrer),l.test(t=t||"")?RegExp.$1:"*")},r=0,s=a.length;r<s;r++)try{a[r].call(null,n)}catch(n){}}}function u(){if(s.length){m=[];for(var e,t=s.length-1;0<=t;t--)e=s[t],d(m,e.w)||(m.push(e.w),s.splice(t,1),e.w.name=e.d);m=null}}l=/^([\w]+?:\/\/.*?(?=\/|$))/i;var l,m,d,p,f=n.startTimer=(p=!(d=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1}),function(){p||(p=!0,o.postMessage)||(setInterval(u,100),setInterval(c,20))});n.postMessage=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};i.fillUndef(n,{origin:"*",source:r}),o.postMessage?(t=n.data,o.FormData||(t=JSON.stringify(t)),e.postMessage(t,n.origin)):(f(),i.isObject(n)&&((t={}).origin=n.origin||"",t.ref=location.href,t.self=n.source,t.data=JSON.stringify(n.data),n="MSG|"+i.object2string(t,"|",!0)),s.unshift({w:e,d:escape(n)}))},e.exports=n},function(e,t,n){"use strict";var d=n(32),p=n(41),f=n(30),g=n(40),h=n(63),s=Object.assign;e.exports=!s||n(22)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=s({},e)[n]||Object.keys(s({},t)).join("")!=r})?function(e,t){for(var n=g(e),r=arguments.length,s=1,i=p.f,o=f.f;s<r;)for(var a,c=h(arguments[s++]),u=i?d(c).concat(i(c)):d(c),l=u.length,m=0;m<l;)o.call(c,a=u[m++])&&(n[a]=c[a]);return n}:s},function(e,t,n){var r=n(15);r(r.S+r.F,"Object",{assign:n(86)})},function(e,t,n){n(87),e.exports=n(6).Object.assign},function(e,t,n){e.exports={default:n(88),__esModule:!0}},function(e,t,n){"use strict";var r=n(0),s=r.notundef,i=r.fillPropertyWithDefault,o={0:"normal",1:"owner",2:"manager"};function a(e){r.verifyOptions(e,"teamId","team::TeamMember"),r.verifyParamAtLeastPresentOne(e,"nickInTeam muteTeam muteNotiType custom","team::TeamMember"),this.teamId=e.teamId,s(e.account)&&(this.account=e.account),s(e.nickInTeam)&&(this.nickInTeam=e.nickInTeam),s(e.muteNotiType)?this.bits=e.muteNotiType:s(e.muteTeam)&&(this.bits=0,e.muteTeam)&&(this.bits+=1),s(e.mute)&&(this.mute=e.mute?1:0),s(e.custom)&&(this.custom=""+e.custom)}a.reverse=function(e){var t,e=r.copy(e);return s(e.teamId)&&(e.teamId=""+e.teamId),s(e.type)&&(e.type=o[e.type]),s(e.active)&&(e.active=1==+e.active),s(e.valid)&&(e.valid=1==+e.valid),s(e.mute)&&(e.mute=1==+e.mute),s(e.joinTime)&&(e.joinTime=+e.joinTime),s(e.updateTime)&&(e.updateTime=+e.updateTime),s(e.bits)&&(t=e.bits,delete e.bits,e.muteTeam=!!(1&t),e.muteNotiType=t),s(e.teamId)&&s(e.account)&&(e.id=a.genId(e.teamId,e.account)),e},a.reverseMembers=function(e){return e.map(function(e){return a.reverse(e)})},a.fillProperties=function(e){var t=i(e,"mute",!1),e=i(e,"custom","");return t||e},a.genId=function(e,t){return e+"-"+t},a.accounts2ids=function(t,e){return e.map(function(e){return a.genId(t,e)})},a.assembleMembers=function(t,e){return(e=r.isArray(e)?e:[e]).map(function(e){return a.assembleMember(t,e)})},a.assembleMember=function(e,t){return{id:a.genId(e.teamId,t),account:t,teamId:e.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0,invitorAccid:""}},a.assembleOwner=function(e){e=a.assembleMember(e,e.owner);return e.type="owner",e},e.exports=a},function(e,t,n){"use strict";n=n(5);"undefined"==typeof window||window.console||n.isWeixinApp||(window.console={log:function(){},info:function(){},warn:function(){},error:function(){}})},function(e,t,n){n(42)("observable")},function(e,t,n){n(42)("asyncIterator")},function(e,t,n){var r=n(18),s=n(62).f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){if(!o||"[object Window]"!=i.call(e))return s(r(e));var t=e;try{return s(t)}catch(t){return o.slice()}}},function(e,t,n){var r=n(34);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var a=n(32),c=n(41),u=n(30);e.exports=function(e){var t=a(e),n=c.f;if(n)for(var r,s=n(e),i=u.f,o=0;s.length>o;)i.call(e,r=s[o++])&&t.push(r);return t}},function(e,t,n){function r(e){a(e,s,{value:{i:"O"+ ++c,w:{}}})}var s=n(31)("meta"),i=n(19),o=n(16),a=n(11).f,c=0,u=Object.isExtensible||function(){return!0},l=!n(22)(function(){return u(Object.preventExtensions({}))}),m=e.exports={KEY:s,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,s)){if(!u(e))return"F";if(!t)return"E";r(e)}return e[s].i},getWeak:function(e,t){if(!o(e,s)){if(!u(e))return!0;if(!t)return!1;r(e)}return e[s].w},onFreeze:function(e){return l&&m.NEED&&u(e)&&!o(e,s)&&r(e),e}}},function(N,F,e){"use strict";function r(e){var t=O[e]=M(x.prototype);return t._k=e,t}function o(e,t,n){return e===_&&o(A,t,n),y(e),t=b(t,!0),y(n),(u(O,t)?(n.enumerable?(u(e,w)&&e[w][t]&&(e[w][t]=!1),n=M(n,{enumerable:T(0,!1)})):(u(e,w)||k(e,w,T(1,{})),e[w][t]=!0),U):k)(e,t,n)}function n(e,t){y(e);for(var n,r=q(t=v(t)),s=0,i=r.length;s<i;)o(e,n=r[s++],t[n]);return e}function t(e){var t=Q.call(this,e=b(e,!0));return!(this===_&&u(O,e)&&!u(A,e))&&(!(t||!u(this,e)||!u(O,e)||u(this,w)&&this[w][e])||t)}function s(e,t){var n;if(e=v(e),t=b(t,!0),e!==_||!u(O,t)||u(A,t))return!(n=$(e,t))||!u(O,t)||u(e,w)&&e[w][t]||(n.enumerable=!0),n}function i(e){for(var t,n=G(v(e)),r=[],s=0;n.length>s;)u(O,t=n[s++])||t==w||t==L||r.push(t);return r}function a(e){for(var t,n=e===_,r=G(n?A:v(e)),s=[],i=0;r.length>i;)!u(O,t=r[i++])||n&&!u(_,t)||s.push(O[t]);return s}var c=e(8),u=e(16),l=e(17),m=e(15),d=e(65),L=e(97).KEY,p=e(22),f=e(45),g=e(37),D=e(31),h=e(7),B=e(43),H=e(42),q=e(96),X=e(95),y=e(14),W=e(19),v=e(18),b=e(47),T=e(27),M=e(54),S=e(94),V=e(61),J=e(11),z=e(32),$=V.f,k=J.f,G=S.f,x=c.Symbol,C=c.JSON,I=C&&C.stringify,w=h("_hidden"),K=h("toPrimitive"),Q={}.propertyIsEnumerable,P=f("symbol-registry"),O=f("symbols"),A=f("op-symbols"),_=Object.prototype,f="function"==typeof x,E=c.QObject,R=!E||!E.prototype||!E.prototype.findChild,U=l&&p(function(){return 7!=M(k({},"a",{get:function(){return k(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=$(_,t);r&&delete _[t],k(e,t,n),r&&e!==_&&k(_,t,r)}:k,j=f&&"symbol"==typeof x.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof x};f||(d((x=function(){if(this instanceof x)throw TypeError("Symbol is not a constructor!");var t=D(0<arguments.length?arguments[0]:void 0),n=function(e){this===_&&n.call(A,e),u(this,w)&&u(this[w],t)&&(this[w][t]=!1),U(this,t,T(1,e))};return l&&R&&U(_,t,{configurable:!0,set:n}),r(t)}).prototype,"toString",function(){return this._k}),V.f=s,J.f=o,e(62).f=S.f=i,e(30).f=t,e(41).f=a,l&&!e(38)&&d(_,"propertyIsEnumerable",t,!0),B.f=function(e){return r(h(e))}),m(m.G+m.W+m.F*!f,{Symbol:x});for(var Y="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Z=0;Y.length>Z;)h(Y[Z++]);for(var ee=z(h.store),te=0;ee.length>te;)H(ee[te++]);m(m.S+m.F*!f,"Symbol",{for:function(e){return u(P,e+="")?P[e]:P[e]=x(e)},keyFor:function(e){if(!j(e))throw TypeError(e+" is not a symbol!");for(var t in P)if(P[t]===e)return t},useSetter:function(){R=!0},useSimple:function(){R=!1}}),m(m.S+m.F*!f,"Object",{create:function(e,t){return void 0===t?M(e):n(M(e),t)},defineProperty:o,defineProperties:n,getOwnPropertyDescriptor:s,getOwnPropertyNames:i,getOwnPropertySymbols:a}),C&&m(m.S+m.F*(!f||p(function(){var e=x();return"[null]"!=I([e])||"{}"!=I({a:e})||"{}"!=I(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],s=1;s<arguments.length;)r.push(arguments[s++]);if(n=t=r[1],(W(t)||void 0!==e)&&!j(e))return X(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!j(t))return t}),r[1]=t,I.apply(C,r)}}),x.prototype[K]||e(20)(x.prototype,K,x.prototype.valueOf),g(x,"Symbol"),g(Math,"Math",!0),g(c.JSON,"JSON",!0)},function(e,t,n){n(98),n(77),n(93),n(92),e.exports=n(6).Symbol},function(e,t,n){e.exports={default:n(99),__esModule:!0}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t){e.exports=function(){}},function(e,t,n){"use strict";var r=n(102),s=n(101),i=n(23),o=n(18);e.exports=n(67)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,s(1)):s(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(e,t,n){var r=n(49),s=Math.max,i=Math.min;e.exports=function(e,t){return(e=r(e))<0?s(e+t,0):i(e,t)}},function(e,t,n){var c=n(18),u=n(59),l=n(104);e.exports=function(a){return function(e,t,n){var r,s=c(e),i=u(s.length),o=l(n,i);if(a&&t!=t){for(;o<i;)if((r=s[o++])!=r)return!0}else for(;o<i;o++)if((a||o in s)&&s[o]===t)return a||o||0;return!a&&-1}}},function(e,t,n){var o=n(11),a=n(14),c=n(32);e.exports=n(17)?Object.defineProperties:function(e,t){a(e);for(var n,r=c(t),s=r.length,i=0;i<s;)o.f(e,n=r[i++],t[n]);return e}},function(e,t,n){"use strict";var r=n(54),s=n(27),i=n(37),o={};n(20)(o,n(7)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:s(1,n)}),i(e,t+" Iterator")}},function(e,t,n){var i=n(49),o=n(48);e.exports=function(s){return function(e,t){var n,e=String(o(e)),t=i(t),r=e.length;return t<0||r<=t?s?"":void 0:(n=e.charCodeAt(t))<55296||56319<n||t+1===r||(r=e.charCodeAt(t+1))<56320||57343<r?s?e.charAt(t):n:s?e.slice(t,t+2):r-56320+(n-55296<<10)+65536}}},function(e,t,n){n(36),n(51),e.exports=n(43).f("iterator")},function(e,t,n){e.exports={default:n(109),__esModule:!0}},,function(e,t,n){var i=n(7)("iterator"),o=!1;try{var r=[7][i]();r.return=function(){o=!0},Array.from(r,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var r=[7],s=r[i]();s.next=function(){return{done:n=!0}},r[i]=function(){return s},e(r)}catch(e){}return n}},function(e,t,n){var r=n(23),s=n(7)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||i[s]===e)}},function(e,t,n){var s=n(14);e.exports=function(e,t,n,r){try{return r?t(s(n)[0],n[1]):t(n)}catch(t){r=e.return;throw void 0!==r&&s(r.call(e)),t}}},,,,,,,function(e,t,n){"use strict";var r=n(58),s=n(0),i=s.undef,o=s.notundef,a=n(5),c=n(84),u=n(290),l=n(184);function m(e){s.verifyOptions(e,"appKey account chatroomId chatroomAddresses","protocol::ChatroomProtocol"),e.isAnonymous||s.verifyOptions(e,"token","protocol::ChatroomProtocol"),s.verifyParamType("chatroomAddresses",e.chatroomAddresses,"array","protocol::ChatroomProtocol"),s.verifyCallback(e,"onconnect onerror onwillreconnect ondisconnect onmsg onmsgs onrobots","protocol::ChatroomProtocol"),r.call(this,e)}var d=r.fn,p=m.fn=m.prototype=Object.create(d);p.init=function(){d.init.call(this),c.Chatroom.setProtocol(this),this.parser=c.Chatroom,this.sendCmd.bind(this),this.syncResult={},this.timetags={},this.msgBuffer=[]},p.reset=function(){var t=this,e=(d.reset.call(t),t.options);i(e.msgBufferInterval)&&(e.msgBufferInterval=300),s.verifyParamType("msgBufferInterval",e.msgBufferInterval,"number","protocol::ChatroomProtocol.reset"),i(e.msgBufferSize)&&(e.msgBufferSize=500),s.verifyParamType("msgBufferSize",e.msgBufferSize,"number","protocol::ChatroomProtocol.reset"),o(e.chatroomAddresses)&&(t.socketUrls=e.chatroomAddresses.map(function(e){return a.formatSocketUrl({url:e,secure:t.options.secure})}),t.socketUrlsBackup=t.socketUrls.slice(0))},p.processChatroom=function(e){switch(e.cmd){case"login":e.error||(e.obj={chatroom:u.reverse(e.content.chatroom),member:l.reverse(e.content.chatroomMember)});break;case"kicked":this.onKicked(e);break;case"logout":break;case"sendMsg":this.onSendMsg(e);break;case"msg":this.onMsg(e);break;case"getChatroomMembers":this.onChatroomMembers(e);break;case"getHistoryMsgs":this.onHistoryMsgs(e);break;case"markChatroomMember":this.onMarkChatroomMember(e);break;case"closeChatroom":break;case"getChatroom":this.onChatroom(e);break;case"updateChatroom":break;case"updateMyChatroomMemberInfo":delete e.obj.chatroomMember;break;case"getChatroomMembersInfo":this.onChatroomMembersInfo(e);break;case"kickChatroomMember":case"updateChatroomMemberTempMute":break;case"queueList":e.error||(e.obj=e.content);break;case"syncRobot":this.onSyncRobot(e)}},p.onChatroom=function(e){e.error||(e.obj.chatroom=u.reverse(e.content.chatroom))},e.exports=m,n(401),n(400),n(399),n(398)},function(e,t,n){"use strict";t.__esModule=!0;var c=r(n(139)),u=r(n(136));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,c.default)(Object(e))){var n=e,r=t,s=[],i=!0,e=!1,t=void 0;try{for(var o,a=(0,u.default)(n);!(i=(o=a.next()).done)&&(s.push(o.value),!r||s.length!==r);i=!0);}catch(n){e=!0,t=n}finally{try{!i&&a.return&&a.return()}finally{if(e)throw t}}return s}throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";var r=n(0);function s(){}s.parse=function(e){e=e.split("|");return{scene:e[0],to:e[1]}},s.genSessionByMsg=function(e){return{id:e.sessionId,scene:e.scene,to:e.target,updateTime:e.time,lastMsg:e}},s.appendLastMsg=function(e){var t=e.lastMsg;e["last"+r.capFirstLetter(t.type)+"Msg"]=t,e["last"+r.capFirstLetter(t.flow)+"Msg"]=t},s.genSessionByMsgs=function(e,t){e=e.getLastNotIgnoredMsg(t);return e?s.genSessionByMsg(e):null},s.trim=function(e){delete e.msgReceiptSendTime,delete e.msgReceiptServerTime,delete e.ack,delete e.unreadMsgs},s.isComplete=function(e){return e.id&&e.scene&&e.to},e.exports=s},function(e,t,n){"use strict";var r=n(9),s=r&&r.__esModule?r:{default:r},i=n(0),o=i.undef,a=i.notundef,c=n(84).IM,u=n(126),l=n(90),m={customP2p:100,customTeam:101,deleteMsgP2p:7,deleteMsgTeam:8},d={0:"applyTeam",1:"rejectTeamApply",2:"teamInvite",3:"rejectTeamInvite",5:"friendRequest",6:"deleteFriend",7:"deleteMsgP2p",8:"deleteMsgTeam",100:"customP2p",101:"customTeam",102:"customP2p"},p={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},f=["team","friend","msg"],g={applyTeam:"team",rejectTeamApply:"team",teamInvite:"team",rejectTeamInvite:"team",addFriend:"friend",applyFriend:"friend",passFriendApply:"friend",rejectFriendApply:"friend",deleteFriend:"friend",deleteMsg:"msg"};function h(e){i.verifyOptions(e,"type to","sysmsg::SystemMessage"),i.verifyParamValid("type",e.type,h.validTypes,"sysmsg::SystemMessage"),-1!==e.type.indexOf("custom")&&(i.verifyOptions(e,"content","sysmsg::SystemMessage"),this.attach=e.content,a(e.apnsText)&&(this.apnsText=""+e.apnsText),a(e.pushPayload)&&("object"===(0,s.default)(e.pushPayload)?this.pushPayload=JSON.stringify(e.pushPayload):this.pushPayload=""+e.pushPayload),a(e.sendToOnlineUsersOnly)&&(this.sendToOnlineUsersOnly=e.sendToOnlineUsersOnly?0:1),a(e.cc)&&(this.cc=e.cc?1:0),a(e.isPushable)&&(this.isPushable=e.isPushable?1:0),a(e.isUnreadable)&&(this.isUnreadable=e.isUnreadable?1:0),a(e.needPushNick))&&(this.needPushNick=e.needPushNick?1:0),this.time=e.time||+new Date,this.type=m[e.type],this.to=e.to,a(e.from)&&(this.from=e.from),a(e.ps)&&(this.ps=e.ps),a(e.deletedIdClient)&&(this.deletedIdClient=e.deletedIdClient),a(e.deletedIdServer)&&(this.deletedIdServer=e.deletedIdServer),a(e.opeAccount)&&(this.opeAccount=e.opeAccount),a(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),a(e.antiSpamContent)&&("object"===(0,s.default)(e.antiSpamContent)?this.antiSpamContent=JSON.stringify(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),a(e.antiSpamBusinessId)&&("object"===(0,s.default)(e.antiSpamBusinessId)?this.antiSpamBusinessId=JSON.stringify(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId),this.idClient=e.idClient||i.guid()}h.validTypes=Object.keys(m).concat(Object.keys(g)),h.validCategories=["team","friend"],h.isCustom=function(e){return"custom"===e.type},h.reverse=function(e){var t,n={time:+e.time,to:e.to,type:d[e.type]};return a(e.from)&&(n.from=e.from),a(e.idServer)&&(n.idServer=""+e.idServer),a(e.deletedIdClient)&&(n.deletedIdClient=e.deletedIdClient),a(e.deletedIdServer)&&(n.deletedIdServer=""+e.deletedIdServer),a(e.deletedMsgTime)&&(n.deletedMsgTime=+e.deletedMsgTime),a(e.deletedMsgFromNick)&&(n.deletedMsgFromNick=""+e.deletedMsgFromNick),a(e.opeAccount)&&(n.opeAccount=e.opeAccount),a(e.ps)&&(n.ps=e.ps),e.attach=e.attach?""+e.attach:"","customP2p"===n.type||"customTeam"===n.type?(n.content=e.attach,a(e.apnsText)&&(n.apnsText=e.apnsText),a(e.pushPayload)&&(n.pushPayload=e.pushPayload),i.merge(n,{sendToOnlineUsersOnly:o(e.sendToOnlineUsersOnly)||0==+e.sendToOnlineUsersOnly,cc:o(e.cc)||1==+e.cc,isPushable:o(e.isPushable)||1==+e.isPushable,isUnreadable:o(e.isUnreadable)||1==+e.isUnreadable,needPushNick:a(e.needPushNick)&&1==+e.needPushNick}),n.scene=n.type.slice(6).toLowerCase(),n.type="custom"):"deleteMsgP2p"===n.type||"deleteMsgTeam"===n.type?(n.scene=n.type.slice(9).toLowerCase(),n.type="deleteMsg"):(e.attach&&(n.attach={},t=JSON.parse(e.attach),a(t.vt)?(n.type=p[t.vt],delete n.attach):(a(t.tinfo)&&(n.attach.team=u.reverse(c.syncUnserialize(t.tinfo,"team"))),a(t.tlist)&&(n.attach.member=l.reverse(c.syncUnserialize(t.tlist,"teamMember"))),a(t.attach)&&(n.attach.custom=t.attach))),n.category=g[n.type],n.read=!1,n.state="init"),a(e.cc)&&(n.cc=1==+e.cc),n.status=e.status||"success",a(e.filter)&&(n.filter=e.filter),n},h.reverseSysMsgs=function(e,t){var n=(t=t||{}).mapper,r=i.isFunction(n);return e.map(function(e){return e=h.reverse(e),e=r?n(e):e})},h.completeUnread=function(t){var n;return t=t||{},f.forEach(function(e){delete t[e]}),Object.keys(g).forEach(function(e){t[e]=t[e]||0,t[e]<0&&(t[e]=0),t[n=g[e]]=t[n]||0,t[n]=t[n]+t[e]}),t.total=0,f.forEach(function(e){t.total+=t[e]}),t},e.exports=h},function(e,t,n){"use strict";var n=n(56),r=(n&&n.__esModule?n:{default:n}).default.clientTypeMap;function s(){}s.reverse=function(e){return e.type=r[e.type],e},s.reverseType=function(e){return r[e]||e},e.exports=s},function(e,t,n){"use strict";var r=n(0),s=r.notundef,i=r.fillPropertyWithDefault,n=Object.keys,o={},a={},c=[],u={},l={normal:0,advanced:1},m={0:"normal",1:"advanced"},d=n(l),p=o.joinMode={noVerify:0,needVerify:1,rejectAll:2},p=(a.joinMode={0:"noVerify",1:"needVerify",2:"rejectAll"},c.push("join"),u.joinMode=n(p),o.beInviteMode={needVerify:0,noVerify:1}),p=(a.beInviteMode={0:"needVerify",1:"noVerify"},c.push("beInvite"),u.beInviteMode=n(p),o.inviteMode={manager:0,all:1}),p=(a.inviteMode={0:"manager",1:"all"},c.push("invite"),u.inviteMode=n(p),o.updateTeamMode={manager:0,all:1}),p=(a.updateTeamMode={0:"manager",1:"all"},c.push("updateTeam"),u.updateTeamMode=n(p),o.updateCustomMode={manager:0,all:1});function f(e){switch(r.verifyOptions(e,"action","team::Team"),e.action){case"create":r.verifyOptions(e,"teamId",!1,"team::Team"),r.verifyOptions(e,"type name","team::Team"),r.verifyParamValid("type",e.type,d,"team::Team"),s(e.level)&&(r.verifyParamType("level",e.level,"number","team::Team"),this.level=e.level);break;case"update":r.verifyOptions(e,"teamId","team::Team"),r.verifyOptions(e,"type",!1,"team::Team")}s(e.teamId)&&(this.teamId=e.teamId),s(e.type)&&(this.type=l[e.type]),s(e.avatar)&&(this.avatar=""+e.avatar),s(e.name)&&(this.name=""+e.name),s(e.intro)&&(this.intro=""+e.intro),s(e.announcement)&&(this.announcement=""+e.announcement),c.forEach(this.setMode.bind(this,e)),s(e.custom)&&(this.custom=""+e.custom)}a.updateCustomMode={0:"manager",1:"all"},c.push("updateCustom"),u.updateCustomMode=n(p),f.prototype.setMode=function(e,t){s(e[t+="Mode"])&&(r.verifyParamValid(t,e[t],u[t],"team::Team"),this[t]=o[t][e[t]])},f.reverse=function(e,t){var n=r.copy(e);if(s(n.teamId)&&(n.teamId=""+n.teamId),s(n.type)&&(n.type=m[n.type]),s(n.level)&&(n.level=+n.level),s(n.valid)&&(n.valid=1==+n.valid),s(n.memberNum)&&(n.memberNum=+n.memberNum),s(n.memberUpdateTime)&&(n.memberUpdateTime=+n.memberUpdateTime),s(n.createTime)&&(n.createTime=+n.createTime),s(n.updateTime)&&(n.updateTime=+n.updateTime),s(n.validToCurrentUser)&&(n.validToCurrentUser="1"===n.validToCurrentUser),s(n.mute)&&(n.mute="1"===n.mute),s(n.muteType))switch(n.muteType){case"0":n.mute=!1,n.muteType="none";break;case"1":n.mute=!0,n.muteType="normal";break;case"3":n.mute=!0,n.muteType="all"}else s(n.mute)&&(1===n.mute?(n.mute=!0,n.muteType="normal"):(n.mute=!1,n.muteType="none"));return c.forEach(function(e,t){s(e[t+="Mode"])&&(e[t]=a[t][e[t]])}.bind(null,n)),delete n.bits,t||f.fillProperties(n),n},f.fillProperties=function(e){var t=i(e,"beInviteMode","needVerify"),n=i(e,"inviteMode","manager"),r=i(e,"updateTeamMode","manager"),s=i(e,"updateCustomMode","manager"),e=i(e,"avatar","");return t||n||r||s||e},e.exports=f},,,,,function(e,t,n){"use strict";var r=n(69),s=n(72),i=n(0),o=n(5);function a(e){switch(i.notundef(e.type)?i.verifyFileType(e.type,"msg::FileMessage"):e.type="file",i.verifyOptions(e,"file","msg::FileMessage"),i.verifyOptions(e.file,"url ext size",!0,"file.","msg::FileMessage"),e.type){case"image":c.verifyFile(e.file,"msg::FileMessage");break;case"audio":u.verifyFile(e.file,"msg::FileMessage");break;case"video":l.verifyFile(e.file,"msg::FileMessage")}s.call(this,e),this.attach=JSON.stringify(e.file)}a.prototype=Object.create(s.prototype),a.reverse=function(e){var t=s.reverse(e);return e.attach=e.attach?""+e.attach:"",t.file=e.attach?JSON.parse(e.attach):{},t.file.url=(0,r.genPrivateUrl)(t.file.url),"audio"!==t.type||t.file.mp3Url||(t.file.mp3Url=t.file.url+(~t.file.url.indexOf("?")?"&":"?")+"audioTrans&type=mp3"),o.httpsEnabled&&0!==t.file.url.indexOf("https://")&&(t.file.url=t.file.url.replace("http","https")),t},e.exports=a;var c=n(395),u=n(394),l=n(393)},function(e,t,n){"use strict";var r=n(50),s=n(121),i=n(5),o=n(290),a=n(397),c=n(0),u=c.verifyOptions,l=c.verifyParamType,m=n(84).Chatroom;function d(e){return this.subType="chatroom",this.nosScene=e.nosScene||"chatroom",this.nosSurvivalTime=e.nosSurvivalTime,e.Protocol=s,e.Message=a,e.constructor=d,e.isAnonymous&&(e.account=e.account||"nimanon_"+c.guid(),e.isAnonymous=1,c.verifyOptions(e,"chatroomNick","api::Chatroom"),e.chatroomAvatar=e.chatroomAvatar||" "),this.init(e)}d.Protocol=s,d.parser=m,d.use=r.use,d.getInstance=function(e){return e.isAnonymous&&(e.account=e.account||"nimanon_"+c.guid(),e.isAnonymous=1,c.verifyOptions(e,"chatroomNick","api::Chatroom.getInstance"),e.chatroomAvatar=e.chatroomAvatar||" "),r.getInstance.call(this,e)},d.genInstanceName=function(e){return c.verifyOptions(e,"chatroomId","api::Chatroom.genInstanceName"),"Chatroom-account-"+e.account+"-chatroomId-"+e.chatroomId};m=d.fn=d.prototype=Object.create(r.prototype);d.info=m.info=i.info,m.getChatroom=function(e){this.processCallback(e),this.sendCmd("getChatroom",e)},m.updateChatroom=function(e){u(e,"chatroom needNotify","api::updateChatroom"),l("needNotify",e.needNotify,"boolean"),this.processCustom(e),this.processCallback(e),e.chatroom=new o(e.chatroom),this.sendCmd("updateChatroom",e)},m.closeChatroom=function(e){this.processCustom(e),this.processCallback(e),this.sendCmd("closeChatroom",e)},e.exports=d,n(387),n(386),n(385)},function(e,t,n){"use strict";var r=n(69),s=n(73),i=n(0),o=n(5);function a(e){switch(i.notundef(e.type)?i.verifyFileType(e.type,"msg::FileMessage"):e.type="file",i.verifyOptions(e,"file","msg::FileMessage"),i.verifyOptions(e.file,"url ext size",!0,"file.","msg::FileMessage"),e.type){case"image":c.verifyFile(e.file,"msg::FileMessage");break;case"audio":u.verifyFile(e.file,"msg::FileMessage");break;case"video":l.verifyFile(e.file,"msg::FileMessage")}s.call(this,e),this.attach=JSON.stringify(e.file)}a.prototype=Object.create(s.prototype),a.reverse=function(e){var t=s.reverse(e);return e.attach=e.attach?""+e.attach:"",t.file=e.attach?JSON.parse(e.attach):{},t.file.url=(0,r.genPrivateUrl)(t.file.url),"audio"!==t.type||t.file.mp3Url||(t.file.mp3Url=t.file.url+(~t.file.url.indexOf("?")?"&":"?")+"audioTrans&type=mp3"),o.httpsEnabled&&0!==t.file.url.indexOf("https://")&&(t.file.url=t.file.url.replace("http","https")),t},e.exports=a;var c=n(430),u=n(429),l=n(428)},function(e,t,n){var r=n(14),s=n(75);e.exports=n(6).getIterator=function(e){var t=s(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){n(51),n(36),e.exports=n(134)},function(e,t,n){e.exports={default:n(135),__esModule:!0}},function(e,t,n){var r=n(74),s=n(7)("iterator"),i=n(23);e.exports=n(6).isIterable=function(e){e=Object(e);return void 0!==e[s]||"@@iterator"in e||i.hasOwnProperty(r(e))}},function(e,t,n){n(51),n(36),e.exports=n(137)},function(e,t,n){e.exports={default:n(138),__esModule:!0}},function(e,t,n){"use strict";var r=n(69),s=n(0),i={unknown:0,male:1,female:2},o={0:"unknown",1:"male",2:"female"};function a(e){s.merge(this,e),s.notundef(this.gender)&&(s.verifyParamValid("gender",this.gender,a.validGenders,"user::User"),this.gender=i[this.gender]),s.notundef(this.email)&&""!==this.email&&s.verifyEmail("email",this.email,"user::User"),s.notundef(this.birth)&&""!==this.birth&&s.verifyBirth("birth",this.birth,"user::User"),s.notundef(this.tel)&&""!==this.tel&&s.verifyTel("tel",this.tel,"user::User")}a.reverse=function(e){e=s.filterObj(e,"account nick avatar _avatar_safe sign gender email birth tel custom createTime updateTime");return s.notundef(e.avatar)&&(e.avatar=(0,r.genPrivateUrl)(e.avatar)),s.notundef(e.gender)&&(e.gender=o[e.gender]),s.notundef(e.createTime)&&(e.createTime=+e.createTime),s.notundef(e.updateTime)&&(e.updateTime=+e.updateTime),e},a.reverseUsers=function(e){return e.map(function(e){return a.reverse(e)})},a.validGenders=Object.keys(i),e.exports=a},function(e,t,n){"use strict";var r=n(11),s=n(27);e.exports=function(e,t,n){t in e?r.f(e,t,s(0,n)):e[t]=n}},function(e,t,n){"use strict";var m=n(35),r=n(15),d=n(40),p=n(114),f=n(113),g=n(59),h=n(141),y=n(75);r(r.S+r.F*!n(112)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,r,s,i=d(e),e="function"==typeof this?this:Array,o=arguments.length,a=1<o?arguments[1]:void 0,c=void 0!==a,u=0,l=y(i);if(c&&(a=m(a,2<o?arguments[2]:void 0,2)),null==l||e==Array&&f(l))for(n=new e(t=g(i.length));u<t;u++)h(n,u,c?a(i[u],u):i[u]);else for(s=l.call(i),n=new e;!(r=s.next()).done;u++)h(n,u,c?p(s,a,[r.value,u],!0):r.value);return n.length=u,n}})},function(e,t,n){n(36),n(142),e.exports=n(6).Array.from},function(e,t,n){e.exports={default:n(143),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var n=n(144),r=n&&n.__esModule?n:{default:n};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,r.default)(e)}},function(e,t,n){"use strict";var r=n(0),s=r.notundef,i=r.fillPropertyWithDefault,o={0:"normal",1:"owner",2:"manager"};function a(e){r.verifyOptions(e,"teamId","superTeam::TeamMember"),r.verifyParamAtLeastPresentOne(e,"nickInTeam muteTeam custom","superTeam::SuperTeamMember"),this.teamId=e.teamId,s(e.account)&&(this.account=e.account),s(e.nickInTeam)&&(this.nickInTeam=e.nickInTeam),s(e.muteTeam)&&(this.bits=0,e.muteTeam)&&(this.bits+=1),s(e.mute)&&(this.mute=e.mute?1:0),s(e.custom)&&(this.custom=""+e.custom)}a.reverse=function(e){var t,e=r.copy(e);return s(e.teamId)&&(e.teamId=""+e.teamId),s(e.type)&&(e.type=o[e.type]),s(e.active)&&(e.active=1==+e.active),s(e.valid)&&(e.valid=1==+e.valid),s(e.mute)&&(e.mute=1==+e.mute),s(e.joinTime)&&(e.joinTime=+e.joinTime),s(e.updateTime)&&(e.updateTime=+e.updateTime),s(e.bits)&&(t=e.bits,delete e.bits,e.muteTeam=!!(1&t)),s(e.teamId)&&s(e.account)&&(e.id=a.genId(e.teamId,e.account)),e},a.reverseMembers=function(e){return e.map(function(e){return a.reverse(e)})},a.fillProperties=function(e){var t=i(e,"mute",!1),e=i(e,"custom","");return t||e},a.genId=function(e,t){return e+"-"+t},a.accounts2ids=function(t,e){return e.map(function(e){return a.genId(t,e)})},a.assembleMembers=function(t,e){return(e=r.isArray(e)?e:[e]).map(function(e){return a.assembleMember(t,e)})},a.assembleMember=function(e,t){return{id:a.genId(e.teamId,t),account:t,teamId:e.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}},a.assembleOwner=function(e){e=a.assembleMember(e,e.owner);return e.type="owner",e},e.exports=a},function(e,t,n){"use strict";var g=n(5),h=g.chunkSize,y=(n(0),n(53));e.exports=function(u,e,l){var m={file:u.data[e],fileSize:u.data[e].size,fileUoloadedSize:0,percentage:0};function d(e){var e=m.fileUoloadedSize+e.loaded,t=Math.floor(1e4*e/m.fileSize)/100;100<=parseInt(t)&&(t=100,d=function(){}),m.percentage!==t&&(m.percentage=t,e={docId:u.docId,total:m.fileSize,loaded:e,percentage:t,percentageText:t+"%"},u.fileInput&&(e.fileInput=u.fileInput),u.blob&&(e.blob=u.blob),u.uploadprogress(e))}function p(e){try{var t=e.result?JSON.parse(e.result):e;l.onError(t)}catch(e){l.onError(e)}}var f={query:{offset:0,complete:m.fileSize<=h,version:"1.0"},headers:{"Content-Type":"application/x-www-form-urlencoded","x-nos-token":u.nosToken.token},method:"POST",timeout:0,onaftersend:function(){u.beginupload(l)},onuploading:d,onload:function e(t){try{t=JSON.parse(t)}catch(e){return void l.onError(e)}var n,r,s,i,o,a,c;t.errMsg||t.errCode?l.onError(t):t.offset<m.fileSize?(delete f.onaftersend,m.fileUoloadedSize=t.offset,l.sn=(r=u.url,i=f,o=m,a=(s=t).offset,c=s.offset+h,i.data=o.file.slice(a,c),i.query.offset=s.offset,i.query.complete=c>=o.fileSize,i.query.context=s.context,i.onuploading=d,i.onload=e,i.onerror=p,y(r,i))):(n=function(e){l.onError(e)},a=g.genFileUrl(u.nosToken),"image"===u.type?y(a+"?imageInfo",{onload:function(e){try{e=JSON.parse(e),u.uploaddone(null,{docId:t.docId,w:e.Width,h:e.Height,orientation:e.Orientation||"",type:e.Type,size:e.Size||m.fileSize})}catch(e){n(e)}},onerror:n}):"video"===u.type||"audio"===u.type?y(a+"?vinfo",{onload:function(e){try{(e=JSON.parse(e)).GetVideoInfo&&e.GetVideoInfo.VideoInfo&&(e=e.GetVideoInfo.VideoInfo),u.uploaddone(null,{docId:t.docId,w:e.Width,h:e.Height,dur:e.Duration,orientation:e.Rotate,audioCodec:e.AudioCodec,videoCodec:e.VideoCodec,container:e.Container,size:e.Size||m.fileSize})}catch(e){n(e)}},onerror:n}):u.uploaddone(null,{docId:t.docId,size:m.fileSize}))},onerror:p};return f.data=m.file.slice(0,h),y(u.url,f)}},function(e,t,n){"use strict";var r=n(53);e.exports=function(e,t){return t.method="POST",t.headers=t.headers||{},t.headers["Content-Type"]="multipart/form-data",t.timeout=0,t.type=t.type||"json",r(e,t)}},function(e,t,n){"use strict";var i,o,a=n(13),c=n(53);i=/json/i,o=/post/i;e.exports=function(e,t){var n=(t=t||{}).data=t.data||{},r=t.headers=t.headers||{},s=a.checkWithDefault(r,"Accept","application/json"),r=a.checkWithDefault(r,"Content-Type","application/json");return i.test(s)&&(t.type="json"),o.test(t.method)&&i.test(r)&&(t.data=JSON.stringify(n)),c(e,t)}},function(e,t,n){"use strict";var i=n(13),o=n(85),r=n(68),a={};function s(e){this.init(),r.call(this,e)}var c,u,l=r.prototype,n=s.prototype=Object.create(l);function m(e){var t,n,e=e.data;0===e.indexOf(c)&&(t=(e=JSON.parse(e.replace(c,""))).key,n=a[t])&&(delete a[t],e.result=decodeURIComponent(e.result||""),n.onLoad(e))}n.init=(u=!(c="NEJ-AJAX-DATA:"),function(){var e;u||(u=!0,(e=i.getGlobal()).postMessage?i.on(e,"message",m):o.addMsgListener(m))}),n.doSend=function(){var e,t,n=this.options,r=i.url2origin(n.url),s=n.proxyUrl||r+"/res/nej_proxy_frame.html",r=a[s];i.isArray(r)?r.push(this.doSend.bind(this,n)):r?this.aborted||(e=this.key=i.uniqueID(),a[e]=this,(t=i.fetch({method:"GET",url:"",data:null,headers:{},timeout:0},n)).key=e,o.postMessage(r,{data:t}),this.afterSend()):(a[s]=[this.doSend.bind(this,n)],i.createIframe({src:s,onload:function(e){var t=a[s];a[s]=i.target(e).contentWindow,t.forEach(function(e){try{e()}catch(e){}})}}))},n.abort=function(){this.aborted=!0,delete a[this.key],l.abort.call(this)},e.exports=s},function(e,t,n){"use strict";var m=n(13),r=n(68),s=n(85),i="NEJ-UPLOAD-RESULT:",d={};function o(e){this.init(),r.call(this,e)}var a,c=r.prototype,n=o.prototype=Object.create(c);function u(e){var t,n,e=e.data;0===e.indexOf(i)&&(t=(e=JSON.parse(e.replace(i,""))).key,n=d[t])&&(delete d[t],e.result=decodeURIComponent(e.result||""),n.onLoad(e.result))}n.init=(a=!1,function(){var e;a||(a=!0,(e=m.getGlobal()).postMessage?m.on(e,"message",u):(s.addMsgListener(u),s.startTimer()))}),n.doSend=function(){var e=this,t=e.options,n=e.key="zoro-ajax-upload-iframe-"+m.uniqueID(),i=(d[n]=e).form=m.html2node('<form style="display:none;"></form>'),r=("undefined"!=typeof document&&document.body.appendChild(i),i.target=n,i.method="POST",i.enctype="multipart/form-data",i.encoding="multipart/form-data",t.url),s=m.genUrlSep(r),o=(i.action=r+s+"_proxy_=form",t.data),a=[],c=[];function u(){a.forEach(function(e,t){t=c[t];t.parentNode&&(e.name=t.name,m.isFunction(e.setAttribute)&&e.setAttribute("form",t.getAttribute("form")),t.parentNode.replaceChild(e,t))})}o&&m.getKeys(o,t.putFileAtEnd).forEach(function(e){var t,n,r,s=o[e];s.tagName&&"INPUT"===s.tagName.toUpperCase()?"file"===s.type&&(n=(t=s).cloneNode(!0),t.parentNode.insertBefore(n,t),(r=m.dataset(t,"name"))&&(t.name=r),i.appendChild(t),m.isFunction(t.setAttribute)&&(t.setAttribute("form",""),t.removeAttribute("form")),a.push(s),c.push(n)):((r=m.html2node('<input type="hidden"/>')).name=e,r.value=s,i.appendChild(r))});var l=e.iframe=m.createIframe({name:n,onload:function(){e.aborted?u():(m.on(l,"load",e.checkResult.bind(e)),i.submit(),u(),e.afterSend())}})},n.checkResult=function(){var e,t;try{if(0<=(t=((e=this.iframe.contentWindow.document.body).innerText||e.textContent||"").trim()).indexOf(i)||0<=e.innerHTML.indexOf(i))return}catch(e){return}this.onLoad(t)},n.onLoad=function(e){c.onLoad.call(this,{status:200,result:e}),m.remove(this.form),m.remove(this.iframe),c.destroy.call(this)},n.destroy=function(){m.remove(this.iframe),m.remove(this.form)},n.abort=function(){this.aborted=!0,delete d[this.key],c.abort.call(this)},e.exports=o},function(o,e,a){var c;!function(e){"use strict";function t(){}var n=t.prototype,r=e.EventEmitter;function i(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function s(e){return function(){return this[e].apply(this,arguments)}}n.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp)for(n in t={},r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n]);else t=r[e]||(r[e]=[]);return t},n.flattenListeners=function(e){for(var t=[],n=0;n<e.length;n+=1)t.push(e[n].listener);return t},n.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},n.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,r=this.getListenersAsObject(e),s="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===i(r[n],t)&&r[n].push(s?t:{listener:t,once:!1});return this},n.on=s("addListener"),n.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},n.once=s("addOnceListener"),n.defineEvent=function(e){return this.getListeners(e),this},n.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},n.removeListener=function(e,t){var n,r,s=this.getListenersAsObject(e);for(r in s)s.hasOwnProperty(r)&&-1!==(n=i(s[r],t))&&s[r].splice(n,1);return this},n.off=s("removeListener"),n.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},n.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},n.manipulateListeners=function(e,t,n){var r,s,i=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)i.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(s=t[r])&&("function"==typeof s?i:o).call(this,r,s);return this},n.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"==n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},n.removeAllListeners=s("removeEvent"),n.emitEvent=function(e,t){var n,r,s,i,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(n=o[i].slice(0),s=0;s<n.length;s++)!0===(r=n[s]).once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},n.trigger=s("emitEvent"),n.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},n.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},n._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},n._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return e.EventEmitter=r,t},void 0!==(c=function(){return t}.call(e,a,e,o))&&(o.exports=c)}(this||{})},function(e,t,n){"use strict";var i=n(13),r=n(68);function s(e){e.onuploading&&this.on("uploading",e.onuploading),r.call(this,e)}var o=r.prototype,n=s.prototype=Object.create(o);n.doSend=function(){var n,r=this.options,t=r.headers,s=this.xhr=new XMLHttpRequest;"multipart/form-data"===t["Content-Type"]?(delete t["Content-Type"],s.upload.onprogress=this.onProgress.bind(this),s.upload.onload=this.onProgress.bind(this),n=r.data,r.data=new window.FormData,n&&i.getKeys(n,r.putFileAtEnd).forEach(function(e){var t=n[e];t.tagName&&"INPUT"===t.tagName.toUpperCase()?"file"===t.type&&[].forEach.call(t.files,function(e){r.data.append(i.dataset(t,"name")||t.name||e.name||"file-"+i.uniqueID(),e)}):r.data.append(e,t)})):t["x-nos-token"]&&(s.upload.onprogress=this.onProgress.bind(this),s.upload.onload=this.onProgress.bind(this)),s.onreadystatechange=this.onStateChange.bind(this),0!==r.timeout&&(this.timer=setTimeout(this.onTimeout.bind(this),r.timeout)),s.open(r.method,r.url,!r.sync),Object.keys(t).forEach(function(e){s.setRequestHeader(e,t[e])}),r.cookie&&"withCredentials"in s&&(s.withCredentials=!0),s.send(r.data),this.afterSend()},n.onProgress=function(e){e.lengthComputable&&e.loaded<=e.total&&this.emit("uploading",e)},n.onStateChange=function(){var e=this.xhr;4===e.readyState&&this.onLoad({status:e.status,result:e.responseText||""})},n.getResponseHeader=function(e){var t=this.xhr;return t?t.getResponseHeader(e):""},n.destroy=function(){clearTimeout(this.timer);try{this.xhr.onreadystatechange=i.f,this.xhr.abort()}catch(e){}o.destroy.call(this)},e.exports=s},function(e,t,n){"use strict";n(192).polyfill(),n(5).isBrowser=!0},,,,,,,,,,,,function(e,t){e.exports=function(e){var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString},function(e,t,n){"use strict";var r=n(56);function s(){}s.typeMap={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};var i=s.typeReverseMap={0:"text",1:"image",2:"audio",3:"video",4:"geo",5:"notification",6:"file",10:"tip",11:"robot",100:"custom"};s.validTypes=Object.keys(s.typeMap),s.setFlow=function(e,t){var n=t===e.from;n&&t===e.to&&(n=r.deviceId===e.fromDeviceId),e.flow=n?"out":"in","robot"===e.type&&e.content&&e.content.msgOut&&(e.flow="in")},s.getType=function(e){e=e.type;return i[e]||e},e.exports=s},function(module,exports,__webpack_require__){!function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;function getGlobal(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==global?global:{}}var root=getGlobal(),io=module.exports;void 0===root.location&&(root.location=null),root.io?module&&(module.exports=io=root.io):root.io=io,function(){!function(e,i){var o=e;o.version="0.9.11",o.protocol=1,o.transports=[],o.j=[],o.sockets={},o.connect=function(e,t){var n,r,e=o.util.parseUri(e),s=(i&&i.location&&(e.protocol=e.protocol||i.location.protocol.slice(0,-1),e.host=e.host||(i.document?i.document.domain:i.location.hostname),e.port=e.port||i.location.port),n=o.util.uniqueUri(e),{host:e.host,secure:"https"===e.protocol,port:e.port||("https"===e.protocol?443:80),query:e.query||""});return o.util.merge(s,t),!s["force new connection"]&&o.sockets[n]||(r=new o.Socket(s)),!s["force new connection"]&&r&&(o.sockets[n]=r),(r=r||o.sockets[n]).of(1<e.path.length?e.path:"")}}(module.exports,root),function(e,r){var a=e.util={},s=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],t=(a.parseUri=function(e){for(var t=s.exec(e||""),n={},r=14;r--;)n[i[r]]=t[r]||"";return n},a.uniqueUri=function(e){var t=e.protocol,n=e.host,e=e.port;return"document"in r&&r.document?(n=n||document.domain,e=e||("https"==t&&"https:"!==document.location.protocol?443:document.location.port)):(n=n||"localhost",e||"https"!=t||(e=443)),(t||"http")+"://"+n+":"+(e||80)},a.query=function(e,t){var n,r=a.chunkQuery(e||""),s=[];for(n in a.merge(r,a.chunkQuery(t||"")),r)r.hasOwnProperty(n)&&s.push(n+"="+r[n]);return s.length?"?"+s.join("&"):""},!(a.chunkQuery=function(e){for(var t,n={},r=e.split("&"),s=0,i=r.length;s<i;++s)(t=r[s].split("="))[0]&&(n[t[0]]=t[1]);return n}));a.load=function(e){if("undefined"!=typeof document&&document&&"complete"===document.readyState||t)return e();a.on(r,"load",e,!1)},a.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},a.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!a.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||a.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new root[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}return null},void 0!==root&&a.load(function(){t=!0}),a.defer=function(e){if(!a.ua.webkit||"undefined"!=typeof importScripts)return e();a.load(function(){setTimeout(e,100)})},a.merge=function(e,t,n,r){var s,i=r||[],o=void 0===n?2:n;for(s in t)t.hasOwnProperty(s)&&a.indexOf(i,s)<0&&("object"==typeof e[s]&&o?a.merge(e[s],t[s],o-1,i):(e[s]=t[s],i.push(t[s])));return e},a.mixin=function(e,t){a.merge(e.prototype,t.prototype)},a.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},a.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a.intersect=function(e,t){for(var n=[],r=e.length>t.length?e:t,s=e.length>t.length?t:e,i=0,o=s.length;i<o;i++)~a.indexOf(r,s[i])&&n.push(s[i]);return n},a.indexOf=function(e,t,n){var r=e.length;for(n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},a.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},a.ua={},a.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),a.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),a.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,root),function(e,o){function t(){}(e.EventEmitter=t).prototype.addListener=t.prototype.on=function(e,t){return this.$events||(this.$events={}),this.$events[e]?o.util.isArray(this.$events[e])?this.$events[e].push(t):this.$events[e]=[this.$events[e],t]:this.$events[e]=t,this},t.prototype.once=function(e,t){var n=this;function r(){n.removeListener(e,r),t.apply(this,arguments)}return r.listener=t,this.on(e,r),this},t.prototype.removeListener=function(e,t){if(this.$events&&this.$events[e]){var n=this.$events[e];if(o.util.isArray(n)){for(var r=-1,s=0,i=n.length;s<i;s++)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;n.splice(r,1),n.length||delete this.$events[e]}else(n===t||n.listener&&n.listener===t)&&delete this.$events[e]}return this},t.prototype.removeAllListeners=function(e){return void 0===e?this.$events={}:this.$events&&this.$events[e]&&(this.$events[e]=null),this},t.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),o.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},t.prototype.emit=function(e){if(!this.$events)return!1;var t=this.$events[e];if(!t)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof t)t.apply(this,n);else{if(!o.util.isArray(t))return!1;for(var r=t.slice(),s=0,i=r.length;s<i;s++)r[s].apply(this,n)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){"use strict";if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={};function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,s,i,o,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),typeof(c="function"==typeof rep?rep.call(t,e,c):c)){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(i=c.length,n=0;n<i;n+=1)o[n]=str(n,c)||"null";s=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]"}else{if(rep&&"object"==typeof rep)for(i=rep.length,n=0;n<i;n+=1)"string"==typeof rep[n]&&(s=str(r=rep[n],c))&&o.push(quote(r)+(gap?": ":":")+s);else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(s=str(r,c))&&o.push(quote(r)+(gap?": ":":")+s);s=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}"}return gap=a,s}}JSON.stringify=function(e,t,n){var r;if(indent=gap="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(!(rep=t)||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("socket.io:: replacer cannot JSON.stringify")},JSON.parse=function(text,reviver){var j;function walk(e,t){var n,r,s=e[t];if(s&&"object"==typeof s)for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(void 0!==(r=walk(s,n))?s[n]=r:delete s[n]);return reviver.call(e,t,s)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("socket.io:: reviver cannot JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var o=e.parser={},c=o.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],u=o.reasons=["transport not supported","client not handshaken","unauthorized"],m=o.advice=["reconnect"],d=t.JSON,p=t.util.indexOf,i=(o.encodePacket=function(e){var t=p(c,e.type),n=e.id||"",r=e.endpoint||"",s=e.ack,i=null;switch(e.type){case"error":var o=e.reason?p(u,e.reason):"",a=e.advice?p(m,e.advice):"";""===o&&""===a||(i=o+(""!==a?"+"+a:""));break;case"message":""!==e.data&&(i=e.data);break;case"event":o={name:e.name};e.args&&e.args.length&&(o.args=e.args),i=d.stringify(o);break;case"json":i=d.stringify(e.data);break;case"connect":e.qs&&(i=e.qs);break;case"ack":i=e.ackId+(e.args&&e.args.length?"+"+d.stringify(e.args):"")}t=[t,n+("data"==s?"+":""),r];return null!=i&&t.push(i),t.join(":")},o.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,r=e.length;n<r;n++)t+="�"+e[n].length+"�"+e[n];return t},/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);o.decodePacket=function(e){if(!(r=e.match(i)))return{};var t=r[2]||"",n=(e=r[5]||"",{type:c[r[1]],endpoint:r[4]||""});switch(t&&(n.id=t,r[3]?n.ack="data":n.ack=!0),n.type){case"error":var r=e.split("+");n.reason=u[r[0]]||"",n.advice=m[r[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var s=d.parse(e);n.name=s.name,n.args=s.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=d.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((r=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=r[1],n.args=[],r[3]))try{n.args=r[3]?d.parse(r[3]):[]}catch(e){}}return n},o.decodePayload=function(e){if("�"!=e.charAt(0))return[o.decodePacket(e)];for(var t,n,r=[],s=1,i="";s<e.length;s++)"�"==e.charAt(s)?(t=e.substr(s+1).substr(0,i),"�"!=e.charAt(s+1+Number(i))&&s+1+Number(i)!=e.length&&(n=Number(i),l=function(e,t){for(var n=0,r=e;r<t.length;r++){if("�"==t.charAt(r))return n;n++}return n}(s+n+1,e),t=e.substr(s+1).substr(0,n+l),s+=l),r.push(o.decodePacket(t)),s+=Number(i)+1,i=""):i+=e.charAt(s);return r}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,s){function t(e,t){this.socket=e,this.sessid=t}e.Transport=t,s.util.mixin(t,s.EventEmitter),t.prototype.heartbeats=function(){return!0},t.prototype.onData=function(e){if(this===this.socket.transport&&(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e)){var t=s.parser.decodePayload(e);if(t&&t.length)for(var n=0,r=t.length;n<r;n++)this.onPacket(t[n])}return this},t.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},t.prototype.setCloseTimeout=function(){var e;this.closeTimeout||((e=this).closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout))},t.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket&&(this.socket.transport===this?this.socket.onDisconnect():this.socket.setBuffer(!1)),this},t.prototype.onConnect=function(){return this.socket.onConnect(),this},t.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},t.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},t.prototype.packet=function(e){this.send(s.parser.encodePacket(e))},t.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},t.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},t.prototype.onClose=function(){this.isOpen=!1,this.socket.transport===this?this.socket.onClose():this.socket.setBuffer(!1),this.onDisconnect(),this.onDisconnectDone instanceof Function&&this.onDisconnectDone(null),this.onConnectionOver instanceof Function&&this.onConnectionOver(null)},t.prototype.onDisconnectDone=function(){},t.prototype.onConnectionOver=function(){},t.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+s.protocol+"/"+this.name+"/"+this.sessid},t.prototype.ready=function(e,t){t.call(this)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,a,n){function t(e){var t;this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:e.transports||a.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},a.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,!this.options["sync disconnect on unload"]||this.isXDomain()&&!a.util.ua.hasCORS||(t=this,a.util.on(n,"beforeunload",function(){t.disconnectSync()},!1)),this.options["auto connect"]&&this.connect()}function c(){}e.Socket=t,a.util.mixin(t,a.EventEmitter),t.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new a.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},t.prototype.publish=function(){var e,t;for(t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},t.prototype.handshake=function(t){var n=this,e=this.options;function r(e){e instanceof Error?(n.connecting=!1,n.onError(e.message)):t.apply(null,e.split(":"))}var s,i,o,e=["http"+(e.secure?"s":"")+":/",e.host+":"+e.port,e.resource,a.protocol,a.util.query(this.options.query,"t="+ +new Date)].join("/");this.isXDomain()&&!a.util.ua.hasCORS&&"undefined"!=typeof document&&document&&document.getElementsByTagName?(s=document.getElementsByTagName("script")[0],(i=document.createElement("script")).src=e+"&jsonp="+a.j.length,i.onreadystatechange=function(){"loaded"==this.readyState&&i.parentNode&&(i.parentNode.removeChild(i),n.connecting=!1,n.reconnecting||n.onError("Server down or port not open"),n.publish("handshake_failed"))},s.parentNode.insertBefore(i,s),a.j.push(function(e){r(e),i.parentNode.removeChild(i)})):((o=a.util.request()).open("GET",e,!0),o.timeout=1e4,this.isXDomain()&&(o.withCredentials=!0),o.onreadystatechange=function(){4==o.readyState&&(o.onreadystatechange=c,200==o.status?r(o.responseText):(403==o.status?(n.connecting=!1,n.onError(o.responseText)):(n.connecting=!1,n.reconnecting||n.onError(o.responseText)),n.publish("handshake_failed")))},o.ontimeout=function(e){n.connecting=!1,n.reconnecting||n.onError(o.responseText),n.publish("handshake_failed")},o.send(null))},t.prototype.connect=function(s){var i;return this.connecting||((i=this).connecting=!0,this.handshake(function(e,t,n,r){i.sessionid=e,i.closeTimeout=1e3*n,i.heartbeatTimeout=1e3*t,i.transports||(i.transports=i.origTransports=r?a.util.intersect(r.split(","),i.options.transports):i.options.transports),i.setHeartbeatTimeout(),i.once("connect",function(){clearTimeout(i.connectTimeoutTimer),i.connectTimeoutTimer=null,s&&"function"==typeof s&&s()}),i.doConnect()})),this},t.prototype.doConnect=function(){var e=this;if(e.transport&&e.transport.clearTimeouts(),e.transport=e.getTransport(e.transports),!e.transport)return e.publish("connect_failed");e.transport.ready(e,function(){e.connecting=!0,e.publish("connecting",e.transport.name),e.transport.open(),e.options["connect timeout"]&&(e.connectTimeoutTimer&&clearTimeout(e.connectTimeoutTimer),e.connectTimeoutTimer=setTimeout(e.tryNextTransport.bind(e),e.options["connect timeout"]))})},t.prototype.getTransport=function(e){for(var t,n=e||this.transports,r=0;t=n[r];r++)if(a.Transport[t]&&a.Transport[t].check(this)&&(!this.isXDomain()||a.Transport[t].xdomainCheck(this)))return new a.Transport[t](this,this.sessionid);return null},t.prototype.tryNextTransport=function(){if(!this.connected&&(this.connecting=!1,this.options["try multiple transports"])){for(var e=this.transports;0<e.length&&e.splice(0,1)[0]!=this.transport.name;);e.length?this.doConnect():this.publish("connect_failed")}},t.prototype.setHeartbeatTimeout=function(){var e;clearTimeout(this.heartbeatTimeoutTimer),this.transport&&!this.transport.heartbeats()||((e=this).heartbeatTimeoutTimer=setTimeout(function(){e.transport&&e.transport.onClose()},this.heartbeatTimeout))},t.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},t.prototype.setBuffer=function(e){(this.doBuffer=e)||!this.connected||!this.buffer.length||this.options.manualFlush||this.flushBuffer()},t.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},t.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},t.prototype.disconnectSync=function(){var e=a.util.request(),t=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,a.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",t,!1),e.send(null),this.onDisconnect("booted")},t.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},t.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},t.prototype.onOpen=function(){this.open=!0},t.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},t.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},t.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect)&&this.reconnect(),this.publish("error",e&&e.reason?e.reason:e)},t.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e)&&this.options.reconnect&&!this.reconnecting&&this.reconnect(),n)&&(this.connectTimeoutTimer&&clearTimeout(this.connectTimeoutTimer),this.tryNextTransport())},t.prototype.reconnect=function(){this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var t=this,e=this.options["max reconnection attempts"],n=this.options["try multiple transports"],r=this.options["reconnection limit"];function s(){if(t.connected){for(var e in t.namespaces)t.namespaces.hasOwnProperty(e)&&""!==e&&t.namespaces[e].packet({type:"connect"});t.publish("reconnect",t.transport.name,t.reconnectionAttempts)}clearTimeout(t.reconnectionTimer),t.removeListener("connect_failed",i),t.removeListener("connect",i),t.reconnecting=!1,delete t.reconnectionAttempts,delete t.reconnectionDelay,delete t.reconnectionTimer,delete t.redoTransports,t.options["try multiple transports"]=n}function i(){if(t.reconnecting)return t.connected?s():t.connecting&&t.reconnecting?t.reconnectionTimer=setTimeout(i,1e3):void(t.reconnectionAttempts++>=e?t.redoTransports?(t.publish("reconnect_failed"),s()):(t.on("connect_failed",i),t.options["try multiple transports"]=!0,t.transports=t.origTransports,t.transport=t.getTransport(),t.redoTransports=!0,t.connect()):(t.reconnectionDelay<r&&(t.reconnectionDelay*=2),t.connect(),t.publish("reconnecting",t.reconnectionDelay,t.reconnectionAttempts),t.reconnectionTimer=setTimeout(i,t.reconnectionDelay)))}this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(i,this.reconnectionDelay),this.on("connect",i)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,root),function(e,s){function t(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}function n(e,t){this.namespace=e,this.name=t}e.SocketNamespace=t,s.util.mixin(t,s.EventEmitter),t.prototype.$emit=s.EventEmitter.prototype.emit,t.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},t.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},t.prototype.send=function(e,t){e={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(e.id=++this.ackPackets,e.ack=!0,this.acks[e.id]=t),this.packet(e)},t.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},t.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},t.prototype.onPacket=function(e){var t=this;function n(){t.packet({type:"ack",args:s.util.toArray(arguments),ackId:e.id})}switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var r=["message",e.data];"data"==e.ack?r.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,r);break;case"event":r=[e.name].concat(e.args),"data"==e.ack&&r.push(n),this.$emit.apply(this,r);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"===e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,r,s){function t(e){r.Transport.apply(this,arguments)}e.websocket=t,r.util.inherit(t,r.Transport),t.prototype.name="websocket",t.prototype.open=function(){var e=r.util.query(this.socket.options.query),t=this,n=n||s.MozWebSocket||s.WebSocket;return this.websocket=new n(this.prepareUrl()+e),this.websocket.onopen=function(){t.onOpen(),t.socket.setBuffer(!1)},this.websocket.onmessage=function(e){t.onData(e.data)},this.websocket.onclose=function(){t.socket.setBuffer(!0),t.onClose()},this.websocket.onerror=function(e){t.onError(e)},this},r.util.ua.iDevice?t.prototype.send=function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:t.prototype.send=function(e){return this.websocket.send(e),this},t.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},t.prototype.close=function(){return this.websocket.close(),this},t.prototype.onError=function(e){this.socket.onError(e)},t.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},t.check=function(){return"WebSocket"in s&&!("__addTask"in WebSocket)||"MozWebSocket"in s},t.xdomainCheck=function(){return!0},r.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),function(e,o,a){function t(e){e&&(o.Transport.apply(this,arguments),this.sendBuffer=[])}function n(){}e.XHR=t,o.util.inherit(t,o.Transport),t.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},t.prototype.payload=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(o.parser.encodePacket(e[n]));this.send(o.parser.encodePayload(t))},t.prototype.send=function(e){return this.post(e),this},t.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),a.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=n,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=n,t.posting=!1,200==this.status?t.socket.setBuffer(!1):t.onClose())},this.sendXHR.send(e)},t.prototype.close=function(){return this.onClose(),this},t.prototype.request=function(e){var t=o.util.request(this.socket.isXDomain()),n=o.util.query(this.socket.options.query,"t="+ +new Date);if(t.open(e||"GET",this.prepareUrl()+n,!0),"POST"==e)try{t.setRequestHeader?t.setRequestHeader("Content-type","text/plain;charset=UTF-8"):t.contentType="text/plain"}catch(e){}return t},t.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},t.check=function(e,t){try{var n=o.util.request(t),r=a.XDomainRequest&&n instanceof XDomainRequest,s=e&&e.options&&e.options.secure?"https:":"http:",i=a.location&&s!=a.location.protocol;if(n&&(!r||!i))return!0}catch(e){}return!1},t.xdomainCheck=function(e){return t.check(e,!0)}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),function(e,r,t){function n(){r.Transport.XHR.apply(this,arguments)}function s(){}e["xhr-polling"]=n,r.util.inherit(n,r.Transport.XHR),r.util.merge(n,r.Transport.XHR),n.prototype.name="xhr-polling",n.prototype.heartbeats=function(){return!1},n.prototype.open=function(){return r.Transport.XHR.prototype.open.call(this),!1},n.prototype.get=function(){var e;this.isOpen&&((e=this).xhr=this.request(),t.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){this.onload=s,this.onerror=s,e.retryCounter=1,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.retryCounter++,!e.retryCounter||3<e.retryCounter?e.onClose():e.get()}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=s,200==this.status?(e.onData(this.responseText),e.get()):e.onClose())},this.xhr.send(null))},n.prototype.onClose=function(){if(r.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=s;try{this.xhr.abort()}catch(e){}this.xhr=null}},n.prototype.ready=function(e,t){var n=this;r.util.defer(function(){t.call(n)})},r.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return io}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}.call(this,__webpack_require__(33),__webpack_require__(309)(module))},function(e,t,n){"use strict";var r={1:"ROOM_CLOSE",2:"ROOM_JOIN",3:"INVITE",4:"CANCEL_INVITE",5:"REJECT",6:"ACCEPT",7:"LEAVE",8:"CONTROL"},s={1:"accid",2:"uid",3:"createTime",4:"expireTime",5:"web_uid"},i={10404:"ROOM_NOT_EXISTS",10405:"ROOM_HAS_EXISTS",10406:"ROOM_MEMBER_NOT_EXISTS",10407:"ROOM_MEMBER_HAS_EXISTS",10408:"INVITE_NOT_EXISTS",10409:"INVITE_HAS_REJECT",10410:"INVITE_HAS_ACCEPT",10201:"PEER_NIM_OFFLINE",10202:"PEER_PUSH_OFFLINE",10419:"ROOM_MEMBER_EXCEED",10420:"ROOM_MEMBER_HAS_EXISTS_OTHER_CLIENT",10417:"UID_CONFLICT"};e.exports={parseAvSignalType:function(e){return r[e]||e},parseAvSignalMember:function(t){var n={};return Object.keys(t).forEach(function(e){n[s[e]]=t[e]}),n},parseAvSignalError:function(e){return e.message=i[e.code]||e.message||e,e}}},function(e,t,n){"use strict";var r=n(0),s={stripmeta:0,blur:2,quality:3,crop:4,rotate:5,thumbnail:7,interlace:9},i={0:"stripmeta",1:"type",2:"blur",3:"quality",4:"crop",5:"rotate",6:"pixel",7:"thumbnail",8:"watermark",9:"interlace",10:"tmp"};function o(e){r.verifyOptions(e,"type","image::ImageOp"),r.verifyParamValid("type",e.type,o.validTypes,"image::ImageOp"),r.merge(this,e),this.type=s[e.type]}o.validTypes=Object.keys(s),o.reverse=function(e){e=r.copy(e);return e.type=i[e.type],e},o.reverseImageOps=function(e){return e.map(function(e){return o.reverse(e)})},e.exports=o},function(e,t,n){"use strict";var i=n(0);e.exports={fromDataURL:function(e){for(var t=i.getGlobal(),n=void 0,n=0<=e.split(",")[0].indexOf("base64")?t.atob(e.split(",")[1]):t.decodeURIComponent(e.split(",")[1]),e=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(n.length),s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return new t.Blob([r],{type:e})}}},function(e,t,n){"use strict";var r=n(0),s={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}};e.exports={genResponseBody:function(e){return s[e=e||"file"]},parseResponse:function(e,t){r.notundef(e.size)&&(e.size=+e.size),r.notundef(e.w)&&(e.w=+e.w),r.notundef(e.h)&&(e.h=+e.h),r.notundef(e.dur)&&(e.dur=+e.dur);var n=e.orientation;return r.notundef(n)&&(delete e.orientation,t)&&("right, top"===n||"left, bottom"===n)&&(t=e.w,e.w=e.h,e.h=t),e}}},,,,,,,,,,,,function(e,t,n){"use strict";var r=n(69),s=n(0),i=s.notundef,o={"-2":"unset","-1":"restricted",0:"common",1:"owner",2:"manager",3:"guest",4:"anonymous"};function a(e){i(e.nick)&&(this.nick=""+e.nick),i(e.avatar)&&(this.avatar=""+e.avatar),i(e.custom)&&(this.custom=""+e.custom)}a.reverse=function(e){e=s.copy(e);return i(e.chatroomId)&&(e.chatroomId=""+e.chatroomId),i(e.avatar)&&(e.avatar=(0,r.genPrivateUrl)(e.avatar)),i(e.type)&&(e.type=o[e.type]),i(e.level)&&(e.level=+e.level),i(e.online)&&(e.online=1==+e.online),i(e.enterTime)&&(e.enterTime=+e.enterTime),i(e.guest)&&(e.guest=1==+e.guest),i(e.blacked)&&(e.blacked=1==+e.blacked),i(e.gaged)&&(e.gaged=1==+e.gaged),i(e.valid)&&(e.valid=1==+e.valid),i(e.updateTime)&&(e.updateTime=+e.updateTime),i(e.tempMuted)?e.tempMuted=1==+e.tempMuted:e.tempMuted=!1,i(e.tempMuteDuration)?e.tempMuteDuration=+e.tempMuteDuration:e.tempMuteDuration=0,e.online||delete e.enterTime,e.guest&&(e.type="guest",delete e.valid),"common"!==e.type&&delete e.level,delete e.guest,e},a.reverseMembers=function(e){return e.map(function(e){return a.reverse(e)})},a.validTypes=Object.keys(o),a.typeReverseMap=o,e.exports=a},function(e,t,n){"use strict";var r=n(21),s=n(298),i=n(168),o=n(76),a=n(70),c=n(0),u=n(190),l=n(171),m=n(39),d=n(292),p=n(291);e.exports=function(e){c.merge(e,{platform:r,xhr:s,io:i,naturalSort:o,deepAccess:a,util:c,support:u,blob:l,ajax:m,LoggerPlugin:d,usePlugin:p})}},function(e,t,n){"use strict";var r=n(0),n=n(82),s=r.merge({},n.idMap,{auth:{id:2,login:3,kicked:5,logout:6,multiPortLogin:7,kick:8},user:{id:3,updatePushToken:1,appBackground:2,markInBlacklist:3,getBlacklist:4,markInMutelist:5,getMutelist:6,getRelations:8,getUsers:7,updateMyInfo:10,updateDonnop:15,syncMyInfo:109,syncUpdateMyInfo:110},notify:{id:4,markRead:3,syncOfflineMsgs:4,batchMarkRead:5,syncOfflineSysMsgs:6,syncOfflineNetcallMsgs:8,syncRoamingMsgs:9,syncMsgReceipts:12,syncRobots:15,syncBroadcastMsgs:16,syncSuperTeamRoamingMsgs:17},sync:{id:5,sync:1,syncTeamMembers:2,syncSuperTeamMembers:3},msg:{id:7,sendMsg:1,msg:2,sysMsg:3,getHistoryMsgs:6,sendCustomSysMsg:7,searchHistoryMsgs:8,deleteSessions:9,getSessions:10,syncSendMsg:101,sendMsgReceipt:11,msgReceipt:12,deleteMsg:13,msgDeleted:14,markSessionAck:16,broadcastMsg:17,clearServerHistoryMsgs:18},team:{id:8,createTeam:1,sendTeamMsg:2,teamMsg:3,teamMsgs:4,addTeamMembers:5,removeTeamMembers:6,updateTeam:7,leaveTeam:8,getTeam:9,getTeams:10,getTeamMembers:11,dismissTeam:12,applyTeam:13,passTeamApply:14,rejectTeamApply:15,addTeamManagers:16,removeTeamManagers:17,transferTeam:18,updateInfoInTeam:19,updateNickInTeam:20,acceptTeamInvite:21,rejectTeamInvite:22,getTeamHistoryMsgs:23,searchTeamHistoryMsgs:24,updateMuteStateInTeam:25,getMyTeamMembers:26,getMutedTeamMembers:27,sendTeamMsgReceipt:28,getTeamMsgReads:29,getTeamMsgReadAccounts:30,notifyTeamMsgReads:31,muteTeamAll:32,getTeamMemberInvitorAccid:33,syncMyTeamMembers:126,syncTeams:109,syncTeamMembers:111,syncCreateTeam:101,syncSendTeamMsg:102,syncUpdateTeamMember:119},superTeam:{id:21,sendSuperTeamMsg:2,superTeamMsg:3,addSuperTeamMembers:5,removeSuperTeamMembers:6,leaveSuperTeam:7,updateSuperTeam:8,getSuperTeam:9,getSuperTeams:12,updateInfoInSuperTeam:10,getMySuperTeamMembers:11,getSuperTeamMembers:13,getSuperTeamHistoryMsgs:14,getSuperTeamMembersByJoinTime:15,syncMySuperTeamMembers:111,syncSuperTeams:109,syncSuperTeamMembers:113,syncCreateSuperTeam:101,syncSendSuperTeamMsg:102,syncUpdateSuperTeamMember:110},friend:{id:12,friendRequest:1,syncFriendRequest:101,deleteFriend:2,syncDeleteFriend:102,updateFriend:3,syncUpdateFriend:103,getFriends:4},chatroom:{id:13,getChatroomAddress:1},filter:{id:101,sendFilterMsg:1,filterMsg:2,filterSysMsg:3,sendFilterCustomSysMsg:7},eventService:{id:14,publishEvent:1,pushEvent:2,subscribeEvent:3,unSubscribeEventsByAccounts:4,unSubscribeEventsByType:5,querySubscribeEventsByAccounts:6,querySubscribeEventsByType:7,pushEvents:9}}),i=r.merge({},n.cmdConfig,{login:{sid:s.auth.id,cid:s.auth.login,params:[{type:"Property",name:"login"}]},logout:{sid:s.auth.id,cid:s.auth.logout},kick:{sid:s.auth.id,cid:s.auth.kick,params:[{type:"StrArray",name:"deviceIds"}]},updatePushToken:{sid:s.user.id,cid:s.user.updatePushToken,params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"int",name:"pushkit"}]},appBackground:{sid:s.user.id,cid:s.user.appBackground,params:[{type:"bool",name:"isBackground"},{type:"Int",name:"badge"}]},markInBlacklist:{sid:s.user.id,cid:s.user.markInBlacklist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getBlacklist:{sid:s.user.id,cid:s.user.getBlacklist,params:[{type:"long",name:"time"}]},markInMutelist:{sid:s.user.id,cid:s.user.markInMutelist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getMutelist:{sid:s.user.id,cid:s.user.getMutelist,params:[{type:"long",name:"time"}]},getRelations:{sid:s.user.id,cid:s.user.getRelations,params:[{type:"long",name:"timetag"}]},getUsers:{sid:s.user.id,cid:s.user.getUsers,params:[{type:"StrArray",name:"accounts"}]},updateMyInfo:{sid:s.user.id,cid:s.user.updateMyInfo,params:[{type:"Property",name:"user"}]},updateDonnop:{sid:s.user.id,cid:s.user.updateDonnop,params:[{type:"Property",name:"donnop"}]},markRead:{sid:s.notify.id,cid:s.notify.markRead,params:[{type:"long",name:"id"},{type:"ph",name:"ph"}]},batchMarkRead:{sid:s.notify.id,cid:s.notify.batchMarkRead,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},sync:{sid:s.sync.id,cid:s.sync.sync,params:[{type:"Property",name:"sync"}]},syncTeamMembers:{sid:s.sync.id,cid:s.sync.syncTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},syncSuperTeamMembers:{sid:s.sync.id,cid:s.sync.syncSuperTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},sendMsg:{sid:s.msg.id,cid:s.msg.sendMsg,params:[{type:"Property",name:"msg"}]},getHistoryMsgs:{sid:s.msg.id,cid:s.msg.getHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},sendCustomSysMsg:{sid:s.msg.id,cid:s.msg.sendCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},searchHistoryMsgs:{sid:s.msg.id,cid:s.msg.searchHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSessions:{sid:s.msg.id,cid:s.msg.getSessions,params:[{type:"long",name:"time"}]},deleteSessions:{sid:s.msg.id,cid:s.msg.deleteSessions,params:[{type:"StrArray",name:"sessions"}]},sendMsgReceipt:{sid:s.msg.id,cid:s.msg.sendMsgReceipt,params:[{type:"Property",name:"msgReceipt"}]},deleteMsg:{sid:s.msg.id,cid:s.msg.deleteMsg,params:[{type:"Property",name:"sysMsg"}]},markSessionAck:{sid:s.msg.id,cid:s.msg.markSessionAck,params:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},clearServerHistoryMsgs:{sid:s.msg.id,cid:s.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParams"}]},sendSuperTeamMsg:{sid:s.superTeam.id,cid:s.superTeam.sendSuperTeamMsg,params:[{type:"Property",name:"msg"}]},addSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.addSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.removeSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},leaveSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.leaveSuperTeam,params:[{type:"long",name:"teamId"}]},updateSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.updateSuperTeam,params:[{type:"Property",name:"team"}]},getSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeam,params:[{type:"long",name:"teamId"}]},getSuperTeams:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeams,params:[{type:"long",name:"timetag"}]},getSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},updateInfoInSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.updateInfoInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},getSuperTeamHistoryMsgs:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},getSuperTeamMembersByJoinTime:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamMembersByJoinTime,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getMySuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.getMySuperTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},createTeam:{sid:s.team.id,cid:s.team.createTeam,params:[{type:"Property",name:"team"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}]},sendTeamMsg:{sid:s.team.id,cid:s.team.sendTeamMsg,params:[{type:"Property",name:"msg"}]},addTeamMembers:{sid:s.team.id,cid:s.team.addTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}]},removeTeamMembers:{sid:s.team.id,cid:s.team.removeTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateTeam:{sid:s.team.id,cid:s.team.updateTeam,params:[{type:"Property",name:"team"}]},leaveTeam:{sid:s.team.id,cid:s.team.leaveTeam,params:[{type:"long",name:"teamId"}]},getTeam:{sid:s.team.id,cid:s.team.getTeam,params:[{type:"long",name:"teamId"}]},getTeams:{sid:s.team.id,cid:s.team.getTeams,params:[{type:"long",name:"timetag"}]},getTeamMembers:{sid:s.team.id,cid:s.team.getTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},dismissTeam:{sid:s.team.id,cid:s.team.dismissTeam,params:[{type:"long",name:"teamId"}]},applyTeam:{sid:s.team.id,cid:s.team.applyTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passTeamApply:{sid:s.team.id,cid:s.team.passTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:s.team.id,cid:s.team.rejectTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},addTeamManagers:{sid:s.team.id,cid:s.team.addTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:s.team.id,cid:s.team.removeTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},transferTeam:{sid:s.team.id,cid:s.team.transferTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},updateInfoInTeam:{sid:s.team.id,cid:s.team.updateInfoInTeam,params:[{type:"Property",name:"teamMember"}]},updateNickInTeam:{sid:s.team.id,cid:s.team.updateNickInTeam,params:[{type:"Property",name:"teamMember"}]},acceptTeamInvite:{sid:s.team.id,cid:s.team.acceptTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:s.team.id,cid:s.team.rejectTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},getTeamHistoryMsgs:{sid:s.team.id,cid:s.team.getTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},searchTeamHistoryMsgs:{sid:s.team.id,cid:s.team.searchTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},updateMuteStateInTeam:{sid:s.team.id,cid:s.team.updateMuteStateInTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"int",name:"mute"}]},getMyTeamMembers:{sid:s.team.id,cid:s.team.getMyTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},getMutedTeamMembers:{sid:s.team.id,cid:s.team.getMutedTeamMembers,params:[{type:"long",name:"teamId"}]},sendTeamMsgReceipt:{sid:s.team.id,cid:s.team.sendTeamMsgReceipt,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReads:{sid:s.team.id,cid:s.team.getTeamMsgReads,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReadAccounts:{sid:s.team.id,cid:s.team.getTeamMsgReadAccounts,params:[{type:"Property",name:"teamMsgReceipt"}]},muteTeamAll:{sid:s.team.id,cid:s.team.muteTeamAll,params:[{type:"long",name:"teamId"},{type:"int",name:"muteType"}]},getTeamMemberInvitorAccid:{sid:s.team.id,cid:s.team.getTeamMemberInvitorAccid,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},friendRequest:{sid:s.friend.id,cid:s.friend.friendRequest,params:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:s.friend.id,cid:s.friend.deleteFriend,params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams"}]},updateFriend:{sid:s.friend.id,cid:s.friend.updateFriend,params:[{type:"Property",name:"friend"}]},getFriends:{sid:s.friend.id,cid:s.friend.getFriends,params:[{type:"long",name:"timetag"}]},getChatroomAddress:{sid:s.chatroom.id,cid:s.chatroom.getChatroomAddress,params:[{type:"long",name:"chatroomId"},{type:"bool",name:"isWeixinApp"}]},sendFilterMsg:{sid:s.filter.id,cid:s.filter.sendFilterMsg,params:[{type:"Property",name:"msg"}]},sendFilterCustomSysMsg:{sid:s.filter.id,cid:s.filter.sendFilterCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},publishEvent:{sid:s.eventService.id,cid:s.eventService.publishEvent,params:[{type:"Property",name:"msgEvent"}]},pushEvent:{sid:s.eventService.id,cid:s.eventService.pushEvent},subscribeEvent:{sid:s.eventService.id,cid:s.eventService.subscribeEvent,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:s.eventService.id,cid:s.eventService.unSubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:s.eventService.id,cid:s.eventService.unSubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},querySubscribeEventsByAccounts:{sid:s.eventService.id,cid:s.eventService.querySubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},querySubscribeEventsByType:{sid:s.eventService.id,cid:s.eventService.querySubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},pushEvents:{sid:s.eventService.id,cid:s.eventService.pushEvents}}),r=r.merge({},n.packetConfig,{"2_3":{service:"auth",cmd:"login",response:[{type:"Property",name:"loginRes"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"},{type:"Property",name:"aosPushInfo"}]},"2_5":{service:"auth",cmd:"kicked",response:[{type:"Number",name:"from"},{type:"Number",name:"reason"}]},"2_6":{service:"auth",cmd:"logout"},"2_7":{service:"auth",cmd:"multiPortLogin",response:[{type:"Number",name:"state"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"}]},"2_8":{service:"auth",cmd:"kick",response:[{type:"StrArray",name:"deviceIds"}]},"3_1":{service:"user",cmd:"updatePushToken"},"3_2":{service:"user",cmd:"appBackground"},"3_3":{service:"user",cmd:"markInBlacklist"},"3_103":{service:"user",cmd:"syncMarkInBlacklist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_4":{service:"user",cmd:"getBlacklist",response:[{type:"StrArray",name:"blacklist"}]},"3_5":{service:"user",cmd:"markInMutelist"},"3_105":{service:"user",cmd:"syncMarkInMutelist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_6":{service:"user",cmd:"getMutelist",response:[{type:"StrArray",name:"mutelist"}]},"3_8":{service:"user",cmd:"getRelations",response:[{type:"PropertyArray",name:"specialRelations",entity:"specialRelation"},{type:"Number",name:"timetag"}]},"3_7":{service:"user",cmd:"getUsers",response:[{type:"PropertyArray",name:"users",entity:"user"}]},"3_10":{service:"user",cmd:"updateMyInfo",response:[{type:"Number",name:"timetag"}]},"3_15":{service:"user",cmd:"updateDonnop",response:[{type:"Number",name:"timetag"}]},"3_115":{service:"user",cmd:"syncUpdateDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"3_109":{service:"user",cmd:"syncMyInfo",response:[{type:"Property",name:"user"},{type:"Number",name:"timetag"}]},"3_110":{service:"user",cmd:"syncUpdateMyInfo",response:[{type:"Property",name:"user"}]},"4_1":{service:"notify"},"4_2":{service:"notify"},"4_3":{service:"notify",cmd:"markRead"},"4_4":{service:"notify",cmd:"syncOfflineMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_5":{service:"notify",cmd:"batchMarkRead"},"4_6":{service:"notify",cmd:"syncOfflineSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_8":{service:"notify",cmd:"syncOfflineNetcallMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_9":{service:"notify",cmd:"syncRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_17":{service:"notify",cmd:"syncSuperTeamRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_12":{service:"notify",cmd:"syncMsgReceipts",response:[{type:"PropertyArray",name:"msgReceipts",entity:"msgReceipt"},{type:"Number",name:"timetag"}]},"4_13":{service:"notify",cmd:"syncDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"4_14":{service:"notify",cmd:"syncSessionAck",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Number",name:"timetag"}]},"4_15":{service:"notify",cmd:"syncRobots",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"4_16":{service:"notify",cmd:"syncBroadcastMsgs",response:[{type:"PropertyArray",name:"broadcastMsgs",entity:"broadcastMsg"}]},"4_100":{service:"notify",cmd:"syncOfflineFilterMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_101":{service:"notify",cmd:"syncOfflineFilterSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"5_1":{service:"sync",cmd:"syncDone",response:[{type:"Number",name:"timetag"}]},"5_2":{service:"sync",cmd:"syncTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"5_3":{service:"sync",cmd:"syncSuperTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"7_1":{service:"msg",cmd:"sendMsg",response:[{type:"Property",name:"msg"}],trivialErrorCodes:[7101]},"7_2":{service:"msg",cmd:"msg",response:[{type:"Property",name:"msg"}]},"7_3":{service:"msg",cmd:"sysMsg",response:[{type:"Property",name:"sysMsg"}]},"7_6":{service:"msg",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_7":{service:"msg",cmd:"sendCustomSysMsg",trivialErrorCodes:[7101]},"7_8":{service:"msg",cmd:"searchHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_9":{service:"msg",cmd:"deleteSessions"},"7_10":{service:"msg",cmd:"getSessions",response:[{type:"StrArray",name:"sessions"}]},"7_101":{service:"msg",cmd:"syncSendMsg",response:[{type:"Property",name:"msg"}]},"7_11":{service:"msg",cmd:"sendMsgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_12":{service:"msg",cmd:"msgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_13":{service:"msg",cmd:"onDeleteMsg"},"7_14":{service:"msg",cmd:"onMsgDeleted",response:[{type:"Property",name:"sysMsg"}]},"7_15":{service:"msg",cmd:"onDeleteMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"7_16":{service:"msg",cmd:"onMarkSessionAck"},"7_17":{service:"msg",cmd:"broadcastMsg",response:[{type:"Property",name:"broadcastMsg"}]},"7_18":{service:"msg",cmd:"clearServerHistoryMsgs"},"7_116":{service:"msg",cmd:"syncMarkSessionAck",response:[{type:"Number",name:"scene"},{type:"String",name:"to"},{type:"Number",name:"timetag"}]},"21_2":{service:"superTeam",cmd:"sendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_3":{service:"superTeam",cmd:"superTeamMsg",response:[{type:"Property",name:"msg"}]},"21_5":{service:"superTeam",cmd:"addSuperTeamMembers",response:[{type:"StrArray",name:"abortedAccidList"},{type:"long",name:"timetag"}]},"21_6":{service:"superTeam",cmd:"removeSuperTeamMembers"},"21_7":{service:"superTeam",cmd:"leaveSuperTeam"},"21_8":{service:"superTeam",cmd:"updateSuperTeam",response:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},"21_9":{service:"superTeam",cmd:"getSuperTeam",response:[{type:"Property",name:"team"}]},"21_12":{service:"superTeam",cmd:"getSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_10":{service:"superTeam",cmd:"updateInfoInSuperTeam"},"21_13":{service:"superTeam",cmd:"getSuperTeamMembers",response:[{type:"long",name:"timetag"}]},"21_11":{service:"superTeam",cmd:"getMySuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_14":{service:"superTeam",cmd:"getSuperTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"21_15":{service:"superTeam",cmd:"getSuperTeamMembersByJoinTime",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_113":{service:"superTeam",cmd:"syncSuperTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"superTeamMember"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_111":{service:"superTeam",cmd:"syncMySuperTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"superTeamMember"},{type:"long",name:"timetag"}]},"21_109":{service:"superTeam",cmd:"syncSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_101":{service:"superTeam",cmd:"syncCreateSuperTeam",response:[{type:"Property",name:"team"}]},"21_102":{service:"superTeam",cmd:"syncSendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_110":{service:"superTeam",cmd:"syncUpdateSuperTeamMember",response:[{type:"Property",name:"teamMember",entity:"superTeamMember"}]},"8_1":{service:"team",cmd:"createTeam",response:[{type:"Property",name:"team"},{type:"StrArray",name:"abortedAccidList"}]},"8_2":{service:"team",cmd:"sendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_3":{service:"team",cmd:"teamMsg",response:[{type:"Property",name:"msg"}]},"8_4":{service:"team",cmd:"teamMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_5":{service:"team",cmd:"addTeamMembers",response:[{type:"long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},"8_6":{service:"team",cmd:"removeTeamMembers"},"8_7":{service:"team",cmd:"updateTeam",response:[{type:"Number",name:"id"},{type:"Number",name:"time"}]},"8_8":{service:"team",cmd:"leaveTeam"},"8_9":{service:"team",cmd:"getTeam",response:[{type:"Property",name:"team"}]},"8_10":{service:"team",cmd:"getTeams",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"Number",name:"timetag"}]},"8_11":{service:"team",cmd:"getTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_12":{service:"team",cmd:"dismissTeam"},"8_13":{service:"team",cmd:"applyTeam",response:[{type:"Property",name:"team"}]},"8_14":{service:"team",cmd:"passTeamApply"},"8_15":{service:"team",cmd:"rejectTeamApply"},"8_16":{service:"team",cmd:"addTeamManagers"},"8_17":{service:"team",cmd:"removeTeamManagers"},"8_18":{service:"team",cmd:"transferTeam"},"8_19":{service:"team",cmd:"updateInfoInTeam"},"8_20":{service:"team",cmd:"updateNickInTeam"},"8_21":{service:"team",cmd:"acceptTeamInvite",response:[{type:"Property",name:"team"}]},"8_22":{service:"team",cmd:"rejectTeamInvite"},"8_23":{service:"team",cmd:"getTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_24":{service:"team",cmd:"searchTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_25":{service:"team",cmd:"updateMuteStateInTeam"},"8_26":{service:"team",cmd:"getMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_27":{service:"team",cmd:"getMutedTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_28":{service:"team",cmd:"sendTeamMsgReceipt",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_29":{service:"team",cmd:"getTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_30":{service:"team",cmd:"getTeamMsgReadAccounts",response:[{type:"String",name:"idClient"},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},"8_31":{service:"team",cmd:"notifyTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_32":{service:"team",cmd:"muteTeamAll",response:[]},"8_33":{service:"team",cmd:"getTeamMemberInvitorAccid",response:[{type:"object",name:"accountsMap"}]},"8_126":{service:"team",cmd:"syncMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_109":{service:"team",cmd:"syncTeams",response:[{type:"Number",name:"timetag"},{type:"PropertyArray",name:"teams",entity:"team"}]},"8_111":{service:"team",cmd:"syncTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_101":{service:"team",cmd:"syncCreateTeam",response:[{type:"Property",name:"team"}]},"8_102":{service:"team",cmd:"syncSendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_119":{service:"team",cmd:"syncUpdateTeamMember",response:[{type:"Property",name:"teamMember"}]},"12_1":{service:"friend",cmd:"friendRequest"},"12_101":{service:"friend",cmd:"syncFriendRequest",response:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}]},"12_2":{service:"friend",cmd:"deleteFriend"},"12_102":{service:"friend",cmd:"syncDeleteFriend",response:[{type:"String",name:"account"}]},"12_3":{service:"friend",cmd:"updateFriend"},"12_103":{service:"friend",cmd:"syncUpdateFriend",response:[{type:"Property",name:"friend"}]},"12_4":{service:"friend",cmd:"getFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_5":{service:"friend",cmd:"syncFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_6":{service:"friend",cmd:"syncFriendUsers",response:[{type:"PropertyArray",name:"users",entity:"user"},{type:"Number",name:"timetag"}]},"13_1":{service:"chatroom",cmd:"getChatroomAddress",response:[{type:"StrArray",name:"address"}]},"14_1":{service:"eventService",cmd:"publishEvent",response:[{type:"Property",name:"msgEvent"}]},"14_2":{service:"eventService",cmd:"pushEvent",response:[{type:"Property",name:"msgEvent"}]},"14_3":{service:"eventService",cmd:"subscribeEvent",response:[{type:"StrArray",name:"accounts"}]},"14_4":{service:"eventService",cmd:"unSubscribeEventsByAccounts",response:[{type:"StrArray",name:"accounts"}]},"14_5":{service:"eventService",cmd:"unSubscribeEventsByType"},"14_6":{service:"eventService",cmd:"querySubscribeEventsByAccounts",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_7":{service:"eventService",cmd:"querySubscribeEventsByType",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_9":{service:"eventService",cmd:"pushEvents",response:[{type:"PropertyArray",name:"msgEvents",entity:"msgEvent"}]},"101_1":{service:"filter",cmd:"sendFilterMsg",response:[{type:"Property",name:"msg"}]},"101_2":{service:"filter",cmd:"filterMsg",response:[{type:"Property",name:"msg"}]},"101_3":{service:"filter",cmd:"filterSysMsg",response:[{type:"Property",name:"sysMsg"}]},"101_7":{service:"filter",cmd:"sendFilterCustomSysMsg"}});e.exports={idMap:s,cmdConfig:i,packetConfig:r}},function(e,t,n){"use strict";var r=n(0).notundef;function s(e){r(e.shouldPushNotificationWhenPCOnline)&&(this.open=e.shouldPushNotificationWhenPCOnline?2:1)}s.getDefaultConfig=function(){return{shouldPushNotificationWhenPCOnline:!0}},s.reverse=function(e){return{shouldPushNotificationWhenPCOnline:1!=+e.open}},e.exports=s},function(e,t){function n(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}(e.exports=n).prototype.duration=function(){var e,t,n=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(e=Math.random(),t=Math.floor(e*this.jitter*n),n=0==(1&Math.floor(10*e))?n-t:n+t),0|Math.min(n,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},function(e,t,n){"use strict";var r=n(0),s=r.notundef,i=r.fillPropertyWithDefault,o=(Object.keys,{}),a={},c={},u=[],l={normal:0,advanced:1},m={0:"normal",1:"advanced"};function d(e){r.verifyOptions(e,"action","superTeam::SuperTeam"),r.verifyOptions(e,"teamId","superTeam::SuperTeam"),s(e.teamId)&&(this.teamId=e.teamId),s(e.type)&&(this.type=l[e.type]),s(e.avatar)&&(this.avatar=""+e.avatar),s(e.name)&&(this.name=""+e.name),s(e.intro)&&(this.intro=""+e.intro),s(e.announcement)&&(this.announcement=""+e.announcement),s(e.custom)&&(this.custom=""+e.custom),u.forEach(this.setMode.bind(this,e))}d.prototype.setMode=function(e,t){s(e[t+="Mode"])&&(r.verifyParamValid(t,e[t],c[t],"Superteam::Team"),this[t]=o[t][e[t]])},d.reverse=function(e,t){var n=r.copy(e);if(s(n.teamId)&&(n.teamId=""+n.teamId),s(n.type)&&(n.type=m[n.type]),s(n.level)&&(n.level=+n.level),s(n.valid)&&(n.valid=1==+n.valid),s(n.memberNum)&&(n.memberNum=+n.memberNum),s(n.memberUpdateTime)&&(n.memberUpdateTime=+n.memberUpdateTime),s(n.createTime)&&(n.createTime=+n.createTime),s(n.updateTime)&&(n.updateTime=+n.updateTime),s(n.validToCurrentUser)&&(n.validToCurrentUser="1"===n.validToCurrentUser),s(n.mute)&&(n.mute="1"===n.mute),s(n.muteType))switch(n.muteType){case"0":n.mute=!1,n.muteType="none";break;case"1":n.mute=!0,n.muteType="normal";break;case"3":n.mute=!0,n.muteType="all"}else s(n.mute)&&(1===n.mute?(n.mute=!0,n.muteType="normal"):(n.mute=!1,n.muteType="none"));return u.forEach(function(e,t){s(e[t+="Mode"])&&(e[t]=a[t][e[t]])}.bind(null,n)),delete n.bits,t||d.fillProperties(n),n},d.fillProperties=function(e){return i(e,"avatar","")},e.exports=d},function(e,t,n){"use strict";var r={set:function(e,t,n){r[e]=t,n&&(n.support=t)}};e.exports=r},function(e,t){var n,r,e=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return(n=setTimeout)(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}var a,c=[],u=!1,l=-1;function m(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length)&&d()}function d(){if(!u){var e=o(m);u=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===i||!r)&&clearTimeout)return(r=clearTimeout)(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||o(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=f,e.addListener=f,e.once=f,e.off=f,e.removeListener=f,e.removeAllListeners=f,e.emit=f,e.prependListener=f,e.prependOnceListener=f,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,n){!function(B,H){e.exports=function(){"use strict";function u(e){return"function"==typeof e}var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,t=void 0,s=void 0,a=function(e,t){l[r]=e,l[r+1]=t,2===(r+=2)&&(s?s(m):F())},e="undefined"!=typeof window?window:void 0,i=e||{},i=i.MutationObserver||i.WebKitMutationObserver,o="undefined"==typeof self&&void 0!==B&&"[object process]"==={}.toString.call(B),N="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function c(){var e=setTimeout;return function(){return e(m,1)}}var l=new Array(1e3);function m(){for(var e=0;e<r;e+=2)(0,l[e])(l[e+1]),l[e]=void 0,l[e+1]=void 0;r=0}var d,p,f,F=void 0;function g(e,t){var n,r=this,s=new this.constructor(v),i=(void 0===s[y]&&E(s),r._state);return i?(n=arguments[i-1],a(function(){return A(i,s,n,r._result)})):P(r,s,e,t),s}function h(e){var t;return e&&"object"==typeof e&&e.constructor===this?e:(C(t=new this(v),e),t)}var F=o?function(){return B.nextTick(m)}:i?(p=0,o=new i(m),f=document.createTextNode(""),o.observe(f,{characterData:!0}),function(){f.data=p=++p%2}):N?((d=new MessageChannel).port1.onmessage=m,function(){return d.port2.postMessage(0)}):(void 0===e?function(){try{var e=Function("return this")().require("vertx");return void 0!==(t=e.runOnLoop||e.runOnContext)?function(){t(m)}:c()}catch(e){return c()}}:c)(),y=Math.random().toString(36).substring(2);function v(){}var b=void 0,T=1,M=2,S={error:null};function k(e){try{return e.then}catch(e){return S.error=e,S}}function x(e,t,n){var s,i,r,o;t.constructor===e.constructor&&n===g&&t.constructor.resolve===h?(r=e,(o=t)._state===T?I(r,o._result):o._state===M?w(r,o._result):P(o,void 0,function(e){return C(r,e)},function(e){return w(r,e)})):n===S?(w(e,S.error),S.error=null):void 0!==n&&u(n)?(s=t,i=n,a(function(n){var r=!1,e=function(e,t){try{e.call(t,function(e){r||(r=!0,s!==e?C(n,e):I(n,e))},function(e){r||(r=!0,w(n,e))})}catch(e){return e}}(i,s,n._label);!r&&e&&(r=!0,w(n,e))},e)):I(e,t)}function C(e,t){var n;e===t?w(e,new TypeError("You cannot resolve a promise with itself")):(n=typeof t,null===t||"object"!=n&&"function"!=n?I(e,t):x(e,t,k(t)))}function L(e){e._onerror&&e._onerror(e._result),O(e)}function I(e,t){e._state===b&&(e._result=t,e._state=T,0!==e._subscribers.length)&&a(O,e)}function w(e,t){e._state===b&&(e._state=M,e._result=t,a(L,e))}function P(e,t,n,r){var s=e._subscribers,i=s.length;e._onerror=null,s[i]=t,s[i+T]=n,s[i+M]=r,0===i&&e._state&&a(O,e)}function O(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,s=void 0,i=e._result,o=0;o<t.length;o+=3)r=t[o],s=t[o+n],r?A(n,r,s,i):s(i);e._subscribers.length=0}}function A(e,t,n,r){var s=u(n),i=void 0,o=void 0,a=void 0,c=void 0;if(s){if((i=function(e,t){try{return e(t)}catch(e){return S.error=e,S}}(n,r))===S?(c=!0,o=i.error,i.error=null):a=!0,t===i)return void w(t,new TypeError("A promises callback cannot return that same promise."))}else i=r,a=!0;t._state===b&&(s&&a?C(t,i):c?w(t,o):e===T?I(t,i):e===M&&w(t,i))}var _=0;function E(e){e[y]=_++,e._state=void 0,e._result=void 0,e._subscribers=[]}R.prototype._enumerate=function(e){for(var t=0;this._state===b&&t<e.length;t++)this._eachEntry(e[t],t)},R.prototype._eachEntry=function(t,e){var n,r,s=this._instanceConstructor,i=s.resolve;i===h?(n=k(t))===g&&t._state!==b?this._settledAt(t._state,e,t._result):"function"!=typeof n?(this._remaining--,this._result[e]=t):s===U?(x(r=new s(v),t,n),this._willSettleAt(r,e)):this._willSettleAt(new s(function(e){return e(t)}),e):this._willSettleAt(i(t),e)},R.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===b&&(this._remaining--,e===M?w(r,n):this._result[t]=n),0===this._remaining&&I(r,this._result)},R.prototype._willSettleAt=function(e,t){var n=this;P(e,void 0,function(e){return n._settledAt(T,t,e)},function(e){return n._settledAt(M,t,e)})};var D=R;function R(e,t){this._instanceConstructor=e,this.promise=new e(v),this.promise[y]||E(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0!==this.length&&(this.length=this.length||0,this._enumerate(t),0!==this._remaining)||I(this.promise,this._result)):w(this.promise,new Error("Array Methods must be provided an Array"))}j.prototype.catch=function(e){return this.then(null,e)},j.prototype.finally=function(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})})};var U=j;function j(e){if(this[y]=_++,this._result=this._state=void 0,this._subscribers=[],v!==e){if("function"!=typeof e)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof j))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var t=this,n=e;try{n(function(e){C(t,e)},function(e){w(t,e)})}catch(n){w(t,n)}}}return U.prototype.then=g,U.all=function(e){return new D(this,e).promise},U.race=function(s){var i=this;return n(s)?new i(function(e,t){for(var n=s.length,r=0;r<n;r++)i.resolve(s[r]).then(e,t)}):new i(function(e,t){return t(new TypeError("You must pass an array to race."))})},U.resolve=h,U.reject=function(e){var t=new this(v);return w(t,e),t},U._setScheduler=function(e){s=e},U._setAsap=function(e){a=e},U._asap=a,U.polyfill=function(){var e=void 0;if(void 0!==H)e=H;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=U},U.Promise=U}()}.call(this,n(191),n(33))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(0),s=r.notundef,i=r.undef;function o(e){s(e.name)&&(this.name=""+e.name),s(e.announcement)&&(this.announcement=""+e.announcement),s(e.broadcastUrl)&&(this.broadcastUrl=""+e.broadcastUrl),s(e.custom)&&(this.custom=""+e.custom),s(e.queuelevel)&&(this.queuelevel=parseInt(e.queuelevel))}o.reverse=function(e){e=r.copy(e);return i(e.announcement)&&(e.announcement=""),i(e.broadcastUrl)&&(e.broadcastUrl=""),i(e.custom)&&(e.custom=""),s(e.createTime)&&(e.createTime=+e.createTime),s(e.updateTime)&&(e.updateTime=+e.updateTime),s(e.onlineMemberNum)&&(e.onlineMemberNum=+e.onlineMemberNum),s(e.mute)&&(e.mute="1"===e.mute),e},e.exports=o},function(e,t,n){"use strict";var r=n(56);e.exports=function(e){e.db&&(r.db=e.db)}},function(e,t,n){"use strict";var n=n(9),i=n&&n.__esModule?n:{default:n};function r(e){var i=this,t=e.url||null;i.level={debug:0,log:1,info:2,warn:3,error:4}[e.level]||0,i.logCache=[],i.logNum=1,i.timeInterval=5e3,window.onerror=function(e,t,n,r,s){i.error(s)},setInterval(function(){0<i.logCache.length&&t&&i.postLogs(t,i.logCache)},i.timeInterval)}r.prototype.debug=function(){0<this.level||(console.debug.apply(this,arguments),this.cacheLogs.apply(this,["[degbug]"].concat(arguments)))},r.prototype.log=function(){1<this.level||(console.log.apply(this,arguments),this.cacheLogs.apply(this,["[log]"].concat(arguments)))},r.prototype.info=function(){2<this.level||(console.info.apply(this,arguments),this.cacheLogs.apply(this,["[info]"].concat(arguments)))},r.prototype.warn=function(){3<this.level||(console.warn.apply(this,arguments),this.cacheLogs.apply(this,["[warn]"].concat(arguments)))},r.prototype.error=function(){4<this.level||(console.error.apply(this,arguments),this.cacheLogs.apply(this,["[error]"].concat(arguments)))},r.prototype.cacheLogs=function(e,t){for(var n=[],r=0;r<t.length;r++){var s=t[r];"object"===(void 0===s?"undefined":(0,i.default)(s))?n.push(JSON.stringify(s)):n.push(s)}e=this.logNum+++" "+e+" "+n.join("; ");this.logCache.push(e.replace("%c",""))},r.prototype.postLogs=function(e,t){var n=this,r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?(n.logCache=[],n.timeInterval=5e3):n.timeInterval+=5e3)},r.open("POST",e),r.setRequestHeader("Content-Type","plain/text;charset=utf-8"),r.timeout=360,r.send(t.join("\n"))},e.exports=r},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n,r=arguments[t];for(n in r)s.call(r,n)&&(e[n]=r[n])}return e};var s=Object.prototype.hasOwnProperty},function(e,t,n){var r=n(166),s=(e.exports=function(e,t,n){if(!r(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),("[object Array]"===s.call(e)?function(e,t,n){for(var r=0,s=e.length;r<s;r++)i.call(e,r)&&t.call(n,e[r],r,e)}:"string"==typeof e?function(e,t,n){for(var r=0,s=e.length;r<s;r++)t.call(n,e.charAt(r),r,e)}:function(e,t,n){for(var r in e)i.call(e,r)&&t.call(n,e[r],r,e)})(e,t,n)},Object.prototype.toString),i=Object.prototype.hasOwnProperty},function(e,t){(t=e.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}},function(e,t,n){var s=n(295),i=n(294);e.exports=function(e){var r;return e?(r={},i(s(e).split("\n"),function(e){var t=e.indexOf(":"),n=s(e.slice(0,t)).toLowerCase(),e=s(e.slice(t+1));void 0===r[n]?r[n]=e:"[object Array]"===Object.prototype.toString.call(r[n])?r[n].push(e):r[n]=[r[n],e]}),r):{}}},function(t,e,n){!function(e){e="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};t.exports=e}.call(this,n(33))},function(e,t,n){"use strict";var r=n(297),s=n(166),h=n(296),i=n(293);function o(e,t,n){var r=e;return s(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=i(t,{uri:e}),r.callback=n,r}function y(e,t,n){return a(t=o(e,t,n))}function a(r){if(void 0===r.callback)throw new Error("callback argument missing");function s(e,t,n){i||(i=!0,r.callback(e,t,n))}var i=!1;function t(e){return clearTimeout(a),(e=e instanceof Error?e:new Error(""+(e||"Unknown XMLHttpRequest Error"))).statusCode=0,s(e,g)}function e(){var e,t,n;if(!o)return clearTimeout(a),e=r.useXDR&&void 0===c.status?200:1223===c.status?204:c.status,t=g,n=null,0!==e?(t={body:function(){var e=void 0,e=c.response||c.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(c);if(f)try{e=JSON.parse(e)}catch(e){}return e}(),statusCode:e,method:l,headers:{},url:u,rawRequest:c},c.getAllResponseHeaders&&(t.headers=h(c.getAllResponseHeaders()))):n=new Error("Internal XMLHttpRequest Error"),s(n,t,t.body)}var n,o,a,c=r.xhr||null,u=(c=c||new(r.cors||r.useXDR?y.XDomainRequest:y.XMLHttpRequest)).url=r.uri||r.url,l=c.method=r.method||"GET",m=r.body||r.data,d=c.headers=r.headers||{},p=!!r.sync,f=!1,g={body:void 0,headers:{},statusCode:0,method:l,url:u,rawRequest:c};if("json"in r&&!1!==r.json&&(f=!0,d.accept||d.Accept||(d.Accept="application/json"),"GET"!==l)&&"HEAD"!==l&&(d["content-type"]||d["Content-Type"]||(d["Content-Type"]="application/json"),m=JSON.stringify(!0===r.json?m:r.json)),c.onreadystatechange=function(){4===c.readyState&&setTimeout(e,0)},c.onload=e,c.onerror=t,c.onprogress=function(){},c.onabort=function(){o=!0},c.ontimeout=t,c.open(l,u,!p,r.username,r.password),p||(c.withCredentials=!!r.withCredentials),!p&&0<r.timeout&&(a=setTimeout(function(){var e;o||(o=!0,c.abort("timeout"),(e=new Error("XMLHttpRequest timeout")).code="ETIMEDOUT",t(e))},r.timeout)),c.setRequestHeader)for(n in d)d.hasOwnProperty(n)&&c.setRequestHeader(n,d[n]);else if(r.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return;return 1}(r.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in r&&(c.responseType=r.responseType),"beforeSend"in r&&"function"==typeof r.beforeSend&&r.beforeSend(c),c.send(m||null),c}(e.exports=y).XMLHttpRequest=r.XMLHttpRequest||function(){},y.XDomainRequest="withCredentials"in new y.XMLHttpRequest?y.XMLHttpRequest:r.XDomainRequest;for(var c=["get","put","post","patch","head","delete"],u=0;u<c.length;u++)!function(r){y["delete"===r?"del":r]=function(e,t,n){return(t=o(e,t,n)).method=r.toUpperCase(),a(t)}}(c[u])},function(e,t,n){"use strict";var r=n(0),s=r.notundef,i={addFriend:1,applyFriend:2,passFriendApply:3,rejectFriendApply:4},o={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};function a(e){r.verifyOptions(e,"account","friend::Friend"),r.verifyParamAtLeastPresentOne(e,"alias custom","friend::Friend"),this.account=e.account,s(e.alias)&&(this.alias=e.alias),s(e.custom)&&(this.custom=e.custom)}a.reverse=function(e){var t=r.filterObj(e,"account alias custom createTime updateTime serverex");return s(e.flag)&&(t.valid="1"===e.flag),s(t.createTime)&&(t.createTime=+t.createTime),s(t.updateTime)&&(t.updateTime=+t.updateTime),t},a.validTypes=function(){return Object.keys(i)},a.getByteFromType=function(e){return i[e]},a.getTypeFromByte=function(e){return o[e]},a.assembleFriend=function(e){var t=+new Date;return{account:e,alias:"",createTime:t,custom:"",updateTime:t,valid:!0}},e.exports=a},function(e,t,n){"use strict";e.exports={imLogin:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",112:"isReactNative",1e3:"token"},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time"},login:{1:"appKey",2:"account",3:"deviceId",5:"chatroomId",8:"appLogin",20:"chatroomNick",21:"chatroomAvatar",22:"chatroomCustom",23:"chatroomEnterCustom",26:"session",38:"isAnonymous",_21_safe:"_chatroomAvatar_safe"},chatroom:{1:"id",3:"name",4:"announcement",5:"broadcastUrl",12:"custom",14:"createTime",15:"updateTime",16:"queuelevel",100:"creator",101:"onlineMemberNum",102:"mute"},msg:{1:"idClient",2:"type",3:"attach",4:"custom",5:"resend",6:"userUpdateTime",7:"fromNick",8:"fromAvatar",9:"fromCustom",10:"yidunEnable",11:"antiSpamContent",12:"skipHistory",13:"body",14:"antiSpamBusinessId",15:"clientAntiSpam",16:"antiSpamUsingYidun",20:"time",21:"from",22:"chatroomId",23:"fromClientType",25:"highPriority",_8_safe:"_fromAvatar_safe"},chatroomMember:{1:"chatroomId",2:"account",3:"type",4:"level",5:"nick",6:"avatar",7:"custom",8:"online",9:"guest",10:"enterTime",12:"blacked",13:"gaged",14:"valid",15:"updateTime",16:"tempMuted",17:"tempMuteDuration",_6_safe:"_avatar_safe"}}},function(e,t,n){"use strict";e.exports={imLogin:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24},login:{appKey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,chatroomCustom:22,chatroomEnterCustom:23,session:26,isAnonymous:38},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,custom:12,createTime:14,updateTime:15,queuelevel:16,creator:100,onlineMemberNum:101,mute:102},msg:{idClient:1,type:2,attach:3,custom:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromCustom:9,yidunEnable:10,antiSpamContent:11,skipHistory:12,body:13,antiSpamBusinessId:14,clientAntiSpam:15,antiSpamUsingYidun:16,time:20,from:21,chatroomId:22,fromClientType:23,highPriority:25},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,custom:7,online:8,guest:9,enterTime:10,blacked:12,gaged:13,valid:14,updateTime:15,tempMuted:16,tempMuteDuration:17}}},function(e,t,n){"use strict";var r=n(0),n=n(82),s=r.merge({},n.idMap,{chatroom:{id:13,login:2,kicked:3,logout:4,sendMsg:6,msg:7,getChatroomMembers:8,getHistoryMsgs:9,markChatroomMember:11,closeChatroom:12,getChatroom:13,updateChatroom:14,updateMyChatroomMemberInfo:15,getChatroomMembersInfo:16,kickChatroomMember:17,updateChatroomMemberTempMute:19,queueOffer:20,queuePoll:21,queueList:22,peak:23,queueDrop:24,queueInit:25,queueChange:26},user:{id:3,syncRobot:16}}),i=r.merge({},n.cmdConfig,{login:{sid:s.chatroom.id,cid:s.chatroom.login,params:[{type:"byte",name:"type"},{type:"Property",name:"login"},{type:"Property",name:"imLogin"}]},logout:{sid:s.chatroom.id,cid:s.chatroom.logout},sendMsg:{sid:s.chatroom.id,cid:s.chatroom.sendMsg,params:[{type:"Property",name:"msg"}]},getChatroomMembers:{sid:s.chatroom.id,cid:s.chatroom.getChatroomMembers,params:[{type:"byte",name:"type"},{type:"long",name:"time"},{type:"int",name:"limit"}]},getHistoryMsgs:{sid:s.chatroom.id,cid:s.chatroom.getHistoryMsgs,params:[{type:"long",name:"timetag"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},markChatroomMember:{sid:s.chatroom.id,cid:s.chatroom.markChatroomMember,params:[{type:"string",name:"account"},{type:"int",name:"type"},{type:"bool",name:"isAdd"},{type:"int",name:"level"},{type:"string",name:"custom"}]},closeChatroom:{sid:s.chatroom.id,cid:s.chatroom.closeChatroom,params:[{type:"string",name:"custom"}]},getChatroom:{sid:s.chatroom.id,cid:s.chatroom.getChatroom},updateChatroom:{sid:s.chatroom.id,cid:s.chatroom.updateChatroom,params:[{type:"Property",name:"chatroom"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"}]},updateMyChatroomMemberInfo:{sid:s.chatroom.id,cid:s.chatroom.updateMyChatroomMemberInfo,params:[{type:"Property",name:"chatroomMember"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"bool",name:"needSave"}]},getChatroomMembersInfo:{sid:s.chatroom.id,cid:s.chatroom.getChatroomMembersInfo,params:[{type:"StrArray",name:"accounts"}]},kickChatroomMember:{sid:s.chatroom.id,cid:s.chatroom.kickChatroomMember,params:[{type:"string",name:"account"},{type:"string",name:"custom"}]},updateChatroomMemberTempMute:{sid:s.chatroom.id,cid:s.chatroom.updateChatroomMemberTempMute,params:[{type:"String",name:"account"},{type:"long",name:"duration"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"}]},queueOffer:{sid:s.chatroom.id,cid:s.chatroom.queueOffer,params:[{type:"string",name:"elementKey"},{type:"string",name:"elementValue"},{type:"bool",name:"transient"}]},queuePoll:{sid:s.chatroom.id,cid:s.chatroom.queuePoll,params:[{type:"string",name:"elementKey"}]},queueList:{sid:s.chatroom.id,cid:s.chatroom.queueList},peak:{sid:s.chatroom.id,cid:s.chatroom.peak},queueDrop:{sid:s.chatroom.id,cid:s.chatroom.queueDrop},queueInit:{sid:s.chatroom.id,cid:s.chatroom.queueInit,params:[{type:"int",name:"limit"}]},queueChange:{sid:s.chatroom.id,cid:s.chatroom.queueChange,params:[{type:"StrStrMap",name:"elementMap"},{type:"bool",name:"needNotify"},{type:"string",name:"notifyExt"}]},syncRobot:{sid:s.user.id,cid:s.user.syncRobot,params:[{type:"long",name:"timetag"}]}}),r=r.merge({},n.packetConfig,{"4_10":{service:"notify"},"4_11":{service:"notify"},"3_16":{service:"chatroom",cmd:"syncRobot",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"13_2":{service:"chatroom",cmd:"login",response:[{type:"Property",name:"chatroom"},{type:"Property",name:"chatroomMember"}]},"13_3":{service:"chatroom",cmd:"kicked",response:[{type:"Number",name:"reason"},{type:"String",name:"custom"}]},"13_4":{service:"chatroom",cmd:"logout"},"13_6":{service:"chatroom",cmd:"sendMsg",response:[{type:"Property",name:"msg"}]},"13_7":{service:"chatroom",cmd:"msg",response:[{type:"Property",name:"msg"}]},"13_8":{service:"chatroom",cmd:"getChatroomMembers",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_9":{service:"chatroom",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_11":{service:"chatroom",cmd:"markChatroomMember",response:[{type:"Property",name:"chatroomMember"}]},"13_12":{service:"chatroom",cmd:"closeChatroom"},"13_13":{service:"chatroom",cmd:"getChatroom",response:[{type:"Property",name:"chatroom"}]},"13_14":{service:"chatroom",cmd:"updateChatroom"},"13_15":{service:"chatroom",cmd:"updateMyChatroomMemberInfo"},"13_16":{service:"chatroom",cmd:"getChatroomMembersInfo",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_17":{service:"chatroom",cmd:"kickChatroomMember"},"13_19":{service:"chatroom",cmd:"updateChatroomMemberTempMute"},"13_20":{service:"chatroom",cmd:"queueOffer"},"13_21":{service:"chatroom",cmd:"queuePoll",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_22":{service:"chatroom",cmd:"queueList",response:[{type:"KVArray",name:"queueList"}]},"13_23":{service:"chatroom",cmd:"peak",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_24":{service:"chatroom",cmd:"queueDrop"},"13_25":{service:"chatroom",cmd:"queueInit"},"13_26":{service:"chatroom",cmd:"queueChange",response:[{type:"StrArray",name:"elementKeyArray"}]}});e.exports={idMap:s,cmdConfig:i,packetConfig:r}},function(e,t,n){"use strict";e.exports={nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time"},login:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",112:"isReactNative",1e3:"token"},loginRes:{17:"lastLoginDeviceId",38:"customTag",102:"connectionId",103:"ip",104:"port",106:"country",111:"hasXMPush"},loginPort:{3:"type",4:"os",5:"mac",13:"deviceId",19:"account",32:"deviceInfo",38:"customTag",102:"connectionId",103:"ip",109:"time"},aosPushInfo:{110:"pushType",111:"hasTokenPreviously"},sync:{1:"myInfo",2:"offlineMsgs",3:"teams",6:"netcallMsgs",7:"roamingMsgs",9:"relations",11:"friends",12:"sessions",13:"friendUsers",14:"msgReceipts",15:"myTeamMembers",16:"donnop",17:"deleteMsg",18:"sessionAck",19:"robots",20:"broadcastMsgs",21:"avSignal",22:"superTeams",23:"myInfoInSuperTeams",24:"superTeamRoamingMsgs",100:"filterMsgs"},donnop:{1:"open"},superTeam:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},superTeamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"createTime",11:"updateTime",12:"custom",13:"mute",14:"invitoraccid",15:"joinTime"},team:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},teamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"joinTime",11:"updateTime",12:"custom",13:"mute",14:"invitorAccid"},msg:{0:"scene",1:"to",2:"from",4:"fromClientType",5:"fromDeviceId",6:"fromNick",7:"time",8:"type",9:"body",10:"attach",11:"idClient",12:"idServer",13:"resend",14:"userUpdateTime",15:"custom",16:"pushPayload",17:"pushContent",18:"apnsAccounts",19:"apnsContent",20:"apnsForcePush",21:"yidunEnable",22:"antiSpamContent",23:"antiSpamBusinessId",24:"clientAntiSpam",25:"antiSpamUsingYidun",26:"needMsgReceipt",100:"isHistoryable",101:"isRoamingable",102:"isSyncable",104:"isMuted",105:"cc",106:"isInBlackList",107:"isPushable",108:"isOfflinable",109:"isUnreadable",110:"needPushNick",111:"isReplyMsg",112:"tempTeamMemberCount"},msgReceipt:{1:"to",2:"from",7:"time",11:"idClient"},teamMsgReceipt:{0:"teamId",1:"idServer",100:"read",101:"unread",102:"idClient",103:"account"},sysMsg:{0:"time",1:"type",2:"to",3:"from",4:"ps",5:"attach",6:"idServer",7:"sendToOnlineUsersOnly",8:"apnsText",9:"pushPayload",10:"deletedIdClient",11:"deletedIdServer",12:"yidunEnable",13:"antiSpamContent",14:"deletedMsgTime",15:"deletedMsgFromNick",16:"opeAccount",105:"cc",107:"isPushable",109:"isUnreadable",110:"needPushNick"},broadcastMsg:{1:"broadcastId",2:"fromAccid",3:"fromUid",4:"timestamp",5:"body"},friend:{4:"account",5:"flag",6:"beflag",7:"source",8:"alias",9:"bits",10:"custom",11:"createTime",12:"updateTime",13:"serverex"},user:{1:"account",3:"nick",4:"avatar",5:"sign",6:"gender",7:"email",8:"birth",9:"tel",10:"custom",12:"createTime",13:"updateTime",_4_safe:"_avatar_safe"},specialRelation:{0:"account",1:"isMuted",2:"isBlacked",3:"createTime",4:"updateTime"},msgType:{0:"text",1:"picture",2:"audio",3:"video",4:"location",5:"notification",6:"file",7:"netcall_audio",8:"netcall_vedio",9:"datatunnel_new",10:"tips",11:"robot",100:"custom"},msgEvent:{1:"type",2:"value",3:"idClient",4:"custom",5:"validTime",6:"broadcastType",7:"sync",8:"validTimeType",9:"durable",10:"time",11:"idServer",12:"clientType",13:"serverConfig",14:"serverCustom",101:"appid",103:"account",104:"enableMultiClient",106:"consid"},msgEventSubscribe:{1:"type",2:"subscribeTime",3:"sync",102:"to",104:"from",105:"time"},clearMsgsParams:{1:"account",2:"delRoam"},delFriendParams:{1:"delAlias"}}},function(e,t,n){"use strict";e.exports={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24},login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,connectionId:102,ip:103,time:109,customTag:38},aosPushInfo:{pushType:110,hasTokenPreviously:111},sync:{myInfo:1,offlineMsgs:2,teams:3,netcallMsgs:6,roamingMsgs:7,relations:9,friends:11,sessions:12,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,deleteMsg:17,sessionAck:18,robots:19,broadcastMsgs:20,avSignal:21,superTeams:22,myInfoInSuperTeams:23,superTeamRoamingMsgs:24,filterMsgs:100},donnop:{open:1},superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,createTime:10,updateTime:11,custom:12,mute:13,invitoraccid:14,joinTime:15},team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,custom:12,mute:13,invitorAccid:14},msg:{scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resend:13,userUpdateTime:14,custom:15,pushPayload:16,pushContent:17,apnsAccounts:18,apnsContent:19,apnsForcePush:20,yidunEnable:21,antiSpamContent:22,antiSpamBusinessId:23,clientAntiSpam:24,antiSpamUsingYidun:25,needMsgReceipt:26,isHistoryable:100,isRoamingable:101,isSyncable:102,isMuted:104,cc:105,isInBlackList:106,isPushable:107,isOfflinable:108,isUnreadable:109,needPushNick:110,isReplyMsg:111,tempTeamMemberCount:112},msgReceipt:{to:1,from:2,time:7,idClient:11},teamMsgReceipt:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},sysMsg:{time:0,type:1,to:2,from:3,ps:4,attach:5,idServer:6,sendToOnlineUsersOnly:7,apnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,yidunEnable:12,antiSpamContent:13,deletedMsgTime:14,deletedMsgFromNick:15,opeAccount:16,cc:105,isPushable:107,isUnreadable:109,needPushNick:110},broadcastMsg:{broadcastId:1,fromAccid:2,fromUid:3,timestamp:4,body:5},friend:{account:4,flag:5,beflag:6,source:7,alias:8,bits:9,custom:10,createTime:11,updateTime:12,serverex:13},user:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,custom:10,createTime:12,updateTime:13},specialRelation:{account:0,isMuted:1,isBlacked:2,createTime:3,updateTime:4},msgType:{text:0,picture:1,audio:2,video:3,location:4,notification:5,file:6,netcall_audio:7,netcall_vedio:8,datatunnel_new:9,tips:10,robot:11,custom:100},msgEvent:{type:1,value:2,idClient:3,custom:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverCustom:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105},clearMsgsParams:{account:1,delRoam:2},delFriendParams:{delAlias:1}}},function(e,t,n){"use strict";function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return t.needPush&&(t.needPush="1"===t.needPush),t.needBadge&&(t.needBadge="1"===t.needBadge),t.channelInValid&&(t.channelInValid="1"===t.channelInValid),t.attach&&(e=JSON.parse(t.attach),t.eventType=o.parseAvSignalType(e.type)),t.members&&(e=JSON.parse(t.members),t.members=e.map(function(e){return o.parseAvSignalMember(e)})),t}var s=n(58).fn,i=n(0),o=n(169);s.processAvSignal=function(e){switch(e.cmd){case"signalingCreate":case"signalingDelay":case"signalingClose":case"signalingJoin":case"signalingLeave":case"signalingInvite":case"signalingCancel":case"signalingReject":case"signalingAccept":case"signalingControl":case"signalingSyncMsgRead":case"signalingGetChannelInfo":break;case"signalingNotify":this.onSignalingNotify(e);break;case"signalingMutilClientSyncNotify":this.onSignalingMutilClientSyncNotify(e);break;case"signalingUnreadMessageSyncNotify":this.onSignalingUnreadMessageSyncNotify(e);break;case"signalingChannelsSyncNotify":this.onSignalingMembersSyncNotify(e);break;default:this.logger.log("avSignal::unhandled cmd:",e.cmd)}};s.onSignalingNotify=function(e){var t;e.error?(t=e.error,this.logger.error("protocal::avSignal:onSignalingNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)):(e.raw&&e.raw.r&&e.raw.r.length&&e.content&&e.content.avSignalTag&&(e.content.avSignalTag.msgid=e.raw.r[0]),t=e.content.avSignalTag,t=Array.isArray(t)?t.map(function(e){return r(e)}):r(t),this.emitAPI({type:"signalingNotify",obj:t}),i.isFunction(this.options.onSignalingNotify)&&this.options.onSignalingNotify(t))},s.onSignalingMutilClientSyncNotify=function(e){var t;e.error?(t=e.error,this.logger.error("protocal::avSignal:onSignalingMutilClientSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)):(this.emitAPI({type:"signalingMutilClientSyncNotify",obj:e.content}),i.isFunction(this.options.onSignalingMutilClientSyncNotify)&&this.options.onSignalingMutilClientSyncNotify(e.content))},s.onSignalingUnreadMessageSyncNotify=function(e){var t;e.error?(t=e.error,this.logger.error("protocal::avSignal:onSignalingUnreadMessageSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)):(t=e.content.avSignalTag,Array.isArray(t)&&(t=t.map(function(e){return r(e)})),this.emitAPI({type:"signalingUnreadMessageSyncNotify",obj:t}),i.isFunction(this.options.onSignalingUnreadMessageSyncNotify)&&this.options.onSignalingUnreadMessageSyncNotify(t))},s.onSignalingMembersSyncNotify=function(e){var t;e.error?(t=e.error,this.logger.error("protocal::avSignal:onSignalingMembersSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)):(t=e.content.avSignalTag,t=(t=Array.isArray(t)?t:[t]).map(function(e){return r(e)}),this.emitAPI({type:"signalingChannelsSyncNotify",obj:t}),i.isFunction(this.options.onSignalingMembersSyncNotify)&&this.options.onSignalingMembersSyncNotify(t))}},function(e,t,n){"use strict";var r=n(58).fn,s=n(170);r.processMisc=function(e){switch(e.cmd){case"getSimpleNosToken":e.error||(e.obj=e.content.nosTokens[0]);break;case"getNosToken":e.error||(e.obj=e.content.nosToken);break;case"notifyUploadLog":e.error||this.emitAPI({type:"notifyUploadLog"});break;case"audioToText":e.error||(e.obj.text=e.content.text);break;case"processImage":e.obj.imageOps=s.reverseImageOps(e.obj.imageOps),e.error||(e.obj={url:e.content.url});break;case"getNosTokenTrans":e.error||(e.obj={nosToken:e.content.nosToken,docId:e.content.docId});break;case"getNosOriginUrl":e.error||(e.obj=e.content.nosFileUrlTag.originUrl);break;case"notifyTransLog":e.error||this.emitAPI({type:"notifyTransLog",obj:e.content.transInfo});break;case"fetchFile":case"fetchFileList":case"removeFile":e.error||(e.obj=e.content);break;case"getServerTime":e.obj=e.content.time}}},function(e,t,n){"use strict";var r=n(58).fn,s=n(5);r.processLink=function(e){e.cmd},r.startHeartbeat=function(){var e=this;e.stopHeartbeat(),e.heartbeatTimer=setTimeout(function(){e.sendCmd("heartbeat",null,e.onHeartbeat.bind(e))},s.heartbeatInterval)},r.stopHeartbeat=function(){this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},r.onHeartbeat=function(e,t){e?(e.callFunc="link::onHeartbeat",this.api.reportLogs({event:"ping_timeout"}),this.onCustomError("heartbeat error","HEARTBEAT_ERROR",e)):this.startHeartbeat()},r.heartbeat=function(){}},function(e,t,n){"use strict";var r,s=n(60),i=s&&s.__esModule?s:{default:s},s=n(58).fn,o=n(26),a=n(21),c=n(125),u=n(56),l=n(5),m=n(0),d=m.notundef;s.login=function(){var t=this;Promise.resolve().then(function(){return t.assembleLogin()}).then(function(e){t.sendCmd("login",(0,i.default)({},e),t.onLogin.bind(t))}),t.autoconnect=!1},s.genSessionKey=(r={},function(){var e=this.name;return r[e]=r[e]||m.guid()}),s.assembleIMLogin=function(){var e=this.options,t=e.account,n=this.autoconnect?0:1;return this.sdkSession=this.genSessionKey(),{appLogin:n,appKey:e.appKey,account:t,token:e.token,sdkVersion:l.info.sdkVersion,protocolVersion:l.info.protocolVersion,os:a.os.toString(),browser:a.name+" "+a.version,clientType:l.CLIENTTYPE||16,session:this.sdkSession,deviceId:u.deviceId,isReactNative:l.isRN?1:0,customTag:e.customTag||""}},s.onLogin=function(e,t){this.loginResult=t,e?this.onAuthError(e,"link::onLogin"):(this.startHeartbeat(),this.afterLogin(t))},s.afterLogin=m.emptyFunc,s.notifyLogin=function(){var e=this.loginResult;this.logger.info("link::notifyLogin: on connect",e),this.options.onconnect(e)},s.logout=function(){var e="done disconnect";this.doLogout?(this.doLogout=!1,this.onAuthError(new o(e="done logout","logout"),"link::logout")):this.isConnected()&&(e=new o(e,"logout"),this.onAuthError(e,"link::logout"))},s.onKicked=function(e){var e=e.content,t=e.from,n=e.reason,e=e.custom,n={reason:this.kickedReasons[n]||"unknown",message:this.kickedMessages[n]||"未知原因"};d(t)&&(n.from=c.reverseType(t)),d(e)&&(n.custom=e),this.shouldNotifyKicked(n)?(t=new o("被踢了","kicked"),m.merge(t,n),this.onAuthError(t,"link::onKicked")):(this.logger.warn("link::onKicked: silentlyKick"),this.shouldReconnect=!0,this.hasNotifyDisconnected=!0,this.disconnectSocket())},s.shouldNotifyKicked=function(e){return"silentlyKick"!==e.reason},s.onAuthError=function(e,t){this.shouldReconnect=!1,(e=e||o.newConnectionError({callFunc:t})).callFunc=e.callFunc||t||null,this.markAllCallbackInvalid(e),this.notifyDisconnect(e)}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var r=n(58).fn,s=n(26),i=n(188),o=n(168),a=n(5),c=n(0);r.initConnect=function(){this.socket=null,this.retryCount=0,this.connecting=!1,this.initConnecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.doLogout=!1},r.resetConnect=function(){var e=this.options;c.notundef(e.needReconnect)?(c.verifyParamType("needReconnect",e.needReconnect,"boolean","link::resetConnect"),this.needReconnect=e.needReconnect):this.needReconnect=!0,this.logger.log("link::resetConnect: needReconnect "+this.needReconnect),c.notundef(e.reconnectionAttempts)&&c.verifyParamType("reconnectionAttempts",e.reconnectionAttempts,"number","link::resetConnect"),c.notundef(e.noCacheLinkUrl)&&c.verifyParamType("noCacheLinkUrl",e.noCacheLinkUrl,"boolean","link::resetConnect"),this.reconnectionAttempts="number"==typeof e.reconnectionAttempts?e.reconnectionAttempts:1/0,this.backoff=new i({min:a.reconnectionDelay,max:a.reconnectionDelayMax,jitter:a.reconnectionJitter})},r.connect=function(e){if(e){if(this.initConnecting)return void this.logger.warn("link::connect: already init connecting");clearTimeout(this.reconnectTimer)}this.isConnected()?this.logger.warn("link::connect: already connected"):this.connecting?this.logger.warn("link::connect: already connecting"):(this.connecting=!0,this.hasNotifyDisconnected=!1,this.socket&&this.socket&&this.socket.socket?(this.logger.info("link::connect: try connecting..."),this.socket.socket.connect()):this.options.socketUrl&&"string"==typeof this.options.socketUrl?this.connectToUrl(this.options.socketUrl):(e=this.getNextSocketUrl())&&!this.options.noCacheLinkUrl?this.connectToUrl(e):this.refreshSocketUrl())},r.getNextSocketUrl=function(){return this.socketUrls.shift()},r.isConnected=function(){return!!this.socket&&!!this.socket.socket&&this.socket.socket.connected},r.connectToUrl=function(t){var e,n=this,r=(t=t||"",n.logger.log("link::connectToUrl: "+t),"undefined"==typeof window&&(r=c.getGlobal(),e=t.split(":"),r&&!r.location&&1<e.length&&(r.location={protocol:e[0],hostname:e[1].slice(2),port:e[2]}),this.options.transports=["websocket"]),this.options.transports||["websocket","xhr-polling"]);n.socket=o.connect(t,{transports:r,reconnect:!1,"force new connection":!0,"connect timeout":a.connectTimeout}),n.logger.info("link::connectToUrl: socket url: "+t+", transports: "+JSON.stringify(r)),n.socket.on("connect",n.onConnect.bind(n)),n.socket.on("handshake_failed",n.onHandshakeFailed.bind(n)),n.socket.on("connect_failed",n.onConnectFailed.bind(n)),n.socket.on("error",n.onError.bind(n)),n.socket.on("message",n.onMessage.bind(n)),n.socket.on("disconnect",function(e){n.logger.warn("link::connectToUrl: socket url: "+t+", disconnected"),n.doLogout?n.logout():n.onDisconnect(!0,"link::socketDisconnect")})},r.disconnect=function(t){var n=this;function r(e){n.logger.info("link::disconnect: socket finally closed, ",e),clearTimeout(n.disconnectCallbackTimer),t(e)}t instanceof Function||(t=function(){}),clearTimeout(n.connectTimer),n.disconnectCallbackTimer=setTimeout(function(){t.call(n,"mark disconnected due to timeout")},1e4),n.socket&&n.socket.socket&&n.socket.socket.transport?n.socket.socket.transport.onDisconnectDone=function(e){r(e)}:r(null),n.isConnected()?(n.logger.log("link::disconnect: start disconnecting"),n.logout()):n.connecting?(n.logger.log("link::disconnect: abort connecting"),n.disconnectSocket()):(n.logger.log("link::disconnect: start otherwise"),n.connecting=!1,n.shouldReconnect=!1,n.needReconnect=!1,n.options.ondisconnect({callFunc:"link::disconnect",message:"manually disconnect status"}))},r.onConnect=function(){this.backoff&&this.backoff.reset(),this.reconnectStatus=0<this.retryCount?1:0,this.retryCount=0,this.connecting=!1,this.initConnecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.logger.log("link::onConnect: socket onconnected, start login"),this.login(),this.api.reportLogs({event:"ws_connected"})},r.onHandshakeFailed=function(){this.api.reportLogs({event:"ws_handshake_failed"}),this.onDisconnect(!1,"link::onHandshakeFailed")},r.onConnectFailed=function(){this.api.reportLogs({event:"ws_connect_failed"}),this.onDisconnect(!1,"link::onConnectFailed")},r.onError=function(){var e=arguments[0];if(e){if(this.api.reportLogs({event:"connect_timeout"}),void 0!==e.x5ImgDecodeStatus)return;if("[object Object]"===Object.prototype.toString.call(e)&&Object.keys(e).length<=0)return;this.onMiscError("连接错误",new s(e,"LINK_ERROR",{callFunc:"link::onError"}))}this.connecting=!1},r.onDisconnect=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.connected=e,this.connecting=!1,this.markAllCallbackInvalid(s.newNetworkError({callFunc:t})),this.stopHeartbeat(),this.reconnect()},r.willReconnect=function(){return this.shouldReconnect&&this.needReconnect&&this.retryCount<this.reconnectionAttempts},r.reconnect=function(){var t=this;if(t.willReconnect())if(t.socket&&t.socket.socket&&t.socket.socket.transport&&t.socket.socket.transport.websocket){t.logger.info("link::reconnect: on socket closed"),t.socket.socket.transport.onConnectionOver=function(){t.logger.log("link::reconnect: on connectionOver"),clearTimeout(t.reconnectTimer),t.doReconnect()};try{t.socket.socket.transport.websocket.close()}catch(e){t.logger.warn("link::reconnect: force disconnect error:",e)}}else clearTimeout(t.reconnectTimer),t.reconnectTimer=setTimeout(function(){t.logger.info("link::reconnect: on socket timeout"),t.doReconnect()},3e4);else t.notifyDisconnect()},r.doReconnect=function(){var e=this,t=(e.socket=null,e.connected&&(e.autoconnect=!0),e.retryCount++,e.appLogin=1,e.backoff.duration());e.logger.info("link::reconnect: will retry after "+t+"ms, retryCount "+e.retryCount),e.options.onwillreconnect({retryCount:e.retryCount,duration:t}),clearTimeout(e.connectTimer),e.connectTimer=setTimeout(function(){e.connect()},t)},r.notifyConnectError=function(e){e=s.newConnectError({message:e,callFunc:"link::notifyConnectError"});this.logger.error("link::notifyConnectError:",e),this.options.onerror(e)},r.notifyDisconnect=function(e){var t=this;t.hasNotifyDisconnected||(t.hasNotifyDisconnected=!0,t.disconnectSocket(),(e=e||new s).retryCount=t.retryCount,e.willReconnect=t.willReconnect(),t.backoff&&t.backoff.reset(),t.retryCount=0,t.socket&&t.socket.socket&&t.socket.socket.transport&&t.socket.socket.transport.websocket?(t.logger.info("link::notifyDisconnect: ondisconnected",e),t.socket.socket.transport.onConnectionOver=function(){t.socket=null,t.options.ondisconnect(e)}):(t.logger.info("link::notifyDisconnect: ondisconnected/no transport ws",e),t.options.ondisconnect(e)),t.onWbNotifyHangup instanceof Function&&t.onWbNotifyHangup({content:{account:t.account,channelId:null,timetag:+Date()}}))},r.disconnectSocket=function(){if(this.isConnected()||this.connecting)try{this.connecting=!1,this.shouldReconnect=!1,this.needReconnect=!1,this.socket.disconnect()}catch(e){this.logger.info("link::disconnectSocket: disconnect failed, error ",e)}}},function(e,t,n){"use strict";var r=n(9),s=r&&r.__esModule?r:{default:r},r=n(50).fn,a=n(0),i=n(82),o=n(169);r.signalingCreate=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.channelName,r=e.ext;return a.verifyOptions(e,"type","api::signalling"),this.sendCmdUsePromise("signalingCreate",{avSignalTag:{type:t,channelName:n,ext:r}}).then(function(e){e=e.avSignalTag;return Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingDelay=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return a.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingDelay",{avSignalTag:e}).then(function(e){e=e.avSignalTag;return Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingClose=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return a.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingClose",{avSignalTag:a.merge(e,{isSave:!0===t?1:0})}).then(function(e){e=e.avSignalTag;return e.offlineEnabled=1===e.isSave,delete e.isSave,Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingJoin=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return a.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingJoin",{avSignalTag:a.merge(e,{isSave:!0===t?1:0})}).then(function(e){var e=e.avSignalTag,t=e.members;return"string"==typeof e.members&&(t=JSON.parse(e.members).map(function(e){return o.parseAvSignalMember(e)})),e.members=t,Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingLeave=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return a.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingLeave",{avSignalTag:a.merge(e,{isSave:!0===t?1:0})}).then(function(e){e=e.avSignalTag;return e.offlineEnabled=1===e.isSave,delete e.isSave,Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingGetChannelInfo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.channelName;return a.verifyOptions(e,"channelName","api::signalling"),this.sendCmdUsePromise("signalingGetChannelInfo",{avSignalTag:{channelName:t}}).then(function(e){var e=e.avSignalTag,t=e.members;return"string"==typeof e.members&&(t=JSON.parse(e.members).map(function(e){return o.parseAvSignalMember(e)})),e.members=t,Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingInvite=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.account,n=e.offlineEnabled,r=e.pushInfo,r=void 0===r?{}:r,e=(a.verifyOptions(e,"channelId requestId account","api::signalling"),"object"===(0,s.default)(r.pushPayload)&&(r.pushPayload=JSON.stringify(r.pushPayload)),a.merge(e,r,{to:t,isSave:!0===n?1:0,needPush:!0===r.needPush?1:0,needBadge:!1===r.needBadge?0:1}));return this.sendCmdUsePromise("signalingInvite",{avSignalTag:e}).then(function(e){e=e.avSignalTag;return e.offlineEnabled=1===e.isSave,e.needBadge=1===e.needBadge,e.needPush=1===e.needPush,delete e.isSave,Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingCancel=function(e){var t=e.account,n=e.offlineEnabled;return a.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingCancel",{avSignalTag:a.merge(e,{to:t,isSave:!0===n?1:0})}).then(function(e){e=e.avSignalTag;return e.offlineEnabled=1===e.isSave,delete e.isSave,Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingCreateAndJoin=function(e){var t=this,n=e.channelName,r=e.uid,s=void 0===r?0:r,r=e.offlineEnabled,i=void 0===r||r,r=e.attachExt,o=void 0===r?"":r;return this.signalingCreate(e).catch(function(e){return 10405===e.code?(t.logger.warn("api::avSignal:signalingCall room already exists:",e),t.signalingGetChannelInfo({channelName:n})):Promise.reject(e)}).then(function(e){e={channelId:e.channelId,offlineEnabled:i,attachExt:o};return s&&a.merge(e,{uid:s}),t.signalingJoin(e)})},r.signalingCall=function(t){var n=this,r=t.account,s=t.offlineEnabled,i=t.requestId,o=(a.verifyOptions(t,"type requestId account","api::signalling"),"");return this.signalingCreateAndJoin(t).then(function(e){n.logger.log("api::avSignal:signalingCall join:",e);e={channelId:o=e.channelId||o,account:r,requestId:i,offlineEnabled:s,attachExt:t.attachExt||"",pushInfo:t.pushInfo||{}};return n.signalingInvite(e)})},r.signalingReject=function(e){var t=e.account,n=e.offlineEnabled;return a.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingReject",{avSignalTag:a.merge(e,{to:t,isSave:!0===n?1:0})}).then(function(e){e=e.avSignalTag;return e.offlineEnabled=1===e.isSave,delete e.isSave,Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingAccept=function(n){var r=this,e=n.account,t=n.offlineEnabled;return a.verifyOptions(n,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingAccept",{avSignalTag:a.merge(n,{to:e,isSave:!0===t?1:0})}).then(function(e){e=e.avSignalTag;return e.offlineEnabled=1===e.isSave,delete e.isSave,Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))}).then(function(e){var t;return n.autoJoin?(t={channelId:n.channelId,offlineEnabled:n.offlineEnabled,attachExt:n.joinAttachExt,uid:n.uid},r.signalingJoin(t)):e})},r.signalingControl=function(e){var t=e.account;return a.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingControl",{avSignalTag:a.merge(e,t?{to:t}:{})}).then(function(e){e=e.avSignalTag;return Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingSync=function(){return this.sendCmdUsePromise("sync",{sync:{avSignal:0}}).then(function(e){e=e.avSignalTag;return Promise.resolve(e)}).catch(function(e){return Promise.reject(o.parseAvSignalError(e))})},r.signalingMarkMsgRead=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(a.verifyOptions(e,"msgid","api::signalling"),i.idMap.avSignal),e="string"==typeof e.msgid?[e.msgid]:e.msgid;return this.sendCmd("batchMarkRead",{sid:t.id,cid:t.signalingNotify,ids:e})}},function(e,t,n){"use strict";var r=n(50).fn,a=n(0),c=n(39),u=n(5),l=n(21);(l=l||{}).name=l.name||"",l.version=l.version||"",r.reportLogs=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,n=t.options,r=u.ntServerAddress;if(r){var s,i=u.info,e=a.merge(e,{appkey:n.appKey,uid:n.account,os:"web",session:t.protocol.sdkSession||"",ver:i.sdkVersion,type:t.subType,platform:""+l.name.toLowerCase()+l.version.replace(/(\.\d+)+$/,"")}),n=r+a.genUrlSep(r),o=[];for(s in e)o.push(s+"="+e[s]);n+=o.join("&"),c(n,{proxyUrl:a.url2origin(n)+"/lbs/res/cors/nej_proxy_frame.html",timeout:u.xhrTimeout,onload:function(){},onerror:function(e){t.logger.info("report::ajax report error",e)}})}}},function(e,t,n){"use strict";var r=n(9),u=r&&r.__esModule?r:{default:r},s=n(0),r=n(50).fn;function o(e,t){for(var n=t.match,r=t.operate,s=e,i=0;i<t.keys.length;i++){var o=t.keys[i],a=o.match||n,c=o.operate||r;try{if("object"===(void 0===(s=function(e,t,n,r){var s=!1,i="";if(1===n?0<=e.indexOf(t)&&(s=!0,i=t):2===n&&(i=new RegExp(t,"g")).test(e)&&(s=!0),s&&""!==i)switch(r){case 1:return e.replace(i,"**");case 2:return{code:2};case 3:return{code:3}}return e}(s,o.key,a,c))?"undefined":(0,u.default)(s)))return s}catch(e){this.logger.warn("misc::filterContent: js cannot parse this regexp ",e)}}return s}r.uploadSdkLogUrl=function(e){return s.verifyOptions(e,"url","misc::uploadSdkLogUrl"),this.cbAndSendCmd("uploadSdkLogUrl",e)},r.getClientAntispamLexicon=function(e){var r=this,s=(e=e||{}).done,i=(s instanceof Function||(s=function(){}),this);return this.protocol.sendCmd("getClientAntispam",e={clientAntispam:{version:0}},function(e,t,n){e?(i.protocol.logger.error("misc::getClientAntispamLexicon:",e),s.call(r,e,{})):(s.call(r,null,n),i.antispamLexicon=n.clientAntispam||{})})},r.filterClientAntispam=function(e){var t=e.content,n=e.antispamLexicon;if(!t)return{code:404,errmsg:"待反垃圾文本content不存在"};n||this.antispamLexicon;var r=this.antispamLexicon&&this.antispamLexicon.thesaurus;if(!r)return{code:404,errmsg:"没有反垃圾词库或者词库格式不合法"};try{r=JSON.parse(r).thesaurus}catch(e){return this.protocol.logger.error("misc::filterClientAntispam: parse thesaurus error"),{code:500,errmsg:"反垃圾词库格式不合法"}}for(var s=t,i=0;i<r.length;i++)if("object"===(void 0===(s=o.call(this,s,r[i]))?"undefined":(0,u.default)(s))){if(2===s.code)return{code:200,type:2,errmsg:"建议拒绝发送",content:t,result:""};if(3===s.code)return{code:200,type:3,errmsg:"建议服务器处理反垃圾，发消息带上字段clientAntiSpam",content:t,result:t}}return s===t?{code:200,type:0,errmsg:"",content:t,result:s}:{code:200,type:1,errmsg:"已对特殊字符做了过滤",content:t,result:s}},r.getServerTime=function(e){this.processCallback(e),this.sendCmd("getServerTime",{},e.callback)}},function(e,t,n){"use strict";var r,s=n(9),u=s&&s.__esModule?s:{default:s},l=n(69),m=n(0),s=n(50).fn;s.viewImageSync=function(e){var t=this.options,n=(m.verifyOptions(e,"url","nos::viewImageSync"),e.url),n=(0,l.url2object)(n),r=n.protocol,s=n.hostname,i=n.path,n=n.query;if("boolean"==typeof e.strip&&(n.stripmeta=e.strip?1:0),"number"==typeof e.quality&&(m.verifyParamMin("quality",e.quality,0,"nos::viewImageSync"),m.verifyParamMax("quality",e.quality,100,"nos::viewImageSync"),n.quality=Math.round(e.quality)),"boolean"==typeof e.interlace&&(n.interlace=e.interlace?1:0),"number"==typeof e.rotate&&(n.rotate=Math.round(e.rotate)),"object"===(0,u.default)(e.thumbnail)){var o=e.thumbnail.mode||"crop",a=e.thumbnail.width,c=e.thumbnail.height;if(0<=a&&0<=c&&a<4096&&c<4096&&(0<a||0<c)){switch(o){case"crop":o="y";break;case"contain":o="x";break;case"cover":o="z";break;default:o="x"}n.thumbnail=""+a+o+c}}return t.downloadUrl?(a=(0,l.url2object)(e.url),c=t.downloadUrl,-1!==(t=(e=a.path).indexOf("/"))&&(a=e.substring(0,t),e=e.substring(t+1),c=c.replace("{bucket}",a).replace("{object}",e)),t=(0,l.url2object)(c),(0,l.object2url)({protocol:t.protocol,hostname:t.hostname,path:t.path,query:m.merge(t.query,n)})):(0,l.object2url)({protocol:r,hostname:s,path:i,query:n})},s.viewImageStripMeta=function(e){m.verifyOptions(e,"url strip","nos::viewImageStripMeta"),m.verifyParamType("strip",e.strip,"boolean","nos::viewImageStripMeta");var t="stripmeta="+(e.strip?1:0),n=(0,l.genUrlSep)(e.url);return e.url+n+t},s.viewImageQuality=function(e){m.verifyOptions(e,"url quality","nos::viewImageQuality"),m.verifyParamType("quality",e.quality,"number","nos::viewImageQuality"),m.verifyParamMin("quality",e.quality,0,"nos::viewImageQuality"),m.verifyParamMax("quality",e.quality,100,"nos::viewImageQuality");var t="quality="+Math.round(e.quality),n=(0,l.genUrlSep)(e.url);return e.url+n+t},s.viewImageInterlace=function(e){m.verifyOptions(e,"url","nos::viewImageInterlace");var t=(0,l.genUrlSep)(e.url);return e.url+t+"interlace=1"},s.viewImageRotate=function(e){for(m.verifyOptions(e,"url angle","nos::viewImageRotate"),m.verifyParamType("angle",e.angle,"number","nos::viewImageRotate");e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t="rotate="+Math.round(e.angle),n=(0,l.genUrlSep)(e.url);return e.url+n+t},s.viewImageBlur=function(e){m.verifyOptions(e,"url radius sigma","nos::viewImageBlur"),m.verifyParamType("radius",e.radius,"number","nos::viewImageBlur"),m.verifyParamMin("radius",e.radius,1,"nos::viewImageBlur"),m.verifyParamMax("radius",e.radius,50,"nos::viewImageBlur"),m.verifyParamType("sigma",e.sigma,"number","nos::viewImageBlur"),m.verifyParamMin("sigma",e.sigma,0,"nos::viewImageBlur");var t="blur="+Math.round(e.radius)+"x"+Math.round(e.sigma),n=(0,l.genUrlSep)(e.url);return e.url+n+t},s.viewImageCrop=function(e){m.verifyOptions(e,"url x y width height","nos::viewImageCrop"),m.verifyParamType("x",e.x,"number","nos::viewImageCrop"),m.verifyParamMin("x",e.x,0,"nos::viewImageCrop"),m.verifyParamType("y",e.y,"number","nos::viewImageCrop"),m.verifyParamMin("y",e.y,0,"nos::viewImageCrop"),m.verifyParamType("width",e.width,"number","nos::viewImageCrop"),m.verifyParamMin("width",e.width,0,"nos::viewImageCrop"),m.verifyParamType("height",e.height,"number","nos::viewImageCrop"),m.verifyParamMin("height",e.height,0,"nos::viewImageCrop");var t="crop="+Math.round(e.x)+"_"+Math.round(e.y)+"_"+Math.round(e.width)+"_"+Math.round(e.height),n=(0,l.genUrlSep)(e.url);return e.url+n+t},s.viewImageThumbnail=(r={cover:"z",contain:"x",crop:"y"},function(e){m.verifyOptions(e,"url mode","nos::viewImageThumbnail"),m.verifyParamValid("mode",e.mode,Object.keys(r),"nos::viewImageThumbnail"),"contain"===e.mode?m.verifyParamAtLeastPresentOne(e,"width height","nos::viewImageThumbnail"):m.verifyOptions(e,"width height","nos::viewImageThumbnail"),m.undef(e.width)&&(e.width=0),m.undef(e.height)&&(e.height=0),m.verifyParamType("width",e.width,"number","nos::viewImageThumbnail"),m.verifyParamMin("width",e.width,0,"nos::viewImageThumbnail"),m.verifyParamType("height",e.height,"number","nos::viewImageThumbnail"),m.verifyParamMin("height",e.height,0,"nos::viewImageThumbnail");var t=Math.round(e.width),n=Math.round(e.height),t="thumbnail="+t+r[e.mode]+n,n=("crop"===e.mode&&m.notundef(e.axis)&&(m.undef(e.axis.x)&&(e.axis.x=5),m.undef(e.axis.y)&&(e.axis.y=5),m.verifyParamMin("axis.x",e.axis.x,0,"nos::viewImageThumbnail"),m.verifyParamMax("axis.x",e.axis.x,10,"nos::viewImageThumbnail"),m.verifyParamMin("axis.y",e.axis.y,0,"nos::viewImageThumbnail"),m.verifyParamMax("axis.y",e.axis.y,10,"nos::viewImageThumbnail"),t=t+"&axis="+Math.round(e.axis.x)+"_"+Math.round(e.axis.y)),m.notundef(e.enlarge)&&(m.verifyParamType("enlarge",e.enlarge,"boolean","nos::viewImageThumbnail"),e.enlarge)&&(t+="&enlarge=1"),(0,l.genUrlSep)(e.url));return e.url+n+t})},function(e,t,n){"use strict";var s,o=n(0),r=n(50).fn,i=n(170),a=n(172),c=n(26);r.transDoc=function(n){o.verifyOptions(n,"fileInput done","nos::transDoc");try{var e=n.fileInput.files[0],t=n.fileInputName=e.name,r={ppt:1,pptx:2,pdf:3},s=t.substring(t.lastIndexOf(".")+1);if(["ppt","pdf","pptx"].indexOf(s)<0)return void n.done(c.newNoFileError("请上传正确格式的文件【ppt, pptx, pdf】",{callFunc:"nos: transDoc",fileInput:n.fileInput}),n)}catch(e){return void n.done(c.newNoFileError("请上传正确的文件节点",{callFunc:"msg::previewFile",fileInput:n.fileInput}),n)}var i=JSON.stringify(a.genResponseBody("file")||{}).replace(/"/gi,'\\"'),t={transToken:{name:t,type:r[s],transType:"png"===n.transcode?11:10,size:e.size,body:i}};this.getNosTokenTrans({responseBody:t,nosToken:{nosScene:n.nosScene||this.nosScene,nosSurvivalTime:n.nosSurvivalTime},callback:function(e,t){e?n.done(e):(n.nosToken=t.nosToken,n.docId=t.docId,this._doPreviewFile(n))}.bind(this)})},r.getSimpleNosToken=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e.num=1,o.verifyOptions(e),this.cbAndSendCmd("getSimpleNosToken",e)},r.getNosToken=function(e){var t=e.callback,n=e.nosToken,e=e.responseBody,r={tag:n.nosScene};n.nosSurvivalTime&&n.nosSurvivalTime!==1/0&&(r.expireSec=n.nosSurvivalTime),this.sendCmd("getNosToken",{responseBody:e,nosToken:r},t)},r.getNosTokenTrans=function(e){this.sendCmd("getNosTokenTrans",e.responseBody,e.callback)},r.packFileDownloadName=function(e){o.verifyOptions(e,"url name",!0,"","nos::packFileDownloadName");var t=e.url;return t+o.genUrlSep(t)+"download="+encodeURIComponent(e.name)},r.audioToMp3=function(e){o.verifyOptions(e,"url","nos::audioToMp3");e=e.url;return e+o.genUrlSep(e)+"audioTrans&type=mp3"},r.removeFile=function(e){this.sendCmd("removeFile",e,e.callback)},r.fetchFile=function(e){this.sendCmd("fetchFile",e,e.callback)},r.fetchFileList=function(e){this.sendCmd("fetchFileList",e,e.callback)},r.stripImageMeta=function(e){return this.beforeProcessImage(e,"stripmeta")},r.qualityImage=function(e){return this.beforeProcessImage(e,"quality")},r.interlaceImage=function(e){return this.beforeProcessImage(e,"interlace")},r.rotateImage=function(e){return this.beforeProcessImage(e,"rotate")},r.blurImage=function(e){return this.beforeProcessImage(e,"blur")},r.cropImage=function(e){return this.beforeProcessImage(e,"crop")},r.thumbnailImage=function(e){return this.beforeProcessImage(e,"thumbnail")},r.beforeProcessImage=function(e,t){var n=o.copy(e);return n.type=t,e.ops=[n],this.processImage(e)},r.processImage=function(e){var t=this,n=(o.verifyOptions(e,"url ops",!0,"","nos::processImage"),o.verifyParamType("ops",e.ops,"array","nos::processImage"),e.ops.map(function(e){return o.verifyOptions(e,"type",!0,"","nos::processImage"),o.verifyParamValid("type",e.type,i.validTypes,"nos::processImage"),t["gen"+e.type.slice(0,1).toUpperCase()+e.type.slice(1)+"Op"](e)}));t.processCallback(e),t.sendCmd("processImage",{url:e.url,imageOps:n},e.callback)},r.genStripmetaOp=function(e){return new i({type:e.type,stripmeta:e.strip?1:0})},r.genQualityOp=function(e){o.verifyOptions(e,"quality",!0,"","nos::genQualityOp"),o.verifyParamType("quality",e.quality,"number","nos::genQualityOp"),o.verifyParamMin("quality",e.quality,0,"nos::genQualityOp"),o.verifyParamMax("quality",e.quality,100,"nos::genQualityOp");var t=Math.round(e.quality);return new i({type:e.type,qualityQuality:t})},r.genInterlaceOp=function(e){return new i({type:e.type})},r.genRotateOp=function(e){for(o.verifyOptions(e,"angle",!0,"","nos::genRotateOp"),o.verifyParamType("angle",e.angle,"number","nos::genRotateOp");e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t=Math.round(e.angle);return new i({type:e.type,rotateAngle:t})},r.genBlurOp=function(e){o.verifyOptions(e,"radius sigma","nos::genBlurOp"),o.verifyParamType("radius",e.radius,"number","nos::genBlurOp"),o.verifyParamMin("radius",e.radius,1,"nos::genBlurOp"),o.verifyParamMax("radius",e.radius,50,"nos::genBlurOp"),o.verifyParamType("sigma",e.sigma,"number","nos::genBlurOp"),o.verifyParamMin("sigma",e.sigma,0,"nos::genBlurOp");var t=Math.round(e.radius),n=Math.round(e.sigma);return new i({type:e.type,blurRadius:t,blurSigma:n})},r.genCropOp=function(e){o.verifyOptions(e,"x y width height","nos::genCropOp"),o.verifyParamType("x",e.x,"number","nos::genCropOp"),o.verifyParamMin("x",e.x,0,"nos::genCropOp"),o.verifyParamType("y",e.y,"number","nos::genCropOp"),o.verifyParamMin("y",e.y,0,"nos::genCropOp"),o.verifyParamType("width",e.width,"number","nos::genCropOp"),o.verifyParamMin("width",e.width,0,"nos::genCropOp"),o.verifyParamType("height",e.height,"number","nos::genCropOp"),o.verifyParamMin("height",e.height,0,"nos::genCropOp");var t=Math.round(e.x),n=Math.round(e.y),r=Math.round(e.width),s=Math.round(e.height);return new i({type:e.type,cropX:t,cropY:n,cropWidth:r,cropHeight:s})},r.genThumbnailOp=(s={cover:"z",contain:"x",crop:"y"},function(e){o.verifyOptions(e,"mode","nos::genThumbnailOp"),o.verifyParamValid("mode",e.mode,Object.keys(s),"nos::genThumbnailOp"),"contain"===e.mode?o.verifyParamAtLeastPresentOne(e,"width height","nos::genThumbnailOp"):o.verifyOptions(e,"width height","nos::genThumbnailOp"),o.undef(e.width)&&(e.width=0),o.undef(e.height)&&(e.height=0),o.verifyParamType("width",e.width,"number","nos::genThumbnailOp"),o.verifyParamMin("width",e.width,0,"nos::genThumbnailOp"),o.verifyParamType("height",e.height,"number","nos::genThumbnailOp"),o.verifyParamMin("height",e.height,0,"nos::genThumbnailOp");var t,n=Math.round(e.width),r=Math.round(e.height),n=new i({type:e.type,thumbnailMode:s[e.mode],thumbnailWidth:n,thumbnailHeight:r});return"crop"===e.mode&&o.notundef(e.axis)&&(o.undef(e.axis.x)&&(e.axis.x=5),o.undef(e.axis.y)&&(e.axis.y=5),o.verifyParamMin("axis.x",e.axis.x,0,"nos::genThumbnailOp"),o.verifyParamMax("axis.x",e.axis.x,10,"nos::genThumbnailOp"),o.verifyParamMin("axis.y",e.axis.y,0,"nos::genThumbnailOp"),o.verifyParamMax("axis.y",e.axis.y,10,"nos::genThumbnailOp"),r=Math.round(e.axis.x),t=Math.round(e.axis.y),n.thumbnailAxisX=r,n.thumbnailAxisY=t),o.notundef(e.enlarge)&&(o.verifyParamType("enlarge",e.enlarge,"boolean","nos::genThumbnailOp"),e.enlarge)&&(n.thumbnailEnlarge=1),n}),r.getNosOriginUrl=function(e){o.verifyOptions(e,"safeShortUrl",!0,"","nos::getNosOriginUrl"),o.verifyParamType("safeShortUrl",e.safeShortUrl,"string","nos::getNosOriginUrl"),/^http(s)?:/.test(e.safeShortUrl)&&~e.safeShortUrl.indexOf("im_url=1")?(this.processCallback(e),this.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e.safeShortUrl}},e.callback)):e.done(new c("参数 “safeShortUrl” 内容非文件安全短链",{callFunc:"nos: getNosOriginUrl"}),e)}},function(e,t,n){"use strict";var i=n(5),o=n(0),a=n(26),c=n(39).upload,u=n(39).chunkUpload,r=n(39).abort,l=o.supportFormData;function s(n){var r=this,e=(r.options=o.copy(n),o.verifyOptions(n,"url fileName"),o.verifyParamPresentJustOne(n,"blob fileInput"),o.verifyCallback(n,"beginupload uploadprogress uploaddone"),n.fileInput&&(n.fileInput=o.verifyFileInput(n.fileInput)),n.type&&o.verifyFileType(n.type),n.timeout?o.verifyParamType("timeout",n.timeout,"number"):n.timeout=6e5,o.verifyFileUploadCallback(n),n.data={},n.params&&o.merge(n.data,n.params),n.fileName),t=n.fileInput;if(l){if(t){var s=n.type?o.filterFiles(t.files,n.type):[].slice.call(t.files,0);if(!s||!s.length)return void n.uploaddone(a.newWrongFileTypeError("未读取到"+n.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+n.type+"类型的文件"));n.data[e]=s[0];s=t.files[0].size}else if(n.blob){if(n.data[e]=n.blob,"file"!==n.type&&n.blob.type&&-1===n.blob.type.indexOf(n.type))return void n.uploaddone(a.newWrongFileTypeError("未读取到"+n.type+"类型的文件, 请确保选择了"+n.type+"类型的文件"));s=n.blob.size}if(n.maxSize&&s>n.maxSize)return void n.uploaddone(a.newFileTooLargeError("上传文件大小超过"+n.maxSize+"限制"));if(!n.commonUpload)return s>i.chunkMaxSize?void n.uploaddone(a.newFileTooLargeError("直传文件大小超过"+i.chunkMaxSize+"限制")):void(r.sn=u(n,e,r));if(s>i.commonMaxSize)return void n.uploaddone(a.newFileTooLargeError("普通上传文件大小超过"+i.commonMaxSize+"限制"))}else o.dataset(t,"name",e),n.data.input=t;s={data:n.data,onaftersend:function(){n.beginupload(r)},onuploading:function(e){var t=Math.floor(1e4*e.loaded/e.total)/100,e={docId:n.docId,total:e.total,loaded:e.loaded,percentage:t,percentageText:t+"%"};n.fileInput&&(e.fileInput=n.fileInput),n.blob&&(e.blob=n.blob),n.uploadprogress(e)},onload:function(e){e.docId=n.docId,e.Error?r.onError(e):n.uploaddone(null,e)},onerror:function(e){try{var t=e.result?JSON.parse(e.result):e;r.onError(t)}catch(t){n.uploaddone(new a(e.message,e.code),r.options)}}};l||(s.mode="iframe"),s.putFileAtEnd=!0,r.sn=c(n.url,s)}s.prototype.onError=function(e){var t=this.options,n=(e=(e=e||{}).Error||e||{}).Code||e.code||"unknown",e=e.Message||e.message||"未知错误";t.uploaddone(new a(n+"("+e+")",n))},s.prototype.abort=function(){r(this.sn)},e.exports=s},function(e,t,n){var r,s;!function(){"use strict";s=[],void 0!==(s="function"==typeof(r=function(i){return function(b){function e(e){e=String(e);return e=1===e.length?"0"+e:e}(b=b||{}).arrayAccessForm=b.arrayAccessForm||"none",b.emptyNodeForm=b.emptyNodeForm||"text",b.jsAttributeFilter=b.jsAttributeFilter,b.jsAttributeConverter=b.jsAttributeConverter,b.attributeConverters=b.attributeConverters||[],b.datetimeAccessFormPaths=b.datetimeAccessFormPaths||[],b.arrayAccessFormPaths=b.arrayAccessFormPaths||[],void 0===b.enableToStringFunc&&(b.enableToStringFunc=!0),void 0===b.skipEmptyTextNodesForObj&&(b.skipEmptyTextNodesForObj=!0),void 0===b.stripWhitespaces&&(b.stripWhitespaces=!0),void 0===b.useDoubleQuotes&&(b.useDoubleQuotes=!0),void 0===b.ignoreRoot&&(b.ignoreRoot=!1),void 0===b.escapeMode&&(b.escapeMode=!0),void 0===b.attributePrefix&&(b.attributePrefix="_"),void 0===b.selfClosingElements&&(b.selfClosingElements=!0),void 0===b.keepCData&&(b.keepCData=!1),void 0===b.jsDateUTC&&(b.jsDateUTC=!1),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),"function"!=typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"});var T={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function M(e){var t=e.localName;return t=null!=(t=null==t?e.baseName:t)&&""!==t?t:e.nodeName}function c(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"):e}function S(e,t,n){if("property"===b.arrayAccessForm&&(e[t]instanceof Array?e[t+"_asArray"]=e[t]:e[t+"_asArray"]=[e[t]]),!(e[t]instanceof Array)&&0<b.arrayAccessFormPaths.length){for(var r=!1,s=0;s<b.arrayAccessFormPaths.length;s++){var i=b.arrayAccessFormPaths[s];if("string"==typeof i){if(i===n){r=!0;break}}else if(i instanceof RegExp){if(i.test(n)){r=!0;break}}else if("function"==typeof i&&i(t,n)){r=!0;break}}r&&(e[t]=[e[t]])}}function k(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");return n.setHours(t[3],t[4],r[0]),1<r.length&&n.setMilliseconds(r[1]),t[6]&&t[7]?(r=60*t[6]+Number(t[7]),r=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*r:r),n.setMinutes(n.getMinutes()-r-n.getTimezoneOffset())):-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()))),n}function x(e,t){if(e.nodeType===T.DOCUMENT_NODE){for(var n={},r=e.childNodes,s=0;s<r.length;s++){var i,o=r.item(s);o.nodeType===T.ELEMENT_NODE&&(i=M(o),b.ignoreRoot?n=x(o,i):n[i]=x(o,i))}return n}if(e.nodeType!==T.ELEMENT_NODE)return e.nodeType===T.TEXT_NODE||e.nodeType===T.CDATA_SECTION_NODE?e.nodeValue:null;for(var a=e,c=t,u={__cnt:0},l=a.childNodes,m=0;m<l.length;m++){var d=l.item(m),p=M(d);d.nodeType!==T.COMMENT_NODE&&(u.__cnt++,null==u[p]?(u[p]=x(d,c+"."+p),S(u,p,c+"."+p)):(u[p]instanceof Array||(u[p]=[u[p]],S(u,p,c+"."+p)),u[p][u[p].length]=x(d,c+"."+p)))}for(var f=0;f<a.attributes.length;f++){var g=a.attributes.item(f);u.__cnt++;for(var h=g.value,y=0;y<b.attributeConverters.length;y++){var v=b.attributeConverters[y];v.test.call(null,g.name,g.value)&&(h=v.convert.call(null,g.name,g.value))}u[b.attributePrefix+g.name]=h}e=a.prefix;return e&&(u.__cnt++,u.__prefix=e),u["#text"]&&(u.__text=u["#text"],u.__text instanceof Array&&(u.__text=u.__text.join("\n")),b.escapeMode&&(u.__text=u.__text.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&")),b.stripWhitespaces&&(u.__text=u.__text.trim()),delete u["#text"],"property"===b.arrayAccessForm&&delete u["#text_asArray"],u.__text=function(e,t){if(0<b.datetimeAccessFormPaths.length)for(var n=t.split(".#")[0],r=0;r<b.datetimeAccessFormPaths.length;r++){var s=b.datetimeAccessFormPaths[r];if("string"==typeof s){if(s===n)return k(e)}else if(s instanceof RegExp){if(s.test(n))return k(e)}else if("function"==typeof s&&s(n))return k(e)}return e}(u.__text,c+".#text")),u.hasOwnProperty("#cdata-section")&&(u.__cdata=u["#cdata-section"],delete u["#cdata-section"],"property"===b.arrayAccessForm)&&delete u["#cdata-section_asArray"],1===u.__cnt&&u.__text?u=u.__text:0===u.__cnt&&"text"===b.emptyNodeForm?u="":1<u.__cnt&&void 0!==u.__text&&b.skipEmptyTextNodesForObj&&(b.stripWhitespaces&&""===u.__text||""===u.__text.trim())&&delete u.__text,delete u.__cnt,b.keepCData||u.hasOwnProperty("__text")||!u.hasOwnProperty("__cdata")?(b.enableToStringFunc&&(u.__text||u.__cdata)&&(u.toString=function(){return(this.__text||"")+(this.__cdata||"")}),u):u.__cdata||""}function o(e,t,n,r){var s="<"+(e&&e.__prefix?e.__prefix+":":"")+t;if(n)for(var i=0;i<n.length;i++){var o=n[i],a=e[o];b.escapeMode&&(a=c(a)),s+=" "+o.substr(b.attributePrefix.length)+"=",b.useDoubleQuotes?s+='"'+a+'"':s+="'"+a+"'"}return s+(r?" />":">")}function a(e,t){return"</"+(e&&e.__prefix?e.__prefix+":":"")+t+">"}function s(e,t){return"property"===b.arrayAccessForm&&-1!==(n=t.toString()).indexOf("_asArray",n.length-"_asArray".length)||0===t.toString().indexOf(b.attributePrefix)||0===t.toString().indexOf("__")||e[t]instanceof Function;var n}function u(e){var t=0;if(e instanceof Object)for(var n in e)s(e,n)||t++;return t}function l(e){var t=[];if(e instanceof Object)for(var n in e)-1===n.toString().indexOf("__")&&0===n.toString().indexOf(b.attributePrefix)&&t.push(n);return t}function m(e){var t,n,r="";return e instanceof Object?r+=(n="",(t=e).__cdata&&(n+="<![CDATA["+t.__cdata+"]]>"),t.__text&&(b.escapeMode?n+=c(t.__text):n+=t.__text),n):null!==e&&(b.escapeMode?r+=c(e):r+=e),r}function d(e){var t,n="";if(0<u(e))for(var r in e)s(e,r)||(n+=function s(e,t,i){var n="";return b.jsAttributeFilter&&b.jsAttributeFilter.call(null,t,e)||(null!=(e=b.jsAttributeConverter?b.jsAttributeConverter.call(null,t,e):e)&&""!==e||!b.selfClosingElements?"object"==typeof e?"[object Array]"===Object.prototype.toString.call(e)?n+=function(e,t){var n="";if(0===e.length)n+=o(e,t,i,!0);else for(var r=0;r<e.length;r++)n+=s(e[r],t,l(e[r]));return n}(e,t):e instanceof Date?n=(n=(n+=o(e,t,i,!1))+(b.jsDateUTC?e.toUTCString():e.toISOString()))+a(e,t):0<u(e)||e.__text||e.__cdata?n=(n=(n+=o(e,t,i,!1))+d(e))+a(e,t):b.selfClosingElements?n+=o(e,t,i,!0):n=(n+=o(e,t,i,!1))+a(e,t):n=(n=(n+=o(e,t,i,!1))+m(e))+a(e,t):n+=o(e,t,i,!0)),n}(t=e[r],r,l(t)));return n+m(e)}function t(e){if(void 0===e)return null;if("string"!=typeof e)return null;var t=null,n=null;if(i)n=(t=new i).parseFromString(e,"text/xml");else if(window&&window.DOMParser){var t=new window.DOMParser,r=null;if(!(window.ActiveXObject||"ActiveXObject"in window))try{r=t.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(e){r=null}try{n=t.parseFromString(e,"text/xml"),null!==r&&0<n.getElementsByTagNameNS(r,"parsererror").length&&(n=null)}catch(e){n=null}}else 0===e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(n=new ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(e);return n}this.asArray=function(e){return null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?k(e):e},this.xml2dom=t,this.dom2js=function(e){return x(e,null)},this.js2dom=function(e){return t(this.js2xml(e))},this.xml2js=function(e){e=t(e);return null!=e?this.dom2js(e):null},this.js2xml=d,this.getVersion=function(){return"3.1.1"}}})?r.apply(t,s):r)&&(e.exports=s)}()},function(e,t,n){"use strict";var r=n(9),l=r&&r.__esModule?r:{default:r},r=n(50).fn,m=n(0),i=n(317),d=n(26),p=n(5),f=n(172),g=n(316),o=n(171);r.sendText=function(e){return this.processCallback(e),e.msg=new this.message.TextMessage(e),this.sendMsg(e)},r.previewFile=function(n){if(m.verifyOptions(n,"done","msg::previewFile"),n.type||(n.type="file"),m.verifyParamPresentJustOne(n,"dataURL blob fileInput filePath wxFilePath fileObject","msg::previewFile"),m.exist(n.maxSize)&&m.verifyParamType("maxSize",n.maxSize,"number","api::previewFile"),m.exist(n.commonUpload)&&m.verifyParamType("commonUpload",n.commonUpload,"boolean","api::previewFile"),n.nosSurvivalTime?(m.verifyParamType("nosSurvivalTime",n.nosSurvivalTime,"number","api::Base.getInstance"),m.verifyParamMin("nosSurvivalTime",n.nosSurvivalTime,86400,"api::Base.getInstance")):n.nosSurvivalTime=this.nosSurvivalTime,n.filePath=n.filePath||n.wxFilePath,delete n.wxFilePath,n.dataURL)n.blob=o.fromDataURL(n.dataURL);else if(!n.blob&&n.fileInput){if(n.fileInput=m.verifyFileInput(n.fileInput,"msg::previewFile"),n.fileInput.files){if(!n.fileInput.files.length)return void n.done(d.newNoFileError("请选择"+n.type+"文件",{callFunc:"msg::previewFile",fileInput:n.fileInput}),n);n.fileSize=n.fileInput.files[0].size}n.fileInputName=m.getFileName(n.fileInput)}this.processCallback(n);var e,t=JSON.stringify(f.genResponseBody(n.type)||{}).replace(/"/gi,'\\"'),r=null,s=n.transcode?"getNosTokenTrans":"getNosToken";r=n.transcode?(m.verifyOptions(n,"fileInput","msg::previewFile"),{transToken:{name:(e=m.getFileInfo(n.fileInput)).name,type:e.transcodeType,transType:"png"===n.transcode?11:10,size:e.size,body:t}}):t,this[s]({responseBody:r,nosToken:{nosScene:n.nosScene||this.nosScene,nosSurvivalTime:n.nosSurvivalTime},callback:function(e,t){e?n.done(e):(n.transcode?(n.nosToken=t.nosToken,n.docId=t.docId):n.nosToken=t,this._doPreviewFile(n))}.bind(this)})},r._doPreviewFile=function(r){var e,s=this,i=r.uploaddone,t=p.genUploadUrl(r.nosToken.bucket),n=p.genChunkUploadUrl(r.nosToken),o=r.commonUpload||!n||p.isWeixinApp||p.isNodejs||p.isRN?(r.commonUpload=!0,t):n,a=this.assembleUploadParams(r.nosToken);function c(e,t,n){r.uploaddone=i,e?r.done(e,r.callback.options):(t=f.parseResponse(t,s.options.exifOrientation),n||(t.url=p.genDownloadUrl(r.nosToken,a.Object),r.nosToken.shortUrl&&(t._url_safe=r.nosToken.shortUrl)),m.exist(r.fileInputName)?t.name=r.fileInputName:r.blob?(e=r.blob.name,t.name=e||"blob-"+t.md5,e||(n=r.blob.type,t.ext=n.slice(n.lastIndexOf("/")+1))):r.filePath?t.name=r.filePath:r.fileObject&&(t.name=r.fileObject.fileName),t.ext||(e=t.name.lastIndexOf("."),t.ext=-1===e?"unknown":t.name.slice(e+1)),t.size=t.size||0,r.done(null,m.copy(t)))}if(p.isWeixinApp)m.verifyOptions(r,"filePath","msg::_doPreviewFile"),s.fileQuickTransfer(r,c,function(){wx.uploadFile({url:o,filePath:r.filePath,name:"file",formData:a,fail:function(e){s.protocol.logger.log("error:","api::msg:upload file failed",e)},success:function(t){if(200===t.statusCode)try{c(null,JSON.parse(t.data))}catch(e){s.protocol.logger.log("error:","parse wx upload file res error",e),c({code:"PARSE_WX_UPLOAD_FILE_RES_ERROR",str:t.data,msg:t.errMsg})}else c({code:t.statusCode,msg:t.errMsg})}})});else if(p.isNodejs){var u={url:o,name:"file",formData:a,success:function(t){if(200===t.statusCode)try{c(null,JSON.parse(t.data))}catch(e){s.protocol.logger.log("error:","parse nodejs upload file res error",e),c({code:"PARSE_NODEJS_UPLOAD_FILE_RES_ERROR",str:t.data,msg:t.errMsg})}else c({code:t.statusCode,msg:t.errMsg})},fail:function(e){s.protocol.logger.log("error:","api::msg:upload file failed",e)}};if(r.filePath)u.filePath=r.filePath;else{if("object"!==(0,l.default)(r.fileObject))throw new d("Nodejs上传fileObject参数类型应如 {fileName:..,fileData:..} ");u.fileData=r.fileObject.fileData}s.fileQuickTransfer(r,c,function(){g.uploadFile(u)})}else p.isRN?(e={url:o,name:"file",formData:a,filePath:r.filePath,success:function(t){if(t.ok&&200===t.status)try{t.md5=t.headers.map&&t.headers.map.etag&&t.headers.map.etag[0]||"UNKNOWN",c(null,t)}catch(e){s.protocol.logger.log("error:","parse React Native upload file res error",e),c({code:"PARSE_React_Native_UPLOAD_FILE_RES_ERROR",res:t})}else c({code:t.status,msg:t.statusText})},fail:function(e){s.protocol.logger.log("error:","api::msg:upload file failed",e)}},s.fileQuickTransfer(r,c,function(){g.uploadFile(e)})):(r.uploaddone=c,r.url=o,r.params=a,r.fileName="file",s.fileQuickTransfer(r,c,function(){return new g(r)}))},r.fileQuickTransfer=function(e,r,s){var i=this,t=(e=e||{},r instanceof Function||(r=function(){}),s instanceof Function||(s=function(){}),e.fastPass);if(t)try{t=JSON.parse(t),e.fastPass=t}catch(e){i.protocol.logger.error("快传参数解析失败")}var n=e.fileInputName||e.name||e.blob&&e.blob.name||"",o=e.fileSize||e.size||e.blob&&e.blob.size||0,a=t?((t.md5||e.digest||"")+"").trim():"",c=e.type||e.blob&&e.blob.type;if(a&&o>=p.threshold){var u=!0,l={name:n,md5:a,ext:n.slice(n.lastIndexOf(".")+1),type:c};switch(c){case"image":t&&t.w&&t.h?(l.w=t.w,l.h=t.h):(u=!1,i.protocol.logger.error("快传 image 文件缺少参数 w 或 h"));break;case"video":t&&t.w&&t.h&&t.dur?(l.w=t.w,l.h=t.h,l.dur=t.dur):(u=!1,i.protocol.logger.error("快传 video 文件缺少参数 w 或 h 或 dur"));break;case"audio":t&&t.dur?l.dur=t.dur:(u=!1,i.protocol.logger.error("快传 audio 文件缺少参数 dur"))}return u?(n={fileQuickTransfer:{md5:a}},o&&(n.fileQuickTransfer.size=o),this.protocol.sendCmd("fileQuickTransfer",n,function(e,t,n){!e&&n&&n.fileQuickTransfer&&n.fileQuickTransfer.url||(i.protocol.logger.error("misc::fileQuickTransfer: not found",e,t,n),s()),n&&n.fileQuickTransfer&&n.fileQuickTransfer.threshold&&(p.threshold=n.fileQuickTransfer.threshold||0),n&&n.fileQuickTransfer&&n.fileQuickTransfer.url&&(l.size=o||n.fileQuickTransfer.size,l.url=n.fileQuickTransfer.url,n.fileQuickTransfer._url_safe&&(l._url_safe=n.fileQuickTransfer._url_safe),r(e,l,!0))})):void s()}s()},r.sendFile=function(e){if(e.type||(e.type="file"),m.verifyParamPresentJustOne(e,"dataURL blob fileInput file filePath wxFilePath fileObject","msg::sendFile"),m.exist(e.maxSize)&&m.verifyParamType("maxSize",e.maxSize,"number","api::previewFile"),m.exist(e.commonUpload)&&m.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile"),this.processCallback(e),e.filePath=e.filePath||e.wxFilePath,delete e.wxFilePath,e.dataURL)this._previewAndSendFile(e);else if(e.blob)this._previewAndSendFile(e);else if(e.fileInput)e.fileInput=m.verifyFileInput(e.fileInput,"msg::sendFile"),e.fileInput.files&&!e.fileInput.files.length?e.done(d.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::sendFile",fileInput:e.fileInput}),e.callback.options):this._previewAndSendFile(e);else if(e.filePath||e.fileObject)this._previewAndSendFile(e);else{var t,n;if(e.file)return(n=e.file._url_safe)&&(t=e.file.url,e.file.url=n,delete e.file._url_safe),e.msg=new this.message.FileMessage(e),this.sendMsg(e,t)}},r._previewAndSendFile=function(r){var s=this,i=(m.verifyCallback(r,"uploaddone beforesend","msg::_previewAndSendFile"),r.done);r.done=function(e,t){var n;r.done=i,e?(r.uploaddone(e,r.callback.options),r.done(e,r.callback.options)):/chatroom/.test(r.scene)||(r.uploaddone(null,m.copy(t)),(e=t._url_safe)&&(n=t.url,t.url=e,delete t._url_safe),r.file=t,r.msg=new s.message.FileMessage(r),r.beforesend(s.sendMsg(r,n)))},s.previewFile(r)},r.assembleUploadParams=function(e){return e?{Object:decodeURIComponent(e.objectName),"x-nos-token":e.token,"x-nos-entity-type":"json"}:null},r.deleteFile=function(n){m.verifyParamPresentJustOne(n,"docId","msg::deleteFile"),this.removeFile({docId:n.docId,callback:function(e,t){e?n.error&&n.error(e,t):n.success&&n.success(t)}})},r.getFile=function(n){m.verifyParamPresentJustOne(n,"docId","msg::getFile"),this.fetchFile({docId:n.docId,callback:function(e,t){e?n.error&&n.error(e,t):n.success&&n.success(t.info)}})},r.getFileList=function(n){var e=n.fromDocId,e=void 0===e?"":e,t=n.limit,r=void 0===t?10:t,t={limit:r};e&&(t.fromDocId=e),this.fetchFileList({fileListParam:t,callback:function(e,t){e?(30<r&&(e.message=e.message+"::文档条数超过限制:30"),n.error&&n.error(e,t)):n.success&&n.success(t)}})},r.sendGeo=function(e){return this.processCallback(e),e.msg=new this.message.GeoMessage(e),this.sendMsg(e)},r.sendTipMsg=function(e){return this.processCallback(e),e.msg=new this.message.TipMessage(e),this.sendMsg(e)},r.sendCustomMsg=function(e){return this.processCallback(e),e.msg=new this.message.CustomMessage(e),this.sendMsg(e)},r.sendRobotMsg=function(e){return this.processCallback(e),e.msg=new this.message.RobotMessage(e),this.sendMsg(e)},r.sendMsg=function(e,t){var n=this.protocol,r=e.msg,s={},i=!!e.isLocal;if(i&&(e.time&&(r.time=e.time),e.idClient)&&(r.idClient=e.idClient),e.resend&&("out"!==e.flow||"fail"!==e.status))return m.onError("只能重发发送失败的消息");e.callback.options.idClient=r.idClient,this.beforeSendMsg(e,s);var o=e.rtnMsg=this.formatReturnMsg(r);return t&&!this.options.keepNosSafeUrl&&o.file&&(o.file._url_safe=o.file.url,o.file.url=t,"audio"===o.type)&&(o.file.mp3Url=t+(~t.indexOf("?")?"&":"?")+"audioTrans&type=mp3"),o.hasOwnProperty("chatroomId")&&!o.chatroomId?m.onError("聊天室未连接"):(i&&(o.status="success",o.isLocal=!0),n.storeSendMsg&&(s.promise=n.storeSendMsg(o)),e.cbaop=function(e){if(e&&"server"!==e.from)return o.status="fail",n.updateSendMsgError&&n.updateSendMsgError(o),o},i||(t&&!this.options.keepNosSafeUrl&&e.callback&&(e.callback.originUrl=t),s.msg=r,this.sendCmd(e.cmd,s,e.callback)),this.afterSendMsg(e),i&&setTimeout(function(){o=m.simpleClone(o),e.done(null,o)},0),m.copy(o))},r.beforeSendMsg=function(){},r.afterSendMsg=function(){},r.formatReturnMsg=function(e){return e=m.copy(e),this.protocol.completeMsg(e),e.status="sending",this.message.reverse(e)},r.resendMsg=function(e){return m.verifyOptions(e,"msg","msg::resendMsg"),this.trimMsgFlag(e),e.resend=!0,this._sendMsgByType(e)},r.forwardMsg=function(e){return m.verifyOptions(e,"msg","msg::forwardMsg"),this.trimMsgFlag(e),this.beforeForwardMsg(e),e.forward=!0,e.msg.idClient=m.guid(),this._sendMsgByType(e)},r.trimMsgFlag=function(e){e&&e.msg&&(e.msg=m.copy(e.msg),delete e.msg.resend,delete e.msg.forward)},r.beforeForwardMsg=function(){},r._sendMsgByType=function(e){switch(m.verifyOptions(e,"msg","msg::_sendMsgByType"),m.verifyParamValid("msg.type",e.msg.type,this.message.validTypes,"msg::_sendMsgByType"),m.merge(e,e.msg),e.type){case"text":return this.sendText(e);case"image":case"audio":case"video":case"file":return this.sendFile(e);case"geo":return this.sendGeo(e);case"custom":return this.sendCustomMsg(e);case"tip":return this.sendTipMsg(e);default:throw new d("不能发送类型为 "+e.type+" 的消息")}},r.parseRobotTemplate=function(e){if(/<template[^>\/]+\/>/.test(e))return{raw:e,json:[{type:"text",name:"",text:""}]};if(!/<template[^>\/]+>/.test(e))return{raw:e,json:[{type:"text",name:"",text:e}]};var t=new i({escapeMode:!1});e=e.replace(/<template [^>]+>/,"<template>");var t=(t=t.xml2js(e)).template.LinearLayout,n=(Array.isArray(t)||(t=[t]),[]);return t=t.forEach(function(e){var t;e.image&&(n=n.concat(s(e))),e.text&&(n=n.concat(r(e))),e.link&&(n=n.concat(((e=e).link&&(t=e.link,t=(t=Array.isArray(t)?t:[t]).map(function(e){return e.image&&(e.image=s(e)),e.text&&(e.text=r(e)),"url"===e._type?(e.type="url",e.style=e._style||"",e.target=e._target,delete e._target,delete e._style):"block"===e._type&&(e.type="block",e.style=e._style||"",e.params=e._params||"",e.target=e._target,delete e._params,delete e._target,delete e._style),delete e._type,e}),e.link=t),e.link)))}),{raw:e,json:n};function r(e){return Array.isArray(e.text)||(e.text=[e.text]),e.text=e.text.map(function(e){return{type:"text",name:e._name,text:e.__text}}),e.text}function s(e){return Array.isArray(e.image)||(e.image=[e.image]),e.image=e.image.map(function(e){return{type:"image",name:e._name,url:e._url}}),e.image}}},function(e,t,n){"use strict";n=n(50).fn;n.isConnected=function(){return!!this.protocol&&this.protocol.isConnected()},n.connect=function(){this.protocol.appLogin=0,this.protocol.connect(!0)},n.disconnect=function(e){this.protocol.disconnect((e=e||{}).done)}},function(e,t,n){"use strict";var r=n(21),o=n(0);function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o.merge(this,{options:e,debug:!1,api:"log",style:"color:blue;",log:o.emptyFunc,info:o.emptyFunc,warn:o.emptyFunc,error:o.emptyFunc}),this.prefix=e.prefix||"",this.setDebug(e.debug)}n(39);var n=s.prototype,a=["Chrome","Safari","Firefox"],i=(n.setDebug=function(){var s,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],i=this;(i.debug=e).style&&(i.style=e.style),i.debug&&o.exist(console)&&(s=console,i.debug=function(){var e=i.formatArgs(arguments);-1!==a.indexOf(r.name)&&o.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,i.style)),i._log("debug",e)},i.log=function(){var e=i.formatArgs(arguments);-1!==a.indexOf(r.name)&&o.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,i.style)),i._log("log",e)},i.info=function(){var e=i.formatArgs(arguments);-1!==a.indexOf(r.name)&&o.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,i.style)),i._log("info",e)},i.warn=function(){var e=i.formatArgs(arguments);-1!==a.indexOf(r.name)&&o.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,i.style)),i._log("warn",e)},i.error=function(){var e=i.formatArgs(arguments);-1!==a.indexOf(r.name)&&o.isString(e[0])&&(e[0]="%c"+e[0],e.splice(1,0,i.style)),i._log("error",e)},i._log=function(e,t){var n=i.options.logFunc,r=null;if(n&&(n[e]&&(r=n[e]),o.isFunction(r)))r.apply(n,t);else if(s[e])try{s[e].apply?i.chrome(e,t):i.ie(e,t)}catch(e){}},i.chrome=function(e,t){-1!==a.indexOf(r.name)?s[e].apply(s,t):i.ie(e,t)},i.ie=function(t,e){e.forEach(function(e){s[t](JSON.stringify(e,null,4))})})},n.formatArgs=function(n){n=[].slice.call(n,0);var e=new Date,e="[NIM LOG "+i(e.getMonth()+1)+"-"+i(e.getDate())+" "+i(e.getHours())+":"+i(e.getMinutes())+":"+i(e.getSeconds())+":"+i(e.getMilliseconds(),3)+" "+this.prefix.toUpperCase()+"]  ";return o.isString(n[0])?n[0]=e+n[0]:n.splice(0,0,e),n.forEach(function(e,t){(o.isArray(e)||o.isObject(e))&&(n[t]=o.simpleClone(e))}),n},function(e,t){t=t||2;for(var n=""+e;n.length<t;)n="0"+n;return n});e.exports=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(132).fn,s=n(0);r.queueOffer=function(e){s.verifyOptions(e,"elementKey elementValue","msg::queueOffer"),e.transient?e.transient=!0:e.transient=!1,this.processCallback(e),this.sendCmd("queueOffer",e,e.callback)},r.queuePoll=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.elementKey=e.elementKey||"",this.processCallback(e),this.sendCmd("queuePoll",e,e.callback)},r.queueList=function(e){this.processCallback(e),this.sendCmd("queueList",e,e.callback)},r.peak=function(e){this.processCallback(e),this.sendCmd("peak",e,e.callback)},r.queueDrop=function(e){this.processCallback(e),this.sendCmd("queueDrop",e,e.callback)},r.queueChange=function(e){s.verifyOptions(e,"elementMap","msg::queueOffer"),e.needNotify?(e.needNotify=!0,s.verifyOptions(e,"notifyExt","msg::queueOffer")):e.needNotify=!1,this.processCallback(e),this.sendCmd("queueChange",e,e.callback)}},function(e,t,n){"use strict";var r=n(0),s=r.undef,i=r.verifyOptions,o=r.verifyParamType,a=n(184),r=n(132).fn;r.updateMyChatroomMemberInfo=function(e){i(e,"member needNotify","member::updateMyChatroomMemberInfo"),o("needNotify",e.needNotify,"boolean","member::updateMyChatroomMemberInfo"),e.needSave=e.needSave||!1,o("needSave",e.needSave,"boolean","member::updateMyChatroomMemberInfo"),this.processCustom(e),this.processCallback(e),e.chatroomMember=new a(e.member),this.sendCmd("updateMyChatroomMemberInfo",e)},r.getChatroomMembers=function(e){i(e,"guest","member::getChatroomMembers"),o("guest",e.guest,"boolean","member::getChatroomMembers"),s(e.time)?e.time=0:o("time",e.time,"number","member::getChatroomMembers"),s(e.limit)?e.limit=100:o("limit",e.limit,"number","member::getChatroomMembers"),this.processCallback(e),e.type=e.guest?1:0,!e.guest&&e.onlyOnline&&(e.type=2),this.sendCmd("getChatroomMembers",e)},r.getChatroomMembersInfo=function(e){i(e,"accounts","member::getChatroomMembersInfo"),o("accounts",e.accounts,"array","member::getChatroomMembersInfo"),this.processCallback(e),this.sendCmd("getChatroomMembersInfo",e)},r.markChatroomIdentity=function(e){i(e,"identity","member::markChatroomIdentity"),e.type={manager:1,common:2,black:-1,mute:-2}[e.identity],delete e.identity,isNaN(e.type)?i(e,"identity",'member::markChatroomIdentity. The valid value of the identity is "manager" or "common" or "black" or "mute".'):this.markChatroomMember(e)},r.markChatroomManager=function(e){e.type=1,this.markChatroomMember(e)},r.markChatroomCommonMember=function(e){e.type=2,this.markChatroomMember(e)},r.markChatroomBlacklist=function(e){e.type=-1,this.markChatroomMember(e)},r.markChatroomGaglist=function(e){e.type=-2,this.markChatroomMember(e)},r.markChatroomMember=function(e){i(e,"account type isAdd","member::markChatroomMember"),o("isAdd",e.isAdd,"boolean","member::markChatroomMember"),s(e.level)?e.level=0:o("level",e.level,"number","member::markChatroomMember"),this.processCustom(e),this.processCallback(e),this.sendCmd("markChatroomMember",e)},r.kickChatroomMember=function(e){i(e,"account","member::kickChatroomMember"),this.processCustom(e),this.processCallback(e),this.sendCmd("kickChatroomMember",e)},r.updateChatroomMemberTempMute=function(e){i(e,"account duration needNotify","member::updateChatroomMemberTempMute"),o("duration",e.duration,"number","member::updateChatroomMemberTempMute"),o("needNotify",e.needNotify,"boolean","member::updateChatroomMemberTempMute"),this.processCustom(e),this.processCallback(e),this.sendCmd("updateChatroomMemberTempMute",e)},r.getRobotList=function(e){s(e.timetag)&&(e.timetag=0),this.processCallback(e),this.sendCmd("syncRobot",e)}},function(e,t,n){"use strict";var s=n(0),i=s.undef,n=n(132).fn,o=(n.beforeSendMsg=function(e){e.cmd="sendMsg"},{text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100});n.getHistoryMsgs=function(r){s.verifyOptions(r),i(r.timetag)?r.timetag=0:s.verifyParamType("timetag",r.timetag,"number","msg::getHistoryMsgs"),i(r.limit)?r.limit=100:s.verifyParamType("limit",r.limit,"number","msg::getHistoryMsgs"),i(r.reverse)?r.reverse=!1:s.verifyParamType("reverse",r.reverse,"boolean","msg::getHistoryMsgs"),i(r.msgTypes)?r.msgTypes=[]:Array.isArray(r.msgTypes)?(r.msgTypes=r.msgTypes.map(function(e){return o[e]}),r.msgTypes=r.msgTypes.filter(function(e){return"number"==typeof e})):"number"==typeof o[r.msgTypes]?r.msgTypes=[o[r.msgTypes]]:r.msgTypes=[],this.processCallback(r),this.sendCmd("getHistoryMsgs",r,function(e,t,n){Array.isArray(n)&&(n=n.map(function(e){return o[e.type]&&(e.type=o[e.type]),e})),r.callback(e,t,n)})}},function(e,t,n){"use strict";var r=n(72),s=n(0),i={welcome:"00",text:"01",link:"03"},o={"01":"text","02":"image","03":"answer",11:"template"};function a(e){s.verifyOptions(e,"content","msg::RobotMessage");var t=e.content;switch(t.type){case"welcome":s.undef(e.body)&&(this.body="欢迎消息");break;case"text":s.verifyOptions(t,"content","msg::RobotMessage"),s.undef(e.body)&&(this.body=t.content);break;case"link":s.verifyOptions(t,"target","msg::RobotMessage")}t.type&&(t.type=i[t.type]),t={param:t,robotAccid:e.robotAccid},this.attach=JSON.stringify(t),e.type="robot",r.call(this,e)}a.prototype=Object.create(r.prototype),a.reverse=function(e){var t,n=r.reverse(e);return"robot"===n.type&&((e=JSON.parse(e.attach)).param&&(e.param.type=o[e.param.type]||"unknown"),e.robotMsg&&(t=(e=s.merge(e,e.robotMsg)).message,"bot"===e.flag?e.message=t.map(function(e){return e.type=o[e.type]||"unknown",e}):e.flag,delete e.robotMsg),n.content=e),n},e.exports=a},function(e,t,n){"use strict";var r=n(72),s=n(0);function i(e){s.verifyOptions(e,"tip","msg::TipMessage"),e.type="tip",r.call(this,e),this.attach=e.tip}i.prototype=Object.create(r.prototype),i.reverse=function(e){var t=r.reverse(e);return t.tip=e.attach,t},e.exports=i},function(e,t,n){"use strict";var r=n(72),s=n(0);function i(e){s.verifyOptions(e,"content","msg::CustomMessage"),e.type="custom",r.call(this,e),"string"!=typeof e.content&&(e.content=JSON.stringify(e.content)),this.attach=e.content}i.prototype=Object.create(r.prototype),i.reverse=function(e){var t=r.reverse(e);return t.content=e.attach,t},e.exports=i},function(e,t,n){"use strict";var r=n(0).notundef,s=n(72),i={301:"memberEnter",302:"memberExit",303:"blackMember",304:"unblackMember",305:"gagMember",306:"ungagMember",307:"addManager",308:"removeManager",309:"addCommon",310:"removeCommon",311:"closeChatroom",312:"updateChatroom",313:"kickMember",314:"addTempMute",315:"removeTempMute",316:"updateMemberInfo",317:"updateQueue",318:"muteRoom",319:"unmuteRoom",320:"batchUpdateQueue"};function o(){}o.prototype=Object.create(s.prototype),o.reverse=function(e){var t=s.reverse(e);if(e.attach=e.attach?""+e.attach:"",e.attach){e=JSON.parse(e.attach);if(t.attach={type:i[e.id]},r(e.data)){e=e.data;if(r(e.operator)&&(t.attach.from=e.operator),r(e.opeNick)&&(t.attach.fromNick=e.opeNick),r(e.target)&&(t.attach.to=e.target),r(e.tarNick)&&(t.attach.toNick=e.tarNick),r(e.muteDuration)&&(t.attach.duration=parseInt(e.muteDuration,10)),"memberEnter"===t.attach.type&&(r(e.muted)?t.attach.gaged=1==+e.muted:t.attach.gaged=!1,r(e.tempMuted)?t.attach.tempMuted=1==+e.tempMuted:t.attach.tempMuted=!1,r(e.muteTtl)?t.attach.tempMuteDuration=+e.muteTtl:t.attach.tempMuteDuration=0),r(e.ext)&&(t.attach.custom=e.ext),r(e.queueChange)){var n=JSON.parse(e.queueChange);switch(n._e){case"OFFER":t.attach.queueChange={type:"OFFER",elementKey:n.key,elementValue:n.content};break;case"POLL":t.attach.queueChange={type:"POLL",elementKey:n.key,elementValue:n.content};break;case"DROP":t.attach.queueChange={type:"DROP"};break;case"PARTCLEAR":case"BATCH_UPDATE":t.attach.queueChange={type:n._e,elementKv:n.kvObject}}}}}else t.attach={};return t},e.exports=o},function(e,t,n){"use strict";var r=n(72),s=n(0);function i(e){e.type="geo",s.verifyOptions(e,"geo","msg::GeoMessage"),s.verifyOptions(e.geo,"lng lat title",!0,"geo.","msg::GeoMessage"),s.verifyParamType("geo.lng",e.geo.lng,"number","msg::GeoMessage"),s.verifyParamType("geo.lat",e.geo.lat,"number","msg::GeoMessage"),s.verifyParamType("geo.title",e.geo.title,"string","msg::GeoMessage"),r.call(this,e),this.attach=JSON.stringify(e.geo)}i.prototype=Object.create(r.prototype),i.reverse=function(e){var t=r.reverse(e);return e.attach=e.attach?""+e.attach:"",t.geo=e.attach?JSON.parse(e.attach):{},t},e.exports=i},function(e,t,n){"use strict";var r=n(131),s=n(0);function i(){}i.prototype=Object.create(r.prototype),i.verifyFile=function(e,t){s.verifyOptions(e,"dur w h",!0,"file.",t)},e.exports=i},function(e,t,n){"use strict";var r=n(131),s=n(0);function i(){}i.prototype=Object.create(r.prototype),i.verifyFile=function(e,t){s.verifyOptions(e,"dur",!0,"file.",t)},e.exports=i},function(e,t,n){"use strict";var r=n(0),n=n(131);function s(){}s.prototype=Object.create(n.prototype),s.verifyFile=function(e,t){r.verifyOptions(e,"w h",!0,"file.",t)},e.exports=s},function(e,t,n){"use strict";var r=n(72),s=n(0);function i(e){s.verifyOptions(e,"text","msg::TextMessage"),e.type="text",r.call(this,e),this.attach=e.text,this.body=""}i.prototype=Object.create(r.prototype),i.reverse=function(e){var t=r.reverse(e);return t.text=e.attach,t},e.exports=i},function(e,t,n){"use strict";function r(e){this.account=e.account}var s=n(0),i=r.prototype,o=i.Message=n(72),a=i.TextMessage=n(396),c=i.FileMessage=n(131),u=i.GeoMessage=n(392),l=i.NotificationMessage=n(391),m=i.CustomMessage=n(390),d=i.TipMessage=n(389),p=i.RobotMessage=n(388);i.validTypes=o.validTypes,i.reverse=function(e){var t;switch(o.getType(e)){case"text":t=a.reverse(e);break;case"image":case"audio":case"video":case"file":t=c.reverse(e);break;case"geo":t=u.reverse(e);break;case"notification":t=l.reverse(e);break;case"custom":t=m.reverse(e);break;case"tip":t=d.reverse(e);break;case"robot":t=p.reverse(e);break;default:t=o.reverse(e)}return o.setExtra(t,this.account),t},i.reverseMsgs=function(e,t){var n,r=this;return e.map(function(e){return e=r.reverse(e),e=t&&((n=t.modifyObj)&&(e=s.merge(e,n)),n=t.mapper,s.isFunction(n))?n(e):e})},e.exports=r},function(e,t,n){"use strict";var r=n(121).fn,s=n(184);r.onChatroomMembersInfo=r.onChatroomMembers=function(e){e.error||(e.obj.members=s.reverseMembers(e.content.members))},r.onMarkChatroomMember=function(e){e.error||(e.obj.member=s.reverse(e.content.chatroomMember))},r.onSyncRobot=function(e){!e.error&&this.options.onrobots?this.options.onrobots(null,e.content):this.ontions.onrobots(e.error,{})}},function(e,t,n){"use strict";var r=n(121).fn,n=n(0);r.completeMsg=function(e){e.chatroomId=this.chatroom&&this.chatroom.id,e.from=this.options.account,e.fromClientType="Web",e.time||(e.time=+new Date)},r.onMsg=function(e){e=this.message.reverse(e.content.msg);this.checkMsgUnique(e)&&(this.msgBuffer.push(e),this.msgFlushTimer||this.startMsgFlushTimer())},r.startMsgFlushTimer=function(){var t=this,n=t.options;t.msgFlushTimer=setTimeout(function(){var e=t.msgBuffer.splice(0,n.msgBufferSize);t.options.onmsgs(e),t.msgBuffer.length?t.startMsgFlushTimer():delete t.msgFlushTimer},n.msgBufferInterval)},r.checkMsgUnique=n.genCheckUniqueFunc("idClient"),r.onSendMsg=function(e){var t=e.obj.msg;e.error?t.status="fail":(t=e.content.msg).status="success",t=this.message.reverse(t),e.obj=t},r.onHistoryMsgs=function(e){e.error||(e.obj||(e.obj={}),e.obj.msgs=this.message.reverseMsgs(e.content.msgs))}},function(e,t,n){"use strict";var r=n(121).fn,s=n(56),i=n(0);r.assembleLogin=function(){var e=this.options,t=(this.sdkSession=this.genSessionKey(),{appKey:e.appKey,account:e.account,deviceId:s.deviceId,chatroomId:e.chatroomId,session:this.sdkSession,appLogin:this.appLogin||0});return{type:1,login:i.merge(t,i.filterObj(e,"chatroomNick chatroomAvatar chatroomCustom chatroomEnterCustom isAnonymous")),imLogin:this.assembleIMLogin()}},r.afterLogin=function(e){e=e.chatroom;this.chatroom=e,this.notifyLogin()},r.kickedReasons=["","chatroomClosed","managerKick","samePlatformKick","silentlyKick","blacked"],r.kickedMessages=["","聊天室关闭了","被房主或者管理员踢出","不允许同一个帐号在多个地方同时登录","悄悄被踢","被拉黑了"]},function(e,t,n){"use strict";var r=n(121).fn,s=n(5),i=n(39);r.refreshSocketUrl=function(){this.socketUrlsBackup=this.socketUrlsBackup||[],this.socketUrls=this.socketUrlsBackup.slice(0),this.logger.info("link::refreshSocketUrl"),this.connectToUrl(this.getNextSocketUrl()),this.getNosChunkUploadUrl()},r.getNosChunkUploadUrl=function(){var t,e;s.isWeixinApp||null!=s.chunkUploadUrl||(e=s.lbsUrl,(t=this).logger.info("link::getNosChunkUploadUrl: ajax webconf "+e),i(e,{onload:function(e){e=JSON.parse(e),s.chunkUploadUrl=s.chunkUploadUrl||e["nos-chunk"]||""},onerror:function(e){t.logger.error("link::getNosChunkUploadUrl: ajax get webconf error",e)}}))}},function(e,t,n){"use strict";n(154);var r=n(132);n(185)(r),e.exports=r},function(e,t,n){"use strict";var r=n(0),s=r.notundef;function i(e){r.verifyOptions(e,"type","event::MsgEventSubscribe"),r.verifyParamType("type",e.type,"number","event::MsgEventSubscribe"),r.findObjIndexInArray([1,2,3],e.type)<0&&r.verifyParamMin("type",e.type,1e5,"event::MsgEventSubscribe"),this.type=e.type,s(e.subscribeTime)?(r.verifyParamType("subscribeTime",e.subscribeTime,"number","event::MsgEventSubscribe"),r.verifyParamMin("subscribeTime",e.subscribeTime,60,"event::MsgEventSubscribe"),r.verifyParamMax("subscribeTime",e.subscribeTime,2592e3,"event::MsgEventSubscribe"),this.subscribeTime=e.subscribeTime):this.subscribeTime=2592e3,s(e.sync)?(r.verifyParamType("sync",e.sync,"boolean","event::MsgEventSubscribe"),this.sync=e.sync):this.sync=!0}i.prototype.assembleEvent=function(e){return{type:this.type,subscribeTime:this.subscribeTime,sync:!0===this.sync?1:0}},e.exports=i},function(e,t,n){"use strict";var r=n(0),s=r.notundef,i=n(26);function o(e){if(r.verifyOptions(e,"type value","event::MsgEvent"),r.verifyParamType("type",e.type,"number","event::MsgEvent"),r.verifyParamType("value",e.value,"number","event::MsgEvent"),this.type=e.type,this.value=e.value,this.idClient=r.guid(),s(e.custom)&&(this.custom=""+e.custom),this.validTime=e.validTime||604800,r.verifyParamType("validTime",this.validTime,"number","event::MsgEvent"),r.verifyParamMin("validTime",this.validTime,60,"event::MsgEvent"),r.verifyParamMax("validTime",this.validTime,604800,"event::MsgEvent"),s(e.broadcastType)){if(r.verifyParamType("broadcastType",e.broadcastType,"number","event::MsgEvent"),[1,2].indexOf(e.broadcastType)<0)throw new i('参数错误"broadcastType":只能为1或2');this.broadcastType=e.broadcastType}else this.broadcastType=2;s(e.sync)?(r.verifyParamType("sync",e.sync,"boolean","event::MsgEvent"),this.sync=e.sync):this.sync=!1}o.prototype.assembleEvent=function(){return{type:this.type,value:this.value,idClient:this.idClient,custom:this.custom||"",validTime:this.validTime,broadcastType:this.broadcastType,sync:!0===this.sync?1:0}},e.exports=o},function(e,t,n){"use strict";var r=n(9),s=r&&r.__esModule?r:{default:r},r=n(29).fn,c=n(0),i=n(404),o=n(403);function u(e){return"object"===(void 0===e?"undefined":(0,s.default)(e))&&(e.msgEventSubscribes?e=e.msgEventSubscribes:e.msgEventSubscribe?e=e.msgEventSubscribe:e.accounts?e=e.accounts:e.msgEvent&&(e=e.msgEvent).time&&(e.time=+e.time),1===e.sync?e.sync=!0:0===e.sync&&(e.sync=!1)),e}r.batchSendEventsCmds=function(s,i,o){var a=this,e=c.dropArrayDuplicates(i.accounts),e=c.reshape2d(e,100),n=[];e.forEach(function(t){n.push(new Promise(function(n,r){var e=c.simpleClone(i);e.accounts=t,a.sendCmdWithResp(s,e,function(e,t){e?r(e):n(u(t))})}))}),Promise.all(n).then(function(e){var t,n,r=null;0<e.length&&(e[0].msgEventSubscribe?(t=u(t=e[0].msgEventSubscribe),n=[],e.forEach(function(e){n=n.concat(e.accounts)}),r={accounts:n,msgEventSubscribe:t}):(r=[],e.forEach(function(e){r=r.concat(e)}))),o(null,r)},function(e){o(e,null)})},r.publishEvent=function(n){var e=(e=new i(n)).assembleEvent();this.processCallback(n),this.sendCmdWithResp("publishEvent",{msgEvent:e},function(e,t){e||(t=u(t)),n.callback(e,t)})},r.subscribeEvent=function(n){c.verifyOptions(n,"accounts","event::subscribeEvent");var e=new o(n);c.verifyParamType("accounts",n.accounts,"array","event::subscribeEvent"),this.processCallback(n),e=e.assembleEvent(),this.batchSendEventsCmds("subscribeEvent",{msgEventSubscribe:e,accounts:n.accounts},function(e,t){n.callback(e,t=e?t:t&&{failedAccounts:t})})},r.unSubscribeEventsByAccounts=function(n){c.verifyOptions(n,"accounts","event::unSubscribeEventsByAccounts"),c.verifyParamType("accounts",n.accounts,"array","event::unSubscribeEventsByAccounts");var e=(e=new o(n)).assembleEvent();this.processCallback(n),this.batchSendEventsCmds("unSubscribeEventsByAccounts",{msgEventSubscribe:e,accounts:n.accounts},function(e,t){n.callback(e,t=e?t:t&&{failedAccounts:t})})},r.unSubscribeEventsByType=function(n){var e=(e=new o(n)).assembleEvent();this.processCallback(n),this.sendCmdWithResp("unSubscribeEventsByType",{msgEventSubscribe:e},function(e,t){n.callback(e)})},r.querySubscribeEventsByAccounts=function(n){c.verifyOptions(n,"accounts","event::querySubscribeEventsByAccounts"),c.verifyParamType("accounts",n.accounts,"array","event::querySubscribeEventsByAccounts");var e=(e=new o(n)).assembleEvent();this.processCallback(n),this.batchSendEventsCmds("querySubscribeEventsByAccounts",{msgEventSubscribe:e,accounts:n.accounts},function(e,t){n.callback(e,t=e?t:t&&{msgEventSubscribes:t})})},r.querySubscribeEventsByType=function(n){var e=(e=new o(n)).assembleEvent();this.processCallback(n),this.sendCmdWithResp("querySubscribeEventsByType",{msgEventSubscribe:e},function(e,t){e||(t={msgEventSubscribes:u(t)}),n.callback(e,t)})}},function(e,t,n){"use strict";var r=n(29).fn,s=n(187),i=n(0),o=i.undef;r.getPushNotificationMultiportConfig=function(){return this.protocol.getPushNotificationMultiportConfig()},r.updatePushNotificationMultiportConfig=function(e){i.verifyOptions(e),o(e.shouldPushNotificationWhenPCOnline)&&(e.shouldPushNotificationWhenPCOnline=!0),e.donnop=new s(e),this.processCallback(e),this.sendCmd("updateDonnop",e)}},function(e,t,n){"use strict";n=n(29).fn;n.clearDB=function(e){var t=this.db,e=(this.processCallback(e),e.done);t.enable?t.clear().then(e,e):e()},n.removeDB=function(e){var t=this.db,e=(this.processCallback(e),e.done);t.enable?t.destroy().then(e,e):e()},n.closeDB=function(e){var t=this.db,e=(this.processCallback(e),e.done);t.enable?t.close().then(e,e):e()}},function(e,t,n){"use strict";var r=n(29).fn,s=n(0);r.audioToText=function(e){s.verifyOptions(e,"url","audio::audioToText"),e.audioToText=s.filterObj(e,"url"),this.processCallback(e),this.sendCmd("audioToText",e)}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";var r=n(29).fn,s=n(0),i=n(5);r.getChatroomAddress=function(e){s.verifyOptions(e,"chatroomId","chatroom::getChatroomAddress"),e.isWeixinApp=i.isWeixinApp,this.processCallback(e),this.sendCmd("getChatroomAddress",e)}},function(e,t,n){"use strict";var r=n(29).fn,a=n(0),i=a.undef,o=a.notundef,c=n(124);r.markSysMsgRead=function(e){var t,n=this.db,r=Promise.resolve(),s=this.protocol,i=(a.verifyOptions(e,"sysMsgs","sysmsg::markSysMsgRead"),e.sysMsgs);function o(){e.done(t,e)}a.isArray(i)||(i=[i]),n.enable?r=n.markSysMsgRead(i).then(function(e){i=e,s.onUpdateSysMsg(e)}):(i=i.filter(function(e){return!e.read})).length&&(s.options.autoMarkRead||s.markSysMsgRead(i,!0),i.forEach(function(e){e.read=!0}),s.onUpdateSysMsg(i)),r.then(function(){return s.reduceSysMsgUnread(i)}).then(o,function(e){t=e,o()})},r.sendCustomSysMsg=function(e){a.verifyOptions(e,"scene to content","sysmsg::sendCustomSysMsg"),a.verifyParamValid("scene",e.scene,this.message.validScenes,"sysmsg::sendCustomSysMsg"),this.processCallback(e),"p2p"===e.scene?e.type="customP2p":e.type="customTeam",e.sysMsg=new c(e);var t="sendCustomSysMsg";return e.filter&&(t="sendFilterCustomSysMsg"),this.sendCmd(t,{sysMsg:e.sysMsg,single:!0},e.callback),this.formatReturnSysMsg(e.sysMsg)},r.formatReturnSysMsg=function(e){return e=a.copy(e),this.protocol.completeSysMsg(e),e.status="sending",c.reverse(e)},r.getLocalSysMsgs=function(e){var t,n=this.db,r=[];function s(){e.sysMsgs=r,e.done(t,e)}a.verifyOptions(e),e.category&&a.verifyParamValid("category",e.category,c.validCategories,"sysmsg::getLocalSysMsgs"),e.type&&a.verifyParamValid("type",e.type,c.validTypes,"sysmsg::getLocalSysMsgs"),i(e.limit)&&(e.limit=100),a.verifyParamType("limit",e.limit,"number","sysmsg::getLocalSysMsgs"),a.verifyParamMax("limit",e.limit,100,"sysmsg::getLocalSysMsgs"),o(e.reverse)?a.verifyParamType("reverse",e.reverse,"boolean","sysmsg::getLocalSysMsgs"):e.reverse=!1,this.processCallback(e),n.enable?n.getSysMsgs(e).then(function(e){r=e,s()},function(e){t=e,s()}):s()},r.updateLocalSysMsg=function(e){var t,n,r=this.db,s=null;function i(){e.sysMsg=s,e.done(t,e)}a.verifyOptions(e,"idServer","sysmsg::updateLocalSysMsg"),this.processCallback(e),r.enable?(n=a.filterObj(e,"idServer state localCustom"),r.updateSysMsg(n).then(function(e){s=e,i()},function(e){t=e,i()})):i()},r.deleteLocalSysMsg=function(e){var t,n=this.db;function r(){e.done(t,e)}a.verifyOptions(e,"idServer","sysmsg::deleteLocalSysMsg"),this.processCallback(e),n.enable?n.deleteSysMsg(e.idServer).then(function(){r()},function(e){t=e,r()}):r()},r.deleteAllLocalSysMsgs=function(e){var t,n=this,r=n.db;function s(){n.protocol.onUpdateSysMsgUnread({}),e.done(t,e)}n.processCallback(e),r.enable&&r.deleteAllSysMsgs().then(function(){s()},function(e){t=e,s()})}},function(e,t,n){"use strict";var r=n(29).fn,a=n(0),c=a.undef,u=a.notundef,s=n(56),i=n(123),o=n(124),l=n(26),m=(r.beforeSendMsg=function(e){var t,n=this.protocol,r=e.msg;switch(r.to===this.account&&(r.fromDeviceId=s.deviceId),r.userUpdateTime=n.myInfo&&n.myInfo.updateTime,r.getScene()){case"p2p":t="sendMsg";break;case"team":t="sendTeamMsg";break;case"superTeam":t="sendSuperTeamMsg"}e.filter&&(t="sendFilterMsg",r.filter=!0),e.cmd=t},r.afterSendMsg=function(e){e=e.rtnMsg,e=i.genSessionByMsg(e);this.protocol.onUpdateSession(e)},r.beforeForwardMsg=function(e){a.verifyOptions(e,"msg scene to","msg::beforeForwardMsg"),e.msg.scene=e.scene,e.msg.to=e.to},r.markMsgRead=function(e){var t=this.protocol;!e||this.db.enable||t.options.autoMarkRead?this.logger.warn("api::markMsgRead: 不需要标记消息为已收到 (没有消息, 或者启用了数据库, 或者启用了自动标记已收到)"):t.markMsgRead(e,!0)},r.sendMsgReceipt=function(e){var t;a.verifyOptions(e),this.processCallback(e),e.msg&&(a.verifyOptions(e,"msg","msg::sendMsgReceipt"),t=e.msg,a.verifyOptions(t,"target idClient time",!0,"msg.","msg::sendMsgReceipt"),this.protocol.shouldSendMsgReceipt(t))?this.sendCmd("sendMsgReceipt",{msgReceipt:{to:t.target,idClient:t.idClient,time:t.time}},e.callback):e.done()},r.isMsgRemoteRead=function(e){return this.protocol.isMsgRemoteRead(e)},r.deleteMsg=function(e){a.verifyOptions(e,"msg","msg::deleteMsg");var t=e.msg;if("team"!==t.scene&&"out"!==t.flow||"success"!==t.status||t.from===t.to||t.isLocal)return e.done(l.newParamError("只能删除自己发送给别人的, 并且发送成功的非本地消息",{callFunc:"msg::deleteMsg"}),e);a.verifyOptions(t,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsg"),a.verifyParamValid("msg.scene",t.scene,this.message.validScenes,"msg::deleteMsg");var n=a.simpleClone(t);this.processPs(n),this.processCallback(e),u(e.opeAccount)?n.opeAccount=e.opeAccount:c(n.opeAccount)&&(n.opeAccount=n.from),"p2p"===n.scene?n.type="deleteMsgP2p":n.type="deleteMsgTeam",n.deletedIdClient=n.idClient,n.deletedIdServer=n.idServer,n=new o(n),this.sendCmd("deleteMsg",{sysMsg:n,msg:t},e.callback)},{text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100});r.getHistoryMsgs=function(e){var t;switch(a.verifyOptions(e,"scene to","msg::getHistoryMsgs"),a.verifyParamValid("scene",e.scene,this.message.validScenes,"msg::getHistoryMsgs"),void 0===e.beginTime&&(e.beginTime=0),a.verifyParamType("beginTime",e.beginTime,"number","msg::getHistoryMsgs"),void 0===e.endTime&&(e.endTime=0),a.verifyParamType("endTime",e.endTime,"number","msg::getHistoryMsgs"),void 0!==e.lastMsgId&&null!==e.lastMsgId||(e.lastMsgId="0"),void 0===e.limit&&(e.limit=100),a.verifyParamType("limit",e.limit,"number","msg::getHistoryMsgs"),a.verifyParamMax("limit",e.limit,100,"msg::getHistoryMsgs"),u(e.reverse)?a.verifyParamType("reverse",e.reverse,"boolean","msg::getHistoryMsgs"):e.reverse=!1,u(e.asc)?a.verifyParamType("asc",e.asc,"boolean","msg::getHistoryMsgs"):e.asc=!1,c(e.msgTypes)?e.msgTypes=[]:Array.isArray(e.msgTypes)?(e.msgTypes=e.msgTypes.map(function(e){return m[e]}),e.msgTypes=e.msgTypes.filter(function(e){return"number"==typeof e})):"number"==typeof m[e.msgTypes]?e.msgTypes=[m[e.msgTypes]]:e.msgTypes=[],this.processCallback(e),e.asc&&(e.cbaop=function(e,t){e||(t.msgs=t.msgs.reverse())}),e.scene){case"p2p":t="getHistoryMsgs";break;case"team":t="getTeamHistoryMsgs";break;case"superTeam":t="getSuperTeamHistoryMsgs"}var n={scene:e.scene,to:e.to,beginTime:e.beginTime,endTime:e.endTime,lastMsgId:e.lastMsgId,limit:e.limit,reverse:e.reverse,msgTypes:e.msgTypes};this.sendCmd(t,n,e.callback)},r.searchHistoryMsgs=function(e){var t;switch(a.verifyOptions(e,"scene to keyword","msg::searchHistoryMsgs"),a.verifyParamValid("scene",e.scene,this.message.validScenes,"msg::searchHistoryMsgs"),void 0===e.beginTime&&(e.beginTime=0),a.verifyParamType("beginTime",e.beginTime,"number","msg::searchHistoryMsgs"),void 0===e.endTime&&(e.endTime=0),a.verifyParamType("endTime",e.endTime,"number","msg::searchHistoryMsgs"),void 0===e.limit&&(e.limit=100),a.verifyParamType("limit",e.limit,"number","msg::searchHistoryMsgs"),a.verifyParamMax("limit",e.limit,100,"msg::searchHistoryMsgs"),u(e.reverse)?a.verifyParamType("reverse",e.reverse,"boolean","msg::searchHistoryMsgs"):e.reverse=!1,u(e.asc)?a.verifyParamType("asc",e.asc,"boolean","msg::searchHistoryMsgs"):e.asc=!1,this.processCallback(e),e.asc&&(e.cbaop=function(e,t){e||(t.msgs=t.msgs.reverse())}),e.scene){case"p2p":t="searchHistoryMsgs";break;case"team":t="searchTeamHistoryMsgs"}var n=a.filterObj(e,"scene to beginTime endTime keyword limit reverse");this.sendCmd(t,n,e.callback)},r.getLocalMsgs=function(t){var e=this.db,n=null,r=[],s=(a.verifyOptions(t),!1),i=(u(t.start)&&(s=!0,a.verifyParamType("start",t.start,"number","msg::getLocalMsgs")),!1);function o(){var e=a.simpleClone(t);e.msgs=r,delete e.callback,delete e.done,t.done(n,e)}u(t.end)&&(i=!0,a.verifyParamType("end",t.end,"number","msg::getLocalMsgs")),s&&i&&t.end<=t.start&&a.onParamError("参数 end 必须晚于 start"),c(t.limit)&&(t.limit=100),a.verifyParamType("limit",t.limit,"number","msg::getLocalMsgs"),a.verifyParamMin("limit",t.limit,1,"msg::getLocalMsgs"),this.processCallback(t),e.enable?e.getMsgs(t).then(function(e){r=e,o()},function(e){(e=e||{}).message=e.message||"msg::getLocalMsgs:db error",o()}):o()},r.getLocalMsgByIdClient=function(e){var t,n=this.db,r=null;function s(){e.msg=r,e.done(t,e)}a.verifyOptions(e,"idClient","msg::getLocalMsgByIdClient"),this.processCallback(e),n.enable?n.getMsgByIdClient(e.idClient).then(function(e){e&&(r=e),s()},function(e){t=e,s()}):s()},r.getLocalMsgsByIdClients=function(e){var t,n=this.db,r=[];function s(){e.msgs=r,e.done(t,e)}a.verifyOptions(e,"idClients","msg::getLocalMsgByIdClient"),a.verifyParamType("idClients",e.idClients,"array","msg::getLocalMsgByIdClient"),this.processCallback(e),n.enable?n.getMsgsByIdClients(e.idClients).then(function(e){r=e.filter(function(e){return!!e}),s()},function(e){t=e,s()}):s()},r.updateLocalMsg=function(e){var t,n,r=this.db,s=null;function i(){e.msg=s,e.done(t,e)}a.verifyOptions(e,"idClient","msg::updateLocalMsg"),this.processCallback(e),r.enable?(n=a.filterObj(e,"idClient localCustom"),r.updateMsg(n).then(function(e){s=e,i()},function(e){t=e,i()})):i()},r.deleteLocalMsg=function(e){a.verifyOptions(e,"msg","msg::deleteLocalMsg");var t,n=e.msg;function r(){e.done(t,e)}a.verifyOptions(n,"idClient sessionId",!0,"msg.","msg::deleteLocalMsg"),this.processCallback(e),this.protocol.deleteLocalMsg(n).then(r,function(e){t=e,r()})},r.deleteLocalMsgsBySession=function(t){var n,r=this,e=r.db;function s(e){n=e,i()}function i(){t.done(n,t)}a.verifyOptions(t,"scene to","msg::deleteLocalMsgsBySession"),a.verifyParamValid("scene",t.scene,r.message.validScenes,"msg::deleteLocalMsgsBySession"),t.sessionId=t.scene+"-"+t.to,t.delLastMsg=!0===t.delLastMsg,r.processCallback(t),e.enable?e.deleteMsgsBySessionId(t).then(function(){t.delLastMsg?e.updateSession({id:t.sessionId,lastMsg:null}).then(function(e){r.protocol.onUpdateSession(e),t.session=e,i()},s):i()},s):(t.delLastMsg&&r.protocol.onUpdateSession({id:t.sessionId,lastMsg:null}),i())},r.deleteLocalMsgs=function(e){var t,n=this,r=n.db,s=!1!==e.updateSession;function i(){e.done(t,e)}a.verifyOptions(e,"sessionId","msg::deleteLocalMsgsBySession"),u(e.start)&&a.verifyParamType("start",e.start,"number","msg::deleteLocalMsgs"),u(e.end)&&a.verifyParamType("end",e.end,"number","msg::deleteLocalMsgs"),u(e.end)&&u(e.start)&&e.end<=e.start&&a.onParamError("参数 end 必须大于 start"),n.processCallback(e),r.enable?r.deleteMsgsBySessionId(e).then(function(){i(),s&&n.protocol.checkAndUpdateLocalSessionByMsg(e.sessionId)},function(e){t=e,i()}):i()},r.deleteAllLocalMsgs=function(e){var t,n=this.db;function r(){e.done(t,e)}this.processCallback(e),n.enable&&n.deleteAllMsgs().then(function(){r()},function(e){t=e,r()})},r.clearServerHistoryMsgs=function(e){a.verifyOptions(e,"account","msg::clearServerHistoryMsgs");var t=!(!1===e.delRoam);this.processCallback(e),this.sendCmd("clearServerHistoryMsgs",{clearMsgsParams:{account:e.account,delRoam:t?1:0}},e.callback)}},function(e,t,n){"use strict";var r=n(29).fn,c=n(0),o=c.undef,u=c.notundef,l=n(167);r.setCurrSession=function(e){this.resetSessionUnread(e),this.protocol.setCurrSession(e)},r.resetAllSessionUnread=function(){for(var e in this.protocol.sessionSet)0<this.protocol.sessionSet[e].unread&&this.resetSessionUnread(e)},r.resetSessionUnread=function(e){var t,n;this.protocol.resetSessionUnread(e),this.options.syncSessionUnread&&((n=this.protocol.findSession(e))?n.lastMsg?n.scene&&n.to?(t=n.lastMsg.time,n&&n.ack&&n.ack>=t?this.logger.warn("api::resetSessionUnread: session ack not needs "+e):(n={scene:"p2p"===n.scene?0:1,to:n.to,timetag:t},this.sendCmd("markSessionAck",n))):this.logger.warn("api::resetSessionUnread: session.scene|to undefined "+e):this.logger.warn("api::resetSessionUnread: session.lastMsg undefined "+e):this.logger.warn("api::resetSessionUnread: session undefined "+e))},r.resetCurrSession=function(){this.protocol.setCurrSession("")},r.insertLocalSession=function(e){var t,n;function r(){e.session=n,e.done(t,e)}c.verifyOptions(e,"scene to","scene::insertLocalSession"),c.verifyParamValid("scene",e.scene,this.message.validScenes,"scene::insertLocalSession"),this.processCallback(e),this.protocol.insertLocalSession(e).then(function(e){n=e,r()},function(e){t=e,r()})},r.getLocalSessions=function(e){var t,n=this,r=n.db,s=[];function i(){e.sessions=s,e.done(t,e)}c.verifyOptions(e),o(e.limit)&&(e.limit=100),c.verifyParamType("limit",e.limit,"number","scene::getLocalSessions"),c.verifyParamMax("limit",e.limit,100,"scene::getLocalSessions"),u(e.reverse)?c.verifyParamType("reverse",e.reverse,"boolean","scene::getLocalSessions"):e.reverse=!1,n.processCallback(e),r.enable?r.getSessions(e).then(function(e){s=e,n.protocol.mergeSessions(s),i()},function(e){t=e,i()}):i()},r.getLocalSession=function(e){var t,n=this.db,r=null;function s(){e.done(t,r)}c.verifyOptions(e,"sessionId","scene::getLocalSession"),c.verifyParamType("sessionId",e.sessionId,"string","scene::getLocalSession"),n.enable?(this.processCallback(e),n.getSession(e.sessionId).then(function(e){e&&(r=e),s()},function(e){t=e,s()})):(this.protocol.sessionSet&&this.protocol.sessionSet[e.sessionId]&&(r=this.protocol.sessionSet[e.sessionId]),s())},r.getLocalSessionsByMsgType=function(n){var s=this.db,i=n.exclude,o=[],a=l.validTypes.slice(0);if(u(i)){if("string"==typeof i)i=[i];else if(!Array.isArray(i))return void c.onParamInvalidType("exclude",["string","string array"],"","exclude::getLocalSessionsByMsgType");i=i.filter(function(e){return-1<a.indexOf(e)}),a=a.filter(function(e){return-1===i.indexOf(e)})}this.processCallback(n),a&&0!==a.length&&s.enable?s.getSessions().then(function(r){i&&0!==i.length?(r.map(function(e,t){var n;e.lastMsg&&-1<i.indexOf(e.lastMsg.type)&&(n=t,t=e.id,e=s.getMsgs({sessionId:t,limit:1,types:a}).then(function(e){return e&&e[0]?r[n].lastMsg=e[0]:r[n].lastMsg=null,Promise.resolve()}),o.push(e))}),Promise.all(o).then(function(e){var t=r.filter(function(e){return e.lastMsg});n.done(null,{exclude:i,sessions:t})})):n.done(null,{exclude:i,sessions:r})}):n.done(null,{exclude:i,sessions:[]})},r.updateLocalSession=function(e){var t,n=this,r=n.db,s=(c.verifyOptions(e,"id","scene::updateLocalSession"),n.processCallback(e),c.filterObj(e,"id localCustom"));function i(){n.protocol.onUpdateSession(s),e.session=s,e.done(t,e)}r.enable?r.updateSession(s).then(function(e){s=e,i()},function(e){t=e,i()}):i()},r.deleteLocalSession=function(e){var t,n=this,r=n.db;function s(){e.done(t,e)}c.verifyOptions(e,"id","session::deleteLocalSession"),n.processCallback(e),r.enable?r.deleteSession(e.id).then(function(){n.protocol.deleteLocalSession(e.id),s()},function(e){t=e,s()}):s()},r.deleteSession=function(e){c.verifyOptions(e,"scene to","session::deleteSession"),this.processCallback(e),e.sessions=[{scene:e.scene,to:e.to}],this.deleteSessions(e)},r.deleteSessions=function(e){c.verifyOptions(e,"sessions","session::deleteSessions"),c.verifyParamType("sessions",e.sessions,"array","session::deleteSessions"),e.sessions.forEach(function(e,t){c.verifyOptions(e,"scene to",!0,"sessions["+t+"].","session::deleteSessions")}),this.processCallback(e),this.sendCmd("deleteSessions",{sessions:e.sessions.map(function(e){return e.scene+"|"+e.to})},e.callback)}},function(e,t,n){"use strict";var r=n(122),o=r&&r.__esModule?r:{default:r},r=n(29).fn,a=n(0),i=a.undef,s=n(189),c=n(146);r.addSuperTeamMembers=function(e){a.verifyOptions(e,"teamId accounts","superTeam::addSuperTeamMembers"),a.verifyParamType("accounts",e.accounts,"array","superTeam::addSuperTeamMembers");var t=a.deduplicate(e.accounts),t=(this.processCallback(e),{teamId:e.teamId,accounts:t});this.sendCmd("addSuperTeamMembers",t,e.callback)},r.removeSuperTeamMembers=function(e){a.verifyOptions(e,"teamId accounts","team::removeSuperTeamMembers"),a.verifyParamType("accounts",e.accounts,"array","team::removeSuperTeamMembers");var t=a.deduplicate(e.accounts),t=(this.processCallback(e),{teamId:e.teamId,accounts:t});this.sendCmd("removeSuperTeamMembers",t,e.callback)},r.leaveSuperTeam=function(e){a.verifyOptions(e,"teamId","superTeam::leaveSuperTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("leaveSuperTeam",t,e.callback)},r.getSuperTeam=function(t){var n,r=this,e=r.db;function s(){r.sendCmd("getSuperTeam",{teamId:t.teamId},t.callback)}a.verifyOptions(t,"teamId","team::getSuperTeam"),r.processCallback(t),t.cbaop=function(e,t){e||r.logger.log("api::getSuperTeam: cbaop "+n,t)},n=t.teamId,e.enable&&!t.sync?e.getSuperTeam(n).then(function(e){e?(r.logger.log("api::getSuperTeam: db.getSuperTeam "+n,e),t.done(null,e)):s()},s):s()},r.getSuperTeams=function(e){var t=this,n=t.db,r=0;function s(){t.sendCmd("getSuperTeams",{timetag:r,NOTSTORE:"timetag"},e.callback)}a.verifyOptions(e),t.processCallback(e),n.enable?n.getSuperTeamsTimetag().then(function(e){r=e,s()},s):s()},r.updateSuperTeam=function(e){a.verifyOptions(e,"teamId","superTeam::updateSuperTeam"),e.action="update",this.processCallback(e),e.team=new s(e),this.sendCmd("updateSuperTeam",{team:e.team,single:!0},e.callback)},r.updateInfoInSuperTeam=function(e){a.verifyOptions(e,"teamId","superTeam::updateInfoInSuperTeam"),this.processCallback(e),this.sendCmd("updateInfoInSuperTeam",{superTeamMember:new c(e),single:!0},e.callback)},r.getSuperTeamMembersByJoinTime=function(e){this.db;var t=e.joinTime,n=e.reverse,r=e.limit,s=e.teamId,n=!!n;i(t)&&(t=0),i(r)&&(r=100),a.verifyOptions(e,"teamId","superTeam::getSuperTeamMembersByJoinTime"),a.verifyParamType("joinTime",t,"number","api::superTeam::getSuperTeamMembersByJoinTime"),a.verifyParamType("limit",r,"number","api::superTeam::getSuperTeamMembersByJoinTime"),this.processCallback(e),this.sendCmd("getSuperTeamMembersByJoinTime",{teamId:s,limit:r,joinTime:t,reverse:n,timetag:0,NOTSTORE:"timetag"},e.callback)},r.getAllSuperTeamMembers=function(n){var r=this,s=this.db;function i(e){r.sendCmd("getSuperTeamMembers",{teamId:n.teamId,timetag:e=e||0,NOTSTORE:"timetag"},n.callback)}a.verifyOptions(n,"teamId","superTeam::getAllSuperTeamMembers"),r.processCallback(n),function(e){var t,n=this.db;return n.enable?(t=n.getSuperTeam(e),n=n.getSuperTeamMembersTimetag(e),Promise.all([t,n]).then(function(e){var e=(0,o.default)(e,2),t=e[0],e=e[1],t=t&&t.memberUpdateTime,n={timetag:e=e||0};return t&&t<=e&&(n.valid=!0),Promise.resolve(n)},function(){return Promise.resolve({timetag:0})})):Promise.resolve(!1)}.bind(this)(n.teamId).then(function(e){var t=e.valid,e=e.timetag;t?(r.logger.info("getAllSuperTeamMembers from local db"),s.getSuperTeamMembers(n.teamId).then(function(e){e={teamId:n.teamId,members:e};n.done(null,e)},function(){return i()})):i(e)})}},function(e,t,n){"use strict";var r=n(29).fn,o=n(0),s=o.undef,i=n(126),a=n(90);r.createTeam=function(e){o.verifyOptions(e,"type name","team::createTeam"),s(e.accounts)?e.accounts=[]:o.verifyParamType("accounts",e.accounts,"array","team::createTeam"),e.action="create",this.processPs(e),this.processCallback(e),e.team=new i(e);var t={team:e.team,accounts:e.accounts.slice(0),ps:e.ps};this.sendCmd("createTeam",t,e.callback)},r.updateTeam=function(e){o.verifyOptions(e,"teamId","team::updateTeam"),e.action="update",this.processCallback(e),e.team=new i(e),this.sendCmd("updateTeam",{team:e.team,single:!0},e.callback)},r.addTeamMembers=function(e){o.verifyOptions(e,"teamId accounts","team::addTeamMembers"),o.verifyParamType("accounts",e.accounts,"array","team::addTeamMembers"),this.processPs(e),o.notexist(e.custom)&&(e.custom=""),this.processCallback(e);var t={teamId:e.teamId,accounts:e.accounts.slice(0),ps:e.ps,attach:e.custom};this.sendCmd("addTeamMembers",t,e.callback)},r.removeTeamMembers=function(e){o.verifyOptions(e,"teamId accounts","team::removeTeamMembers"),o.verifyParamType("accounts",e.accounts,"array","team::removeTeamMembers"),this.processCallback(e);var t={teamId:e.teamId,accounts:e.accounts.slice(0)};this.sendCmd("removeTeamMembers",t,e.callback)},r.acceptTeamInvite=function(e){o.verifyOptions(e,"idServer teamId from","team::acceptTeamInvite"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("acceptTeamInvite",t,e.callback)},r.rejectTeamInvite=function(e){o.verifyOptions(e,"idServer teamId from","team::rejectTeamInvite"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectTeamInvite",t,e.callback)},r.applyTeam=function(e){o.verifyOptions(e,"teamId","team::applyTeam"),this.processPs(e),this.processCallback(e);var t={teamId:e.teamId,ps:e.ps};this.sendCmd("applyTeam",t,e.callback)},r.passTeamApply=function(e){o.verifyOptions(e,"idServer teamId from","team::passTeamApply"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("passTeamApply",t,e.callback)},r.rejectTeamApply=function(e){o.verifyOptions(e,"idServer teamId from","team::rejectTeamApply"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectTeamApply",t,e.callback)},r.addTeamManagers=function(e){o.verifyOptions(e,"teamId accounts","team::addTeamManagers"),o.verifyParamType("accounts",e.accounts,"array","team::addTeamManagers"),this.processCallback(e);var t={teamId:e.teamId,accounts:e.accounts.slice(0)};this.sendCmd("addTeamManagers",t,e.callback)},r.removeTeamManagers=function(e){o.verifyOptions(e,"teamId accounts","team::removeTeamManagers"),o.verifyParamType("accounts",e.accounts,"array","team::removeTeamManagers"),this.processCallback(e);var t={teamId:e.teamId,accounts:e.accounts.slice(0)};this.sendCmd("removeTeamManagers",t,e.callback)},r.updateInfoInTeam=function(e){o.verifyOptions(e,"teamId","team::updateInfoInTeam"),this.processCallback(e),this.sendCmd("updateInfoInTeam",{teamMember:new a(e),single:!0},e.callback)},r.updateNickInTeam=function(e){o.verifyOptions(e,"teamId account","team::updateNickInTeam"),this.processCallback(e),this.sendCmd("updateNickInTeam",{teamMember:new a(e),single:!0},e.callback)},r.updateMuteStateInTeam=function(e){o.verifyOptions(e,"teamId account mute","team::updateMuteStateInTeam"),this.processCallback(e),e.mute=e.mute?1:0,this.sendCmd("updateMuteStateInTeam",e)},r.getMutedTeamMembers=function(e){o.verifyOptions(e,"teamId","team::getMutedTeamMembers"),this.processCallback(e),this.sendCmd("getMutedTeamMembers",e)},r.leaveTeam=function(e){o.verifyOptions(e,"teamId","team::leaveTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("leaveTeam",t,e.callback)},r.transferTeam=function(e){o.verifyOptions(e,"teamId account leave","team::transferTeam"),o.verifyParamType("leave",e.leave,"boolean","team::transferTeam"),this.processCallback(e);var t={teamId:e.teamId,account:e.account,leave:e.leave};this.sendCmd("transferTeam",t,e.callback)},r.dismissTeam=function(e){o.verifyOptions(e,"teamId","team::dismissTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("dismissTeam",t,e.callback)},r.getTeam=function(t){var n,r=this,e=r.db;function s(){r.sendCmd("getTeam",{teamId:t.teamId},t.callback)}o.verifyOptions(t,"teamId","team::getTeam"),r.processCallback(t),t.cbaop=function(e,t){e||r.logger.log("api::getTeam: cbaop "+n,t)},n=t.teamId,e.enable&&!t.sync?e.getTeam(n).then(function(e){e&&e.validToCurrentUser?(r.logger.log("api::getTeam: db.getTeam "+n,e),t.done(null,e)):s()},s):s()},r.getTeams=function(e){var t=this,n=t.db,r=0;function s(){t.sendCmd("getTeams",{timetag:r,NOTSTORE:"timetag"},e.callback)}o.verifyOptions(e),t.processCallback(e),n.enable?n.getTeamsTimetag().then(function(e){r=e,s()},s):s()},r.getTeamMembers=function(e){o.verifyOptions(e,"teamId","team::getTeamMembers"),this.processCallback(e),this.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0,NOTSTORE:"timetag"},e.callback)},r.getTeamMemberByTeamIdAndAccount=function(i){o.verifyParamType("teamId",i.teamId,"numeric or numeric string","team::getTeamMemberByTeamIdAndAccount"),o.verifyOptions(i,"account","team::getTeamMemberByTeamIdAndAccount"),this.processCallback(i),this.sendCmd("getTeamMembers",{teamId:i.teamId,timetag:0,NOTSTORE:"timetag"},function(e,t,n){var r={};if(t&&t.members&&t.members.length)for(var s=0;s<t.members.length;s++)if(t.members[s].account===i.account){r[i.account]=t.members[s];break}i.callback(e,r,n)})},r.getTeamMemberInvitorAccid=function(r){o.verifyParamType("teamId",r.teamId,"numeric or numeric string","team::getTeamMemberInvitorAccid"),s(r.accounts)||(o.verifyParamType("accounts",r.accounts,"array","team::getTeamMemberInvitorAccid"),200<r.accounts.length&&o.onParamError("accounts 参数数组长度不能超过200","team::getTeamMemberInvitorAccid"));var e={teamId:r.teamId};r.accounts.length&&(e.accounts=r.accounts.slice(0)),this.processCallback(r),this.sendCmd("getTeamMemberInvitorAccid",e,function(e,t,n){r.callback(e,n&&n.accountsMap||{})})},r.notifyForNewTeamMsg=function(t){o.verifyOptions(t,"teamIds","team::notifyForNewTeamMsg"),this.protocol.notifyForNewTeamMsg(t.teamIds).then(function(e){t.done(e.error||null,e.map,e.miss)},function(e){t.done(e)})},r.getMyTeamMembers=function(e){o.verifyOptions(e,"teamIds","team::getMyTeamMembers");var t=this.processCallbackPromise(e);return this.sendCmd("getMyTeamMembers",e),t},r.getLocalTeams=function(e){var t,n=this.db,r=[];function s(){e.teams=r,e.done(t,e)}o.verifyOptions(e,"teamIds","team::getLocalTeams"),o.verifyParamType("teamIds",e.teamIds,"array","team::getLocalTeams"),this.processCallback(e),n.enable?n.getTeamsByTeamIds(e.teamIds).then(function(e){r=e.filter(function(e){return!!e}),s()},function(e){t=e,s()}):s()},r.getLocalTeamMembers=function(e){var t,n=this.db,r=[];function s(){e.members=r,e.done(t,e)}o.verifyOptions(e,"teamId accounts","team::getLocalTeamMembers"),o.verifyParamType("accounts",e.accounts,"array","team::getLocalTeamMembers"),this.processCallback(e),n.enable?n.getInvalidTeamMembers(e.teamId,e.accounts).then(function(e){r=e.filter(function(e){return!!e}),s()},function(e){t=e,s()}):s()},r.deleteLocalTeam=function(e){var t,n=this.db;function r(){e.done(t,e)}o.verifyOptions(e,"teamId","team::deleteLocalTeam"),this.processCallback(e),n.enable?n.deleteTeam(e.teamId).then(function(){r()},function(e){t=e,r()}):r()},r.muteTeamAll=function(e){switch(o.verifyOptions(e,"teamId type","team::muteTeamAll"),e.type){case"none":e.muteType=0;break;case"normal":e.muteType=1;break;case"all":e.muteType=2;break;default:e.muteType=1}this.processCallback(e),this.sendCmd("muteTeamAll",e)},r.sendTeamMsgReceipt=function(e){o.verifyOptions(e,"teamMsgReceipts","team::sendTeamMsgReceipt"),this.processCallback(e),this.sendCmd("sendTeamMsgReceipt",e)},r.getTeamMsgReads=function(e){o.verifyOptions(e,"teamMsgReceipts","team::getTeamMsgReads"),this.processCallback(e),this.sendCmd("getTeamMsgReads",e)},r.getTeamMsgReadAccounts=function(e){o.verifyOptions(e,"teamMsgReceipt","team::getTeamMsgReadAccounts"),this.processCallback(e),this.sendCmd("getTeamMsgReadAccounts",e)}},function(e,t,n){"use strict";n(29).fn.getRobots=function(e){(e=e||{}).type="getRobots",this.processCallback(e),this.sendCmd("sync",{sync:{robots:0}},e.callback)}},function(e,t,n){"use strict";var r=n(29).fn,i=n(0),s=i.notundef,o=n(299);r.friendRequest=function(e){i.verifyOptions(e,"type account","friend::friendRequest"),i.verifyParamValid("type",e.type,o.validTypes(),"friend::friendRequest"),this.processPs(e),this.processCallback(e);var t={account:e.account,type:o.getByteFromType(e.type),ps:e.ps};s(e.idServer)&&(t.idServer=e.idServer),this.sendCmd("friendRequest",t,e.callback)},r.addFriend=function(e){e.type="addFriend",this.friendRequest(e)},r.applyFriend=function(e){e.type="applyFriend",this.friendRequest(e)},r.passFriendApply=function(e){i.verifyOptions(e,"idServer","friend::passFriendApply"),e.type="passFriendApply",this.friendRequest(e)},r.rejectFriendApply=function(e){i.verifyOptions(e,"idServer","friend::rejectFriendApply"),e.type="rejectFriendApply",this.friendRequest(e)},r.deleteFriend=function(e){i.verifyOptions(e,"account","friend::deleteFriend");var t=!0===e.delAlias;this.processCallback(e),this.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:t?1:0}},e.callback)},r.updateFriend=function(e){this.processCallback(e);var t=new o(e);this.sendCmd("updateFriend",{friend:t,single:!0},e.callback)},r.getFriends=function(e){var t=this,n=t.db,r=0;function s(){t.sendCmd("getFriends",{timetag:r,NOTSTORE:"timetag"},e.callback)}i.verifyOptions(e),t.processCallback(e),n.enable?n.getFriendsTimetag().then(function(e){r=e,s()},s):s()}},function(e,t,n){"use strict";var r=n(29).fn,c=n(0),u=c.objs2accounts,s=n(140);r.updateMyInfo=function(e){c.verifyOptions(e),this.processCallback(e),e.user=new s(e),delete e.user.account,this.sendCmd("updateMyInfo",{user:e.user,single:!0},e.callback)},r.getMyInfo=function(e){return(e=e||{}).account=this.account,this.getUser(e)},r.getUser=function(t){var n,r=this,e=r.db;function s(){r.sendCmd("getUsers",{accounts:[n],single:!0},t.callback)}c.verifyOptions(t,"account","user::getUser"),r.processCallback(t),t.cbaop=function(e,t){if(!e)return t=t[0]||null,r.logger.log("api::getUser: cbaop "+n,t),t},n=t.account,!t.sync&&e.enable?e.getUser(n).then(function(e){e?(r.logger.log("api::getUser: db.getUser "+n,e),t.done(null,e)):s()},s):s()},r.getUsers=function(r){var s,i=this,e=i.db,o=[];function a(){i.sendCmd("getUsers",{accounts:s,single:!0},r.callback)}c.verifyOptions(r,"accounts","user::getUsers"),c.verifyParamType("accounts",r.accounts,"array","user::getUsers"),i.processCallback(r),r.cbaop=function(e,t){if(!e)return t=t.concat(o),i.logger.log("api::getUsers: cbaop "+s,t),t},s=c.deduplicate(r.accounts),c.verifyArrayMax("accounts",r.accounts,150,"user::getUsers"),!r.sync&&e.enable?e.getUsers(s).then(function(e){var t,n;e&&e.length===s.length?(i.logger.log("api::getUsers: db.getUsers",e),r.done(null,e)):(t=u(o=e),n=[],s.forEach(function(e){-1===t.indexOf(e)&&n.push(e)}),s=n,a())},a):a()}},function(e,t,n){"use strict";var r=n(29).fn,i=n(0);r.markInBlacklist=function(e){i.verifyOptions(e,"account isAdd","relation::markInBlacklist"),i.verifyParamType("isAdd",e.isAdd,"boolean","relation::markInBlacklist"),this.processCallback(e),this.sendCmd("markInBlacklist",{account:e.account,isAdd:e.isAdd},e.callback)},r.addToBlacklist=function(e){return e.isAdd=!0,this.markInBlacklist(e)},r.removeFromBlacklist=function(e){return e.isAdd=!1,this.markInBlacklist(e)},r.markInMutelist=function(e){i.verifyOptions(e,"account","relation::markInMutelist"),i.verifyParamType("isAdd",e.isAdd,"boolean","relation::markInMutelist"),this.processCallback(e),this.sendCmd("markInMutelist",{account:e.account,isAdd:e.isAdd},e.callback)},r.addToMutelist=function(e){return e.isAdd=!0,this.markInMutelist(e)},r.removeFromMutelist=function(e){return e.isAdd=!1,this.markInMutelist(e)},r.getRelations=function(e){var t=this,n=t.db,r=0;function s(){t.sendCmd("getRelations",{timetag:r,NOTSTORE:"timetag"},e.callback)}e=i.verifyOptions(e),t.processCallback(e),n.enable?n.getRelationsTimetag().then(function(e){r=e,s()},s):s()}},function(e,t,n){"use strict";var r=n(29).fn,s=n(0);r.kick=function(e){s.verifyOptions(e,"deviceIds","link::kick"),this.processCallback(e),this.sendCmd("kick",{deviceIds:e.deviceIds.slice(0)},e.callback)}},function(e,t,n){"use strict";var r=n(29).fn,s=n(0),i=s.isArray,o=n(90);r.mergeObjArray=function(e,t,n){return e=e||[],t&&(t=i(t)?t:[t]).length?s.mergeObjArray(e,t,n=n||{}):e},r.cutObjArray=function(e,t,n){return e&&t&&(t=i(t)?t:[t]).length?s.cutObjArray(e,t,n=n||{}):e},r.mergeLoginPorts=function(e,t){return this.mergeObjArray(e,t,{keyPath:"deviceId"})},r.cutLoginPorts=function(e,t){return this.cutObjArray(e,t,{keyPath:"deviceId",sortPath:"type"})},r.mergeRelations=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},r.cutRelations=function(e,t){return this.cutObjArray(e,t,{keyPath:"account"})},r.findRelation=function(e,t){return s.findObjInArray(e,{keyPath:"account",value:t})},r.mergeFriends=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},r.cutFriends=function(e,t){return this.cutObjArray(e,t,{keyPath:"account"})},r.cutFriendsByAccounts=function(e,t){t=(t=i(t)?t:[t]).map(function(e){return{account:e}});return this.cutFriends(e,t)},r.findFriend=function(e,t){return s.findObjInArray(e,{keyPath:"account",value:t})},r.mergeUsers=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},r.findUser=function(e,t){return s.findObjInArray(e,{keyPath:"account",value:t})},r.mergeTeams=function(e,t){return this.mergeObjArray(e,t,{keyPath:"teamId"})},r.cutTeams=function(e,t){return this.cutObjArray(e,t,{keyPath:"teamId"})},r.findTeam=function(e,t){return s.findObjInArray(e,{keyPath:"teamId",value:t})},r.assembleTeamOwner=o.assembleOwner,r.assembleTeamMembers=o.assembleMembers,r.genTeamMemberId=o.genId,r.mergeTeamMembers=function(e,t){return this.mergeObjArray(e,t)},r.cutTeamMembers=function(e,t){return this.cutObjArray(e,t)},r.cutTeamMembersByAccounts=function(e,t,n){i(n)||(n=[n]);t=o.assembleMembers({teamId:t},n);return this.cutTeamMembers(e,t)},r.findTeamMember=function(e,t){return s.findObjInArray(e,{keyPath:"id",value:t})},r.mergeSessions=function(e,t){return this.mergeObjArray(e,t,{sortPath:"updateTime",desc:!0})},r.cutSessions=function(e,t){return this.cutObjArray(e,t)},r.cutSessionsByIds=function(e,t){t=(t=i(t)?t:[t]).map(function(e){return{id:e}});return this.cutSessions(e,t)},r.findSession=function(e,t){return s.findObjInArray(e,{keyPath:"id",value:t})},r.mergeMsgs=function(e,t){return this.mergeObjArray(e,t,{keyPath:"idClient",sortPath:"time"})},r.cutMsgs=function(e,t){return this.cutObjArray(e,t,{keyPath:"idClient"})},r.cutMsgsByIdClients=function(e,t){t=(t=i(t)?t:[t]).map(function(e){return{idClient:e}});return this.cutMsgs(e,t)},r.findMsg=function(e,t){return s.findObjInArray(e,{keyPath:"idClient",value:t})},r.mergeSysMsgs=function(e,t){return this.mergeObjArray(e,t,{keyPath:"idServer",desc:!0})},r.cutSysMsgs=function(e,t){return this.cutObjArray(e,t,{keyPath:"idServer"})},r.cutSysMsgsByIdServers=function(e,t){t=(t=i(t)?t:[t]).map(function(e){return{idServer:e}});return this.cutSysMsgs(e,t)},r.findSysMsg=function(e,t){return s.findObjInArray(e,{keyPath:"idServer",value:t})}},function(e,t,n){"use strict";var r=n(73),s=n(0),i={welcome:"00",text:"01",link:"03"},o={"01":"text","02":"image","03":"answer",11:"template"};function a(e){s.verifyOptions(e,"content","msg::RobotMessage"),s.undef(e.robotAccid)&&(e.robotAccid=e.to);var t=e.content;switch(t.type){case"welcome":s.undef(e.body)&&(this.body="欢迎消息");break;case"text":s.verifyOptions(t,"content","msg::RobotMessage"),s.undef(e.body)&&(this.body=t.content);break;case"link":s.verifyOptions(t,"target","msg::RobotMessage")}t.type&&(t.type=i[t.type]),t={param:t,robotAccid:e.robotAccid},this.attach=JSON.stringify(t),e.type="robot",r.call(this,e)}a.prototype=Object.create(r.prototype),a.reverse=function(e){var t,n=r.reverse(e);return"robot"===n.type&&((e=JSON.parse(e.attach)).param&&(e.param.type=o[e.param.type]||"unknown"),e.robotMsg&&(t=(e=s.merge(e,e.robotMsg)).message,"bot"===e.flag?e.message=t.map(function(e){return e.type=o[e.type]||"unknown",e}):e.flag,delete e.robotMsg),n.content=e),n},e.exports=a},function(e,t,n){"use strict";var r=n(73),s=n(0);function i(e){s.verifyOptions(e,"tip","msg::TipMessage"),e.type="tip",r.call(this,e),this.body=e.tip}i.prototype=Object.create(r.prototype),i.reverse=function(e){var t=r.reverse(e);return t.text="",t.tip=e.body,e.attach&&(t.attach=e.attach),t},e.exports=i},function(e,t,n){"use strict";var r=n(73),s=n(0);function i(e){s.verifyOptions(e,"content","msg::CustomMessage"),e.type="custom",r.call(this,e),this.attach=e.content}i.prototype=Object.create(r.prototype),i.reverse=function(e){var t=r.reverse(e);return t.content=e.attach,t},e.exports=i},function(e,t,n){"use strict";var r=n(0).notundef,s=n(73),i=n(84).IM,o=n(126),a=n(140),c={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMute",101:"netcallMiss",102:"netcallBill",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute"};function u(){}u.prototype=Object.create(s.prototype),u.reverse=function(e){var t=s.reverse(e);return e.attach=e.attach?""+e.attach:"",e.attach?(e=JSON.parse(e.attach),t.attach={type:c[e.id]||e.id},r(e.data)&&(e=e.data,r(e.tinfo)&&(t.attach.team=o.reverse(i.syncUnserialize(e.tinfo,"team"),!0)),r(e.ids)&&(t.attach.accounts=e.ids),r(e.id)&&(t.attach.account=e.id),r(e.uinfos)&&(t.attach.users=e.uinfos.map(function(e){return a.reverse(i.syncUnserialize(e,"user"))})),r(e.mute)&&(t.attach.mute=1==+e.mute),r(e.attach)&&(t.attach.custom=e.attach),r(e.channel)&&(t.attach.channelId=e.channel),r(e.calltype)&&(t.attach.netcallType=e.calltype),r(e.duration)&&(t.attach.duration=e.duration),r(e.time)&&(t.attach.time=e.time),r(e.from)&&(t.attach.from=e.from),r(e.ext)&&(t.attach.ext=e.ext),t.attach.accounts)&&t.attach.accounts.length<=2&&t.from===t.to&&t.attach.accounts.some(function(e){if(e!==t.to)return t.to=e,!0})):t.attach={},t},e.exports=u},function(e,t,n){"use strict";var r=n(73),s=n(0);function i(e){e.type="geo",s.verifyOptions(e,"geo","msg::GeoMessage"),s.verifyOptions(e.geo,"lng lat title",!0,"geo.","msg::GeoMessage"),s.verifyParamType("geo.lng",e.geo.lng,"number","msg::GeoMessage"),s.verifyParamType("geo.lat",e.geo.lat,"number","msg::GeoMessage"),s.verifyParamType("geo.title",e.geo.title,"string","msg::GeoMessage"),r.call(this,e),this.attach=JSON.stringify(e.geo)}i.prototype=Object.create(r.prototype),i.reverse=function(e){var t=r.reverse(e);return e.attach=e.attach?""+e.attach:"",t.geo=e.attach?JSON.parse(e.attach):{},t},e.exports=i},function(e,t,n){"use strict";var r=n(133),s=n(0);function i(){}i.prototype=Object.create(r.prototype),i.verifyFile=function(e,t){s.verifyOptions(e,"dur w h",!0,"file.",t)},e.exports=i},function(e,t,n){"use strict";var r=n(133),s=n(0);function i(){}i.prototype=Object.create(r.prototype),i.verifyFile=function(e,t){s.verifyOptions(e,"dur",!0,"file.",t)},e.exports=i},function(e,t,n){"use strict";var r=n(0),n=n(133);function s(){}s.prototype=Object.create(n.prototype),s.verifyFile=function(e,t){r.verifyOptions(e,"w h",!0,"file.",t)},e.exports=s},function(e,t,n){"use strict";var r=n(73),s=n(0);function i(e){s.verifyOptions(e,"text","msg::TextMessage"),e.type="text",r.call(this,e)}i.prototype=Object.create(r.prototype),i.reverse=function(e){return r.reverse(e)},e.exports=i},function(e,t,n){"use strict";function r(e){this.account=e.account}var s=n(0),i=r.prototype,o=i.Message=n(73),a=i.TextMessage=n(431),c=i.FileMessage=n(133),u=i.GeoMessage=n(427),l=i.NotificationMessage=n(426),m=i.CustomMessage=n(425),d=i.TipMessage=n(424),p=i.RobotMessage=n(423);i.validScenes=o.validScenes,i.validTypes=o.validTypes,i.reverse=function(e){var t;switch(o.getType(e)){case"text":t=a.reverse(e);break;case"image":case"audio":case"video":case"file":t=c.reverse(e);break;case"geo":t=u.reverse(e);break;case"notification":t=l.reverse(e);break;case"custom":t=m.reverse(e);break;case"tip":t=d.reverse(e);break;case"robot":t=p.reverse(e);break;default:t=o.reverse(e)}return o.setExtra(t,this.account),t},i.reverseMsgs=function(e,t){var n,r=this;return e.map(function(e){return e=r.reverse(e),e=t&&((n=t.modifyObj)&&(e=s.merge(e,n)),n=t.mapper,s.isFunction(n))?n(e):e})},e.exports=r},function(e,t,n){"use strict";var r=n(56),r=r&&r.__esModule?r:{default:r},s=n(25).fn,i=n(0),o=r.default.clientTypeMap;function a(e){e=i.copy(e=e||{});return e.clientType&&(e.clientType=o[e.clientType]||""),e.serverCustom&&(e.custom=JSON.parse(e.serverCustom),"string"==typeof e.custom[0]&&(e.custom=e.custom[0]),delete e.serverCustom),e}s.processEventService=function(e){var t,n=e.content,r=e.error,s=this.options||{};switch(r&&(r.callFunc="events::processEventService",this.onCustomError("事件服务解包失败","EVENT_SERVICE_ERROR",r)),e.cmd){case"pushEvent":i.isFunction(s.onpushevents)&&(t={msgEvents:[a(n.msgEvent)]},s.onpushevents(t));break;case"pushEvents":i.isFunction(s.onpushevents)&&(t={msgEvents:(t=n.msgEvents).map(a)},s.onpushevents(t))}}},function(e,t,n){"use strict";n(25).fn.processFilter=function(e){switch(e.cmd){case"sendFilterMsg":this.onSendMsg(e,!0);break;case"filterMsg":this.onMsg(e,!0);break;case"filterSysMsg":this.onSysMsg(e,!0);break;case"sendFilterCustomSysMsg":this.onSendSysMsg(e,!0)}}},function(e,t,n){"use strict";n=n(25).fn;n.processChatroom=function(e){"getChatroomAddress"===e.cmd&&this.onChatroomAddress(e)},n.onChatroomAddress=function(e){e.error||(e.obj.address=e.content.address)}},function(e,t,n){"use strict";n=n(25).fn;n.syncSessionAck=function(e){var i=this,o=i.db,a=Promise.resolve(),t=([[e.content.p2p,"p2p"],[e.content.team.m_map,"team"]].forEach(function(e){var r=e[0],s=e[1];Object.keys(r).forEach(function(e){var t=s+"-"+e,n={id:t,ack:r[e]};o.enable&&(a=a.then(function(){return o.putSession(n)}).then(function(){i.markUnreadBySessionAck({sessionId:t,ack:r[e]})})),i.mergeSession(n)})}),i.logger.warn("session::syncSessionAck: parse offline session ack",i.sessionSet),e.content.timetag);(a=o.enable?a.then(function(){return i.db.updateSessionAck(t)}).catch(function(e){return i.logger.error("sessionAck::syncSessionAck: ",e),Promise.reject(e)}):a).cmd="sessionAck",i.syncPromiseArray.push(a)},n.onMarkSessionAck=function(e){e.error||this.storeSessionAck(e.obj)},n.syncMarkSessionAck=function(e){this.storeSessionAck(e.content)},n.storeSessionAck=function(e){var t,n;this.options.syncSessionUnread&&(t=this.db,n=(0===e.scene?"p2p":"team")+"-"+e.to,(e=e.timetag)<=((this.findSession(n)||{}).ack||0)?this.logger.warn("session::storeSessionAck: ack <= ackInMemory",e):(this.mergeSession(e={id:n,ack:e}),t.enable&&t.updateSession(e),this.logger.info("session::storeSessionAck:",e),this.markUnreadBySessionAck({sessionId:n,ack:e.ack})))},n.markUnreadBySessionAck=function(e){var t=e.sessionId,n=e.ack,r=this,s=r.db;if(s.enable)r.pushMsgTask(function(){return s.getMsgCountAfterAck({shouldCountNotifyUnread:r.options.shouldCountNotifyUnread,sessionId:t,ack:n}).then(function(e){e={id:t,unread:e};return r.logger.log("session::markUnreadBySessionAck: db.getMsgCountAfterAck done"),r.syncing&&r.cacheSyncedSession(e),r.onUpdateSession(e),s.updateSession(e)})});else{e=r.findSession(t);if(e){var i=e.unreadMsgs;if(i&&i.length){for(var o=0,a=[],c=i.length-1;0<=c;c--){var u=i[c];if(!(u.time>n))break;o++,a.push(u)}e.unreadMsgs=a,e.unread=o,r.logger.info("session::markUnreadBySessionAck: unread "+o),r.onUpdateSession(e)}}}}},function(e,t,n){"use strict";var r=n(122),l=r&&r.__esModule?r:{default:r},r=n(25).fn,g=n(0),h=n(123),y=n(26);r.mergeSession=function(e){e=g.copyWithNull(e);var t=this.sessionSet,n=e.id,r=t[n];if(r&&r.lastMsg&&e&&e.lastMsg&&e.lastMsg.isLocal){var s=r.lastMsg.time||0;if((e.lastMsg.time||0)<s)return r}return t[n]=g.merge(r,e),e=t[n],g.undef(e.unread)&&(e.unread=0),e},r.mergeSessions=function(e){var t=this;(e=e||[]).forEach(function(e){t.mergeSession(e)})},r.deleteLocalSession=function(e){var t=this;(e=g.isArray(e)?e:[e]).forEach(function(e){delete t.sessionSet[e]})},r.onDeleteSessions=function(e){e.obj=e.obj.sessions.map(function(e){return h.parse(e)})},r.onUpdateSession=function(t){var n=this;return new Promise(function(e){t?(t=n.mergeSession(t),t=g.simpleClone(t),h.trim(t),h.isComplete(t)&&(n.logger.info("session::onUpdateSession:",t.id,g.simpleClone(t)),n.options.onupdatesession(t),e(t))):e(t)})},r.setCurrSession=function(e){this.currSessionId=e=""+e,this.logger.info("session::setCurrSession:",e)},r.findSession=function(e){return this.sessionSet[e]},r.resetSessionUnread=function(e){var t=this.db;this.findSession(e=""+e)?(t.enable&&t.resetSessionUnread(e),!this.options.autoMarkRead&&this.sessionUnreadMsgs&&this.sessionUnreadMsgs[e]&&(t=this.sessionUnreadMsgs[e],this.markMsgRead(t,!0),this.sessionUnreadMsgs[e]=[]),this.onUpdateSession({id:e,unread:0})):this.logger.warn("session::resetSessionUnread: no session "+e)},r.insertLocalSession=function(m){var d=this,p=d.db,f=d.sessionSet;return new Promise(function(t,n){var r,s=m.scene,i=m.to,o=s+"-"+i,a=d.findSession(o);if(a)n(y.sessionExist({callFunc:"session::insertLocalSession",session:a}));else{if(g.isNumber(m.updateTime))r=m.updateTime;else{var e,c,u=[];for(c in f)f.hasOwnProperty(c)&&(e=f[c],g.isNumber(e.updateTime))&&u.push(e.updateTime);r=Math.max.apply(Math,u)+1,r=Math.max(r,+new Date)}var l=Promise.resolve();(l=p.enable?p.getMsgs({sessionId:o,limit:1}):l).then(function(e){g.isArray(e)&&1===e.length?(e=e[0],(a=h.genSessionByMsg(e)).updateTime=r):a={id:o,scene:s,to:i,updateTime:r,lastMsg:null},p.enable?p.putSession(a).then(t,n):t(a),d.onUpdateSession(a)})}})},r.updateLocalSession=function(i,o){var a=this;return new Promise(function(e,t){var n,r,s=a.db;a.findSession(i.id)?(n=Promise.resolve(),r=g.filterObj(i,"id lastMsg localCustom unread"),(n=s.enable?s.updateSession(r):n).then(function(e){return a.onUpdateSession(e,o)}).then(e,function(e){t({callFunc:"session::updateLocalSession",event:e})})):t(y.sessionNotExist({sessionId:i.id,callFunc:"session::updateLocalSession"}))})},r.checkAndUpdateLocalSessionByMsg=function(o){var a,c=this.db,u=this,t=this.options.syncSessionUnread&&o!==this.currSessionId,e=c.getMsgs({sessionId:o,limit:1}),n=c.getSession(o).then(function(e){if(e)return a=Object.assign({},e),e.ack=e.ack||0,t?c.getMsgs({sessionId:o,start:e.ack}):Promise.resolve();u.logger.error("can't find session that sessionId = "+o)});return Promise.all([e,n]).then(function(e){var t,n,e=(0,l.default)(e,2),r=e[0],e=e[1],s={id:o},i=a.lastMsg?a.lastMsg.idClient:null;return r&&r[0]?t=(r=r[0]).idClient:r=t=null,i!==t&&(s.lastMsg=r),void 0!==e&&(n=0,(e=e||[]).forEach(function(e){e.isUnreadable&&"in"===e.flow&&("notification"!==e.type||u.options.shouldCountNotifyUnread(msg))&&n++}),n!==a.unread)&&(s.unread=n),1<Object.keys(s).length?(u.logger.log("session::checkAndUpdateLocalSessionByMsg::needUpdate newSession:",s),c.updateSession(s).then(function(e){return u.onUpdateSession(s)})):Promise.resolve(200)})}},function(e,t,n){"use strict";var r=n(25).fn,a=n(0),c=n(124);r.splitSysMsgs=function(e,t){for(var n,r=e.length-1;0<=r;r--)n=e[r],c.isCustom(n)&&(e.splice(r,1),t.push(n))},r.onOfflineSysMsgs=function(e,t){var n,r=this,s=(s=e.content.sysMsgs.map(function(e){return e=c.reverse(e),t&&(e.filter=!0),e})).reverse(),e=(r.markSysMsgRead(s),[]),i=(r.splitSysMsgs(s,e),t?"offlineFilterSysMsgs":"offlineSysMsgs"),o=t?"offlineFilterCustomSysMsgs":"offlineCustomSysMsgs";s.length&&((n=r.putSysMsg(s,"offlineSysMsgs").then(function(e){(s=e).length&&(r.logger.info("sysmsg::onOfflineSysMsgs: ",i,s.length,s),r.syncResult[i]=r.syncResult[i]||[],r.syncResult[i]=r.syncResult[i].concat(s))}).catch(function(e){return r.logger.error("sysMsg::onOfflineSysMsgs: ",e),Promise.reject(e)})).cmd="sysMsgs",r.syncPromiseArray.push(n)),e.length&&(r.logger.info("sysmsg::onOfflineSysMsgs: ",o,e),r.syncResult[o]=r.syncResult[o]||[],r.syncResult[o]=r.syncResult[o].concat(e))},r.onSendSysMsg=function(e,t){var n=e.obj;this.completeSysMsg(n),e.error?n.status="fail":n.status="success",n=c.reverse(n),t&&(e.obj.filter=!0),e.obj=n},r.completeSysMsg=function(e){return e.from=this.account,e},r.onSysMsg=function(e,t){e=c.reverse(e.content.sysMsg);this.markSysMsgRead(e),t&&(e.filter=!0),c.isCustom(e)?(this.logger.info("sysmsg::onSysMsg: on customSysMsg",e),this.options.oncustomsysmsg(e)):this.syncing?this.unhandledSysMsgs.push(e):this.handleSysMsg(e)},r.handleSysMsg=function(n){var r=this,s=n.type,i=n.from;r.sysMsgPromise=r.sysMsgPromise.then(function(){return r.putSysMsg(n,"onSysMsg")}).then(function(e){n=e[0]}).then(function(){if(n){var e,t=Promise.resolve();switch(s){case"addFriend":t=r.onFriendRequest(e={type:"addFriend",account:i});break;case"passFriendApply":t=r.onFriendRequest(e={type:"passFriendApply",account:i});break;case"deleteFriend":t=r.onDeleteFriend({account:i})}return e&&e.friend&&(n.friend=e.friend),t}}).then(function(){n&&(r.logger.info("sysmsg::handleSysMsg: ",s,n),setTimeout(function(){r.options.onsysmsg(n)},0))})},r.putSysMsg=function(n,t){var r,e,s,i,o;return(n=a.isArray(n)?n:[n])[0].filter?Promise.resolve(n):(e=(r=this).db,s=e.enable,i=Promise.resolve(),o=[],(i=(i=i.then(function(){return s?e.putSysMsg(n):n}).then(function(e){var t=[];n.forEach(function(e){r.checkSysMsgUnique(e)&&t.push(e)}),n=t,o=s?e:n})).then(function(){return r.getSysMsgUnread().then(function(e){return o.length||((o=n).backward=!0),r.updateSysMsgUnread(o,e,1).then(function(e){"offlineSysMsgs"===t&&(r.syncResult.sysMsgUnread=e),"onSysMsg"===t&&r.onUpdateSysMsgUnread(e)})})})).then(function(){return n}))},r.checkSysMsgUnique=a.genCheckUniqueFunc("idServer"),r.getSysMsgUnread=function(){var e=this,n=e.db;return new Promise(function(t){n.enable?n.getSysMsgUnread().then(function(e){t(e)},function(){t(e.sysMsgUnread)}):t(e.sysMsgUnread)})},r.updateSysMsgUnread=function(e,t,n){if(!(e=a.isArray(e)?e:[e]).length)return Promise.resolve(t);t=t||{};var r,s=this.db;return e.forEach(function(e){(0<n&&!e.read||n<0&&e.read)&&(r=e.type,t[r]=(t[r]||0)+n)}),t=c.completeUnread(t),this.sysMsgUnread=t,s.enable&&!e.backward?s.updateSysMsgUnread(t):Promise.resolve(t)},r.reduceSysMsgUnread=function(t){var n=this;return n.getSysMsgUnread().then(function(e){return n.updateSysMsgUnread(t,e,-1)}).then(function(e){n.onUpdateSysMsgUnread(e)})},r.onUpdateSysMsgUnread=function(e){var t=this;setTimeout(function(){t.logger.info("sysmsg::onUpdateSysMsgUnread:",e),t.options.onupdatesysmsgunread(e)},0)},r.updateSysMsg=function(e){var t=this,n=t.db;(n.enable?n.updateSysMsg(e):Promise.resolve(e)).then(function(e){t.onUpdateSysMsg(e)})},r.onUpdateSysMsg=function(e){var t=this;setTimeout(function(){(e=a.isArray(e)?e:[e]).forEach(function(e){t.logger.info("sysmsg::onUpdateSysMsg:",e),t.options.onupdatesysmsg(e)})},0)},r.processUnsettledSysMsgs=function(){var t=this;t.unhandledSysMsgs.forEach(function(e){t.handleSysMsg(e)}),t.resetUnsettledSysMsgs()}},function(e,t,n){"use strict";var r=n(25).fn,s=n(124),i=n(123),o=n(0);r.onDeleteMsg=function(e){var n=this.db;delete e.obj.sysMsg,e.error||(e.promise=this.deleteLocalMsg(e.obj.msg).then(function(){var t=e.obj.msg;n.enable&&n.getTimetag("deleteMsg").then(function(e){t.time>=(e=e||0)&&n.updateDeleteMsgTimetag((new Date).getTime())})}))},r.onMsgDeleted=function(e){var t,n,r;e.error||(n=(t=this).db,r=s.reverse(e.content.sysMsg),r=t.processDeleteMsgSysMsg(r),t.markSysMsgRead(r),t.deleteLocalMsg(r.msg).then(function(){n.enable&&n.updateDeleteMsgTimetag(r.time+1),t.handleSysMsg(r)}))},r.processDeleteMsgSysMsg=function(t){return t.msg={},["scene","from","to"].forEach(function(e){t.msg[e]=t[e]}),t.msg.idClient=t.deletedIdClient,t.msg.idServer=t.deletedIdServer,t.msg.time=t.deletedMsgTime,t.msg.fromNick=t.deletedMsgFromNick,t.opeAccount=t.opeAccount||t.from,t.msg.opeAccount=t.opeAccount,this.message.Message.setExtra(t.msg,this.account),t},r.onDeleteMsgOfflineRoaming=function(e){var t,n,r;e.error||(t=this,n=1==+e.content.type?"offline":"roaming",r=s.reverseSysMsgs(e.content.sysMsgs,{mapper:function(e){return t.processDeleteMsgSysMsg(e)}}),t.logger.info("msg::onDeleteMsgOfflineRoaming: on delete "+n,r),"offline"==n&&t.markSysMsgRead(r),e=e.content.timetag,t.timetags.deleteMsg=e,t.syncResult.deleteMsgTimetag=e,(e=t.putSysMsg(r,"offlineSysMsgs").catch(function(e){return t.logger.error("msgDelete::onDeleteMsgOfflineRoaming: ",e),Promise.reject(e)})).cmd="deleteMsgSysMsgs "+n,t.syncPromiseArray.push(e),t.syncResult.deleteMsgSysMsgs=t.syncResult.deleteMsgSysMsgs||[],t.syncResult.deleteMsgSysMsgs.push({type:n,sysMsgs:r}))},r.deleteMsgOfflineRoaming=function(e,n){var r,s,t;return e?((r=this).logger.info("msg::deleteMsgOfflineRoaming: ",e,n),s=r.db,t=[],e.forEach(function(e){e.sysMsgs.forEach(function(e){e=r.deleteLocalMsg(e.msg,{cbUpdateSession:function(e){e=r.mergeSession(e),e=o.simpleClone(e),i.trim(e);var t=o.findObjIndexInArray(n,{value:e.id});if(-1!==t&&(n[t]=o.merge({},n[t],e)),s.enable)return s.updateSession(e)}});t.push(e)})}),Promise.all(t).then(function(){if(s.enable)return s.updateDeleteMsgTimetag(r.syncResult.deleteMsgTimetag)})):Promise.resolve()},r.deleteLocalMsg=function(t,e){var r,s,i,o,n,a=this,c=a.db,u=(e=e||{}).cbUpdateSession||a.updateLocalSession.bind(a);return c.enable&&t?(r=!1,i=s=null,o=t.sessionId,c.getMsgs({sessionId:o,limit:1}).then(function(e){e&&e[0]&&e[0].idClient===t.idClient&&(r=!0)}).then(function(){return c.getMsgByIdClient(t.idClient)}).then(function(e){return i=e,c.deleteMsg(t.idClient)}).then(function(){if(r)return c.getMsgs({sessionId:o,limit:1})}).then(function(e){r&&e&&e[0]&&(s=e[0])}).then(function(){if(a.options.rollbackDelMsgUnread)return c.getSessions({sessionId:o})}).then(function(e){var t={id:o},n=(r&&(t.lastMsg=s),e&&e.msgReceiptTime||0);return e&&i&&n<i.time&&a.options.account===i.to&&e.unread&&(a.logger.log("msgDelete::deleteLocalMsg:db.getSessions: ",e),t.unread=e.unread-1),u(t)})):(a.options.rollbackDelMsgUnread&&t&&t.sessionId&&(n=(e=a.findSession(t.sessionId)).msgReceiptTime||0,e)&&n<t.time&&a.options.account===t.to&&e.unread&&(a.logger.log("msgDelete::deleteLocalMsg:getSessions: ",e),e.unread=e.unread-1,a.onUpdateSession(e)),Promise.resolve())}},function(e,t,n){"use strict";var r=n(25).fn,s=n(0);r.onOfflineMsgReceipts=function(e){var t,i=this,o=i.db,n=e.content.msgReceipts,a=i.syncResult.msgReceipts=[],c=[],u="msgReceipts",l=i.syncResult.sessions||{};n.forEach(function(n){n.time=+n.time;var r=n.sessionId="p2p-"+n.from,s=(u+="-"+r,t=Promise.resolve(),l[r]);o.enable?t=o.getSession(r).then(function(e){var t;if((e=e||s)&&i.shouldUpdateSessionFromMsgReceipt(e,n))return e=i.genSessionFromMsgReceipt(e,n),(t=i.syncResult.sessions)&&t[r]&&(t=t[r]).lastMsg&&e.lastMsg&&t.lastMsg.time>e.lastMsg.time&&(e.lastMsg=t.lastMsg),o.putSession(e).then(function(e){e&&i.cacheSyncedSession(e)})}).catch(function(e){return i.logger.error("msgReceipt::onOfflineMsgReceipt: ",e),Promise.reject(e)}):s&&a.push(n),c.push(t)}),(t=Promise.all(c).then(function(){if(o.enable)return o.updateMsgReceiptsTimetag(e.content.timetag)})).cmd=u,i.syncPromiseArray.push(t)},r.mergeSessionAndMsgReceipts=function(n,e){var r=this,s={};return e=e||[],(n=n||[]).forEach(function(e){s[e.id]=e}),e.forEach(function(e){var t=s[e.sessionId];r.shouldUpdateSessionFromMsgReceipt(t,e)&&(t=r.genSessionFromMsgReceipt(t,e),n=r.api.mergeSessions(n,t))}),n},r.shouldUpdateSessionFromMsgReceipt=function(e,t){return!e||!e.msgReceiptServerTime||t.time>e.msgReceiptServerTime},r.genSessionFromMsgReceipt=function(e,t){var n=t.time,r={id:t.sessionId,msgReceiptTime:n,msgReceiptServerTime:n};return e&&e.id===t.sessionId&&(r=s.merge({},e,r)),e&&e.updateTime||(r.updateTime=n),r},r.onMsgReceipt=function(e){var n=this,t=n.db,r=e.content.msgReceipt,s=(r.time=+r.time,r.idClient),e=Promise.resolve();(e=t.enable&&s?t.getMsgByIdClient(s):e).then(function(e){var t;if(e){if(!e.idServer)return void(n.msgReceiptTasks[s]=r);t=e.time}else t=r.time;r.msgReceiptTime=t,n.updateSessionMsgReceiptTime(r)})},r.resolveMsgReceiptTask=function(e){var t=this.msgReceiptTasks[e.idClient];t&&(t.msgReceiptTime=e.time,this.updateSessionMsgReceiptTime(t))},r.updateSessionMsgReceiptTime=function(e){var t=this.db,e={id:"p2p-"+e.from,msgReceiptTime:e.msgReceiptTime,msgReceiptServerTime:e.time};t.enable&&t.putSession(e),this.onUpdateSession(e)},r.onSendMsgReceipt=function(e){var t,n;e.error||(n=+(t=e.obj.msgReceipt).time,e=+e.content.msgReceipt.time,this.sessionSet["p2p-"+t.to].msgReceiptSendTime=Math.min(n,e))},r.shouldSendMsgReceipt=function(e){if(e&&"p2p"===e.scene&&"success"===e.status){var t=this.sessionSet[e.sessionId];if(t)return!(t=t.msgReceiptSendTime)||t<e.time}return!1},r.isMsgRemoteRead=function(e){if(e&&"p2p"===e.scene&&"out"===e.flow&&"success"===e.status){var t=this.sessionSet[e.sessionId];if(t&&t.msgReceiptTime)return e.time<=t.msgReceiptTime}return!1}},function(e,t,n){"use strict";var r=n(25).fn,y=n(0),v=y.undef,s=n(56),c=n(90),o=n(146),l=n(123),i=n(186);r.processMsg=function(e){switch(e.cmd){case"sendMsg":this.onSendMsg(e);break;case"msg":this.onMsg(e);break;case"sysMsg":this.onSysMsg(e);break;case"broadcastMsg":this.onBroadcastMsg(e);break;case"sendCustomSysMsg":this.onSendSysMsg(e);break;case"getHistoryMsgs":case"searchHistoryMsgs":this.onHistoryMsgs(e);break;case"syncSendMsg":this.onMsg(e);break;case"deleteSessions":this.onDeleteSessions(e);break;case"sendMsgReceipt":this.onSendMsgReceipt(e);break;case"msgReceipt":this.onMsgReceipt(e);break;case"onDeleteMsg":this.onDeleteMsg(e);break;case"onMsgDeleted":this.onMsgDeleted(e);break;case"onDeleteMsgOfflineRoaming":this.onDeleteMsgOfflineRoaming(e);break;case"onMarkSessionAck":this.onMarkSessionAck(e);break;case"syncMarkSessionAck":this.syncMarkSessionAck(e)}},r.checkIgnore=function(e){var t=this;e.forEach(function(e){"notification"===e.type&&!e.ignore&&t.options.shouldIgnoreNotification(e)&&(e.ignore=!0)})},r.filterIgnore=function(e){return e.filter(function(e){return!e.ignore})},r.genSessionByMsgs=function(e){return this.checkIgnore(e),l.genSessionByMsgs(this.message.Message,e)},r.onRoamingMsgs=function(e){var t=this,n=t.message,r=n.Message,s=(0,r.getMaxTimetag)(i=n.reverseMsgs(e.content.msgs)),i=r.sortMsgs(i),o=(i=r.deduplication(i))[0],a=o.sessionId,n=t.genSessionByMsgs(i),e=(t.cacheSyncedSession(n),t.putMsg(i,"roamingMsgs").then(function(e){(i=t.filterIgnore(e)).length&&(t.logger.info("msg::onRoamingMsgs: putRoamingMsgs",a,i.length,i),t.syncResult.roamingMsgs=t.syncResult.roamingMsgs||[],t.syncResult.roamingMsgs.push({sessionId:a,scene:o.scene,to:o.target,msgs:i,timetag:s}),t.syncing||t.onSyncDone())}).catch(function(e){return t.logger.error("msg::onRoamingMsgs: ",e),Promise.reject(e)}));e.cmd="roamingMsgs-"+a,t.syncPromiseArray.push(e)},r.onOfflineMsgs=function(e,t){var n,i,o=this,r=o.message,a=r.Message,s=null,r=r.reverseMsgs(e.content.msgs,{modifyObj:s=t?{filter:!0}:s}),c=[],u="",l=t?"offlineFilterMsgs":"offlineMsgs";function m(t){var n,r,s,e;c.length&&(n=a.getMaxTimetag(c),r=c[0].scene,s=c[0].target,o.markMsgRead(c),c=a.sortMsgs(c),c=a.deduplication(c),e=o.genSessionByMsgs(c),o.cacheSyncedSession(e),(i=o.putMsg(c,"offlineMsgs").then(function(e){c=e,(c=o.filterIgnore(c)).length&&(o.logger.info("msg::onOfflineMsgs： toreLastSession",l,t,c.length,c),o.syncResult[l]=o.syncResult[l]||[],o.syncResult[l].push({sessionId:t,scene:r,to:s,msgs:c,timetag:n}))}).catch(function(e){return o.logger.error("msg::onOfflineMsgs: ",e),Promise.reject(e)})).cmd="offlineMsgs-"+t,o.syncPromiseArray.push(i))}r.forEach(function(e){(n=e.sessionId)!==u?(m(u),(c=[]).push(e),u=n):c.push(e)}),m(u)},r.markUnreadByMsgsPromise=function(t){var n=this,e=n.db;e.enable&&e.getSession(t).then(function(e){e.ack&&n.markUnreadBySessionAck({sessionId:t,ack:e.ack})})},r.completeMsg=function(e){return e.from=this.account,e.fromNick=this.myInfo&&this.myInfo.nick,e.fromClientType="Web",e.fromDeviceId=s.deviceId,e.time||(e.time=+new Date),e},r.onMsgs=function(e){var t=this;t.message.reverseMsgs(e.content.msgs,{mapper:function(e){t.handleMsg(e)}})},r.onMsg=function(e,t){e=this.message.reverse(e.content.msg);t&&(e.filter=!0),this.syncing?(this.logger.log("msg::onMsg:is in syncing ..."),this.unhandledMsgs.push({type:"onMsg",msg:e})):this.handleMsg(e)},r.onBroadcastMsgs=function(e){e=(e=e.content.broadcastMsgs).sort(function(e,t){return e.broadcastId-t.broadcastId});this.putBroadcastMsgs(e)},r.onBroadcastMsg=function(e){e=e.content.broadcastMsg;e.time=e.timestamp,this.syncing?this.unhandledMsgs.push({type:"onBroadcastMsg",msg:e}):e&&this.putBroadcastMsg(e)},r.pushMsgTask=function(e){this.msgPromise=this.msgPromise.then(function(){return e()})},r.handleMsg=function(r){var s=this,i=s.db,o=r.time;s.markMsgRead(r),s.msgPromise=s.msgPromise.then(function(){return s.putMsg(r,"onMsg")}).then(function(e){var t,n;return s.logger.log("msg::handleMsg:putMsg: ",r),i.enable?(t=i.updateRoamingMsgTimetag(o),n=Promise.resolve(),"superTeam"===r.scene&&(n=i.updateSuperTeamRoamingMsgTimetag(o)),Promise.all([t,n])):Promise.resolve()}).then(function(){if(s.logger.log("msg::handleMsg:updateRoamingMsgTimetag: ",o,r),r)return s.checkUserUpdate(r)}).then(function(){if(r){var e=r.type;if("notification"===(s.logger.log("msg::handleMsg:checkUserUpdate: "+r.scene+" "+e+" msg"+("notification"===e?" "+r.attach.type:""),r),e))return s.onTeamNotificationMsg(r)}}).then(function(){r&&!r.ignore&&(s.logger.info("msg::handleMsg:onmsg: ",r),setTimeout(function(){s.options.onmsg(y.copy(r))},0))}).then(void 0,function(e){e.callFunc="msg::handleMsg",s.onCustomError("消息处理错误",e)})},r.putMsg=function(n,a){var c,u,l,e,t,m,d,p,f,g;return(n=y.isArray(n)?n:[n])[0].filter?Promise.resolve(n):(u=(c=this).db,l=u.enable,e=Promise.resolve(),t=c.message.Message.getLastMsg(n),m=t.flow,d=t.sessionId!==c.currSessionId,h(p=c.genSessionByMsgs(n)),f=!1,g=[],c.checkIgnore(n),c.logger.log("start"),e=(e=(e=e.then(function(){return l||c.options.autoMarkRead||"roamingMsgs"===a||!p||(c.sessionUnreadMsgs=c.sessionUnreadMsgs||{},c.sessionUnreadMsgs[p.id]=c.sessionUnreadMsgs[p.id]||[],c.sessionUnreadMsgs[p.id]=c.sessionUnreadMsgs[p.id].concat(n.filter(function(e){return c.options.shouldCountNotifyUnread(e)}))),l&&"roamingMsgs"!==a&&"offlineMsgs"!==a?(c.logger.log("msg::putMsg:db.putMsg: ",p),u.putMsg(n)):n}).then(function(e){var t=[];return n.forEach(function(e){c.checkMsgUnique(e)&&t.push(e)}),n=t,g=l?e:n,Promise.resolve(n)})).then(function(r){return r.length&&(h(p=c.genSessionByMsgs(r)),l)&&p?new Promise(function(n,e){u.getSessions({sessionId:p.id}).then(function(e){var t;e&&e.lastMsg&&(t=e.lastMsg,p.lastMsg)&&p.lastMsg.time<t.time&&(p.lastMsg=t),c.logger.log("msg::putMsg:db.getSessions: ",p),g.length?p?u.putSession(p).then(function(e){n(e)}):n(e):(f=!0,g=r,n(e))})}):Promise.resolve(p)})).then(function(e){if(p&&g.length){var t="roamingMsgs"===a,n=c.options.syncSessionUnread,r=p.id,s=c.findSession(r)||{},i=s.ack||0;if("offlineMsgs"===a||t&&n||"onMsg"===a&&"in"===m&&d){l&&e?(p=e,i=i||p.ack||0):(e=s)&&(p.unread=e.unread||0),h(p),p.unread=p.unread||0;var o=0;if(g.forEach(function(e){var t=c.options.shouldCountNotifyUnread(e),t=("notification"!==e.type||"notification"===e.type&&t)&&(v(e.isUnreadable)||e.isUnreadable);(t=t&&n?e.time>i&&"out"!==e.flow:t)&&(o++,n)&&!l&&((t=s.unreadMsgs||[]).push(e),p.unreadMsgs=t)}),p.unread+=o,c.logger.log("msg::putMsg:updateSession: ",p),h(p),l&&!f)return u.updateSession({id:p.id,unread:p.unread})}}}),"onMsg"===a?e=e.then(function(){n.length&&p&&(c.onUpdateSession(p),c.options.syncSessionUnread)&&!d&&c.api.resetSessionUnread(c.currSessionId)}):"sendMsg"===a&&!d&&p&&p.lastMsg&&p.lastMsg.isLocal&&(c.onUpdateSession(p),c.api.resetSessionUnread(c.currSessionId)),e.then(function(){return Promise.resolve(n)}));function h(e){"roamingMsgs"!==a&&"offlineMsgs"!==a||c.cacheSyncedSession(e)}},r.putBroadcastMsgs=function(e){var t=this,n=t.db,r=e.length;if(0<r){if(t.doMarkBroadcastMsgsRead(e),n.enable)return r=e[r-1].broadcastId,n.updateBroadcastMsgTimetag(r),n.putBroadcastMsg(e).then(function(){return setTimeout(function(){t.doMarkMsgsRead(),t.options.onbroadcastmsgs(y.copy(e))},0),Promise.resolve(e)});setTimeout(function(){t.options.onbroadcastmsgs(y.copy(e))},0)}return e},r.putBroadcastMsg=function(e){var t=this,n=t.db;return t.doMarkBroadcastMsgsRead([e]),n.enable?(e.broadcastId&&n.updateBroadcastMsgTimetag(e.broadcastId),n.putBroadcastMsg(e).then(function(){return setTimeout(function(){t.options.onbroadcastmsg(y.copy(e))},0),Promise.resolve(e)})):(setTimeout(function(){t.options.onbroadcastmsg(y.copy(e))},0),e)},r.doMarkBroadcastMsgsRead=function(e){e=e.map(function(e){return e.broadcastId}),this.sendCmd("batchMarkRead",{sid:7,cid:17,ids:e})},r.cacheSyncedSession=function(e){var t;e&&this.syncResult&&(e=y.merge({},e),this.syncResult.sessions=this.syncResult.sessions||{},t=e.id,this.syncResult.sessions[t]=y.merge(this.syncResult.sessions[t],e),v(this.syncResult.sessions[t].unread)&&(this.syncResult.sessions[t].unread=0),this.mergeSession(this.syncResult.sessions[t]))},r.checkMsgUnique=y.genCheckUniqueFunc("idClient"),r.storeSendMsg=function(e){var t;if(!this.syncing)return t=this.putMsg(e,"sendMsg"),this.msgPromise=this.msgPromise.then(function(){return t}),t;this.unhandledMsgs.push({type:"sendMsg",msg:e})},r.updateSendMsgError=function(e){var t;if(!this.syncing)return t=this.updateMsg(e),this.msgPromise=this.msgPromise.then(function(){return t}),t;this.unupdatedMsgs.push(e)},r.onSendMsg=function(t,n){var e,r=this,s=t.obj&&t.obj.msg||t.content.msg;function i(){r.completeMsg(s);var e=t.error&&7101===t.error.code;t.error&&!e||(s.idServer=t.content.msg.idServer,s.time=+t.content.msg.time),t.error?s.status="fail":s.status="success",s=r.message.reverse(s),n&&(s.filter=!0),t.obj=s,r.syncing?r.unupdatedMsgs.push(s):r.msgPromise=Promise.all([r.msgPromise,t.obj.promise]).then(function(e){return e.length||(s.resend=!0),r.updateMsg(s).then(function(){return r.options.syncSessionUnread&&r.currSessionId===s.sessionId&&r.api.resetSessionUnread(r.currSessionId),r.resolveMsgReceiptTask(s),s})})}t.obj?i():(e=r.db)&&e.enable&&e.getMsgByIdClient(s.idClient).then(function(e){e&&(s=e,i())},function(e){i()})},r.updateLocalMsg=function(e){var t=this.updateMsg(e);return this.msgPromise=this.msgPromise.then(function(){return t}),t},r.updateMsg=function(s){var i,o,a,c,u;return s.filter?Promise.resolve(s):(o=(i=this).db,a="success"===s.status,c=l.genSessionByMsg(s),u=!!s.isLocal,o.enable?o.updateMsg(s).then(function(e){var t=o.updateSession(c),n=Promise.resolve(),r=Promise.resolve();return a&&e&&!u&&(n=o.updateRoamingMsgTimetag(e.time),"superTeam"===s.scene)&&(r=o.updateSuperTeamRoamingMsgTimetag(e.time)),i.onUpdateSession(c),Promise.all([t,n,r])}):(a&&!u&&(i.timetags.roamingMsgs=s.time),i.onUpdateSession(c),Promise.resolve(s)))},r.updateRoamingMsgTimetag=function(e){var t=this.db;return t.enable?t.updateRoamingMsgTimetag(e):(this.timetags.roamingMsgs=e,Promise.resolve(e))},r.checkUserUpdate=function(s){var i=this,o=s.from;return o===i.account?Promise.resolve():new Promise(function(n){var e,t=i.userSet[o];function r(){i.api.getUser({account:o,sync:!0,done:function(e,t){e||setTimeout(function(){i.logger.log("user::checkUserUpdate: onupdateuser",t.account,t),i.options.onupdateuser(t)},0),n()}})}(!t||(t=+t.updateTime,e=+s.userUpdateTime,!isNaN(t)&&!isNaN(e)&&y.isNumber(t)&&y.isNumber(e)&&t<e)?r:n)()})},r.processUnsettledMsgs=function(){var n=this;n.unhandledMsgs.forEach(function(e){var t=e.msg;switch(e.type){case"onMsg":n.handleMsg(t);break;case"sendMsg":n.msgPromise=n.msgPromise.then(function(){return n.putMsg(t)});break;case"onBroadcastMsg":n.msgPromise=n.msgPromise.then(function(){return n.putBroadcastMsg(t)})}}),n.unupdatedMsgs.forEach(function(e){n.msgPromise=n.msgPromise.then(function(){return n.updateMsg(e)})}),n.resetUnsettledMsgs()},r.onTeamNotificationMsg=function(e){this.db;var t=e.attach,n=t.type,r=e.from,s=e.to,i=e.time,o=t.team,a=t.account,c=t.accounts;switch(n){case"updateTeam":return o.updateTime=i,this.onUpdateTeam(o);case"addTeamMembers":return this.onAddTeamMembers(e,o,c);case"removeTeamMembers":return this.onRemoveTeamMembers(o,s,c);case"acceptTeamInvite":return this.onAddTeamMembers(e,o,[r]);case"passTeamApply":return this.onAddTeamMembers(e,o,[a]);case"addTeamManagers":return this.updateTeamManagers(e,s,c,!0,i);case"removeTeamManagers":return this.updateTeamManagers(e,s,c,!1,i);case"leaveTeam":return this.onRemoveTeamMembers(o,s,[r]);case"dismissTeam":return this.onDismissTeam(s,i);case"transferTeam":return this.transferTeam(e,o,r,a);case"updateTeamMute":return this.onUpdateTeamMembersMute(e,o,[a],t.mute);case"updateSuperTeam":return o.updateTime=i,this.onUpdateSuperTeam(o);case"addSuperTeamMembers":return this.onAddSuperTeamMembers(e,o,c);case"removeSuperTeamMembers":return this.onRemoveSuperTeamMembers(o,s,c);case"leaveSuperTeam":return this.onRemoveSuperTeamMembers(o,s,[r]);case"dismissSuperTeam":return this.onDismissSuperTeam(s,i);case"transferSuperTeam":return this.transferSuperTeam(e,o,r,a);case"addSuperTeamManagers":return this.updateSuperTeamManagers(e,s,c,!0,i);case"removeSuperTeamManagers":return this.updateSuperTeamManagers(e,s,c,!1,i);case"updateSuperTeamMembersMute":return this.onUpdateSuperTeamMembersMute(e,o,c,t.mute)}},r.onAddSuperTeamMembers=function(e,t,n){var r=this.db,s=(t.teamId,o.assembleMembers(t,n)),e={team:t,accounts:n,members:e.attach.members=s};if(this.logger.info("team::onAddSuperTeamMembers: ",e),this.options.onAddSuperTeamMembers(y.simpleClone(e)),r.enable)return e=r.putSuperTeamMembers(s),s=Promise.resolve(),-1<n.indexOf(this.account)&&t&&(s=r.putSuperTeam(t)),Promise.all([e,s])},r.onRemoveSuperTeamMembers=function(e,t,n){var r=this.db,s={team:e,accounts:n};if(this.logger.info("team::onRemoveSuperTeamMembers:",s),this.options.onRemoveSuperTeamMembers(y.simpleClone(s)),r.enable)return-1===n.indexOf(this.account)?(s=r.removeSuperTeamMembersByAccounts(t,n),n=Promise.resolve(),e&&(n=r.putSuperTeam(e)),Promise.all([s,n])):r.leaveSuperTeam(t)},r.onDismissSuperTeam=function(e,t){var n=this.db,r={teamId:e};if(this.logger.info("team::onDismissSuperTeam:",r),this.options.onDismissSuperTeam(r),n.enable)return n.dismissSuperTeam(e,t)},r.onAddTeamMembers=function(e,t,n){var r,s=this,i=s.db,o=t.teamId,a=c.assembleMembers(t,n),e={team:t,accounts:n,members:e.attach.members=a};if(s.logger.info("team::onAddTeamMembers: ",e),s.options.onAddTeamMembers(y.simpleClone(e)),i.enable)return e=i.putTeam(t),-1===n.indexOf(s.account)?r=i.putTeamMembers(a):(s.logger.warn("team::onAddTeamMembers: user join team",o),e=new Promise(function(e){s.api.getTeamMembers({teamId:o,sync:!0,done:function(){e()}})})),Promise.all([r,e])},r.onRemoveTeamMembers=function(e,t,n){var r=this.db,s={team:e,accounts:n};if(this.logger.info("team::onRemoveTeamMembers:",s),this.options.onRemoveTeamMembers(y.simpleClone(s)),r.enable)return-1===n.indexOf(this.account)?(s=r.removeTeamMembersByAccounts(t,n),n=Promise.resolve(),e&&(n=r.putTeam(e)),Promise.all([s,n])):r.leaveTeam(t)},r.updateTeamManagers=function(e,t,n,r,s){var i=this.db,o=e.attach.members=n.map(function(e){return{id:c.genId(t,e),type:r?"manager":"normal",updateTime:s}}),a={teamId:""+t,memberUpdateTime:s},e={team:e.attach.team=a,accounts:n,isManager:r,members:o};if(this.logger.info("team::updateTeamManagers:",e),this.options.onUpdateTeamManagers(y.simpleClone(e)),i.enable)return o=i.updateTeam(a),e=i.updateTeamManagers(t,n,r,s),Promise.all([o,e])},r.updateSuperTeamManagers=function(e,t,n,r,s){var i=this.db,o=e.attach.members=n.map(function(e){return{id:c.genId(t,e),teamId:t,account:e,type:r?"manager":"normal",updateTime:s}}),a={teamId:""+t,memberUpdateTime:s},e={team:e.attach.team=a,accounts:n,isManager:r,members:o};if(this.logger.info("team::updateSuperTeamManagers:",e),this.options.onUpdateSuperTeamManagers(y.simpleClone(e)),i.enable)return n=i.updateSuperTeam(a),e=i.updateSuperTeamMembers(o),Promise.all([n,e])},r.onDismissTeam=function(e,t){var n=this.db,r={teamId:e};if(this.logger.info("team::onDismissTeam:",r),this.options.onDismissTeam(r),n.enable)return n.dismissTeam(e,t)},r.transferTeam=function(e,t,n,r){var s=this.db,i=t.teamId,o=t.memberUpdateTime,a={id:c.genId(i,n),type:"normal",updateTime:o},i={id:c.genId(i,r),type:"owner",updateTime:o},o=(e.attach.members=[a,i],{team:t,from:a,to:i});if(this.logger.info("team::transferTeam:",o),this.options.onTransferTeam(y.simpleClone(o)),s.enable)return s.transferTeam(t,n,r)},r.transferSuperTeam=function(e,t,n,r){var s=this.db,i=t.teamId,o=t.memberUpdateTime,n={teamId:i,type:"normal",account:n,updateTime:o},i={teamId:i,type:"owner",account:r,updateTime:o},r=(e.attach.members=[n,i],{team:t,from:n,to:i});if(this.logger.info("team::transferSuperTeam:",r),this.options.onTransferSuperTeam(y.simpleClone(r)),s.enable)return s.transferSuperTeam(t,n,i)},r.onUpdateTeamMembersMute=function(e,t,n,r){var s=this.db,i=n.map(function(e){return{id:c.genId(t.teamId,e),account:e,teamId:t.teamId,mute:r,updateTime:t.memberUpdateTime}}),e=(e.attach.members=i,{team:t,accounts:n,members:i,mute:r});if(this.logger.info("team::onUpdateTeamMembersMute:",e),this.options.onUpdateTeamMembersMute(y.simpleClone(e)),s.enable)return n=s.updateTeamMembers(i),e=s.putTeam(t),Promise.all([n,e])},r.onUpdateSuperTeamMembersMute=function(e,t,n,r){var s=this.db,i=n.map(function(e){return{id:o.genId(t.teamId,e),account:e,teamId:t.teamId,mute:r,updateTime:t.memberUpdateTime}}),e=(e.attach.members=i,{team:t,accounts:n,members:i,mute:r});if(this.logger.info("team::onUpdateSuperTeamMembersMute:",e),this.options.onUpdateSuperTeamMembersMute(y.simpleClone(e)),s.enable)return n=s.updateSuperTeamMembers(i),e=s.putSuperTeam(t),Promise.all([n,e])},r.onHistoryMsgs=function(e){e.error||(e.obj.msgs=this.message.reverseMsgs(e.content.msgs))},r.isFilterMsgs=function(e){return!!e[0].filter},r.splitMsgs=function(e,t,n,r){e.forEach(function(e){if(e.filter)r.push(e);else switch(e.scene){case"p2p":t.push(e);break;case"team":n.push(e)}})},r.markMsgRead=function(e,t){var n;y.isArray(e)||(e=[e]),(this.db.enable||this.options.autoMarkRead||t)&&(this.splitMsgs(e,t=[],e=[],n=[]),this.markP2pMsgsRead(t),this.markTeamMsgsRead(e),this.markFilterMsgsRead(n))},r.markP2pMsgsRead=function(e){var t,n;e.length&&(t=i.idMap.msg.id,n=i.idMap.msg.msg,this.doMarkMsgsRead(t,n,e))},r.markTeamMsgsRead=function(e){var t,n;e.length&&(t=i.idMap.team.id,n=i.idMap.team.teamMsg,this.doMarkMsgsRead(t,n,e))},r.markFilterMsgsRead=function(e){var t,n;e.length&&(t=i.idMap.filter.id,n=i.idMap.filter.filterMsg,this.doMarkMsgsRead(t,n,e))},r.markSysMsgRead=function(e,t){var n;y.isArray(e)||(e=[e]),(this.db.enable||this.options.autoMarkRead||t)&&(t=this.isFilterMsgs(e)?(n=i.idMap.filter.id,i.idMap.filter.filterSysMsg):(n=i.idMap.msg.id,i.idMap.msg.sysMsg),this.doMarkMsgsRead(n,t,e))},r.doMarkMsgsRead=function(e,t,n){n&&n.length&&(!n[0].attach||"netcallBill"!==n[0].attach.type&&"netcallMiss"!==n[0].attach.type||(e=9,t=11),this.sendCmd("batchMarkRead",{sid:e,cid:t,ids:n.map(function(e){return e.idServer})}))}},function(e,t,n){"use strict";var r=n(25).fn,s=n(0),o=n(187);r.processNotify=function(e){switch(e.cmd){case"syncOfflineNetcallMsgs":case"syncOfflineMsgs":this.onOfflineMsgs(e);break;case"batchMarkRead":break;case"syncOfflineSysMsgs":this.onOfflineSysMsgs(e);break;case"syncRoamingMsgs":case"syncSuperTeamRoamingMsgs":this.onRoamingMsgs(e);break;case"syncOfflineFilterMsgs":this.onOfflineMsgs(e,!0);break;case"syncOfflineFilterSysMsgs":this.onOfflineSysMsgs(e,!0);break;case"syncMsgReceipts":this.onOfflineMsgReceipts(e);break;case"syncDonnop":this.onDonnop(e,!0);break;case"syncSessionAck":this.syncSessionAck(e);break;case"syncRobots":this.onRobots(e);break;case"syncBroadcastMsgs":this.onBroadcastMsgs(e)}},r.onDonnop=function(e,t){var n,r,s,i;e.error||(r=(n=this).db,s=o.reverse(e.content.donnop),n.mergeDonnop(s),s=n.dbDonnop(),t?(i=e.content.timetag,n.timetags.donnop=i,(s=r.enable?s.then(function(){return n.db.updateDonnopTimetag(i)}).catch(function(e){return n.logger.error("notify::onDonnop: ",e),Promise.reject(e)}):s).cmd="donnop",n.syncPromiseArray.push(s)):n.onPushNotificationMultiportConfigUpdate())},r.onUpdateDonnop=function(e){e.error||(e=e.obj)&&(this.mergeDonnop(s.filterObj(e,["shouldPushNotificationWhenPCOnline"])),this.dbDonnop(),this.onPushNotificationMultiportConfigUpdate())},r.getPushNotificationMultiportConfig=function(){return s.merge({},this.pushNotificationMultiportConfig)},r.mergeDonnop=function(e){this.pushNotificationMultiportConfig=s.merge({},this.pushNotificationMultiportConfig,e)},r.dbDonnop=function(){return this.db.enable?this.db.setDonnop(this.pushNotificationMultiportConfig):Promise.resolve()},r.onPushNotificationMultiportConfigUpdate=function(){var t=this;setTimeout(function(){var e=t.getPushNotificationMultiportConfig();t.logger.info("link::onPushNotificationMultiportConfigUpdate:",e),t.options.onPushNotificationMultiportConfigUpdate(e)})}},function(e,t,n){"use strict";var r=n(25).fn,s=n(0),a=s.objs2accounts,f=s.teams2ids,g=n(189),c=n(146);r.processSuperTeam=function(e){var t,n,r,s=e.error;switch(void 0===e.obj&&(e.obj={}),e.cmd){case"sendSuperTeamMsg":this.onSendMsg(e);break;case"superTeamMsg":this.onMsg(e);break;case"syncSuperTeams":this.onSuperTeams(e);break;case"syncCreateSuperTeam":t=g.reverse(e.content.team),r=c.assembleOwner(t),this.logger.info("team::processTeam: sync createTeam",t,r),this.options.onSyncCreateSuperTeam(t,r),this.onCreateSuperTeam(t,r);break;case"getSuperTeamHistoryMsgs":case"searchSuperTeamHistoryMsgs":this.onHistoryMsgs(e);break;case"addSuperTeamMembers":case"removeSuperTeamMembers":case"leaveSuperTeam":case"addSuperTeamManagers":case"removeSuperTeamManagers":case"transferSuperTeam":break;case"updateInfoInSuperTeam":s||((n=e.obj).account=this.account,n.id=c.genId(n.teamId,n.account),n=c.reverse(n),e.obj=n,this.onUpdateSuperTeamMember(n));break;case"syncUpdateSuperTeamMember":n=c.reverse(e.content.teamMember),this.onUpdateSuperTeamMember(n);break;case"updateSuperTeam":e.obj=g.reverse(e.obj,!0);break;case"getSuperTeam":e.error||(e.obj=g.reverse(e.content.team));break;case"getSuperTeams":this.onSuperTeams(e);break;case"syncSuperTeamMembers":this.onSyncSuperTeamMembers(e);break;case"getSuperTeamMembers":e.error||this.onGetAllSuperTeamMembers(e);break;case"getSuperTeamMembersByJoinTime":e.error||this.onSuperTeamMembers(e)}},r.onSuperTeams=function(n){n.content=n.content||{};var i,o=this,a=o.db,c=o.packetFromSync(n),u=n.content.teams||[],l=!0,m=[],d=[],e=(n.error&&803===n.error.code&&(n.error=null,l=!1),new Promise(function(e,t){var r,s;n.error?c&&t(n.error):(l&&u.forEach(function(e){((e=g.reverse(e)).validToCurrentUser?m:d).push(e)}),o.logger.info("superTeam::onSuperTeams: parseData",f(m),m,"invalid",f(d),d),u.length?(l=!0,i=n.content.timetag):l=!1,a.enable?(r=e,s=t,n.promise=new Promise(function(t,n){function e(){c?(p(),t(),r()):a.getSuperTeams().then(function(e){m=e,p(),t(),r()}).then(void 0,function(e){e.message="db.getSuperTeams error",e.callFunc="superTeam::afterMergeData",n(e),s(e)})}l?a.mergeSuperTeams(m,d,i).then(function(){e()}).then(void 0,function(e){e={callFunc:"superTeam::onSuperTeams:mergeData",message:"db.mergeSuperTeams error",event:e};n(e),s(e)}):(o.logger.warn("superTeam::onSuperTeams:mergeData: no teams need merge"),e())}).then(void 0,function(e){throw e.message="merge teams data error",e.callFunc="superTeam::mergeData",s(e),e})):(p(),e()))}).catch(function(e){return o.logger.error("superTeam::onSuperTeams: ",e),Promise.reject(e)}));function p(){o.timetags.superTeams=i,m.invalid=d,c?(o.syncResult.superTeams=m,o.syncResult.invalidSuperTeams=d):(o.logger.info("superTeam::onSuperTeams: not in syncing, get teams",f(m),m),n.obj=m)}c&&(e.cmd="superteams",o.syncPromiseArray.push(e))},r.onCreateSuperTeam=function(e,t){var n=this.db;n.enable&&(n.putSuperTeam(e),n.putSuperTeamMembers(t))},r.onGetAllSuperTeamMembers=function(t){var n,r=this,s=this.db,e=t.raw.ser,i=r.superTeamMembersData[e].teamId;s.enable?(n=t.content&&t.content.timetag,t.promise=Promise.all(r.superTeamMembersData[e].pArr).then(function(){return s.getSuperTeamMembers(i).then(function(e){n&&s.updateSuperTeamMemberTimetag(i,n),t.obj={members:e,invalid:[],teamId:i}})}).catch(function(e){return r.logger.error(e)})):t.obj={members:r.superTeamMembersData[e].members,invalid:r.superTeamMembersData[e].invalid,teamId:i},r.superTeamMembersData[e]=void 0},r.onSyncSuperTeamMembers=function(e){var t=this.db,n=[],r=[],s=e.content.members||[],i=e.raw.ser,o=(o=e.obj?e.obj.teamId:o)||e.content.teamId;s.forEach(function(e){((e=c.reverse(e)).valid?r:n).push(e)}),this.logger.info("team::onSyncSuperTeamMembers: parseData",o,a(r),r,"invalid",a(n),n),t.enable?(this.superTeamMembersData[i]=this.superTeamMembersData[i]||{teamId:o,pArr:[]},s=Promise.resolve(),s=(s=e.content&&e.content.isAll?t.deleteSuperTeamMembers(o):s).then(function(){return t.mergeSuperTeamMembers(o,r,n)}).then(function(){return Promise.resolve()}),this.superTeamMembersData[i].pArr.push(s)):(this.superTeamMembersData[i]=this.superTeamMembersData[i]||{teamId:o,members:[],invalid:[]},r.length&&(this.superTeamMembersData[i].members=this.api.mergeTeamMembers(this.superTeamMembersData[i].members,r)),n.length&&(this.superTeamMembersData[i].invalid=this.api.mergeTeamMembers(this.superTeamMembersData[i].invalid,n))),e.raw=void 0},r.onSuperTeamMembers=function(e){var t=this.db,n=[],r=[],s=e.content.members||[],i=(i=e.obj?e.obj.teamId:i)||e.content.teamId;s.forEach(function(e){((e=c.reverse(e)).valid?r:n).push(e)}),this.logger.info("team::onSyncSuperTeamMembers: parseData",i,a(r),r,"invalid",a(n),n),t.enable&&t.mergeSuperTeamMembers(i,r,n),e.obj={members:r,invalid:n,teamId:i}},r.onUpdateSuperTeamMember=function(e){e.updateTime||(e.updateTime=+new Date),this.logger.warn("superTeam::onUpdateSuperTeamMember: ",e),this.options.onUpdateSuperTeamMember(s.simpleClone(e));var t={teamId:e.teamId,memberUpdateTime:e.updateTime},t=(this.onUpdateSuperTeam(t),this.db);t.enable&&t.updateSuperTeamMember(e)},r.onUpdateSuperTeam=function(e){this.logger.info("superteam::onUpdateSuperTeam:",e),this.options.onUpdateSuperTeam(s.simpleClone(e));var t=this.db;t.enable&&t.updateSuperTeam(e)}},function(e,t,n){"use strict";var r=n(25).fn,o=n(0),m=o.objs2accounts,f=o.teams2ids,g=n(126),d=n(90);r.processTeam=function(e){var t=e.error,n=void 0,r=void 0,s=void 0;switch(void 0===e.obj&&(e.obj={}),e.cmd){case"createTeam":n=e.obj.team;t||(n=e.content.team),n=g.reverse(n),e.obj.team=n,s=d.assembleOwner(n),e.obj.owner=s,t||(this.logger.info("team::processTeam: create team",{team:n,owner:s}),this.onCreateTeam(n,s));break;case"syncCreateTeam":n=g.reverse(e.content.team),s=d.assembleOwner(n),this.logger.info("team::processTeam: sync createTeam",n,s),this.options.onsynccreateteam(n,s),this.onCreateTeam(n,s);break;case"sendSuperTeamMsg":case"sendTeamMsg":this.onSendMsg(e);break;case"teamMsg":this.onMsg(e);break;case"teamMsgs":this.onMsgs(e);break;case"addTeamMembers":case"removeTeamMembers":case"leaveTeam":case"dismissTeam":case"addTeamManagers":case"removeTeamManagers":case"transferTeam":break;case"updateInfoInTeam":t||((r=e.obj).account=this.account,r.id=d.genId(r.teamId,r.account),r=d.reverse(r),e.obj=r,this.mergeMyTeamMembers(r),this.onUpdateTeamMember(r));break;case"updateNickInTeam":e.obj=d.reverse(e.obj);break;case"updateTeam":e.obj=g.reverse(e.obj,!0);break;case"applyTeam":e.error||(e.obj=g.reverse(e.content.team));break;case"passTeamApply":this.updateTeamSysMsgState(e,"passed");break;case"rejectTeamApply":this.updateTeamSysMsgState(e,"rejected");break;case"acceptTeamInvite":this.updateTeamSysMsgState(e,"passed"),e.error||(e.obj=g.reverse(e.content.team));break;case"rejectTeamInvite":this.updateTeamSysMsgState(e,"rejected");break;case"getTeam":e.error||(e.obj=g.reverse(e.content.team));break;case"getTeams":this.onTeams(e);break;case"getTeamMembers":this.onTeamMembers(e);break;case"syncTeams":this.onTeams(e);break;case"syncTeamMembers":this.onTeamMembers(e);break;case"getTeamHistoryMsgs":case"searchTeamHistoryMsgs":this.onHistoryMsgs(e);break;case"syncSendTeamMsg":this.onMsg(e);break;case"notifyTeamMsgReads":this.onTeamMsgReceipt(e);break;case"syncUpdateTeamMember":r=d.reverse(e.content.teamMember),this.onUpdateTeamMember(r),r.account===this.account&&this.mergeMyTeamMembers(r);break;case"updateMuteStateInTeam":break;case"getMyTeamMembers":e.error||(e.obj=d.reverseMembers(e.content.teamMembers));break;case"getMutedTeamMembers":e.error||(e.obj={teamId:e.obj.teamId,members:d.reverseMembers(e.content.teamMembers)});break;case"syncMyTeamMembers":this.onSyncMyTeamMembers(e)}},r.onCreateTeam=function(e,t){var n=this.db;n.enable&&(n.putTeam(e),n.putTeamMembers(t)),this.options.onCreateTeam(e,t)},r.onTeams=function(n){n.content=n.content||{};var i,o=this,a=o.db,c=o.packetFromSync(n),u=n.content.teams||[],l=!0,m=[],d=[],e=(n.error&&803===n.error.code&&(n.error=null,l=!1),new Promise(function(e,t){var r,s;n.error?c&&t(n.error):(l&&u.forEach(function(e){((e=g.reverse(e)).validToCurrentUser?m:d).push(e)}),o.logger.info("team::onTeams: parseData",f(m),m,"invalid",f(d),d),u.length?(l=!0,i=n.content.timetag):l=!1,a.enable?(r=e,s=t,n.promise=new Promise(function(t,n){function e(){c?(p(),t(),r()):a.getTeams().then(function(e){m=e,p(),t(),r()}).then(void 0,function(e){e.message="db.getTeams error",e.callFunc="team::afterMergeData",n(e),s(e)})}l?a.mergeTeams(m,d,i).then(function(){e()}).then(void 0,function(e){e={callFunc:"team::onTeams:mergeData",message:"db.mergeTeams error",event:e};n(e),s(e)}):(o.logger.warn("team::onTeams:mergeData: no teams need merge"),e())}).then(void 0,function(e){throw e.message="merge teams data error",e.callFunc="team::mergeData",s(e),e})):(p(),e()))}).catch(function(e){return o.logger.error("team::onTeams: ",e),Promise.reject(e)}));function p(){o.timetags.teams=i,m.invalid=d,c?(o.syncResult.teams=m,o.syncResult.invalidTeams=d,o.syncing||o.onSyncDone()):(o.logger.info("team::onTeams: not in syncing, get teams",f(m),m),n.obj=m)}c&&(e.cmd="teams",o.syncPromiseArray.push(e))},r.onTeamMembers=function(n){n.content=n.content||{};var r,s=this,i=(s.db,s.packetFromSync(n)),o=n.content.members||[],a=!0,c=[],u=[],l=""+(l=(l=n.obj?n.obj.teamId:l)||n.content.teamId),e=(!n.error||406===n.error.code&&(n.error=null,a=!1),new Promise(function(e,t){n.error?i&&(s.logger.error("team::onTeamMember: team error:",l,n.error),t({callFunc:"team::onTeamMembers",event:n.error,message:"teamId-"+l+" 获取群成员错误"})):(a&&o.forEach(function(e){((e=d.reverse(e)).valid?c:u).push(e)}),s.logger.warn("team::onTeamMembers: parseData",l,m(c),c,"invalid",m(u),u),o.length?(a=!0,r=n.content.timetag):a=!1,c.invalid=u,i?(s.syncTeamMembersResult[l]=c,s.syncTeamMembersResult[l+"-invalid"]=u,s.timetags["team-"+l]=r):(s.logger.info("team::onTeamMembers: not syncing, get members",l,m(c),c),n.obj={teamId:l,members:c}),e())}));i&&(e.cmd=l,s.syncTeamMembersPromiseArray.push(e))},r.onUpdateTeamMember=function(e){e.updateTime||(e.updateTime=+new Date),this.logger.info("team::onUpdateTeamMember: ",e),this.options.onupdateteammember(o.simpleClone(e));var t={teamId:e.teamId,memberUpdateTime:e.updateTime},t=(this.onUpdateTeam(t),this.db);t.enable&&t.updateTeamMember(e)},r.onUpdateTeam=function(e){this.logger.info("team::onUpdateTeam:",e),this.options.onUpdateTeam(o.simpleClone(e));var t=this.db;t.enable&&t.updateTeam(e)},r.onSyncMyTeamMembers=function(e){var t,n=this,r=n.db,s=d.reverseMembers(e.content.teamMembers);n.logger.info("team::onSyncMyTeamMembers:",s),r.enable&&((t=r.putTeamMembers(s).then(function(){return r.updateMyTeamMembersTimetag(e.content.timetag)}).catch(function(e){return n.logger.error("team::syncMyTeamMember: ",e),Promise.reject(e)})).cmd="myTeamMembers",n.syncTeamMembersPromiseArray.push(t)),n.mergeMyTeamMembers(s)},r.mergeMyTeamMembers=function(e){o.isArray(e)||(e=[e]);var n=this.myTeamMembersMap=this.myTeamMembersMap||{};e.forEach(function(e){var t=e.teamId;n[t]=o.merge(n[t],e)}),this.logger.info("team::mergeMyTeamMembers:",n)},r.notifyForNewTeamMsg=function(t){o.isArray(t)||(t=[t]);var n=this,r=this.myTeamMembersMap||{},s={},i=[],e=(t.forEach(function(e){o.exist(r[e])?s[e]=r[e].muteNotiType:i.push(e)}),Promise.resolve({map:s}));return e=i.length?n.api.getMyTeamMembers({teamIds:i,promise:!0}).then(function(e){n.mergeMyTeamMembers(e),e.forEach(function(e){s[e.teamId]=e.muteNotiType});e=t.filter(function(e){return!s[e]});return Promise.resolve({map:s,miss:e})}).catch(function(e){return 0<Object.keys(s).length?Promise.resolve({map:s,miss:i,error:e}):Promise.reject(e)}):e},r.updateTeamSysMsgState=function(e,t){var n=e.error;n&&(t="error",n=o.filterObj(n,"code message")),e={idServer:e.obj.idServer,state:t},n&&(e.error=n),this.updateSysMsg(e)},r.onTeamMsgReceipt=function(e){var t=e.content,e=e.error;e&&this.logger.error("team::onTeamMsgReceipt:",e),t&&t.teamMsgReceipts&&this.options.onTeamMsgReceipt(t)}},function(e,t,n){"use strict";var r=n(25).fn,s=n(0);r.onRobots=function(e){var e=e.content;s.isFunction(this.options.onrobots)&&Array.isArray(e.robots)&&0<(e=e.robots.filter(function(e){return!!e.botid})).length&&this.options.onrobots(e||[])}},function(e,t,n){"use strict";var r=n(25).fn,s=n(0),g=s.objs2accounts,h=n(299),i=n(140);r.processFriend=function(e){var t=e.obj,n=e.content,r=e.error;switch(e.cmd){case"friendRequest":this.updateFriendSysMsg(e),r||this.onFriendRequest(t);break;case"syncFriendRequest":this.onFriendRequest(n,!0);break;case"deleteFriend":r||this.onDeleteFriend(t);break;case"syncDeleteFriend":this.onDeleteFriend(n,!0);break;case"updateFriend":r||this.onUpdateFriend(t);break;case"syncUpdateFriend":this.onUpdateFriend(n.friend,!0);break;case"getFriends":case"syncFriends":this.onFriends(e);break;case"syncFriendUsers":this.onFriendUsers(e)}},r.onFriends=function(n){var i,o=this,a=o.db,c=n.error,u=o.packetFromSync(n),l=n.content.friends,m=!0,d=[],p=[],e=new Promise(function(e,t){var r,s;c?u&&t(c):(m&&l.forEach(function(e){((e=h.reverse(e)).valid?d:p).push(e)}),o.logger.info("friend::onFriends: parse friends",g(d),d,"delete",g(p),p),l.length?(m=!0,i=n.content.timetag):m=!1,a.enable?(r=e,s=t,n.promise=new Promise(function(t,n){function e(){u?(f(),t(),r()):a.getFriends().then(function(e){d=e,f(),t(),r()}).then(void 0,function(e){e._msg="get friends error",n(e),s(e)})}m?a.mergeFriends(d,p,i).then(function(){e()}).then(void 0,function(e){e._msg="merge friends error",n(e),s(e)}):(o.logger.info("friend::onFriends: no merge friends"),e())}).then(void 0,function(e){throw e._msg="merge friends data error",s(e),e})):(f(),e()))}).catch(function(e){return o.logger.error("friend::onFriends: ",e),Promise.reject(e)});function f(){o.timetags.friends=i,d.invalid=p,u?(o.syncResult.friends=d,o.syncResult.invalidFriends=p):(o.logger.info("friend::onFriends: get friends bingo",g(d),d),n.obj=d)}u&&(e.cmd="friends",o.syncPromiseArray.push(e))},r.onFriendRequest=function(e,t){var n=Promise.resolve(),r=this.db,s=e.type;return"addFriend"!==(s=e.type=h.getTypeFromByte(s)||s)&&"passFriendApply"!==s||(s=e.friend=h.assembleFriend(e.account),r.enable&&(n=r.putFriend(s))),t&&this.onSyncFriendAction(e),n},r.onSyncFriendAction=function(e){this.logger.info("friend::onSyncFriendActionon:",e),this.options.onsyncfriendaction(e)},r.onDeleteFriend=function(e,t){var n=Promise.resolve(),r=this.db;return r.enable&&(n=r.deleteFriend(e.account)),t&&(e.type="deleteFriend",this.onSyncFriendAction(e)),n},r.onUpdateFriend=function(e,t){var n=this.db,e=h.reverse(e);n.enable&&n.updateFriend(e),t&&this.onSyncFriendAction({type:"updateFriend",friend:e})},r.onFriendUsers=function(e){var t=this.db,e=e.content,n=e.users.map(function(e){return i.reverse(e)}),e=(this.logger.warn("friend::onFriendUsers: parse users",g(n),n),e.timetag),r=Promise.resolve();t.enable&&(r=t.mergeFriendUsers(n,e)),this.timetags.friendUsers=e,r.cmd="friendUsers",this.syncPromiseArray.push(r),this.syncResult.users=n,this.syncing||this.onSyncDone()},r.updateFriendSysMsg=function(e){var t,n=e.obj,r=e.error;if(e.obj.idServer){if(r)t="error",r=s.filterObj(r,"code message");else{var e=n.type;switch(h.getTypeFromByte(e)||e){case"passFriendApply":t="passed";break;case"rejectFriendApply":t="rejected"}}e={idServer:n.idServer,state:t},r&&(e.error=r),this.updateSysMsg(e)}}},function(e,t,n){"use strict";var r=n(0);function s(){}s.parse=function(e){e=r.copy(e);return e.isBlacked="1"===e.isBlacked,e.isMuted="1"===e.isMuted,e.createTime=+e.createTime,e.updateTime=+e.updateTime,e},e.exports=s},function(e,t,n){"use strict";var r=n(25).fn,i=n(0),y=i.objs2accounts,v=n(447),l=n(140);r.processUser=function(e){var t,n=this,r=n.db,s=e.obj,i=e.error,o=e.content;switch(e.cmd){case"markInBlacklist":i||n.markInBlacklist(s);break;case"syncMarkInBlacklist":n.markInBlacklist(o,!0);break;case"markInMutelist":i||n.markInMutelist(s);break;case"syncMarkInMutelist":n.markInMutelist(o,!0);break;case"getRelations":i||n.onRelations(e);break;case"syncMyInfo":n.onMyInfo(e,!0);break;case"updateMyInfo":i||(s.updateTime=o.timetag,n.onUpdateMyInfo(e,s));break;case"syncUpdateMyInfo":n.onUpdateMyInfo(e,o.user,!0);break;case"getUsers":i||(t=o.users.map(function(e){return e=l.reverse(e),n.mergeUser(e),e}),e.obj=t,r.enable&&r.putUsers(t));break;case"updateDonnop":n.onUpdateDonnop(e);break;case"syncUpdateDonnop":n.onDonnop(e,!1)}},r.onMyInfo=function(e){var s,i=this,o=i.db,a=e.error,c=e.content,e=new Promise(function(e,t){var n,r;a?(a&&(a.callFunc="user::onMyInfo"),e(a),i.syncData()):(s=l.reverse(c.user),i.logger.info("user::onMyInfo: parseData",s),o.enable?(n=e,r=t,o.mergeMyInfo(s,!0).then(function(){u(),n()}).then(void 0,function(e){e.message="db.mergeMyInfo error",e.callFunc="user::onMyInfo",r(e)})):(u(),e()))}).catch(function(e){return i.logger.error("user::onMyInfo: ",e),Promise.reject(e)});function u(){i.timetags.myInfo=s.updateTime,i.syncResult.myInfo=s}e.cmd="myInfo",i.syncPromiseArray.push(e)},r.onUpdateMyInfo=function(e,t,n){var r=this.db,t=l.reverse(t),s=i.merge(this.myInfo,t);this.myInfo=s,n?(this.logger.info("user::onUpdateMyInfo:",s),this.options.onupdatemyinfo(s)):e.obj=s,r.enable&&(t.account=this.account,r.updateUser(t))},r.onRelations=function(n){var i=this,o=i.db,a=n.error,c=i.packetFromSync(n),u=n.content.specialRelations,l=!0,m=void 0,d=[],p=[],f=[],g=[],e=new Promise(function(e,t){var r,s;a?c&&(e(a),i.syncData()):(u.forEach(function(e){var t={account:(e=v.parse(e)).account,createTime:e.createTime,updateTime:e.updateTime};(e.isBlacked?d:p).push(t),(e.isMuted?f:g).push(t)}),i.logger.info("user::onRelations: parse blacklist",y(d),d,"delete",y(p),p),i.logger.info("user::onRelations: parse mutelist",y(f),f,"delete",y(g),g),u.length?(l=!0,m=n.content.timetag):l=!1,o.enable?(r=e,s=t,n.promise=new Promise(function(t,n){function e(){c?(h(),t(),r()):o.getRelations().then(function(e){d=e[0],f=e[1],h(),t(),r()}).then(void 0,function(e){e.message="db.getRelations error",e.callFunc="user::onRelations",n(e),s(e)})}l?o.mergeRelations(d,p,f,g,m).then(function(){e()}).then(void 0,function(e){e.message="db.mergeRelations error",e.callFunc="user::onRelations",n(e),s(e)}):(i.logger.warn("user::onRelations: no relations need merge"),e())}).then(void 0,function(e){throw e.message="merge relations data error",e.callFunc="user::onRelations",s(e),e})):(h(),e()))}).catch(function(e){return i.logger.error("user::onRelations: ",e),Promise.reject(e)});function h(){i.timetags.relations=m,d.invalid=p,f.invalid=g,c?(i.syncResult.blacklist=d,i.syncResult.mutelist=f,i.syncResult.invalidBlacklist=p,i.syncResult.invalidMutelist=g):(i.logger.info("user::onRelations: get relations",d,f),n.obj.blacklist=d,n.obj.mutelist=f)}c&&(e.cmd="relations",i.syncPromiseArray.push(e))},r.markInBlacklist=function(e,t){var n=this.db;e.record={account:e.account,updateTime:+new Date},n.enable&&n.markInBlacklist(e),t&&(this.logger.info("user::markInBlacklist:",e),this.options.onsyncmarkinblacklist(e))},r.markInMutelist=function(e,t){var n=this.db;e.record={account:e.account,updateTime:+new Date},n.enable&&n.markInMutelist(e),t&&(this.logger.info("user::markInMutelist:",e),this.options.onsyncmarkinmutelist(e))},r.mergeUser=function(e){this.userSet[e.account]=e}},function(e,t,n){"use strict";var r=n(145),L=r&&r.__esModule?r:{default:r},r=n(25).fn,D=n(0),B=n(26),H=D.undef,q=D.objs2ids,X=D.objs2accounts,W=D.teams2ids,V=n(123),s=D.getGlobal();r.beforeSync=function(){var e=this.db;return e.enable?e.clearSendingMsgs():Promise.resolve()},r.syncData=function(){var n=this,e=n.db,r=n.options,e=e.enable;function t(e){n.syncPromiseArray=[],n.syncResult={},n.syncTeamMembersPromiseArray=[],n.syncSuperTeamMembersPromiseArray=[],n.syncTeamMembersResult={},n.checkNosReqNum=0,n.getNosOriginUrlReqNum=0,D.verifyBooleanWithDefault(r,"syncRelations syncFriends syncFriendUsers syncTeams syncSuperTeams syncRoamingMsgs syncSuperTeamRoamingMsgs syncMsgReceipts syncExtraTeamInfo",!0,"","sync::syncData"),D.verifyBooleanWithDefault(r,"syncFilter syncTeamMembers syncSuperTeamMembers",!1,"","sync::syncData");var t={},e=(e=e||{},s._nimForceSyncIM&&(n.logger.warn("sync::syncData: nimForceSyncIM"),delete e.teams,s._nimForceSyncIM=!1),t.myInfo=e.myInfo||0,t.offlineMsgs=0,r.syncRelations&&(t.relations=e.relations||0),r.syncFriends&&(t.friends=e.friends||0),r.syncFriendUsers&&(t.friendUsers=e.friendUsers||0),r.syncRobots&&(t.robots=e.robots||0),r.syncTeams&&(t.teams=e.teams||0),r.syncSuperTeams&&(t.superTeams=e.superTeams||0),r.syncRoamingMsgs&&(t.roamingMsgs=e.roamingMsgs||0),r.syncSuperTeamRoamingMsgs&&(t.superTeamRoamingMsgs=e.superTeamRoamingMsgs||0),r.syncMsgReceipts&&(t.msgReceipts=e.msgReceipts||0),r.syncExtraTeamInfo&&(t.myTeamMembers=e.myTeamMembers||0),r.syncSessionUnread&&(t.sessionAck=e.sessionAck||0),r.syncBroadcastMsgs&&(t.broadcastMsgs=e.broadcastMsg||0),t.donnop=e.donnop||0,t.deleteMsg=e.deleteMsg||0,t.netcallMsgs=0,r.syncFilter&&(t.filterMsgs=0),n.onSyncData.bind(n));e.isImSyncDataCb=!0,n.sendCmd("sync",{sync:t,isImSyncDataObj:!0},e)}n.syncing=!0,e?n.beforeSync().then(function(){return n.db.getTimetags()}).then(function(e){t(e)},function(){t()}):t(n.timetags)},r.onSyncData=function(e,t){e&&3<this.syncRetryTimes&&(this.syncRetryTimes=0,e.callFunc="sync::onSyncData",this.onCustomError("SYNC_DATA_ERROR",e))},r.processSync=function(e){switch(this.syncRetryTimes=this.syncRetryTimes||0,this.syncRetryTimes++,e.cmd){case"syncDone":e.error?3<this.syncRetryTimes||this.syncData():(this.timetags.sync=e.content.timetag,this.onSyncDone());break;case"syncTeamMembersDone":this.onSyncTeamMembersDone()}},r.onSyncDone=function(r){var i,o,a,c,u,l,m,d,p,f,g,h,y,v,b,T,M,S,k,x,C,I,w,P,e,t,O=this,A=O.db,_=A.enable,E=O.options,R=O.syncPromiseArray,U=O.syncResult;function n(){var t,e,n,r,s;R?(O.logger.info("sync::onSyncDone: after sync",D.promises2cmds(R)),R=[],o=U.blacklist||[],a=U.invalidBlacklist||[],c=U.mutelist||[],u=U.invalidMutelist||[],l=U.friends,m=U.invalidFriends||[],d=U.myInfo,p=U.users,g=U.superTeams,y=U.invalidSuperTeams,f=U.teams,h=U.invalidTeams||[],v=U.sessions,b=U.msgReceipts,T=U.roamingMsgs,M=U.offlineMsgs,S=U.offlineFilterMsgs,x=U.offlineSysMsgs,C=U.offlineCustomSysMsgs,I=U.offlineFilterSysMsgs,w=U.offlineFilterCustomSysMsgs,U.broadcastMsgs,P=U.sysMsgUnread,v&&(t=[],Object.keys(v).forEach(function(e){t.push(v[e])}),v=t.sort(function(e,t){return t.updateTime-e.updateTime})),e=Promise.resolve(),_&&(r=[],s=[],T&&T.forEach(function(e){s=[].concat((0,L.default)(s),(0,L.default)(e.msgs))}),M&&M.forEach(function(e){s=[].concat((0,L.default)(s),(0,L.default)(e.msgs))}),n=A.putMsg(s),r.push(n),e=Promise.all(r).then(function(){return s}).then(function(e){var t={};e.forEach(function(e){e=e.sessionId;t[e]||(t[e]=!0,O.markUnreadByMsgsPromise(e))})})),e.then(function(){_&&!O.hasSynced&&(O.hasSynced=!0,E.syncRelations&&(i=A.getRelations().then(function(e){o=e[0],c=e[1],o.invalid=a,c.invalid=u},function(e){return e._msg="on relations error",e}).catch(function(e){return O.logger.error("sync::syncRelation: ",e),Promise.reject(e)}),R.push(i)),E.syncFriends&&(i=A.getFriends().then(function(e){(l=e).invalid=m},function(e){return e._msg="on friends error",e}).catch(function(e){return O.logger.error("sync::syncFriends: ",e),Promise.reject(e)}),R.push(i)),H(d)&&(i=A.getUser(O.account).then(function(e){d=e},function(e){return e._msg="on myInfo error",e}).catch(function(e){return O.logger.error("sync::syncMyInfo: ",e),Promise.reject(e)}),R.push(i)),E.syncFriendUsers&&(i=A.getFriends().then(function(e){return e.map(function(e){return e.account})}).then(function(e){return A.getUsers(e)}).then(function(e){p=e},function(e){return e._msg="on users error",e}).catch(function(e){return O.logger.error("sync::syncFriendUser: ",e),Promise.reject(e)}),R.push(i)),E.syncTeams&&(i=A.getTeams().then(function(e){(f=e).invalid=h},function(e){return e._msg="on teams error",e}).catch(function(e){return O.logger.error("sync::syncTeams: ",e),Promise.reject(e)}),R.push(i)),E.syncSuperTeams&&(i=A.getSuperTeams().then(function(e){(g=e).invalid=y},function(e){return e._msg="on superteams error",e}).catch(function(e){return O.logger.error("sync::syncSuperTeams: ",e),Promise.reject(e)}),R.push(i)),i=A.getTeamMembersByAccount(O.account).then(function(e){O.mergeMyTeamMembers(e)}).catch(function(e){return O.logger.error("sync::getTeamMembersByAccount: ",e),Promise.reject(e)}),R.push(i),i=A.getDonnop().then(function(e){O.mergeDonnop(e)}).catch(function(e){return O.logger.error("sync::donnop: ",e),Promise.reject(e)}),R.push(i),i=A.getSessions().then(function(e){v=e},function(e){return e._msg="on sessions error",e}).catch(function(e){return O.logger.error("sync::getSession: ",e),Promise.reject(e)}),R.push(i),i=A.getSysMsgUnread().then(function(e){P=e},function(e){return e._msg="on sysMsgUnread error",e}).catch(function(e){return O.logger.error("sync::getSysMsgUnread: ",e),Promise.reject(e)}),R.push(i));var e=R.filter(function(e){return"sessionAck"===e.cmd}),t=(0===e.length&&e.push(Promise.resolve()),R.filter(function(e){return"sessionAck"!==e.cmd}));0===t.length&&t.push(Promise.resolve()),Promise.all(t).then(function(){return Promise.all(e)}).then(j).then(N,function(e){e.callFunc="sync::onSyncDone",e.message="taskAfterSync syncDBDataPromise 出错",O.onCustomError("SYNC_SESSION_ACK_ERROR",e)})})):O.logger.warn("sync::onSyncDone: after sync --no promiseArray")}function j(){O.logger.info("sync::onSyncDone: taskAfterSync"),U.deleteMsgSysMsgs&&(r={},T&&T.forEach(function(e){r[e.sessionId]=e}),s={},M&&M.forEach(function(e){s[e.sessionId]=e}),i=O.api,U.deleteMsgSysMsgs.forEach(function(e){e.sysMsgs.forEach(function(e){var t=e.msg,n=t.sessionId;[r,s].forEach(function(e){e[n]&&(e[n].msgs=i.cutMsgs(e[n].msgs,t))})})}),A.enable||[T,M].forEach(function(e){e&&e.forEach(function(e){var t;v=e.msgs.length?(t=O.genSessionByMsgs(e.msgs),O.cacheSyncedSession(t),i.mergeSessions(v,t)):i.cutSessions(v,{id:e.sessionId})})}));var r,s,i,e=[];return e.push(O.deleteMsgOfflineRoaming(U.deleteMsgSysMsgs,v)),Promise.all(e)}function N(){setTimeout(s,0)}function s(){var t,n=[],r=[],s=(o&&(O.logger.info("sync::notifyDataAsync: on blacklist",X(o),o),E.onblacklist(o)),c&&(O.logger.info("sync::notifyDataAsync: on mutelist",X(c),c),E.onmutelist(c)),l&&(O.logger.info("sync::notifyDataAsync: on friends",X(l),l),E.onfriends(l)),d&&(O.logger.info("sync::notifyDataAsync: on myInfo",d),O.myInfo=d,E.onmyinfo(D.copy(d))),p&&(p.forEach(function(e){O.mergeUser(e)}),O.logger.info("sync::notifyDataAsync: on users",X(p),p),E.onusers(p)),f&&(O.logger.info("sync::notifyDataAsync: on teams",W(f),f),E.onteams(f)),g&&(O.logger.info("sync::notifyDataAsync: onSuperTeams",W(g),g),E.onSuperTeams(g)),(v=b&&(!O.hasSynced&&v&&v.length||O.hasSynced)?O.mergeSessionAndMsgReceipts(v,b):v)&&v.length&&(v.forEach(function(e){O.syncResult.sessions&&O.syncResult.sessions[e.id]&&"number"==typeof O.syncResult.sessions[e.id].unread&&(e.unread=O.syncResult.sessions[e.id].unread),O.mergeSession(e),V.trim(e)}),O.logger.info("sync::notifyDataAsync: on sessions",q(v),v),E.onsessions(v)),T&&T.forEach(function(e){n.push(e.timetag),(t=e.msgs).length&&(O.logger.info("sync::notifyDataAsync: on roaming msgs",e.sessionId,t.length,t),E.onroamingmsgs(e),"superTeam"===t[0].scene)&&r.push(e.timetag)}),M&&M.forEach(function(e){n.push(e.timetag),(t=e.msgs).length&&(O.logger.info("sync::notifyDataAsync: on offline msgs",e.sessionId,t.length,t),E.onofflinemsgs(e))}),S&&S.forEach(function(e){n.push(e.timetag),(t=e.msgs).length&&(O.logger.info("sync::notifyDataAsync: on offline filter msgs",e.sessionId,t.length,t),E.onofflinefiltermsgs(t))}),[]),i=[],e=(U.deleteMsgSysMsgs&&U.deleteMsgSysMsgs.forEach(function(e){"roaming"===e.type?s=s.concat(e.sysMsgs):i=i.concat(e.sysMsgs)}),s.length&&(k=(k=k||[]).concat(s)),i.length&&(x=(x=x||[]).concat(i)),k&&(O.logger.info("sync::notifyDataAsync: on roaming sys msgs",k.length,k),E.onroamingsysmsgs(k)),x&&(O.logger.info("sync::notifyDataAsync: on offline sys msgs",x.length,x),E.onofflinesysmsgs(x)),I&&(O.logger.info("sync::notifyDataAsync: on offline filter sys msgs",I.length,I),E.onofflinefiltersysmsgs(I)),C&&(O.logger.info("sync::notifyDataAsync: on offline custom sys msgs",C.length,C),E.onofflinecustomsysmsgs(C)),w&&(O.logger.info("sync::notifyDataAsync: on offline filter custom sys msgs",w.length,w),E.onofflinefiltercustomsysmsgs(w)),P&&(P=D.merge({},O.sysMsgUnread,P),O.sysMsgUnread=D.merge({},P),O.logger.info("sync::notifyDataAsync: on sysMsgUnread",P),E.onsysmsgunread(P)),O.getPushNotificationMultiportConfig());O.logger.info("sync::notifyDataAsync: on pushNotificationMultiportConfig",e),E.onPushNotificationMultiportConfig(e),n.length?(e=Math.max.apply(Math,n),O.updateRoamingMsgTimetag(e).then(F,F)):F(),r.lenth&&A.enable&&(e=Math.max.apply(Math,r),O.db.updateSuperTeamRoamingMsgTimetag(e)),O.syncPromiseArray=[],O.syncResult={}}function F(){if(O.processUnsettledMsgs(),O.processUnsettledSysMsgs(),O.syncing&&E.onsyncdone(),O.syncing=!1,E.syncTeamMembers&&f&&f.length)throw new B("sync team members api deprecated!")}R&&R.length?(0===(e=R.filter(function(e){return"sessionAck"===e.cmd})).length&&e.push(Promise.resolve()),0===(t=R.filter(function(e){return"sessionAck"!==e.cmd})).length&&t.push(Promise.resolve()),Promise.all(t).then(function(){return Promise.all(e)},function(e){e.callFunc="sync::onSyncDone",e.message="afterSync syncNormalPromise 出错",O.onCustomError("SYNC_NORMAL_ERROR",e)}).then(n,function(e){e.callFunc="sync::onSyncDone",e.message="afterSync syncSessionAckPromise 出错",O.onCustomError("SYNC_SESSION_ACK_ERROR",e)}).catch(function(e){O.syncData()})):n()},r.syncTeamMembers=function(e){this.timetags;var t={};e.forEach(function(e){t[e.teamId]=0},this),this.sendCmd("syncTeamMembers",{sync:t},this.onSyncTeamMembers.bind(this))},r.onSyncTeamMembers=function(e,t){e.callFunc="sync::onSyncTeamMembers",e.message="同步群成员错误",this.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)},r.onSyncTeamMembersDone=function(){var t,i=this,e=i.db,s=i.options,o=i.syncTeamMembersResult,n=i.syncTeamMembersPromiseArray;function r(){i.logger.log("sync::onSyncTeamMembersDone: afterSync",D.promises2cmds(n)),n=[],e.enable&&!i.hasSyncedTeamMembers?(i.hasSyncedTeamMembers=!0,s.syncTeams&&s.syncTeamMembers?e.getTeams().then(function(e){e.forEach(function(e){var s=e.teamId;t=new Promise(function(n,r){i.api.getTeamMembers({teamId:s,done:function(e,t){e&&r({callFunc:"sync::getTeamMembers: teamId-"+s,message:"sync team members error"}),o[s]=t.members||[],n()}})}),n.push(t)}),n.length?Promise.all(n).then(a,function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="pullFullData promiseArray notifyData 错误",i.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)}):a()},function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="pullFullData getTeams 错误",i.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)}):u()):a()}function a(){setTimeout(c,0)}function c(){var n,r;Object.keys(o).forEach(function(e){var t;-1===e.indexOf("invalid")&&(n=o[e],r=o[e+"-invalid"]||[],n.invalid=r,e=e,t=n,i.logger.info("sync::onSyncTeamMembersDone: onTeamMembers",e,X(t),t),s.onteammembers({teamId:e,members:t}))}),u()}function u(){i.logger.info("sync::onSyncTeamMembersDone: bingo"),s.onsyncteammembersdone(),i.syncTeamMembersResult=null,i.syncTeamMembersPromiseArray=null}n.length?Promise.all(n).then(r,function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="同步群成员 syncTeamMembersPromiseArray 错误",i.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)}).catch(function(e){i.logger.log("sync::onSyncTeamMembersDone: syncTeamMembersPromiseArray promise ",e),r()}):r()}},function(e,t,n){"use strict";var r=n(25).fn,s=n(125);r.assembleLogin=function(){var e=this.assembleIMLogin();return this.addPushInfo instanceof Function?this.addPushInfo(e):Promise.resolve({login:e})},r.afterLogin=function(){var e,t=this,n=(this.initPush instanceof Function&&this.initPush(),this.db);n.enable?(e=this.account,this.options.appendAppKeyForDBName&&(e+="-"+this.options.appKey),this.db.init(e).then(function(){t.notifyLogin(),t.syncData()},function(e){t.logger.warn("link::afterLogin: no db",e),n.reset(!1),t.notifyLogin(),t.syncData()})):(this.logger.info("link::afterLogin: no db"),this.notifyLogin(),this.syncData())},r.processAuth=function(e){switch(e.cmd){case"login":e.error||(e.content=e.content||{},this.loginAndroidPush&&this.loginAndroidPush(e.content.aosPushInfo||{}),e.obj=e.content.loginRes,this.connectionId=e.content.loginRes.connectionId,this.onLoginPortsChange(e,2));break;case"kicked":return void this.onKicked(e);case"multiPortLogin":this.onLoginPortsChange(e,e.content.state);break;case"kick":e.error||(e.obj.deviceIds=e.content.deviceIds)}},r.onLoginPortsChange=function(e,t){var n=this,e=e.content.loginPorts;if(e&&e.length){var r=!0;switch(t){case 2:r=!0;break;case 3:r=!1}e.forEach(function(e){e.type=s.reverseType(e.type),e.time=+e.time,e.online=r}),(e=e.filter(function(e){return e.connectionId!==n.connectionId})).length&&(n.logger.info("link::onLoginPortsChange:",e),n.options.onloginportschange(e))}},r.kickedReasons=["","samePlatformKick","serverKick","otherPlatformKick","silentlyKick"],r.kickedMessages=["","不允许同一个帐号在多个地方同时登录","被服务器踢了","被其它端踢了","悄悄被踢"]},function(e,t,n){"use strict";var r=n(25).fn,o=n(5),a=n(0),c=n(39);r.refreshSocketUrl=function(){var t=this,e=t.options,n=o.info,r=e.lbsUrl;function s(e){t.socketUrls=[],(e=o.isWeixinApp?e.data:JSON.parse(e)).common.link.forEach(function(e){t.socketUrls.push(o.formatSocketUrl({url:e,secure:t.options.secure}))}),e.common["link.default"].forEach(function(e){e=o.formatSocketUrl({url:e,secure:t.options.secure}),-1===t.socketUrls.indexOf(e)&&t.socketUrls.push(e)});try{o.uploadUrl=e.nosup[0]}catch(e){}o.chunkUploadUrl=o.chunkUploadUrl||e["nos-chunk"]||"",t.logger.info("link::refreshSocketUrl: ajax load, got socket urls ",t.socketUrls),t.connectToUrl(t.getNextSocketUrl())}function i(e){t.logger.error("link::refreshSocketUrl: ajax lbs error",e),t.api.reportLogs({event:"nimlb",code:3001});e=o.getDefaultLinkUrl(t.options.secure);e?(t.logger.info("link::refreshSocketUrl: use default link url",e),t.connectToUrl(e)):t.onDisconnect(!1,"link::refreshSocketUrl")}r=r+a.genUrlSep(r)+"k="+e.appKey+"&id="+e.account+"&sv="+n.sdkVersion+"&pv="+n.protocolVersion,t.logger.info("link::refreshSocketUrl: ajax "+r),o.isWeixinApp?(r=r.replace(/:\d+/,""),wx.request({url:r,success:s,fail:i})):c(r,{proxyUrl:a.url2origin(r)+"/lbs/res/cors/nej_proxy_frame.html",timeout:o.xhrTimeout,onload:s,onerror:i})}},function(e,t,n){"use strict";var r=n(52).fn,i=n(0),o=i.notundef;r.putSession=function(e){return void 0===(e=i.merge({},e)).updateTime&&e.lastMsg&&e.lastMsg.time&&(e.updateTime=e.lastMsg.time),delete e.unread,this.modifyOrPut({table:"session",obj:e,key:"id",modifyObjWhenPut:{unread:0}})},r.getSessions=function(e){var t,n=!(e=e||{}).reverse,r=e.limit||100,s=e.lastSessionId,e=e.sessionId,i=!1;if(o(s))t=function(e){return!!i||(e.id===s&&(i=!0),!1)};else if(o(e))return this.get("session",e);return this.getAll("session",{index:"updateTime",desc:n,limit:r,filter:t})},r.getSession=function(e){return this.get("session",e)},r.updateSession=function(t){var n=this,r=t.id,s=i.filterObj(t,"ack unread lastMsg localCustom msgReceiptTime msgReceiptServerTime");return Object.keys(t).forEach(function(e){0===e.indexOf("last")&&(s[e]=t[e])}),this.getOne("session",null,r,{modifyObj:s}).then(function(e){return e?n.logger.log("db::updateSession: "+r,s):n.logger.warn("db::updateSession: no record "+r),e})},r.resetSessionUnread=function(e){return this.updateSession({id:e,unread:0})},r.deleteSession=function(e){return this.remove("session",e)}},function(e,t,n){"use strict";var r=n(52).fn,o=n(0);o.notundef,r.putBroadcastMsg=function(s){var i=this;return new Promise(function(e){o.isArray(s)||(s=[s]);var t=[],n=s.length;function r(){0==--n&&e(t)}s.forEach(function(e){e=o.copy(e),i.put("broadcastMsg",e).then(function(e){t.push(e[0]),r()},r)})})},r.getBroadcastMsgs=function(e){return this.getAll("broadcastMsg",e=e||{})}},function(e,t,n){"use strict";var r=n(52).fn,c=n(0),u=c.notundef;r.putSysMsg=function(s){var i=this;return new Promise(function(e){var t,n;function r(){0==--n&&e(t)}(s=c.isArray(s)?s:[s])[0].filter||(t=[],n=s.length,s.forEach(function(e){e=c.copy(e),i.put("sysMsg",e).then(function(e){t.push(e[0]),r()},r)}))})},r.getSysMsgs=function(e){var t=!(e=e||{}).reverse,n=e.limit||100,r=null,s=null;e.category&&(r="category",s=e.category),e.type&&(r="type",s=e.type);var i,o=e.lastIdServer,a=!1,c=e.read;return e={filter:i=u(o)||u(c)?function(e){return!u(o)||(o=""+o,a)?t():(e.idServer===o&&(a=!0),!1);function t(){return!u(c)||e.read===c}}:i,desc:t,limit:n},r?this.getOnly("sysMsg",r,s,e):this.getAll("sysMsg",e)},r.getSysMsgByIdServer=function(e){return this.getOne("sysMsg","idServer",e)},r.updateSysMsg=function(e){var t,n,r=this;if(!e.filter)return t=""+e.idServer,n=c.filterObj(e,"read state error localCustom"),this.getOne("sysMsg","idServer",t,{modifyObj:n}).then(function(e){return e?r.logger.log("db::updateSysMsg: "+t,n):r.logger.warn("db::updateSession: "+t),e})},r.markSysMsgRead=function(e){var a=this;return new Promise(function(t,n){c.isArray(e)||(e=[e]);var r,s,i=[],o=[];e.forEach(function(e){r=a.getSysMsgByIdServer(e.idServer).then(function(e){e&&!e.read&&(s=a.updateSysMsg({idServer:e.idServer,read:!0}),o.push(s))},n),i.push(r)}),Promise.all(i).then(function(){Promise.all(o).then(function(e){t(e)},n)},n)})},r.deleteSysMsg=function(e){var t,n=this,r=[];return(e=c.isArray(e)?e:[e]).forEach(function(e){t=n.getOne("sysMsg","idServer",e=""+e,{remove:!0}),r.push(t)}),1===r.length?r[0]:Promise.all(r)},r.deleteAllSysMsgs=function(){var e=this.clearTable("sysMsg"),t=this.clearTable("sysMsgUnread");return Promise.all([e,t])},r.getSysMsgUnread=function(){return this.getAll("sysMsgUnread").then(function(e){var t={};return e.forEach(function(e){t[e.type]=e.num}),t})},r.updateSysMsgUnread=function(t){var e=this,n=(t=c.copy(t),[]);return Object.keys(t).forEach(function(e){n.push({type:e,num:t[e]})}),this.put("sysMsgUnread",n).then(function(){return e.logger.log("db::updateSysMsgUnread: ",t),t})}},function(e,t,n){"use strict";var r=n(52).fn,h=n(0),s=n(5);r.putMsg=function(e){return!(e=h.isArray(e)?e:[e]).length||e[0].filter?Promise.resolve():(e=e.filter(function(e){return!e.ignore}),this.put("msg1",e))},r.updateMsg=function(e){var t,n,r=this;if(!e.filter)return t=e.idClient,n=h.filterObj(e,"resend status idServer time localCustom"),r.getOne("msg1",null,t,{modifyObj:n}).then(function(e){return e?r.logger.log("db::updateMsg: "+t,n):r.logger.warn("db::updateMsg: no record "+t),e})},r.getMsgs=function(e){return s.isBrowser?this.getMsgsIndexedDB(e):s.isRN?this.getMsgsRN(e):Promise.resolve()},r.getMsgsRN=function(e){var t={};return"number"==typeof e.start&&(t.lowerBound=["time",e.start]),"number"==typeof e.end&&e.end!==1/0&&(t.upperBound=["time",e.end]),t.desc=!1,t.sortIndex="time","boolean"==typeof e.desc&&(t.desc=e.desc),"number"==typeof e.limit&&(t.limit=e.limit),t.searchIndex=[],e.sessionId&&t.searchIndex.push(["sessionId",e.sessionId]),"string"==typeof e.type&&t.searchIndex.push(["type",e.type]),this.getAll("msg1",t)},r.getMsgsIndexedDB=function(e){this.checkDB();var t="time",n=!1,r=!1,s=(e=e||{}).sessionId||[],i=e.sessionIds||[],o=(h.isString(s)?s=[s]:Array.isArray(s)||(s=[]),h.isString(i)?i=[i]:Array.isArray(i)||(i=[]),s.concat(i)),o=(1===o.length?(n=!0,t="sessionTime",s=o[0]):1<o.length&&(r=n=!0,i=o),e.start||0),a=e.end||1/0,c=o,u=a,n=(n&&!r&&(c=[s,o],u=[s,a]),!1!==e.desc),o=e.limit||100,l=!1,m=!1,d=e.type||[],p=e.types||[],s=(h.isString(d)?d=[d]:Array.isArray(d)||(d=[]),h.isString(p)?p=[p]:Array.isArray(p)||(p=[]),d.concat(p)),f=(1===s.length?(l=!0,d=s[0]):1<s.length&&(m=l=!0,p=s),e.keyword||""),g=e.filterFunc,a=void 0;return(r||l||f||h.isFunction(g))&&(a=function(e){if(r&&-1===i.indexOf(e.sessionId))return!1;if(l)if(m){if(-1===p.indexOf(e.type))return!1}else if(d!==e.type)return!1;return(!f||-1!==(e.text||e.tip||"").indexOf(f))&&(!g||g(e))}),this.server.query("msg1",t).bound(c,u,!0,!0).desc(n).limit(o).filter(a).execute()},r.getMsgCountAfterAck=function(e){return s.isBrowser?this.getMsgCountAfterAckIndexedDB(e):s.isRN?this.getMsgCountAfterAckRN(e):Promise.resolve()},r.getMsgCountAfterAckRN=function(t){var e=t=t||{},n=e.sessionId,e=e.ack;return this.checkDB(),this.getAll("msg1",{searchIndex:["sessionId",n],lowerBound:["time",e]}).then(function(e){e=e.filter(function(e){return"out"!==e.flow&&("notification"!==e.type||!!t.shouldCountNotifyUnread(e))});return Promise.resolve(e.length)})},r.getMsgCountAfterAckIndexedDB=function(t){var e=(t=t||{}).sessionId;return this.checkDB(),this.server.query("msg1","sessionTime").bound([e,t.ack],[e,1/0],!0,!0).execute().then(function(e){e=e.filter(function(e){return"out"!==e.flow&&("notification"!==e.type||!!t.shouldCountNotifyUnread(e))});return Promise.resolve(e.length)})},r.amendMsg=function(e){return e?(h.notexist(e.text)&&(e.text=""),e):null},r.getMsgByIdClient=function(e){var t=this;return t.getOne("msg1",null,e).then(function(e){return t.amendMsg(e)})},r.getMsgsByIdClients=function(e){var t,n=this,r=[];return e.forEach(function(e){t=n.getMsgByIdClient(e),r.push(t)}),Promise.all(r)},r.clearSendingMsgs=function(){var t=this;return t.getOnly("msg1","status","sending",{modifyObj:{status:"fail"}}).then(function(e){t.logger.log("db::clearSendingMsgs: msgs send failed",e)})},r.deleteMsg=function(e){var t,n=this,r=[];return(e=h.isArray(e)?e:[e]).forEach(function(e){t=n.getOne("msg1",null,e,{remove:!0}).then(function(e){return n.logger.log("db::deleteMsg:",e),e}),r.push(t)}),1===r.length?r[0]:Promise.all(r)},r.deleteMsgsBySessionId=function(e){var n=this,r=null,t=e.start,s=e.end;return void 0!==t&&void 0!==s?r=function(e){return t<e&&e<s}:void 0!==t?r=function(e){return t<e}:void 0!==s&&(r=function(e){return e<s}),r?n.getOnly("msg1","sessionId",e.sessionId).then(function(e){n.logger.log("db::deleteMsgsBySessionId: session results",e);var t=[];return(e=e||[]).map(function(e){r(e.time)&&t.push(e.idClient)}),n.deleteMsg(t)}):n.getOnly("msg1","sessionId",e.sessionId,{remove:!0})},r.deleteMsgsByTime=function(e){return this.remove("msg1",null,"time",e.start,e.end,!0,!0)},r.deleteAllMsgs=function(){var e=this.clearTable("msg1"),t=this.clearTable("session");return Promise.all([e,t])}},function(e,t,n){"use strict";var r=n(52).fn,s=n(0);r.mergeMyInfo=function(e,t){var n=this;return n.put("user",e).then(function(){return t?n.updateMyInfoTimetag(e.updateTime):e})},r.mergeFriendUsers=function(e,t){var n=this;return n.putUsers(e).then(function(){n.updateFriendUserTimetag(t)})},r.putUsers=function(e){return this.put("user",e)},r.putUser=function(e){return this.put("user",e)},r.updateUser=function(t){var n=this,r=(t=s.copy(t)).account;return this.getOne("user",null,r,{modifyObj:t}).then(function(e){return e?n.logger.log("db::updateUser: "+r,t):n.logger.warn("db::updateUser: no record "+r),e})},r.putUsersIfIsFriend=function(e){var n,r=this,s=[],i=[];return e.forEach(function(t){n=r.getFriend(t.account).then(function(e){return e&&(n=r.putUser(t),i.push(n)),e}),s.push(n)}),Promise.all(s).then(function(){return Promise.all(i).then(function(e){return e})})},r.deleteUser=function(e){return this.remove("user",e)},r.getUser=function(e){return this.getOne("user",null,e)},r.getUsers=function(t){return this.getAll("user",{filter:function(e){return-1!==t.indexOf(e.account)}})},r.getAllUsers=function(){return this.getAll("user")}},function(e,t,n){"use strict";var r=n(52).fn,o=n(0),i=n(26),s=n(189),a=n(146);function c(e){return e.valid&&e.validToCurrentUser}function u(e){return e&&e.valid}function l(e){return e&&o.fillUndef(e,{mute:!1,custom:""}),e}r.mergeSuperTeams=function(e,t,n){var r=this,s=r.put("superTeam",e),i=r.leaveTeams(t,n);return Promise.all([s,i]).then(function(){return r.logger.log("db::mergeSuperTeams:"),r.updateSuperTeamTimetag(n),[e,t,n]})},r.putSuperTeam=function(e){if(e)return(e=o.isArray(e)?e:[e]).forEach(function(e){e.validToCurrentUser=!0}),this.put("superTeam",e)},r.updateSuperTeam=function(t){var n=this,r=(t=o.copy(t)).teamId;return n.getOne("superTeam",null,r,{modifyObj:t}).then(function(e){return e?(n.logger.log("db::updateSuperTeam: "+r,t),e):(n.logger.warn("db::updateSuperTeam: no record "+r),n.putSuperTeam(t))})},r.leaveSuperTeam=function(e){var t=this;return t.updateSuperTeam({teamId:e,validToCurrentUser:!1}).then(function(){return t.removeAllSuperTeamMembers(e)})},r.dismissSuperTeam=function(e,t){var n=this;return n.updateSuperTeam({teamId:e,valid:!1,validToCurrentUser:!1,updateTime:t}).then(function(){return n.removeAllSuperTeamMembers(e)})},r.leaveSuperTeams=function(e,t){var n,r=this,s=[];return e.forEach(function(e){n=r.leaveSuperTeam(e.teamId,t),s.push(n)}),Promise.all(s)},r.getSuperTeamsByTeamIds=function(e){var t,n=this,r=[];return e.forEach(function(e){t=n.getSuperTeam(e),r.push(t)}),Promise.all(r)},r.getSuperTeam=function(e){var t=this;return t.getOne("superTeam",null,e=""+e).then(function(e){return e?(t.updateSuperTeamProperties([e]),e):null})},r.getSuperTeams=function(){var t=this;return t.getAll("superTeam",{filter:c}).then(function(e){return t.updateSuperTeamProperties(e),e})},r.updateSuperTeamProperties=function(e){e.forEach(function(e){e&&s.fillProperties(e)})},r.mergeSuperTeamMembers=function(e,t,n,r){var s=this,t=s.putSuperTeamMembers(t),n=s.updateSuperTeamMembers(n);return Promise.all([t,n]).then(function(){return s.logger.log("db::mergeSuperTeamMembers: "+e),null!=r?s.updateSuperTeamMemberTimetag(e,r):Promise.resolve()})},r.putSuperTeamMembers=function(e){return this.put("superTeamMember",e)},r.getSuperTeamMembersByAccount=function(e){return this.getOnly("superTeamMember","account",e,{filter:u,mapper:l}).then()},r.getSuperTeamMembers=function(e,t){var n=this,r=(e=""+e,{filter:function(e){return e.valid},mapper:l});if(t){if("number"!=typeof t.joinTime)return void n.logger.error("db::getSuperTeamMembers::params.joinTime should be number, not ",t.joinTime);t.limit&&(r.limit=t.limit),t.reverse?r.filter=function(e){return e.valid&&e.joinTime<=t.joinTime}:r.filter=function(e){return e.valid&&e.joinTime>=t.joinTime}}return n.getOnly("superTeamMember","teamId",e,r).then(function(e){return n.updateSuperTeamMemberProperties(e).then(function(){return e})})},r.updateSuperTeamMemberProperties=function(e){var t,n=this,r=[];return e.forEach(function(e){a.fillProperties(e)&&(t=n.updateSuperTeamMember(e),r.push(t))}),Promise.all(r)},r.getInvalidSuperTeamMembers=function(t,e){var n=this;t=""+t;var r,s=[];return e.forEach(function(e){r=n.getOne("superTeamMember","id",a.genId(t,e)).then(l),s.push(r)}),Promise.all(s)},r.updateSuperTeamMember=function(e){var t=this,n=e.teamId,r=e.account,s=a.genId(n,r),i=o.filterObj(e,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne("superTeamMember","id",s,{modifyObj:i,mapper:l}).then(function(e){return e?t.logger.log("db::updateSuperTeamMember: "+n+" "+r,i):t.logger.warn("db::updateSuperTeam: no record "+n+" "+r),e})},r.updateSuperTeamMembers=function(e){var t,n,r=this;return e.length?(n=[],e.forEach(function(e){t=r.updateSuperTeamMember(e),n.push(t)}),Promise.all(n)):Promise.resolve()},r.removeSuperTeamMembersByAccounts=function(t,e){e=e.map(function(e){return{teamId:t,account:e,valid:!1}});return this.updateSuperTeamMembers(e)},r.removeAllSuperTeamMembers=function(e){var t=this;return t.getOnly("superTeamMember","teamId",e,{modifyObj:{valid:!1}}).then(function(){return t.logger.warn("db::removeAllSuperTeamMembers: "+e),t.deleteSuperTeamMemberTimetag(e)})},r.deleteSuperTeamMembers=function(e){var t=this;return t.getOnly("superTeamMember","teamId",e,{remove:!0}).then(function(){t.logger.warn("db::deleteTeamMembers: "+e),t.deleteSuperTeamMemberTimetag(e)})},r.deleteSuperTeam=function(e){var t,r=this,s=[];return(e=o.isArray(e)?e:[e]).forEach(function(n){n=""+n,t=r.get("superTeam",n).then(function(e){if(e&&c(e))throw i.stillInTeamError({callFunc:"team::deleteTeam",team:e});var e=r.remove("superTeam",n),t=r.deleteSuperTeamMembers(n);return Promise.all([e,t])}),s.push(t)}),1===s.length?s[0]:Promise.all(s)},r.transferSuperTeam=function(e,t,n){var r=this;return r.updateSuperTeamMembers([t,n]).then(function(){return r.putSuperTeam(e).then(function(){return r.logger.log("db::transferSuperTeam: "+e.teamId+" "+t.account+" -> "+n.account),[e,t,n]})})}},function(e,t,n){"use strict";var r=n(52).fn,o=n(0),i=n(26),s=n(126),a=n(90);function c(e){return e.valid&&e.validToCurrentUser}function u(e){return e&&e.valid}function l(e){return e&&o.fillUndef(e,{mute:!1,custom:""}),e}r.mergeTeams=function(e,t,n){var r=this,s=r.put("team",e),i=r.leaveTeams(t,n);return Promise.all([s,i]).then(function(){return r.logger.log("db::mergeTeams:"),r.updateTeamTimetag(n),[e,t,n]})},r.putTeam=function(e){if(e)return(e=o.isArray(e)?e:[e]).forEach(function(e){e.validToCurrentUser=!0}),this.put("team",e)},r.updateTeam=function(t){var n=this,r=(t=o.copy(t)).teamId;return n.getOne("team",null,r,{modifyObj:t}).then(function(e){if(e)n.logger.log("db::updateTeam: "+r,t);else if(n.logger.warn("db::updateTeam: no record "+r),t.validToCurrentUser)return n.putTeam(t);return e})},r.transferTeam=function(e,t,n){var r=this,s=e.teamId,i=e.memberUpdateTime;return r.updateTeamMembers([{teamId:s,account:t,type:"normal",updateTime:i},{teamId:s,account:n,type:"owner",updateTime:i}]).then(function(){return r.putTeam(e).then(function(){return r.logger.log("db::transferTeam: "+e.teamId+" "+t+" -> "+n),[e,t,n]})})},r.leaveTeam=function(e){var t=this;return t.updateTeam({teamId:e,validToCurrentUser:!1}).then(function(){return t.removeAllTeamMembers(e)})},r.dismissTeam=function(e,t){var n=this;return n.updateTeam({teamId:e,valid:!1,validToCurrentUser:!1,updateTime:t}).then(function(){return n.removeAllTeamMembers(e)})},r.leaveTeams=function(e,t){var n,r=this,s=[];return e.forEach(function(e){n=r.leaveTeam(e.teamId,t),s.push(n)}),Promise.all(s)},r.getTeamsByTeamIds=function(e){var t,n=this,r=[];return e.forEach(function(e){t=n.getTeam(e),r.push(t)}),Promise.all(r)},r.getTeam=function(e){var t=this;return t.getOne("team",null,e=""+e).then(function(e){return e?(t.updateTeamProperties([e]),e):null})},r.getTeams=function(){var t=this;return t.getAll("team",{filter:c}).then(function(e){return t.updateTeamProperties(e),e})},r.updateTeamProperties=function(e){e.forEach(function(e){e&&s.fillProperties(e)})},r.mergeTeamMembers=function(e,t,n,r){var s=this,t=s.putTeamMembers(t),n=s.updateTeamMembers(n);return Promise.all([t,n]).then(function(){return s.logger.log("db::mergeTeamMembers: "+e),s.updateTeamMemberTimetag(e,r)})},r.putTeamMembers=function(e){return this.put("teamMember",e)},r.getTeamMembersByAccount=function(e){return this.getOnly("teamMember","account",e,{filter:u,mapper:l}).then()},r.getTeamMembers=function(e){var t=this;return t.getOnly("teamMember","teamId",e=""+e,{filter:function(e){return e.valid},mapper:l}).then(function(e){return t.updateTeamMemberProperties(e).then(function(){return e})})},r.updateTeamMemberProperties=function(e){var t,n=this,r=[];return e.forEach(function(e){a.fillProperties(e)&&(t=n.updateTeamMember(e),r.push(t))}),Promise.all(r)},r.getInvalidTeamMembers=function(t,e){var n=this;t=""+t;var r,s=[];return e.forEach(function(e){r=n.getOne("teamMember",null,a.genId(t,e)).then(l),s.push(r)}),Promise.all(s)},r.updateTeamMember=function(e){var t=this,n=e.teamId,r=e.account,s=a.genId(n,r),i=o.filterObj(e,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne("teamMember",null,s,{modifyObj:i,mapper:l}).then(function(e){return e?t.logger.log("db::updateTeamMember: "+n+" "+r,i):t.logger.warn("db::updateTeam: no record "+n+" "+r),e})},r.updateTeamMembers=function(e){var t,n,r=this;return e.length?(n=[],e.forEach(function(e){t=r.updateTeamMember(e),n.push(t)}),Promise.all(n)):Promise.resolve()},r.updateTeamManagers=function(t,e,n,r){e=e.map(function(e){return{teamId:t,account:e,type:n?"manager":"normal",updateTime:r}});return this.updateTeamMembers(e)},r.removeTeamMembersByAccounts=function(t,e){e=e.map(function(e){return{teamId:t,account:e,valid:!1}});return this.updateTeamMembers(e)},r.removeAllTeamMembers=function(e){var t=this;return t.getOnly("teamMember","teamId",e,{modifyObj:{valid:!1}}).then(function(){return t.logger.warn("db::removeAllTeamMembers: "+e),t.deleteTeamMemberTimetag(e)})},r.deleteTeamMembers=function(e){var t=this;return t.getOnly("teamMember","teamId",e,{remove:!0}).then(function(){t.logger.warn("db::deleteTeamMembers: "+e),t.deleteTeamMemberTimetag(e)})},r.deleteTeam=function(e){var t,r=this,s=[];return(e=o.isArray(e)?e:[e]).forEach(function(n){n=""+n,t=r.get("team",n).then(function(e){if(e&&c(e))throw i.stillInTeamError({callFunc:"team::deleteTeam",team:e});var e=r.remove("team",n),t=r.deleteTeamMembers(n);return Promise.all([e,t])}),s.push(t)}),1===s.length?s[0]:Promise.all(s)}},function(e,t,n){"use strict";var r=n(52).fn,s=n(0);r.mergeFriends=function(e,t,n){var r=this;return r.updateAndDelete("friend",e,t).then(function(){return r.logger.log("db::mergeFriends: updateAndDelete done",e),n&&r.updateFriendTimetag(n),[e,t,n]})},r.putFriend=function(e){return this.put("friend",e)},r.updateFriend=function(t){var n=this,r=(t=s.copy(t)).account;return this.getOne("friend",null,r,{modifyObj:t}).then(function(e){return e?n.logger.log("db::updateFriend: "+r,t):n.logger.warn("db::updateFriend: no record "+r),e})},r.deleteFriend=function(e){var t=this.remove("friend",e),e=this.deleteUser(e);return Promise.all([t,e])},r.getFriends=function(){return this.getAll("friend",{filter:function(e){return e.valid}})},r.getFriend=function(e){return this.getOne("friend",null,e)}},function(e,t,n){"use strict";var r=n(52).fn,s=n(0);r.mergeRelations=function(e,t,n,r,s){var i=this,o=i.updateAndDelete("blacklist",e,t),a=i.updateAndDelete("mutelist",n,r);return Promise.all([o,a]).then(function(){return i.logger.log("db::mergeRelations: timetag "+s),i.updateRelationTimetag(s),[e,t,n,r,s]})},r.getRelations=function(){var e=this.getAll("blacklist"),t=this.getAll("mutelist");return Promise.all([e,t])},r.markInBlacklist=function(e){var t;return(e=s.copy(e)).isAdd?(t=e.record,this.put("blacklist",t)):(t=e.account,this.remove("blacklist",t))},r.markInMutelist=function(e){var t;return(e=s.copy(e)).isAdd?(t=e.record,this.put("mutelist",t)):(t=e.account,this.remove("mutelist",t))}},function(e,t,n){"use strict";n=n(52).fn;n.getTimetags=function(e){var t={};return this.getAll("timetag",{filter:e,mapper:function(e){return-1!==e.name.indexOf("team-")?t[e.name]=0:t[e.name]=e.value,e}}).then(function(){return t})},n.getTeamMemberTimetags=function(){return this.getTimetags(function(e){return-1!==e.name.indexOf("team-")})},n.getTimetag=function(e){return this.getOne("timetag",null,e).then(function(e){return(e=e||{value:0}).value})},n.getTeamMemberTimetag=function(e){return 0},n.updateTimetag=function(e,t){return this.put("timetag",{name:e,value:t})},n.updateMyInfoTimetag=function(e){return this.updateTimetag("myInfo",e)},n.updateRelationTimetag=function(e){return this.updateTimetag("relations",e)},n.getRelationsTimetag=function(){return this.getTimetag("relations")},n.updateFriendTimetag=function(e){return this.updateTimetag("friends",e)},n.getFriendsTimetag=function(){return this.getTimetag("friends")},n.updateFriendUserTimetag=function(e){return this.updateTimetag("friendUsers",e)},n.updateTeamTimetag=function(e){return this.updateTimetag("teams",e)},n.getTeamsTimetag=function(){return this.getTimetag("teams")},n.updateSuperTeamTimetag=function(e){return this.updateTimetag("superTeams",e)},n.getSuperTeamsTimetag=function(){return this.getTimetag("superTeams")},n.updateTeamMemberTimetag=function(e,t){return this.updateTimetag("team-"+e,t)},n.getTeamMembersTimetag=function(e){return this.getTimetag("team-"+e)},n.updateSuperTeamMemberTimetag=function(e,t){return this.updateTimetag("superTeam-"+e,t)},n.getSuperTeamMembersTimetag=function(e){return this.getTimetag("superTeam-"+e)},n.updateMyTeamMembersTimetag=function(e){return this.updateTimetag("myTeamMembers",e)},n.getBroadcastMsgTimetag=function(e){return this.getTimetag("broadcastMsg")},n.updateBroadcastMsgTimetag=function(e){return this.updateTimetag("broadcastMsg",parseInt(e))},n.updateRoamingMsgTimetag=function(e){return this.updateTimetag("roamingMsgs",e)},n.updateSuperTeamRoamingMsgTimetag=function(e){return this.updateTimetag("superTeamRoamingMsgs",e)},n.updateMsgReceiptsTimetag=function(e){return this.updateTimetag("msgReceipts",e)},n.updateDonnopTimetag=function(e){return this.updateTimetag("donnop",e)},n.updateDeleteMsgTimetag=function(e){return this.updateTimetag("deleteMsg",e)},n.updateSessionAck=function(e){return this.updateTimetag("sessionAck",e)},n.deleteTimetag=function(e){return this.remove("timetag",e)},n.deleteTeamMemberTimetag=function(e){return this.deleteTimetag("team-"+e)},n.deleteSuperTeamMemberTimetag=function(e){return this.deleteTimetag("superTeam-"+e)}},function(e,t,n){"use strict";n=n(52).fn;n.setKey=function(e,t){return this.put("kv",{key:e,value:t})},n.getKey=function(e){return this.get("kv",e).then(function(e){return e&&e.value})},n.setDonnop=function(e){return this.setKey("donnop",e)},n.getDonnop=function(){return this.getKey("donnop")}},function(e,t,n){"use strict";var r={version:9},s={kv:{key:{keyPath:"key"}},timetag:{key:{keyPath:"name"}},blacklist:{key:{keyPath:"account"}},mutelist:{key:{keyPath:"account"}},friend:{key:{keyPath:"account"}},user:{key:{keyPath:"account"}},team:{key:{keyPath:"teamId"}},teamMember:{key:{keyPath:"id"},indexes:{teamId:{unique:!1},account:{unique:!1}}},superTeam:{key:{keyPath:"teamId"}},superTeamMember:{key:{keyPath:"id"},indexes:{teamId:{unique:!1},account:{unique:!1},id:{unique:!1}}},msg:{key:{autoIncrement:!0},indexes:{idClient:{unique:!0},sessionId:{unique:!1},time:{unique:!1},type:{unique:!1},sessionType:{unique:!1},status:{unique:!1},sessionTime:{key:["sessionId","time"],unique:!1}}},msg1:{key:{keyPath:"idClient"},indexes:{sessionId:{unique:!1},time:{unique:!1},status:{unique:!1},sessionTime:{key:["sessionId","time"],unique:!1}}},broadcastMsg:{key:{keyPath:"broadcastId"},indexes:{time:{unique:!1}}},sysMsg:{key:{autoIncrement:!0},indexes:{idServer:{unique:!0},category:{unique:!1},type:{unique:!1}}},sysMsgUnread:{key:{keyPath:"type"}},session:{key:{keyPath:"id"},indexes:{updateTime:{unique:!1}}}};r.keyPath=function(e){return s[e].key.keyPath},r.schema=function(){return window._nimForceSyncIM=!0,s},e.exports=r},function(u,d,p){"use strict";!function(e){var t,v,n,S,k,l,r,i,s,o=p(9),x=o&&o.__esModule?o:{default:o};function a(){if(n=n||t.indexedDB||t.webkitIndexedDB||t.mozIndexedDB||t.oIndexedDB||t.msIndexedDB||(null===t.indexedDB&&t.shimIndexedDB?t.shimIndexedDB:v))return n;throw"IndexedDB required"}function C(e){return e}function I(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function w(e){return"function"==typeof e}function P(e){return e===v}function c(d,e){var a=this,p=!1;this.name=e,this.getIndexedDB=function(){return d},this.add=function(e){if(p)throw"Database has been closed";for(var n=[],t=0,r=0;r<arguments.length-1;r++)if(Array.isArray(arguments[r+1]))for(var s=0;s<arguments[r+1].length;s++)n[t]=arguments[r+1][s],t++;else n[t]=arguments[r+1],t++;var i=d.transaction(e,k),o=i.objectStore(e);return new Promise(function(e,t){n.forEach(function(n){var e=n.item&&n.key?(e=n.key,n=n.item,o.add(n,e)):o.add(n);e.onsuccess=function(e){var e=e.target,t=e.source.keyPath;null===t&&(t="__id__"),Object.defineProperty(n,t,{value:e.result,enumerable:!0})}}),i.oncomplete=function(){e(n,a)},i.onerror=function(e){e.preventDefault(),t(e)},i.onabort=function(e){t(e)}})},this.updateAndDelete=function(e,n,r){if(p)throw"Database has been closed";var s=d.transaction(e,k),i=s.objectStore(e),o=i.keyPath;return new Promise(function(e,t){n.forEach(function(e){var t;e.item&&e.key?(t=e.key,e=e.item,i.put(e,t)):i.put(e)}),r.forEach(function(e){i.delete(e[o])}),s.oncomplete=function(){e([n,r])},s.onerror=function(e){t(e)}})},this.update=function(e){if(p)throw"Database has been closed";for(var t,n=[],r=1;r<arguments.length;r++)t=arguments[r],Array.isArray(t)?n=n.concat(t):n.push(t);var s=d.transaction(e,k),i=s.objectStore(e);return i.keyPath,new Promise(function(e,t){n.forEach(function(e){var t=e.item&&e.key?(t=e.key,e=e.item,i.put(e,t)):i.put(e);t.onsuccess=function(e){},t.onerror=function(e){}}),s.oncomplete=function(){e(n,a)},s.onerror=function(e){t(e)},s.onabort=function(e){t(e)}})},this.remove=function(e,s,i,o,a,c,u){if(p)throw"Database has been closed";var l=d.transaction(e,k),m=l.objectStore(e);return new Promise(function(e,t){function n(e){return e===v||null===e}var r;n(o)&&(o=-1/0),n(a)&&(a=1/0),null===s||Array.isArray(s)||(s=[s]),n(i)?null!==s?s.forEach(function(e){m.delete(e)}):m.delete(range=S.bound(o,a,c,u)):(r=void 0,r=null!==s?S.only(s[0]):S.bound(o,a,c,u),m.index(i).openCursor(r).onsuccess=function(e){e=e.target.result;e&&(e.delete(),e.continue())}),l.oncomplete=function(){e()},l.onerror=function(e){t(e)},l.onabort=function(e){t(e)}})},this.clear=function(e){if(p)throw"Database has been closed";var n=d.transaction(e,k);return n.objectStore(e).clear(),new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(e){t(e)}})},this.close=function(){p||(d.close(),p=!0,delete i[e])},this.get=function(e,t){if(p)throw"Database has been closed";var r=d.transaction(e),s=r.objectStore(e).get(t);return new Promise(function(t,n){s.onsuccess=function(e){t(e.target.result)},r.onerror=function(e){n(e)}})},this.query=function(e,t){if(p)throw"Database has been closed";return new r(e,d,t)},this.count=function(e,t){if(p)throw"Database has been closed";d.transaction(e).objectStore(e)};for(var t=0,n=d.objectStoreNames.length;t<n;t++)!function(n){for(var e in a[n]={},a)l.call(a,e)&&"close"!==e&&(a[n][e]=function(t){return function(){var e=[n].concat([].slice.call(arguments,0));return a[t].apply(a,e)}}(e))}(d.objectStoreNames[t])}function m(e,t,n,r){var e=e.target.result,s=new c(e,t);return i[t]=e,Promise.resolve(s)}t=window,S=(t=void 0!==t?t:"undefined"!=typeof self?self:void 0!==e?e:{}).IDBKeyRange||t.webkitIDBKeyRange,k="readwrite",l=Object.prototype.hasOwnProperty,r=function(g,h,y){function t(e,t){var n="next",r="openCursor",s=[],i=null,o=C,a=!1,c=function(){return M(e,t,r,a?n+"unique":n,i,s,o)},u=function(){return n=null,r="count",{execute:c}},l=function e(){var t;return 1==(i="array"===I(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments,0,2)).length&&i.unshift(0),t=i[1],"number"!==I(t)&&(i=null),{execute:c,count:u,keys:m,filter:d,asc:p,desc:f,distinct:g,modify:h,limit:e,map:y,remove:v}},m=function e(t){return(t=!!P(t)||!!t)&&(r="openKeyCursor"),{execute:c,keys:e,filter:d,asc:p,desc:f,distinct:g,modify:h,limit:l,map:y,remove:v}},d=function e(){return s.push(Array.prototype.slice.call(arguments,0,2)),{execute:c,count:u,keys:m,filter:e,asc:p,desc:f,distinct:g,modify:h,limit:l,map:y,remove:v}},p=function e(t){return t=!!P(t)||!!t,n=t?"next":"prev",{execute:c,count:u,keys:m,filter:d,asc:e,desc:f,distinct:g,modify:h,limit:l,map:y,remove:v}},f=function e(t){return t=!!P(t)||!!t,n=t?"prev":"next",{execute:c,count:u,keys:m,filter:d,asc:p,desc:e,distinct:g,modify:h,limit:l,map:y,remove:v}},g=function e(t){return t=!!P(t)||!!t,a=t,{execute:c,count:u,keys:m,filter:d,asc:p,desc:f,distinct:e,modify:h,limit:l,map:y,remove:v}},h=function e(t){return b=t,{execute:c,count:u,keys:m,filter:d,asc:p,desc:f,distinct:g,modify:e,limit:l,map:y,remove:v}},y=function e(t){return w(t)&&(o=t),{execute:c,count:u,keys:m,filter:d,asc:p,desc:f,distinct:g,modify:h,limit:l,map:e,remove:v}},v=function e(t){return t=!!P(t)||!!t,T=t,{execute:c,count:u,keys:m,filter:d,asc:p,desc:f,distinct:g,modify:h,limit:l,map:y,remove:e}};return{execute:c,count:u,keys:m,filter:d,asc:p,desc:f,distinct:g,modify:h,limit:l,map:y,remove:v}}var n=this,b=!1,T=!1,M=function(c,u,l,m,d,p,f){return new Promise(function(e,t){var n=b||T?k:"readonly",n=h.transaction(g,n),r=n.objectStore(g),r=y?r.index(y):r,s=c?S[c].apply(null,u):null,i=[],s=[s],o=0,a=(d=d||null,p=p||[],"count"!==l&&s.push(m||"next"),!!b&&Object.keys(b));r[l].apply(r,s).onsuccess=function(e){var t,n,e=e.target.result;(void 0===e?"undefined":(0,x.default)(e))===(0,x.default)(0)?i=e:e&&(null!==d&&d[0]>o?(o=d[0],e.advance(d[0])):null!==d&&o>=d[0]+d[1]||(t=!0,n="value"in e?e.value:e.key,p.forEach(function(e){e&&e.length&&(2===e.length?t=t&&n[e[0]]===e[1]:w(e[0])&&(t=t&&e[0].apply(v,[n])))}),t&&(o++,i.push(f(n)),T?e.delete():b&&(n=function(e){for(var t=0;t<a.length;t++){var n=a[t],r=b[n];r instanceof Function&&(r=r(e)),e[n]=r}return e}(n),e.update(n))),e.continue()))},n.oncomplete=function(){e(i)},n.onerror=function(e){t(e)},n.onabort=function(e){t(e)}})};"only bound upperBound lowerBound".split(" ").forEach(function(e){n[e]=function(){return new t(e,arguments)}}),this.filter=function(){var e=new t(null,null);return e.filter.apply(e,arguments)},this.all=function(){return this.filter()}},i={},s={version:"0.10.2",open:function(u){var e;return new Promise(function(t,n){if(i[u.server])m({target:{result:i[u.server]}},u.server,u.version,u.schema).then(t,n);else{try{e=a().open(u.server,u.version)}catch(e){n(e)}e.onsuccess=function(e){m(e,u.server,u.version,u.schema).then(t,n)},e.onupgradeneeded=function(e){var t,n=e,r=u.schema,s=e.target.result;for(t in r="function"==typeof r?r():r){var i,o=r[t],a=!l.call(r,t)||s.objectStoreNames.contains(t)?n.currentTarget.transaction.objectStore(t):s.createObjectStore(t,o.key);for(i in o.indexes){var c=o.indexes[i];try{a.index(i)}catch(n){a.createIndex(i,c.key||i,Object.keys(c).length?c:{unique:!1})}}}},e.onerror=function(e){n(e)}}})},remove:function(s){return new Promise(function(t,n){if(!s)return t();var e,r;(e="string"==typeof(s=(void 0===s?"undefined":(0,x.default)(s))===c?s.name:s)?i[s]:e)&&"function"==typeof e.close&&e.close();try{r=a().deleteDatabase(s)}catch(e){n(e)}r.onsuccess=function(e){delete i[s],t(s)},r.onerror=function(e){n(e)},r.onblocked=function(e){n(e)}})}},void 0!==u&&void 0!==u.exports?u.exports=s:(o=function(){return s}.call(d,p,d,u))!==v&&(u.exports=o)}.call(this,p(33))},function(e,t,n){"use strict";var r=n(21),o=n(70),s=n(464),a=n(463),c=n(0),i=n(190),n=n(26),u=n.newSupportDBError,l=n.noDBError,m=!1;function d(e){m=e,i.set("db",e,s)}if(d(!!c.getGlobal().indexedDB),"IE"===r.name&&d(!1),"Microsoft Edge"===r.name&&d(!1),"Safari"===r.name){try{parseInt(r.version.split(".")[0],10)<10&&d(!1)}catch(e){}d(!1)}function p(e){this.concurrency=0,this.pendingTasks=[],this.queue=Promise.resolve(),this.logger=e.logger}n=p.prototype;n.reset=c.emptyFunc,m&&(n.reset=function(e){this.enable=!1!==e}),n.addTask=function(s){var i=this;return new Promise(function(t,n){function r(e){i.concurrency--;var t=i.pendingTasks.shift();t&&i.addTask(t),e()}if(i.concurrency<100)return i.concurrency++,s().then(function(e){r(function(){t(e),s.resolve&&s.resolve(e)})},function(t){r(function(){var e={event:(t=t||{}).event||t,callFunc:t.callFunc||"db::addTask"};n(e),s.reject&&s.reject(e)})});s.resolve||(s.resolve=t,s.reject=n),i.pendingTasks.push(s)})},n.init=function(e){var t=this;return t.addTask(function(){return t.enable?t.server?Promise.resolve():(t.name="nim-"+e,s.open({server:t.name,version:a.version,schema:a.schema}).then(function(e){t.logger.log("db::init: "+t.name),t.server=e},function(e){throw d(!1),t.server=null,t.name=null,e})):Promise.reject(u({callFunc:"db::init"}))})},n.destroy=function(){var e=this;return e.addTask(function(){return e.enable?e.server?s.remove(e.name).then(function(){e.logger.log("db::destroy: "+e.name),e.server=null,e.name=null}):Promise.resolve():Promise.reject(u({callFunc:"db::destroy"}))})},n.clear=function(){var n=this;return n.addTask(function(){return n.enable?n.server?n.server.clear("timetag").then(function(){var e=[].slice.call(n.server.getIndexedDB().objectStoreNames),t=[];if(e.forEach(function(e){t.push(n.server.clear(e))}),t.length)return Promise.all(t).then(function(){n.logger.log("db::clear: "+n.name)}).catch(function(e){return n.logger.error("db::clear: ",e),Promise.reject(e)})}):Promise.resolve():Promise.reject(u({callFunc:"db::clear"}))})},n.close=function(){this.server&&(this.server.close(),this.server=null,this.name=null)},n.remove=function(e,t,n,r,s,i,o){var a=this;return a.addTask(function(){return a.checkDB(),a.server.remove(e,t,n,r,s,i,o).then(function(){a.logger.log("db::delete: "+e+" "+(t||n))}).catch(function(e){a.logger.error("db::remove::server.remove error",e)})})},n.put=function(s,e){var i=this;return i.addTask(function(){return i.checkDB(),c.isArray(e)||(e=[e]),i.server.update(s,e).then(function(e){var t=["put",s],n=a.keyPath(s),r=[];return n&&(e.forEach(function(e){r.push(o(e,n))}),t.push(1===r.length?r[0]:r)),t.push(1===e.length?e[0]:e),t.unshift("db::put:"),i.logger.log.apply(i.logger.log,t),e})})},n.get=function(e,t){var n=this;return n.addTask(function(){return n.checkDB(),n.server.get(e,t)})},n.modifyOrPut=function(e){var t=this,n=e.table,r=c.copy(e.obj),s=e.key,i=e.modifyObjWhenPut,e=c.copy(r);return delete e[s],t.getOne(n,null,r[s],{modifyObj:e}).then(function(e){return e?(t.logger.log("db::modifyOrPut: update table "+n,r),e):(r=c.merge(r,i),t.put(n,r).then(function(e){return e[0]}))})},n.updateAndDelete=function(e,t,n){var r=this;return r.addTask(function(){return r.checkDB(),r.server.updateAndDelete(e,t,n)})},n.getAll=function(e,t){var n=this;return n.addTask(function(){return n.checkDB(),(t=t||{}).keys=!0===t.keys,t.desc=!0===t.desc,t.distinct=!0===t.distinct,n.server.query(e,t.index).filter(t.filter).keys(t.keys).desc(t.desc).limit(t.limit).distinct(t.distinct).map(t.mapper).modify(t.modifyObj).execute()})},n.getOnly=function(e,t,n,r){var s=this;return s.addTask(function(){return s.checkDB(),(r=r||{}).keys=!0===r.keys,r.desc=!0===r.desc,r.distinct=!0===r.distinct,r.remove=!0===r.remove,s.server.query(e,t).only(n).filter(r.filter).keys(r.keys).desc(r.desc).limit(r.limit).distinct(r.distinct).map(r.mapper).modify(r.modifyObj).remove(r.remove).execute()})},n.getOne=function(){return this.getOnly.apply(this,arguments).then(function(e){return e[0]})},n.clearTable=function(e){var t=this;return t.addTask(function(){return t.checkDB(),t.server.clear(e)})},n.checkDB=function(){if(!this.enable)throw u({callFunc:"db::checkDB"});if(!this.server)throw l({callFunc:"db::checkDB"})},e.exports=p},function(e,t,n){"use strict";n(154);var r=n(29);n(185)(r),e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(154);var r={NIM:n(466),Chatroom:n(402)};n(185)(r),e.exports=r}])}),!function(y){function N(){y.ajax({url:window._XHLURL.USERCHAT+"/cors/userchat.html?v=20200421",type:"get",async:!0,success:function(e){var n;y("body").append(e),localStorage.setItem("xhlWindowClick","0"),"zh"!==(I=-1<(I=-1<(I=-1<(I=-1<(I=-1<(I=(navigator.language||navigator.browserLanguage).toLowerCase()).indexOf("cn")?"zh_cn":I).indexOf("en")?"en":I).indexOf("ru")?"ru":I).indexOf("tw")?"zh-tw":I).indexOf("fr")?"fr":I)&&"zh-sg"!==I&&"zh-hk"!==I||(I="zh_cn"),y.ajax({url:window._XHLURL.cn_SERVERPORT+"/cuss-login/translate/getConfigOrBrowserLanguageForChat",type:"post",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify({orgId:_XHL.a[0][1],websiteLanguageParam:_XHL.a[0][2]||"",browserLangageParam:I}),success:function(e){var t;"1"===e.code&&(t=e.data,w=w.concat(t.languagePack),_XHL.a[0][2]&&"埋点配置了语言参数，直接返回"===e.message?(I=_XHL.a[0][2],Se()):1===t.language?(I=t.list[0],Se()):0===t.language&&(-1===t.list.indexOf(I)&&(I="en"),Se()))}}),_XHL.a.openChat=function(){a()||(y(".xhl-notification-badge").addClass("xhl-hidden"),y(".xhl-notification-badge-text").attr("name",0).text(""),T.mysdk.resetSessionUnread()),y(".xhl-launch-button.xhl-size-md").attr({"aria-hiden":"true",tabindex:"-1"}).addClass("xhl-hidden"),y("#xhl-container").removeClass("xhl-hidden"),y("#xhl-container [tabindex][aria-hidden]").attr({"aria-hiden":"false",tabindex:"0"})},y(".xhl-launch-button").click(function(e){e.stopPropagation(),Te()}),y(".xhl-top-bar").click(function(){ge&&m("isFBMessenger"),y(".xhl-launch-button.xhl-size-md").attr({"aria-hiden":"false",tabindex:"0"}).removeClass("xhl-hidden"),y("#xhl-container").addClass("xhl-hidden"),y("#xhl-container [tabindex][aria-hidden]").attr({"aria-hiden":"true",tabindex:"-1"}),clearInterval(h),E(),y("#xhl-one").hide(),y("#xhl-second").hide()}),y("#FacebookMessengerLink").click(function(){var e;y(".xhl-top-bar").click(),ge&&(m("isFBMessenger")||(e=y(".xhl-launch-button").attr("style"),y(".xhl-launch-button").attr("style","right: 100px !important;"+e||"")),document.cookie="isFBMessenger="+escape("true")+";path=/",y("#fb-root").show(),a()||y(".xhl-launch-button").removeClass("xhl-launch-button-bottom"))}),y(".xhl-contact-btn").click(function(){y(".xhl-chat-poptip").hide(),y(".xhl-notification-badge").addClass("xhl-hidden"),y(".xhl-notification-badge-text").attr("name",0).text("");var e=(new Date).getTime();T.mysdk.resetSessionUnread(),localStorage.setItem("xhlWindowClick","reset"+e),y("#xhl-one").hide(),y("#xhl-second").hide(),y("#xhl-container").removeClass("xhl-hidden"),y(".xhl-launch-button").addClass("xhl-hidden")}),y(".xhl-cancel-btn").click(function(){y("#xhl-one").hide(),y("#xhl-second").hide(),clearInterval(h),E()}),y(".xhl-dialog-close").click(function(){y("#xhl-one").hide(),y("#xhl-second").hide(),clearInterval(h),E()}),y(".xhl-poptip-close").click(function(e){e.stopPropagation(),Te()}),a()?window.addEventListener("resize",ve(be,1e3)):(n=y(window).height(),window.addEventListener("resize",function(){var e=y(window).height(),t=(y("#messageText").bind("focus",function(){e<n&&y("#xhl-container").height(e+"px")}).bind("blur",function(){y("#xhl-container").css({position:"fixed",bottom:"0"})}),y(document.activeElement));t.hasClass("xhl-chat-input")&&(t=t.closest("#xhl-container"))&&!t.hasClass("xhl-hidden")&&(t=t.find(".xhl-message-block-container").get(0))&&t.scrollIntoView&&t.scrollIntoView(!1)})),m("_xhlMatomoSiteId")?(ge=!0,y(".xhl-footer-form-container").css("cssText","bottom: 35px !important;"),"true"===m("isFBMessenger")?y(".xhl-launch-button").attr("style","right: 100px !important;"):y("#fb-root").hide()):y("#FacebookMessengerLink").hide(),m("_xhlMatomoWASiteId")?(e=function(e){var t=navigator.language,n=window.location.origin;switch(t){case"zh-CN":case"zh-TW":case"zh-HK":return"嗨，我在 "+n+"/?v="+e+" 找到了您的 WhatsApp，我想了解更多信息";case"ru":return"Привет, я нашел ваш WhatsApp на "+n+"/?v="+e+" , и я хочу узнать больше";case"fr":return"Bonjour, j'ai trouvé votre WhatsApp sur "+n+"/?v="+e+" , et je veux en savoir plus";case"de":return"Hallo, ich habe Ihre WhatsApp unter "+n+"/?v="+e+" gefunden und möchte weitere Informationen erhalten";case"es":return"Hola, encontré tu WhatsApp en "+n+"/?v="+e+" , y quiero saber más información";case"ja":return"こんにちは、"+n+"/?v="+e+" でWhatsAppを見つけました。詳細を知りたいです。";case"ar":return"مرحبًا ، لقد وجدت تطبيق WhatsApp الخاص بك على "+n+"/?v="+e+" ، وأريد معرفة المزيد من المعلومات";default:return"Hi, I found your WhatsApp on "+n+"/?v="+e+" , and I want to know more information"}}(p()),e="https://wa.me/+"+m("_xhlMatomoWASiteId")+"/?text="+e,y("#WhatsAppLink").attr("href",e)):y("#WhatsAppLink").hide()}})}n=document.createElement("link"),t=document.getElementsByTagName("head")[0],n.async=!0,n.rel="stylesheet",n.href=window._XHLURL.USERCHAT+"/css/userbase.css?v=20210421",t.appendChild(n),(n=document.createElement("link")).async=!0,n.rel="stylesheet",n.href=window._XHLURL.USERCHAT+"/font/iconfont.css",t.appendChild(n),window.CONFIG={appkey:"216ec91d0f9c962dd8134033c9a5aa22",url:"https://apptest.netease.im"},window.CONFIG.openSubscription=!0;var e=X("visitorId"),c=X("gclid"),t=function(){m("_xhlufirstvisit")&&"undefined"!=m("_xhlufirstvisit")?1==m("_xhlufirstvisit")?m("_xhlufirstvisitstate")||v("_xhlufirstvisit",2):m("_xhlufirstvisit"):(v("_xhlufirstvisit",1),document.cookie="_xhlufirstvisitstate="+escape(1)+";path=/");var e={};document&&(e.url=document.URL||"",e.title=document.title||"",e.visitSource=document.referrer||"");window&&window.screen&&(e.screen=window.screen.width+"*"+window.screen.height||0,e.screenResolution=window.screen.colorDepth||0);navigator&&(e.lang=navigator.language||"");return e.isFirstVisit=m("_xhlufirstvisit"),e}(),n=function(){var e,t,n={},r=navigator.userAgent.toLowerCase();for(t in(e=(e=r.match(/rv:([\d.]+)\) like gecko/))||r.match(/msie ([\d.]+)/))?n.ie=e[1]:(e=r.match(/firefox\/([\d.]+)/))?n.firefox=e[1]:(e=r.match(/chrome\/([\d.]+)/))?n.chrome=e[1]:(e=r.match(/opera.([\d.]+)/))?n.opera=e[1]:(e=r.match(/version\/([\d.]+).*safari/))&&(n.safari=e[1]),n)n.browserName=t,n.version=n[t];return n}(),F=function(){var e,t=-1!=navigator.userAgent.indexOf("Windows",0)?1:0,n=-1!=navigator.userAgent.indexOf("Mac",0)?1:0,r=-1!=navigator.userAgent.indexOf("Linux",0)?1:0,s=-1!=navigator.userAgent.indexOf("X11",0)?1:0,i=-1!=navigator.userAgent.indexOf("iPhone ",0)?1:0,o=-1!=navigator.userAgent.indexOf("Android ",0)?1:0,a=-1!=navigator.userAgent.indexOf("IPad ",0)?1:0;t?e="Windows":o?e="Android":i?e="iPhone":a?e="IPad":n?e="Mac":r?e="Lunix":s&&(e="Unix");return e}(),L=(x=(new Date).getTimezoneOffset(),L=x<0?"+":"-",x=Math.abs(x),"GTM"+L+(Math.floor(x/60)<10?"0":" ")+Math.floor(x/60)+":"+(x%60==0?"00":x%60)),u={},l=p(!0),D="";function B(){y.ajax({url:window._XHLURL.SERVERPORT+"/server/getDateTime",type:"post",dataType:"json",async:!1,success:function(e){var t=Math.floor(90*Math.random())+10,e=[u.enterpriseId,"FK",e,t].join("");v("_xhluvisitorid",e),q(e)}})}function H(){e&&e!==l?(v("_xhluvisitorid",e),q(e)):!l||-1===l.indexOf(u.enterpriseId+"FK")?B():q(l)}function q(e){var r,s,i,t,n,o;function a(){dataLayer.push(arguments)}e.trim()?(v("_xhluvisitorid",D=e),u.visitorId=e,1e4==_XHL.a[0][1]?u.visitorName=m("userName")+"("+m("enterpriseId")+")":l===u.visitorId&&m("_xhluinfodone")===u.visitorId&&W(e,"",0),window.VISITORBASICINFO=u,t=window,n=document,t[o="dataLayer"]=t[o]||[],t[o].push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),t=n.getElementsByTagName("script")[0],(o=n.createElement("script")).async=!0,o.src="https://www.googletagmanager.com/gtm.js?id=GTM-N27CXKS",t.parentNode.insertBefore(o,t),n=m("_xhlMatomoSiteId"),o=p(),n&&(n='<div id="fb-root"></div>\n<script>window.fbAsyncInit = function() {FB.init({xfbml: true,version: "v3.3"});};(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "https://connect.facebook.net/en_US/sdk/xfbml.customerchat.js";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));<\/script>\n<div class="fb-customerchat" attribution=setup_tool page_id="'+n+'" ref="'+o+'"></div>',y("body").append(n)),t=u,(o=JSON.parse(localStorage.getItem("_xUserInfo")||'""')||{}).baseinfo=t,o.track=o.track||[],20<=o.track.length&&o.track.splice(20),(n={}).title=t.title,n.url=t.url,n.time=new Date,o.track[0]?o.track[0].url!==n.url&&(new Date(o.track[0].time),o.track.unshift(n)):o.track.unshift(n),localStorage.setItem("_xUserInfo",JSON.stringify(o)),N(),t=e,c&&(n=m("urlGclid"),c!==n)&&(v("urlGclid",c),y.ajax({url:window._XHLURL.SERVERPORT+"/visitortrace/saveGoogleInfo",type:"post",dataType:"json",data:{visitorId:t,enterpriseId:_XHL.a[0][1],gclid:c,url:window.location.href},success:function(e){}})),r=e,s=30,i=window.setInterval(function(){var t=m("_ga");if(t){var n=[];try{n=JSON.parse(m("gaSaved"))||[]}catch(e){}-1===n.indexOf(t)&&y.ajax({url:window._XHLURL.SERVERPORT+"/oversea/analytics/saveGaVisitorRelation",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({orgId:_XHL.a[0][1],gaId:t,visitorId:r,domainName:window.location.host}),success:function(e){!e||"1"!==e.code&&"-101"!==e.code||(n.push(t),v("gaSaved",JSON.stringify(n)))}})}s--,!t&&s||window.clearInterval(i)},300),o=_XHL.a[0][1],n=u.visitorId,window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","UA-124614447-1",{custom_map:{dimension1:"CompanyId",dimension2:"VisitorId"}}),a("event","LCView",{CompanyId:o,VisitorId:n})):setTimeout(H,300)}function X(e){e=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),e=window.location.search.substr(1).match(e);return null!=e?unescape(e[2]):null}function W(e,t,n){y.ajax({url:window._XHLURL.SERVERPORT+"/server/enterpriseVisitor",type:"post",dataType:"json",data:{enterpriseId:_XHL.a[0][1],visitorId:e},success:function(e){e.code&&0==e.code||(window.XHL_countryCode=e.ipLocationCode,window.XHL_country=e.ipLocation),1===n&&J(t)}})}function V(e){window.XHL_countryCode&&window.XHL_country?J(e):W(p(),e,1)}function J(e){var t="in"===e.flow?"server":"client";y.ajax({url:window._XHLURL.SERVERPORT+"/piwik/chatMatomoVisit/save",type:"post",data:{orgId:_XHL.a[0][1],msgId:e.idClient,msgType:t,sessionId:e.sessionId,currentUrl:window.location.href,visitorId:p(),countryCode:window.XHL_countryCode,country:window.XHL_country}})}function v(e,t){var n=new Date;n.setTime(n.getTime()+2592e9),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString()+";path=/"}function m(e){var e=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(e=document.cookie.match(e))?unescape(e[2]):null}function p(e){if(!e)return D;for(var t=document.cookie.split(";"),n=null,r=0;r<t.length;r++){var s=t[r];if(-1<s.indexOf("_xhluvisitorid")&&!function(e){var t,n=e.substr(-1,6);for(t in n){var r=n.charCodeAt(t);if(65<=r&&r<=90||97<=r&&r<=122)return 1}return}(n=s.split("=")[1]))return unescape(n)}return n}window.XHL_countryCode="",window.XHL_country="",u.gclid=c,u.title=t.title,u.url=t.url,u.visitSource=t.visitSource,u.screen=t.screen,u.screenResolution=t.screenResolution,u.lang=t.lang,u.isFirstVisit=t.isFirstVisit,u.browser=n.browserName,u.browserVersion=n.version,u.os=F,u.timeZone=L,u.enterpriseId=_XHL.a[0][1],H(),Function.prototype.bind||(Function.prototype.bind=function(){var e=this,t=Array.prototype.slice.call(arguments),n=t.shift();return function(){return e.apply(n,t.concat(Array.prototype.slice.call(arguments)))}});function z(n,e){return e=""+e,n&&e?e.replace(n.r,function(e){var t=n[n.i?e:e.toLowerCase()];return null!=t?t:e}):e||""}$=/<br\/?>$/,G={r:/\<|\>|\&|\r|\n|\s{2}|\'|\"/g,"<":"&lt;",">":"&gt;","&":"&amp;","  ":" &nbsp;",'"':"&quot;","'":"&#39;","\n":"<br/>","\r":""};var $,G,i=function(e){return(e=z(G,e)).replace($,"<br/><br/>")};function K(e){var t="",n=e.file?i(e.file.url):"",r="in"===e.flow?"收到":"发送";switch(e.type){case"text":t=(t=i(e.text)).replace(/((https|http):\/\/[\S.\/]+)(?![^<]+>)/gi,"<a href='$1' target='_blank'>$1</a>");break;case"image":t=-1===e.status?"<p>["+e.message.message+"]</p>":(e.file.url=i(e.file.url),s=e.file.name?"&download="+encodeURIComponent(e.file.name):"",'<a href="'+e.file.url+"?imageView"+s+'" target="_blank"><img onload="_XHL.loadImg()" data-src="'+e.file.url+'" src="'+e.file.url+"?imageView"+s+'&thumbnail=200x0&quality=85" style="max-width: 100%"/></a>');break;case"file":t=-1===e.status?"<p>["+e.message.message+"]</p>":/png|jpg|bmp|jpeg|gif/i.test(e.file.ext)?(e.file.url=i(e.file.url),'<a class="f-maxWid" href="'+e.file.url+'?imageView" target="_blank"><img data-src="'+e.file.url+'" src="'+e.file.url+'?imageView&thumbnail=200x0&quality=85" style="max-width: 100%"/></a>'):'<a href="'+(n+=e.file?"&download="+encodeURI(i(e.file.name)):"")+'" target="_blank" class="download-file f-maxWid"><span class="icon icon-file2"></span>'+i(e.file.name)+"</a>";break;case"tip":t=e.tip;break;case"video":t='<video src= "'+n+'" controls>您的浏览器不支持 video 标签。</video>';break;case"audio":t=window.Audio?e.from===b&&e.from!==e.to?'<div class="u-audio j-mbox right"> <a href="javascript:;" class="j-play playAudio" data-dur="'+e.file.dur+'"  data-src="'+n+'">点击播放</a><b class="j-duration">'+Math.floor(e.file.dur/1e3)+'"</b><span class="u-icn u-icn-play" title="播放音频"></span></div>':'<div class="u-audio j-mbox left"> <a href="javascript:;" class="j-play playAudio" data-dur="'+e.file.dur+'"  data-src="'+n+'">点击播放</a><b class="j-duration">'+Math.floor(e.file.dur/1e3)+'"</b><span class="u-icn u-icn-play" title="播放音频"></span></div>':'<a href="'+n+'" target="_blank" class="download-file"><span class="icon icon-file2"></span>['+r+"一条语音消息]</a>";break;case"geo":t=r+"一条[地理位置]消息";break;case"custom":var s=JSON.parse(e.content);t=1===s.type?r+"一条[猜拳]消息,请到手机或电脑客户端查看":2===s.type?r+"一条[阅后即焚]消息,请到手机或电脑客户端查看":3===s.type?'<img class="chartlet" onload="loadImg()" src="./images/'+i(s.data.catalog)+"/"+i(s.data.chartlet)+'.png">':4==s.type?r+"一条[白板]消息,请到手机或电脑客户端查看":r+"一条[自定义]消息，请到手机或电脑客户端查看";break;case"robot":t=r+"一条[机器人]消息,请到手机或电脑客户端查看";break;default:e&&e.attach&&void 0!==e.attach.netcallType||(t=r+"一条[未知消息类型]消息")}return t}Date.prototype.Format=function(e){var t,n={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(t in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[t]:("00"+n[t]).substr((""+n[t]).length)));return e};var Q=function(e){(t=new Date).setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.setHours(0),n=t.getTime(),t.setMonth(1),t.setDate(1);var t,n=[n,t.getTime()];return s(e,n[0]<=e?"HH:mm":e<n[0]&&n[1]<=e?"MM-dd HH:mm":"yyyy-MM-dd HH:mm")},Y=function(e){(t=new Date).setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.setHours(0),n=t.getTime(),t.setMonth(1),t.setDate(1);var t,n=[n,t.getTime()];return n[0]<=e?s(e,"HH:mm"):n[0]-864e5<=e?"昨天":n[0]-1728e5<=e?"前天":n[0]-6048e5<=e?"星期"+s(e,"w"):s(e,n[1]<=e?"MM-dd":"yyyy-MM-dd")};r={i:!0,r:/\byyyy|yy|MM|cM|eM|M|dd|d|HH|H|mm|ms|ss|m|s|w|ct|et\b/g},Z=["上午","下午"],ee=["A.M.","P.M."],te=["日","一","二","三","四","五","六"],ne=["一","二","三","四","五","六","七","八","九","十","十一","十二"],re=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];var r,Z,ee,te,ne,re,s=function(e,t,n){if(!e||!t)return"";e=new Date(e),r.yyyy=e.getFullYear(),r.yy=(""+r.yyyy).substr(2),r.M=e.getMonth()+1,r.MM=o(r.M),r.eM=re[r.M-1],r.cM=ne[r.M-1],r.d=e.getDate(),r.dd=o(r.d),r.H=e.getHours(),r.HH=o(r.H),r.m=e.getMinutes(),r.mm=o(r.m),r.s=e.getSeconds(),r.ss=o(r.s),r.ms=e.getMilliseconds(),r.w=te[e.getDay()];e=r.H<12?0:1;return r.ct=Z[e],r.et=ee[e],n&&(r.H=r.H%12),z(r,t)};function o(e){return((e=parseInt(e)||0)<10?"0":"")+e}function se(e,t){t=(t=t||T.cache).getUserById(e),e=t&&t.nick?t.nick:"客服",t=t&&t.custom?t.custom:e;return e=-1===(navigator.language||navigator.browserLanguage).toLowerCase().indexOf("zh")?t:e}function ie(e,t){t=(t=t||T.cache).getUserById(e);return t&&t.nick?t.nick:e}function a(){for(var e=navigator.userAgent,t=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),n=!0,r=0;r<t.length;r++)if(0<e.indexOf(t[r])){n=!1;break}return n}function oe(e,t,n,r,s){var i=window._XHLURL.SERVERPORT+"/server/saveChatMessageNew",o="",a=e.text,c=("text"!=e.type&&(o=e.file.url,a=e.file.name),{fromAccount:e.from,fromNick:e.fromNick,toAccount:e.to,msgTimestamp:e.time,flow:n,idClient:e.idClient,msgType:e.type,attach:o,enterpriseId:_XHL.a[0][1],body:a,operateSource:r,toNick:t,visitorId:p()});y.ajax({url:i,type:"post",data:c,async:!1,success:function(e){var t,n,r=document.getElementById("xhl-wrapper");r&&(r.dispatchEvent(new CustomEvent("xhlSaveChatMessage",{bubbles:!0,detail:{data:c}})),t=m("presetFormValue"))&&(null!=m(n="presetFormValue")&&(document.cookie=n+"=;expires="+new Date(0).toGMTString()+";path=/"),t===c.body)&&r.dispatchEvent(new CustomEvent("xhlSendPresetForm",{bubbles:!0,detail:{data:c}})),s&&("2"===e.code?s.resolve(!0):s.resolve(!1))},error:function(e){s&&s.resolve(!1)}})}window._XHL.loadImg=function(){y("#chatContentTemp").scrollTop(99999)};d.prototype.getMyNick=function(){return this.Nick},d.prototype.getUserById=function(e){return this.personlist[e]||!1},d.prototype.setPersonlist=function(e){for(var t,n=e.length-1;0<=n;n--)t=e[n],this.personlist[t.account]=t},d.prototype.updateAvatar=function(e){this.personlist[b].avatar=e},d.prototype.updatePersonlist=function(e){if(this.personlist[e.account])for(var t in e)this.personlist[e.account][t]=e[t];else this.personlist[e.account]=e},d.prototype.getPersonlist=function(){return this.personlist},d.prototype.addMsgs=function(t){if(y.isArray(t))for(var n=0;n<t.length;n++){var e="team"===t[n].scene?"team-"+(e=t[n].to):"p2p-"+(e=t[n].from===b?t[n].to:t[n].from);this.msgs[e]||(this.msgs[e]=[]);0===this.msgs[e].filter(function(e){return e.idServer==t[n].idServer}).length&&this.msgs[e].push(t[n])}else this.addMsg(t)},d.prototype.addMsg=function(t){var e="team"===t.scene?"team-"+t.to:"p2p-"+(t.from===b?t.from:t.to);this.msgs[e]||(this.msgs[e]=[]);0===this.msgs[e].filter(function(e){return e.idServer==t.idServer}).length&&this.msgs[e].push(t);for(var n=0;n<this.sessions.length;n++)if(e===this.sessions[n]){this.sessions.splice(n,1);break}},d.prototype.addMsgsByReverse=function(e,t){for(var n=0;n<e.length;n++)e[n].from===b?e[n].to:e[n].from,this.msgs[t]||(this.msgs[t]=[]),this.msgs[t].unshift(e[n])},d.prototype.findMsg=function(e,t){for(var n=this.msgs[e],r=n.length-1;0<=r;r--)if(n[r].idClient===t)return n[r];return!1},d.prototype.setMsg=function(e,t,n){for(var r=this.msgs[e],s=r.length-1;0<=s;s--)if(r[s].idClient===t)return r.splice(s,1),void r.push(n)},d.prototype.setSysMsgs=function(e){this.sysMsgs=e},d.prototype.getSysMsgs=function(e){return this.sysMsgs},d.prototype.addCustomSysMsgs=function(e){for(var t=0;t<e.length;t++)this.customSysMsgs.push(e[t])},d.prototype.deleteCustomSysMsgs=function(){this.customSysMsgs=[]},d.prototype.getCustomSysMsgs=function(e){return this.customSysMsgs},d.prototype.getSysMsgCount=function(e){return this.sysMsgCount},d.prototype.setSysMsgCount=function(e){this.sysMsgCount=e},d.prototype.addSysMsgCount=function(e){this.sysMsgCount=this.sysMsgCount+e},d.prototype.getMsgs=function(e){return this.msgs[e]||[]},d.prototype.getMsgsByUser=function(e){return this.msgs[e]||[]},d.prototype.addOfflineMsgs=function(e){for(var t=e.length-1;0<=t;t--)/text|image|file|audio|video|geo|custom|notification/i.test(e[t].type)&&this.addMsgs(e[t])},d.prototype.updatePersonSubscribe=function(e){var t,n,r,s;return!!e.account&&(t=e.account,this.personSubscribes[t]=this.personSubscribes[t]||{},this.personSubscribes[t][e.type]={account:e.account,type:e.type,value:e.value,custom:e.custom,clientType:e.clientType,serverConfig:e.serverConfig,time:e.time,multiPortStatus:""},t=this.personSubscribes[t][e.type],1!=+e.type||1!=+e.value&&2!=+e.value&&3!=+e.value&&10001!=+e.value||(e=JSON.parse(t.serverConfig),n=0,t.multiPortStatus="",e.online&&(0<=e.online.indexOf(4)?(t.multiPortStatus="电脑",n=4):0<=e.online.indexOf(2)?(t.multiPortStatus="iOS",n=2):0<=e.online.indexOf(1)?(t.multiPortStatus="Android",n=1):0<=e.online.indexOf(16)?(t.multiPortStatus="Web",n=16):0<=e.online.indexOf(64)&&(t.multiPortStatus="Mac",n=64)),t.custom&&0<Object.keys(t.custom).length?(e=n,r=t.custom,s="",r=r||{},0!==e?r=r[e]:r[4]?(r=r[4],s="电脑"):r[2]?(r=r[2],s="iOS"):r[1]?(r=r[1],s="Android"):r[16]?(r=r[16],s="Web"):r[64]&&(r=r[64],s="Mac"),r&&("number"==typeof(r=JSON.parse(r)).net_state&&(e={0:"",1:"Wifi",2:"WWAN",3:"2G",4:"3G",5:"4G"}[r.net_state])&&(s+="-"+e),"number"==typeof r.online_state?s+={0:"在线",1:"忙碌",2:"离开"}[r.online_state]:s+="在线"),e=s,""!==t.multiPortStatus&&""===e?t.multiPortStatus+="在线":t.multiPortStatus+=e):0!==n?t.multiPortStatus+="在线":t.multiPortStatus="离线"),!0)},d.prototype.getMultiPortStatus=function(e){return this.personSubscribes[e]&&this.personSubscribes[e][1]?this.personSubscribes[e][1].multiPortStatus:""},d.prototype.getPersonSubscribes=function(){return this.personSubscribes};var ae=d;function d(e){this.friendslist=[],this.personlist={},this.personSubscribes={},this.teamlist=[],this.teamMembers={},this.teamMap={},this.msgs={},this.sessions=[],this.blacklist=[],this.mutelist=[],this.sysMsgs=[],this.customSysMsgs=[],this.getHistoryMsgCount=0,this.sysMsgCount=0,this.currSessionId="",this.Nick=""}function f(i,e){var t,n=m("_xhlusdktoken"),r=m("_xhlusdkid");function s(e){e&&nim.subscribeEvent({type:1,accounts:[e],subscribeTime:86400,sync:!0,done:function(e,t){}})}n&&(this.person={},this.team=[],this.person[r]=!0,this.controller=i,this.cache=e,window.nim=i.nim=this.nim=SDK.NIM.getInstance({db:!1,appKey:CONFIG.appkey,account:r,token:n,onconnect:function(){nim.updateMyInfo({custom:JSON.stringify({visitorId:p()}),done:function(e,t){}}),this.controller.sendCustomSysMsgForTrack(window._XHL.a.onLineServers),y("[data-xhl]").css("display","block");var e=m("_xhluchatobject");e&&i.getHistoryMsgs("p2p",e)}.bind(this),ondisconnect:function(e){e&&"silentlyKick"==e.reason&&++t<5&&nim.connect()}.bind(this),onerror:function(e){}.bind(this),onwillreconnect:function(e){y("errorNetwork").removeClass("hide")}.bind(this),syncTeamMembers:!1,onmsg:function(e){"text"==e.type?(e.from,e.to,e.text):(e.from,e.to,e.url);this.controller.doMsg(e)}.bind(this),onofflinemsgs:function(e){e=e.msgs,this.cache.addMsgs(e);for(var t=0;t<e.length;t++)"p2p"===e[t].scene&&(this.person[e[t].from!==r?e[t].from:e[t].to]=!0,V(e[t]))}.bind(this),syncSessionUnread:!0,onsessions:function(e){for(var t=0;t<e.length;t++)this.cache.currSessionId=e[t].id,0<e[t].unread&&(y(".xhl-launch-button").hasClass("xhl-hidden")||(y(".xhl-notification-badge").removeClass("xhl-hidden"),y(".xhl-notification-badge-text").text(e[t].unread).attr("name",e[t].unread),He(e[t].lastMsg)))}.bind(this),onsyncdone:function(){this.controller.sendCustomSysMsgForSubscribesLogin(window._XHL.a.onLineServers),this.controller.initInfo()}.bind(this),oncustomsysmsg:function(e){var t=e.from,n=JSON.parse(e.content),r=n.id;101===r&&-1===ce.indexOf(t)&&(s(t),ce.push(t));102==r&&this.controller.sendCustomSysMsgForTrack([t]);204==r&&((t=m("_xhluchatobject"))&&t!=n.receivedTransferServerAccId&&nim.unSubscribeEventsByAccounts({type:1,accounts:[t],done:function(e,t){}}),t==n.receivedTransferServerAccId&&!i.needReconnect||s(n.receivedTransferServerAccId),i.needReconnect=!1,v("_xhluchatobject",n.receivedTransferServerAccId));301===r&&y(1==me?"#xhl-one":"#xhl-second").show();103===r?(!m("_xhluchatobject")||m("_xhluchatobject")&&e.from===m("_xhluchatobject"))&&("客服"===(t=this.controller.getNick(e.from))&&(t=_(t)),y(".inputing-service-name").text(t),m("_xhlServiceInputing")||v("_xhlServiceInputing",!0),y(".service-inputing").css("display","block")):104===r&&(y(".inputing-service-name").text(""),m("_xhlServiceInputing")&&v("_xhlServiceInputing",!1),y(".service-inputing").css("display","none"))}.bind(this),onmyinfo:function(e){this.cache.Nick=e.nick}.bind(this),onpushevents:function(e){if(window.CONFIG.openSubscription)for(var t=e.msgEvents,n=m("_xhluchatobject"),r=0;r<t.length;r++){var s=t[r];"3"!==s.value||n&&s.account!==n||(y(".inputing-service-name").text(""),m("_xhlServiceInputing")&&v("_xhlServiceInputing",!1),y(".service-inputing").css("display","none")),s.account&&1===Number(s.type)&&(s=JSON.parse(s.serverConfig),Array.isArray(s.online))&&!s.online.length&&(i.needReconnect=!0)}}.bind(this)}),t=0)}var ce=[];function g(e,t){y(".preset-form-tips").stop(!0,!0).addClass("alert "+t).html(e).show().delay(1500).fadeOut()}f.prototype.resetSessionUnread=function(){this.cache.currSessionId&&this.nim.resetSessionUnread(this.cache.currSessionId)},f.prototype.sendTextMessage=function(e,t,n,r,s){r=!!r,T.$messageText.val(""),this.nim.sendText({scene:e||"p2p",to:t,text:n,isLocal:r,done:s})},f.prototype.sendFileMessage=function(e,t,n,r){var s=n.files?n.files[0]:null;if(s&&s.size&&s.size>10*Math.pow(1024,2))return s=_("可发送文件大小上限为10M"),void g(s,"xhl-tip-warning");s=n.value,s=s.substring(s.lastIndexOf(".")+1,s.length),s=/png|jpg|bmp|jpeg|gif/i.test(s)?"image":"file";this.nim.sendFile({scene:e,to:t,type:s,fileInput:n,uploadprogress:function(e){console},uploaderror:function(){console},uploaddone:function(e,t){},beforesend:function(e){console},done:r})},f.prototype.forwardMessage=function(e,t,n,r){this.nim.forwardMsg({msg:e,scene:t,to:n,done:r})},f.prototype.getWebHistoryMsgs=function(e,t,n,r){n.endTime?this.nim.getHistoryMsgs({scene:e,to:t,endTime:n.endTime,lastMsgId:n.lastMsgId,limit:30,done:r}):this.nim.getHistoryMsgs({scene:e,to:t,limit:30,done:r})},f.prototype.getLocalMsgs=function(e,t,n){t?this.nim.getLocalMsgs({sessionId:e,end:t,limit:20,done:n}):this.nim.getLocalMsgs({sessionId:e,limit:20,done:n})},f.prototype.kick=function(e){e=0===e?this.mobileDeviceId:this.pcDeviceId;this.nim.kick({deviceIds:[e],done:function(e,t){}})},f.prototype.getUsers=function(e,n){var r=e.slice(0,150),s=e.slice(150),i=[],t=this,o=function(){!e||e.length<=0||t.nim.getUsers({accounts:r,done:function(e,t){e?n(e):(i=i.concat(t),0<s.length?(r=s.slice(0,150),s=s.slice(150),o()):n(e,i))}})};o()},f.prototype.getUser=function(e,t){this.nim.getUser({account:e,done:t})},f.prototype.updateMyInfo=function(e,t,n,r,s,i,o){this.nim.updateMyInfo({nick:e,gender:t,birth:n,tel:r,email:s,sign:i,done:o})},f.prototype.updateMyAvatar=function(e,t){this.nim.updateMyInfo({avatar:e,done:t})},f.prototype.previewImage=function(e){this.nim.previewFile({type:"image",fileInput:e.fileInput,uploadprogress:function(e){},done:e.callback})},f.prototype.sendMsgReceipt=function(e,t){this.nim.sendMsgReceipt({msg:e,done:t})},f.prototype.sendCustomSysMsg=function(e,t,n){this.nim.sendCustomSysMsg({scene:"p2p",to:account,content:t,callback:n,cc:!1,needPushNick:!0})};var b,T,h,ue,M,S,k,le,x,C={buildChatContentUI:function(e,t){var n="",r=t.getMsgs(e);if(0!==r.length){30<=r.length&&(n='<div class="more-msgs tc" style="text-align: center;margin-top: 10px"><span style="color: #999;cursor: pointer;font-size: 14px">查看更多↑</span></div>');for(var s=0,i=r.length;s<i;++s){var o=r[s],a=t.getUserById(o.from);o.attach&&void 0!==o.attach.netcallType&&"netcallBill"!==o.attach.type&&"netcallMiss"!==o.attach.type||((0==s||3e5<o.time-r[s-1].time)&&(n+=this.makeTimeTag(Q(o.time))),n+=this.makeChatContent(o,a))}}return n},contactChatContentUI:function(e,t){var n="";if(0!==e.length){30===e.length&&(n='<div class="more-msgs tc" style="text-align: center;margin-top: 10px"><span style="color: #999;cursor: pointer;font-size: 14px">查看更多↑</span></div>');for(var r=0,s=e.length;r<s;++r){var i=e[r],o=t.getUserById(i.from);i.attach&&void 0!==i.attach.netcallType&&"netcallBill"!==i.attach.type&&"netcallMiss"!==i.attach.type||((0==r||3e5<i.time-e[r-1].time)&&(n+=this.makeTimeTag(Q(i.time))),n+=this.makeChatContent(i,o))}}return n},updateChatContentUI:function(e,t){y("#chatContent .item").last();var n="",t=t.getUserById(e.from);return e.attach&&void 0!==e.attach.netcallType&&"netcallBill"!==e.attach.type&&"netcallMiss"!==e.attach.type?"":n+this.makeChatContent(e,t)},makeChatContent:function(e,t){if(e.attach&&e.attach.type&&(void 0===e.attach.netcallType||"netcallBill"!==e.attach.type&&"netcallMiss"!==e.attach.type)){if(void 0!==e.attach.netcallType)return"";n='<p class="u-notice tc item" data-time="'+e.time+'" data-id="'+e.idClient+'" data-idServer="'+e.idServer+'"><span class="radius5px">'+void 0+"</span></p>"}else{var n,r=e.type,s=e.from;t.avatar,e.scene;n=("tip"===r?['<div data-time="'+e.time+'" data-id="'+e.idClient+'" id="'+e.idClient+'" data-idServer="'+e.idServer+'">','<p class="u-notice tc item '+(s==b&&e.idServer?"j-msgTip":"")+'" data-time="'+e.time+'" data-id="'+e.idClient+'" data-idServer="'+e.idServer+'"><span class="radius5px">'+K(e)+"</span></p>","</div>"]:(n="operator"==(t="",(r=e).from===r.to?t="Web"===r.fromClientType?"operator":"visitor":"in"===r.flow?t="operator":"out"===r.flow&&(t="visitor"),t)?['<div class="xhl-message-block" data-time="'+e.time+'" data-id="'+e.idClient+'" id="'+e.idClient+'" data-idServer="'+e.idServer+'">','<div class="xhl-message-container">','<p class="xhl-operator-name">'+se(s)+" "+Q(e.time)+"</p>",'<div class="xhl-message-group">',("image"===e.type?'<p class="xhl-operator-message xhl-message-img-wrapper">':'<p class="xhl-operator-message">')+K(e)+"</p>","</div>","</div>"]:(r="","fail"===e.status||e.isInBlackList||(r=" ga_visitor-message"),['<div class="xhl-message-block" data-time="'+e.time+'" data-id="'+e.idClient+'" id="'+e.idClient+'" data-idServer="'+e.idServer+'">','<div class="xhl-message-container">','<div class="xhl-message-group">',("image"===e.type?'<p class="xhl-visitor-message xhl-message-img-wrapper'+r+'">':'<p class="xhl-visitor-message ga_visitor-message">')+K(e)+"</p>","</div>","</div>"]),"fail"===e.status||e.isInBlackList?n.push('<span class="error j-resend" data-session="'+e.sessionId+'" data-id="'+e.idClient+'"><div class="icon-error">!</div></span>'):n.push(""),n=n.concat(["</div>"]))).join("")}return n},makeTimeTag:function(e){return'<p class="u-msgTime" style="text-align: center !important;">- - - - -&nbsp;'+e+"&nbsp;- -- - -</p>"}},me=1,de=3e3,I="",w=[],pe="离线表单",P="zh_cn",fe=!0,ge=!(f.prototype.resendMsg=function(e,t){this.nim.resendMsg({msg:e,done:t})}),O={},he=null,A={},ye=[];function ve(n,r){var s=null;return function(){var e=this,t=arguments;null!==s&&clearTimeout(s),s=setTimeout(function(){n.apply(e,t)},r)}}function be(){var e=y("#messageText").outerHeight()+40;y(".service-inputing").css("bottom",e+"px")}function Te(){Xe(),clearInterval(h),E(),y("#xhl-one").hide(),y("#xhl-second").hide();var e=(new Date).getTime();y(".xhl-conversation-container").hasClass("xhl-display")?localStorage.setItem("xhlWindowClick",e):(y(".xhl-chat-poptip").hide(),y(".xhl-notification-badge").addClass("xhl-hidden"),y(".xhl-notification-badge-text").attr("name",0).text(""),T.mysdk.resetSessionUnread(),localStorage.setItem("xhlWindowClick","Click_"+e)),y(".xhl-launch-button.xhl-size-md").attr({"aria-hiden":"true",tabindex:"-1"}).addClass("xhl-hidden"),y("#xhl-container").removeClass("xhl-hidden"),y("#xhl-container [tabindex][aria-hidden]").attr({"aria-hiden":"false",tabindex:"0"})}function Me(n,r,i,c){var e=[];S=n.split(";")[0],e.push(S),y.ajax({url:window._XHLURL.cn_SERVERPORT+"/cuss-login/translate/getConfigOrBrowserLanguageForForm",type:"post",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify({orgId:_XHL.a[0][1],websiteLanguageParam:_XHL.a[0][2]||"",browserLangageParam:I,templateId:e}),success:function(e){var s,o,a,t;"1"===e.code&&(w=w.concat(e.data.languagePack),s=r,o=i,a=c,t=(e=n).split(";")[1],S=e.split(";")[0],y.ajax({url:window._XHLURL.cn_SERVERPORT+"/form-cust/form/getColumnsShow",type:"get",dataType:"json",data:{parentTempateId:t,templateId:S},success:function(e){var t,n,i,r;1==e.code&&(new Array,t=(e=e.data).show,pe=e.template&&e.template.cname?e.template.cname:"表单",n="",y.each(t,function(e,t){n+=function(e,t){var n=t.type.toUpperCase(),r=t.name,s=t.isNeed;I!=P&&(r=_(r));var i=" ",o="";1==s&&(i='<span class="xhl-component-span">*</span>',o=" choose");var a=t.option;"a1003"===e&&(he={name:r,index:e,temp:i,tempClass:o});var c="";switch(n){case"TEXT":case"INPUT":c='<div class="xhl-chat-controls"><input onchange="XHLInputCheck(this)" oninput="XHLInputCheck(this)" type="text" placeholder="'+r+'" name="'+e+'" class="xhl-chat-form-input xhl-chat-valtype '+e+o+'" >'+i+"</div>";break;case"TEXTAREA":c='<div class="xhl-chat-controls"><textarea onchange="XHLInputCheck(this)" oninput="XHLInputCheck(this)" type="" placeholder="'+r+'" name="'+e+'" class="xhl-chat-form-textarea xhl-chat-valtype '+e+o+'" /></textarea>'+i+"</div>";break;case"SELECT":m=-1<a.indexOf("?")?a.split("?"):a.split(",");var u='<option disabled selected style="display:none;" value="">'+r+"</option>";y.each(m,function(e,t){I!=P&&(t=_(t)),u+='<option value="'+t+'">'+t+"</option>"}),c='<div class="xhl-chat-controls"><select data-placeholder="'+r+'" class="xhl-chat-form-select xhl-chat-valtype '+e+o+'" data-valtype="option" name="'+e+'">'+u+"</select>"+i+"</div>";break;case"SELECTMULTIPLE":var l="",m=a.split("?");y.each(m,function(e,t){I!=P&&(t=_(t)),l+='<div><input type="checkbox" onclick="myCheck(this)" onblur="multipleBlur_checkbox(this)" value="'+t+'">'+t+"</div>"}),c='<div class="xhl-chat-controls"> <div class="xhl-chat-triangle-down xhl-chat-selectMultiple-triangle-btn XHLCHATICON XHLCHATICON-arrow-opened"></div><input type="text" placeholder="'+r+'" name="'+e+'" onclick="multipleIn(this)" onblur="multipleBlur_input(this)" readonly class="xhl-chat-selectMultiple-input xhl-chat-form-input xhl-chat-valtype '+e+o+'">'+('<div tabindex="0" onblur="multipleBlur_div(this)" class="xhl-chat-selectMultiple-div xhl-chat-dis">'+l+"</div>")+i+"</div>"}return c}(e,t)}),e='<div > <div class="xhl-form-message"><p>'+a+'</p></div><form id="xhl_chat_form"><fieldset>'+n+'</fieldset></form></div><div class="xhl-chat-tip"></div>',n&&(r="<div "+("11120"==_XHL.a[0][1]?'id="xhlFormSubmit" ':"")+'class="xhl-chat-submit ga_submit_chat_offline_form" style="background-color: '+o+'!important" onclick="xhlChatFormSubmit()">'+s+"</div>",y(".xhl-form-submit").html(r)),y(".xhl-conversation-container").html(e),y(".xhl-conversation-container").addClass("offline-container"),y(".xhl-conversation-container").css("margin-bottom","40px"),r=S,y.ajax({url:window._XHLURL.cn_SERVERPORT+"/form-cust/form/getTemplateConfig",type:"get",dataType:"json",data:{id:r},success:function(e){var t,n,r;1==e.code&&(e=e.data,(e=JSON.parse(e)).COUNTRYAREA)&&"select"===e.COUNTRYAREA.type&&he&&(t=(e=he).name,n=e.index,r=e.temp,e=e.tempClass,t='<div class="xhl-chat-controls"><div class="xhl-chat-countryArea"><input type="text" placeholder="'+t+'" name="'+n+'" autocomplete="new-password" onfocus="XHLChatCountryAreaFocus(this)" onblur="XHLChatCountryAreaBlur(this)" oninput="XHLChatCountryAreaChange(this)" class="xhl-chat-countryArea-input xhl-chat-form-input xhl-chat-valtype '+n+e+'" /><span class="xhl-chat-countryArea-triangle-btn XHLCHATICON XHLCHATICON-arrow-opened"></span><span tabindex="0" class="xhl-chat-countryArea-clear-btn XHLCHATICON XHLCHATICON-delete" onclick="XHLChatCountryAreaNodeClear(this)"></span><div tabindex="0" onblur="XHLChatCountryAreaBlur(this)" class="xhl-chat-countryArea-popper" style="display: none;"></div></div>'+r+"</div>",y("form#xhl_chat_form").find(".a1003").parent().replaceWith(y(t)))}}),i=t,y.ajax({url:window._XHLURL.cn_SERVERPORT+"/new-privilege/formFieldConfig/getListForClient",type:"get",dataType:"json",data:{serviceFlag:"save_form",orgId:_XHL.a[0][1]},success:function(e){if(1==e.code){var t,n=e.data;for(t in O={},n){var r,s=n[t].typeLength;s&&i[t]?(r=JSON.parse(s),"input"===i[t].type||"text"===i[t].type?s=r.text:"textarea"===i[t].type&&(s=r.textarea)):s=n[t].usableLength,O[t]=s}}}}))}}))}})}function _(e){for(var t,n,r=w.length,s=1,i=0;i<r;i++)if(e==w[i].zh_cn)return s=0,-1<(n=t=I.toLowerCase()).indexOf("-")&&(n=n.split("-")[0]),w[i][t]||w[i][n]||w[i].en;if(1===s)return e}function Se(){var s=p();s.trim()?y.ajax({url:window._XHLURL.SERVERPORT+"/visitortrace/visitorInfoTraceAndLogin",type:"post",dataType:"json",data:window.VISITORBASICINFO,success:function(e){var t,n,r,h;1==e.code?(n=e.data.acctid,r=e.data.token,t=e.data.haveServer,window._XHL.a.onLineServers=e.data.onLineServers,0==(window._XHL.a.isHaveServer=t)?ke():(h=_XHL.a[0][1],y.ajax({url:window._XHLURL.cn_SERVERPORT+"/cuss-login/online/getByOrgId",type:"get",dataType:"json",data:{orgId:h},success:function(e){var t,n,r,s,i,o,a,c,u,l,m,d,p,f,g;""!=e?(t=e.data.windowColor||"#20B2BB",n=e.data.miniColor||"#20B2BB",r=e.data.miniText||"Chat with us",s=e.data.enable||1,i=e.data.topText||"Now chatting",o=e.data.welcomes||"Welcome！Our customer service will help you through this live chat",a=e.data.inputPrompt||"Type here and hit enter to chat",c=e.data.displayStatus||1,u=e.data.windowPosition||1,l=e.data.windowSize||2,f=e.data.defaultChatFormEnable||2,e=e.data.chatGreeting||"",d=m=g="",p="正在输入...",1===f&&(_XHL.a[0][1]+""!="11318"&&_XHL.a[0][1]+""!="11349"&&_XHL.a[0][1]+""!="10110"||(y("#presetEmail").parents(".xhl-preset-form-item").addClass("xhl-display"),y("#presetWhatsApp").parents(".xhl-preset-form-item").removeClass("xhl-display")),y(".xhl-preset-form").removeClass("xhl-display"),y("#xhl-preset-form-btn").removeClass("xhl-display"),"10289"==_XHL.a[0][1]&&y("#xhl_phone").removeClass("xhl-display"),y(".xhl-conversation-container").addClass("xhl-display"),y(".xhl-footer-form-container").addClass("xhl-display"),y("#xhl-container .xhl-footer-form-container").css("border","1px solid #e8e9eb")),I!=P&&(r=_(r),i=_(i),o=_(o),a=_(a),e=_(e),g=_("姓名"),m=_("邮箱"),d=_("开始聊天"),presetNameTips=_("姓名不能为空"),presetEmailTips=_("邮箱格式不正确"),p=_("正在输入..."),y("#presetName").text(g).attr("name",presetNameTips),y("#presetEmail").text(m).attr("name",presetEmailTips),y("#xhl-preset-form-btn").text(d)),y("#xhl-preset-form-txt").text(e),y(".on-inputing").text(p),y("#xhl-preset-form-btn").css("background-color",t),y(".xhl-button-text").text(r),f=y(".xhl-launch-button").attr("style"),h+""=="10848"?(y("#xhl-launch-button-div > .xhl-launch-button-svg").remove(),y("#xhl-launch-button-div > .xhl-button-text").attr("style","background-color: "+n+"!important; margin: 189px 0 0 !important; padding: 0 20px !important; width: 113px !important; line-height: 36px !important; text-align: center !important;"),y(".xhl-launch-button").attr("style","padding: 0 !important; border-radius: 0 !important; min-height: 226px !important;background: no-repeat top right url(http://content.leadscloud.com/Fj8t5-y_SHTjY2QUKXSJgl7v24Zs) !important;"+f||"")):y(".xhl-launch-button").attr("style","background-color:"+n+" !important;"+f||""),y(".xhl-top-bar").attr("style","background-color:"+t+" !important;border-color:"+t+" !important;"),y(".xhl-end-chat-button").attr("style","background-color:"+t+" !important"),xe(c),1==s&&(Ce(c),2==u&&(y(".xhl-launch-button").addClass("xhl-bottom-left"),y("#xhl-container").addClass("xhl-bottom-left")),1==l?(y(".xhl-launch-button").addClass("xhl-size-lg"),y("#xhl-container").addClass("xhl-size-lg")):3==l&&(y(".xhl-launch-button").addClass("xhl-size-sm"),y("#xhl-container").addClass("xhl-size-sm")),y("#NoteTips").text(o),g='<span title="'+i+'">'+i+"</span>",y(".xhl-end-chat-button").html(g),y(".xhl-chat-input").attr({placeholder:a,title:a,"aria-label":a}),be())):(xe(1),Ce(1))},error:function(){}}),y(".xhl-form-submit").empty("xhl-display")),v("_xhlusdkid",n),v("_xhlusdktoken",r),b=m("_xhlusdkid"),T=new U(b),t=s,n=e.data.locationIp,r=X("tempUniqueId"),t&&n&&r&&y.ajax({url:window._XHLURL.cn_SERVERPORT+"/crm/monitoringlinkuse/createMonitoringRelation",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({orgId:_XHL.a[0][1],visitorType:2,tempUniqueId:r,visitorId:t,locationIp:n}),success:function(e){}})):JSON.parse(window.VISITORBASICINFO).substring(0,700)},error:function(e){}}):JSON.parse(window.VISITORBASICINFO).substring(0,700)}function ke(){y(".xhl-footer-form-container").empty(),y("#xhl-container .xhl-footer-form-container").css("border","none");var p=_XHL.a[0][1];y.ajax({url:window._XHLURL.cn_SERVERPORT+"/cuss-login/offline/getByOrgId",type:"get",dataType:"json",data:{orgId:p},success:function(e){var t,n,r,s,i,o,a,c,u,l,m,d;""!=e?(k=1==e.code?(t=e.data.enable||1,n=e.data.windowColor||"#20B2BB",r=e.data.miniColor||"#20B2BB",s=e.data.miniText||"Chat with us",i=e.data.displayStatus||1,o=e.data.windowPosition||1,a=e.data.windowSize||2,c=e.data.topText||"Now chatting",m=e.data.displayText||"Please leave your message here! We will send detailed technical info and quotation to you!",u=e.data.offlineLink||"",d=e.data.buttonColor||"#20B2BB",l=e.data.buttonText||"Contact Us",e.data.conclusions||"Thanks, we will get back to you as soon as we can"):(s="Chat with us",o=i=t=1,a=2,c="Now chatting",m="Please leave your message here! We will send detailed technical info and quotation to you!",u="",d=r=n="#20B2BB",l="Contact Us","Thanks, we will get back to you as soon as we can"),I!=P&&(s=_(s),c=_(c),m=_(m),l=_(l),k=_(k)),""!=u?Me(u,l,d,m):(e='<div class="xhl-form-message"><p>'+m+"</p></div>",y(".xhl-conversation-container").html(e)),u='<span title="'+c+'">'+c+"</span>",y(".xhl-end-chat-button").html(u),y(".xhl-button-text").text(s),l=y(".xhl-launch-button").attr("style"),p+""=="10848"?(y("#xhl-launch-button-div > .xhl-launch-button-svg").remove(),y("#xhl-launch-button-div > .xhl-button-text").attr("style","background-color: "+r+"!important; margin: 189px 0 0 !important; padding: 0 20px !important; width: 113px !important; line-height: 36px !important; text-align: center !important;"),y(".xhl-launch-button").attr("style","padding: 0 !important; border-radius: 0 !important; min-height: 226px !important;background: no-repeat top right url(http://content.leadscloud.com/Fj8t5-y_SHTjY2QUKXSJgl7v24Zs) !important;"+l||"")):y(".xhl-launch-button").attr("style","background-color:"+r+" !important;"+l||""),y(".xhl-top-bar").attr("style","background-color:"+n+" !important;border-color:"+n+" !important;"),y(".xhl-end-chat-button").attr("style","background-color:"+n+" !important;"),_XHL.a[0][1]+""!="11318"&&_XHL.a[0][1]+""!="11349"&&"10110"!=_XHL.a[0][1]||xe(i),1==t&&(Ce(i),2==o&&(y(".xhl-launch-button").addClass("xhl-bottom-left"),y("#xhl-container").addClass("xhl-bottom-left")),1==a?(y(".xhl-launch-button").addClass("xhl-size-lg"),y("#xhl-container").addClass("xhl-size-lg")):3==a&&(y(".xhl-launch-button").addClass("xhl-size-sm"),y("#xhl-container").addClass("xhl-size-sm")))):(m="Please leave your message here! We will send detailed technical info and quotation to you!",d='<div class="xhl-form-message"><p>'+(m=I!=P?_(m):m)+"</p></div>",y(".xhl-conversation-container").html(d),_XHL.a[0][1]+""!="11318"&&_XHL.a[0][1]+""!="11349"&&"10110"!=_XHL.a[0][1]||xe(1),Ce(1))},error:function(){}})}function xe(i){y.ajax({url:window._XHLURL.cn_SERVERPORT+"/cuss-login/invite/getByOrgId",type:"get",dataType:"json",data:{orgId:_XHL.a[0][1]},success:function(e){var t,n,r,s;le=1==e.code?(ue=e.data.enable,me=e.data.displayStyle,de=e.data.timeInterval?1e3*e.data.timeInterval:3e4,t=e.data.bgColor,M=e.data.frequencyLimit,e.data.acceptButtonColor,e.data.refuseButtonColor,n=e.data.textDescription,r=e.data.acceptButtonText,s=e.data.refuseButtonText,e.data.hasFrequencyLimit):(de=3e4,M=10,n="Chat with us for getting more information about our products and service",r="Chat Now",s="Chat Later",me=ue=1),y(".xhl-alert-one").attr("style","background-color:"+t+" !important;"),y(".xhl-alert-two").attr("style","background-color:"+t+" !important;"),y(".xhl-one-accept").attr("style","color:"+t+" !important;"),y(".xhl-two-accept").attr("style","color:"+t+" !important;"),I!=P&&(n=_(n),r=_(r),s=_(s)),y(".xhl-dialog-content").text(n),y(".xhl-dialog-contact-btn").text(r),y(".xhl-dialog-cancel-btn").text(s),a()&&2==i&&E(),a()||E()},error:function(){}})}function Ce(e){a()&&1==e?(("true"===m("isFBMessenger")?y(".xhl-launch-button"):y("#xhl-container")).removeClass("xhl-hidden"),y(".xhl-button-text").removeClass("xhl-hidden")):a()&&2==e?(y(".xhl-launch-button").removeClass("xhl-hidden"),y(".xhl-button-text").removeClass("xhl-hidden")):(y(".xhl-launch-button").removeClass("xhl-hidden"),"true"===m("isFBMessenger")?y(".xhl-launch-button").removeClass("xhl-launch-button-bottom"):y(".xhl-launch-button").addClass("xhl-launch-button-bottom"))}function E(){1!==ue||!window._XHL.a.isHaveServer&&_XHL.a[0][1]+""!="11318"&&_XHL.a[0][1]+""!="11349"&&"10110"!=_XHL.a[0][1]||(h=setTimeout(function(){if(!y(".xhl-launch-button").hasClass("xhl-hidden")){if(2!=le&&1==le)if(""!=M)M--;else if(0===M)return;y(1==me?"#xhl-one":"#xhl-second").show()}},de))}function R(e,t){y(".xhl-chat-tip").stop(!0,!0).addClass(t).html(e).show(),setTimeout(function(){y(".xhl-chat-tip").attr("style","display:none !important")},1500)}_XHL.a[0][1]+""=="10970"&&(ye=["GB","US"]),multipleIn=function(e){y(e).next().toggleClass("xhl-chat-dis")},myCheck=function(e){var t=y(e).parent().parent().prev().val(),n=t?t.split(","):[];if(e.checked)n.push(e.nextSibling.nodeValue);else for(var r=0;r<n.length;r++)n[r]===e.value&&n.splice(r,1);y(e).parent().parent().prev().val(n)},multipleBlur_input=function(e){setTimeout(function(){e.contains(document.activeElement)||e.nextSibling.contains(document.activeElement)||y(e).next().addClass("xhl-chat-dis")},0)},multipleBlur_div=function(e){setTimeout(function(){e.contains(document.activeElement)||e.previousSibling.contains(document.activeElement)||y(e).addClass("xhl-chat-dis")},0)},multipleBlur_checkbox=function(e){setTimeout(function(){e.contains(document.activeElement)||e.parentNode.parentNode.contains(document.activeElement)||e.parentNode.parentNode.previousSibling.contains(document.activeElement)||y(e).parent().parent().addClass("xhl-chat-dis")},0)},XHLInputCheck=function(e){var t,n,r=y(e).attr("name"),r=O[r];r&&(t=0<y(e).siblings(".xhl-error-tip").length,n=(n=_("最大字数限制 000 字")).replace("000",r),e.value.length>r?t||y(e).after('<div class="xhl-error-tip" title="'+n+'">'+n+"</div>"):t&&y(e).siblings(".xhl-error-tip").remove())},XHLChatPopoverHideCheck=function(t,n,r,s){setTimeout(function(){var e=t.querySelector(n);e&&e.contains(document.activeElement)||(s?y(e).find(r).hide(s):y(e).find(r).hide())},0)},XHLChatCountryAreaFocus=function(e){var t,n,r=y(e).siblings(".xhl-chat-countryArea-popper");r.is(":visible")||(t=y(e).closest("form#xhl_chat_form")[0],n=y(t).prop("scrollHeight")||0,r.show(function(){y(e).val()?setTimeout(function(){var e;(y(t).prop("scrollHeight")||0)<=n||(e=r[0])&&e.scrollIntoView()},0):(A.countrys&&A.countrys.length||XHLChatCountryAreaGetCountries(),XHLChatCountryAreaTreeRender(A,t))}))},XHLChatCountryAreaBlur=function(e){var t=y(e).closest("form#xhl_chat_form")[0];XHLChatPopoverHideCheck(t,".xhl-chat-countryArea",".xhl-chat-countryArea-popper",function(){var e=y(t).find(".xhl-chat-countryArea-input");"readonly"!==e.attr("readonly")&&e.val("")})},XHLChatCountryAreaChange=ve(function(e){var t=y(e).val(),t=XHLChatCountryAreaSearch(t),e=y(e).closest("form#xhl_chat_form")[0];XHLChatCountryAreaTreeRender(t,e)},500),XHLChatCountryAreaGetCountries=function(){y.ajax({url:window._XHLURL.cn_SERVERPORT+"/report/country/allcountry",type:"get",async:!1,success:function(e){"1"===e.code&&(A=e.data)}})},XHLChatCountryAreaSearch=function(e){var t;return e.slice()?(t={},y.ajax({url:window._XHLURL.cn_SERVERPORT+"/report/country/wherelike",type:"post",async:!1,data:{name:e.slice()},success:function(e){"1"===e.code&&(t=e.data)}}),t):A},XHLChatCountryAreaTreeRender=function(e,t){y(t).find(".xhl-chat-countryArea-popper").empty();var n=e.countrys||[],e=e.divisions||[],i=(e.length&&y.each(e,function(e,t){n.filter(function(e){return e.code===t.countryCode}).length||n.push({code:t.countryCode,ename:t.countryEnname,name:t.countryName})}),n.length&&n.sort(function(e,t){e=e.ename||"",t=t.ename||"";return e.localeCompare(t)}),e.length&&e.sort(function(e,t){e=e.divisionEnname||"",t=t.divisionEnname||"";return e.localeCompare(t)}),y('<div class="xhl-chat-countryArea-tree"></div>')),r=(y.each(n,function(e,t){t='<div class="xhl-chat-countryArea-country xhl-chat-countryArea-node" data-regionType="country" data-nodeLevel="1" data-code="'+t.code+'" data-name="'+t.ename+'"><span class="xhl-chat-countryArea-toggle-btn XHLCHATICON XHLCHATICON-arrow-opened" onclick="XHLChatCountryAreaTreeToggle(this)"></span><div class="xhl-chat-countryArea-node-label" onclick="XHLChatCountryAreaNodeClick(this)">'+t.ename+'</div><div class="xhl-chat-countryArea-division-group"></div></div>';i.append(y(t))}),y.each(e,function(e,s){var t=i.find('.xhl-chat-countryArea-country[data-code="'+s.countryCode+'"] > .xhl-chat-countryArea-division-group'),n=t.siblings(".xhl-chat-countryArea-toggle-btn"),r='<div class="xhl-chat-countryArea-division xhl-chat-countryArea-node" data-regionType="division" data-nodeLevel="2" data-code="'+s.countryCode+"-"+s.divisionCode+'" data-name="'+s.countryEnname+"-"+s.divisionEnname+'">'+("CN"===s.countryCode||s.list?'<span class="xhl-chat-countryArea-toggle-btn XHLCHATICON XHLCHATICON-arrow-opened" onclick="XHLChatCountryAreaTreeToggle(this)"></span>':"")+'<div class="xhl-chat-countryArea-node-label" onclick="XHLChatCountryAreaNodeClick(this)">'+s.divisionEnname+'</div><div class="xhl-chat-countryArea-division-group"></div></div>';t.append(y(r)),n.addClass("xhl-chat-countryArea-toggle-btn__active"),s.list&&y.each(s.list,function(e,t){var n=i.find('.xhl-chat-countryArea-country[data-code="'+s.countryCode+"-"+s.divisionCode+'"] > .xhl-chat-countryArea-division-group'),r=n.siblings(".xhl-chat-countryArea-toggle-btn"),t='<div class="xhl-chat-countryArea-division xhl-chat-countryArea-node" data-regionType="division" data-nodeLevel="3" data-code="'+s.countryCode+"-"+s.divisionCode+"-"+t.divisionCode+'" data-name="'+s.countryEnname+"-"+s.divisionEnname+"-"+t.divisionEnname+'"><div class="xhl-chat-countryArea-node-label" onclick="XHLChatCountryAreaNodeClick(this)">'+t.divisionEnname+"</div></div>";n.append(y(t)),r.addClass("xhl-chat-countryArea-toggle-btn__active")})}),n.length||e.length||(i='<div style="text-align: center;font-size: 14px;line-height: 24px;">No Data</div>'),y(t).prop("scrollHeight")||0);y(t).find(".xhl-chat-countryArea-popper").append(i),setTimeout(function(){var e;(y(t).prop("scrollHeight")||0)<=r||(e=y(t).find(".xhl-chat-countryArea-popper")[0])&&(e.scrollIntoView(),e.scrollTop=0)})},XHLChatCountryAreaTreeToggle=function(e){var n,r,s,i,o,a,c;y(e).hasClass("xhl-chat-countryArea-toggle-btn__active")?(y(e).removeClass("xhl-chat-countryArea-toggle-btn__active"),y(e).siblings(".xhl-chat-countryArea-division-group").hide()):(y(e).addClass("xhl-chat-countryArea-toggle-btn__active"),(n=y(e).siblings(".xhl-chat-countryArea-division-group")).find(".xhl-chat-countryArea-node").length||(e=y(e).parent(),r=e.attr("data-code"),s=e.attr("data-name"),i=e.attr("data-nodeLevel"),o="",a={},a="CN"===r||/CN-/.test(r)?(e=e.attr("data-provinceId"),o="/report/country/getChinaList",{pId:e||0}):(o="/report/country/getByCountryCode",{countryCode:r}),c=[],y.ajax({url:window._XHLURL.cn_SERVERPORT+o,type:"post",async:!1,data:a,success:function(e){"1"===e.code&&y.each(e.data,function(e,t){var n;"/report/country/getChinaList"===o?(n={divisionCode:t.code,divisionCnname:t.name,divisionEnname:t.pinyin,parentId:a.pId,provinceId:t.id},t.parentId||["32","33","34"].includes(t.id+"")||(n.hasChildren=!0)):n={divisionCode:t.divisionCode,divisionCnname:t.divisionCnname,divisionEnname:t.divisionEnname},c.push(n)})}}),c.length&&c.sort(function(e,t){e=e.divisionEnname||"",t=t.divisionEnname||"";return e.localeCompare(t)}),y.each(c,function(e,t){t='<div class="xhl-chat-countryArea-division xhl-chat-countryArea-node" data-regionType="division" data-nodeLevel="'+(Number(i)+1)+'" data-code="'+r+"-"+t.divisionCode+'" data-name="'+s+"-"+t.divisionEnname+'" data-provinceId="'+t.provinceId+'">'+(t.hasChildren?'<span class="xhl-chat-countryArea-toggle-btn XHLCHATICON XHLCHATICON-arrow-opened" onclick="XHLChatCountryAreaTreeToggle(this)"></span>':"")+'<div class="xhl-chat-countryArea-node-label" onclick="XHLChatCountryAreaNodeClick(this)">'+t.divisionEnname+'</div><div class="xhl-chat-countryArea-division-group"></div></div>';n.append(y(t))})),n.show())},XHLChatCountryAreaNodeClick=function(e){var t=y(e).closest("form#xhl_chat_form");if("country"===y(e).parent().attr("data-regiontype")){var n=y(e).parent().attr("data-code"),n=ye.includes(n);if(n)return void((n=y(e).siblings(".xhl-chat-countryArea-toggle-btn"))&&!n.hasClass("xhl-chat-countryArea-toggle-btn__active")&&n.click())}t.find(".xhl-chat-countryArea-node__selected").removeClass("xhl-chat-countryArea-node__selected"),y(e).parent().addClass("xhl-chat-countryArea-node__selected");n=y(e).parent().attr("data-name"),e=t.find(".xhl-chat-countryArea-input");e.val(n),e.attr("readonly","readonly"),t.find(".xhl-chat-countryArea-triangle-btn").hide(),t.find(".xhl-chat-countryArea-clear-btn").show(),t.find(".xhl-chat-countryArea-popper").hide()},XHLChatCountryAreaNodeClear=function(e){var e=y(e).closest("form#xhl_chat_form"),t=e.find(".xhl-chat-countryArea-input");t.val(""),t.removeAttr("readonly"),t.focus(),e.find(".xhl-chat-countryArea-node__selected").removeClass("xhl-chat-countryArea-node__selected"),e.find(".xhl-chat-countryArea-clear-btn").hide(),e.find(".xhl-chat-countryArea-triangle-btn").show()},xhlChatFormSubmit=function(){var e=p(),i={orgId:_XHL.a[0][1],currentUrl:window.location.href,templateId:S,source:2,proj:e},o=0,a="请选择",c=(I!=P&&(a=_("请选择")+" "),_("不能为空")),n=_("提交成功"),r=_("提交失败"),u=_("邮箱格式不正确"),l=_("电话号码格式不正确"),m=_("请输入正确的WhatsApp信息"),t=(_("电话号码至少为7位数字"),_("请确保字段内容格式正确"));if(y(".xhl-chat-controls").each(function(){var e=y(this).find(".xhl-chat-valtype"),t=e.attr("name"),n=e.hasClass("choose"),r=e.val();if("a1003"===t&&(r=!e.hasClass("xhl-chat-countryArea-input")||"readonly"===e.attr("readonly")?e.val():""),e.is("select")){var s=e.attr("data-placeholder"),s=a+s;if(n&&(r==s||!r))return o=1,R(s,"xhl-tip-warning"),e.focus(),!1}else{if(n)if(""==r)return o=1,R(e.attr("placeholder")+c,"xhl-tip-warning"),e.focus(),!1;if("a10010"===t&&""!==r&&!/\w+?@\S+?\.[A-Za-z\d]{2,4}/gm.test(r))return o=1,R(u,"xhl-tip-warning"),e.focus(),!1;if("a10012"===t&&""!==r)if(!/^[ \\\-_`~!@#$%^&*()+=|{}':;",\[\].<>/?~！@#￥%……&*（）——+\d]+(( x| ext)[ \\\-_`~!@#$%^&*()+=|{}':;",\[\].<>/?~！@#￥%……&*（）——+\d]+)?$/i.test(r)||!/\d/.test(r))return o=1,R(l,"xhl-tip-warning"),e.focus(),!1;if("a10052"===t&&""!==r&&!/^[ \-_`~!@#$%^&*()+=|{}':;',\[\].<>/?~！@#￥%……&*（）——+\d]+$/.test(r))return o=1,R(m,"xhl-tip-warning"),e.focus(),!1}0==o&&(i[t]=r)}),0===o){for(var s in O){y(".xhl-form-submit").parent().parent().find("[name='"+s+"']").each(function(){this&&this.oninput&&XHLInputCheck(this)});var d=i[s],s=O[s];d&&s&&d.length>s&&(o=1)}1===o&&R(t,"xhl-tip-warning")}0==o&&fe&&(fe=!1,y.ajax({url:window._XHLURL.SERVERPORT+"/server/enterpriseVisitor",type:"post",dataType:"json",data:{enterpriseId:_XHL.a[0][1],visitorId:e},success:function(e){e.code&&0==e.code||(firstVisitorAddress=e.firstVisitorAddress,countryCode=e.ipLocationCode,country=e.ipLocation),i.sourceUrl=firstVisitorAddress,y.ajax({url:window._XHLURL.cn_SERVERPORT+"/form-cust/form/saveColumnValue",type:"post",dataType:"json",data:i,success:function(e){var t;1==e.code?((t=document.getElementById("xhl-wrapper"))&&t.dispatchEvent(new CustomEvent("xhlChatFormSubmit",{bubbles:!0,detail:{data:i}})),t=e.data,R(n,"xhl-tip-success"),e='<div class="xhl-form-message"><p class="xhl_submit_chat_offline_form_success">'+k+"</p></div>",y(".xhl-conversation-container").html(e),y(".xhl-form-submit").empty(),t&&(e=t,e={orgId:_XHL.a[0][1],visitorId:p(),piwikVisitorId:window.piwikVisitorId||"",currentUrl:window.location.href,countryCode:window.XHL_countryCode,country:window.XHL_country,formId:e},y.ajax({url:window._XHLURL.SERVERPORT+"/piwik/piwik/saveFormPiwikVisitRelation",type:"post",contentType:"application/json",dataType:"json",data:JSON.stringify(e),success:function(){}}),y.ajax({url:window._XHLURL.WebsocketURL+"/websocketLeavemessage/sendEnterpriseLeavemessageMessage",type:"post",dataType:"json",data:{enterpriseId:_XHL.a[0][1],message:pe},success:function(e){}}))):R(r,"xhl-tip-danger"),fe=!0},error:function(e){R(r,"xhl-tip-danger"),fe=!0}})}}))},x=this,t=function(){return r=[function(e,t,n){"use strict";e.exports={}},function(e,t){"use strict";var n,r,s={getNode:function(e,t){return this.isString(e)?(t=t||document).querySelector(e):this.isElement(e)?e:void 0},getNodes:function(e){return document.querySelectorAll(e)},isString:function(e){return"string"==typeof e},isElement:function(e){return!(!e||1!==e.nodeType)},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},addEvent:function(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},hasClass:function(e,t){return 0!==(t=t||"").replace(/\s/g,"").length&&new RegExp(" "+t+" ").test(" "+e.className+" ")},addClass:function(e,t){!e||this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(e&&this.hasClass(e,t)){for(var n=" "+e.className.replace(/[\t\r\n]/g,"")+" ";0<=n.indexOf(" "+t+" ");)n=n.replace(" "+t+" "," ");e.className=n.replace(/^\s+|\s+$/g,"")}},safeHtml:(n=/<br\/?>$/,r={r:/<|>|\&|\r|\n|\s|\'|\"/g,"<":"&lt;",">":"&gt;","&":"&amp;"," ":"&nbsp;",'"':"&quot;","'":"&#39;","\n":"<br/>","\r":""},function(e){return(e=i(r,e)).replace(n,"<br/><br/>")})},i=function(n,e){return e=""+e,n&&e?e.replace(n.r,function(e){var t=n[n.i?e:e.toLowerCase()];return null!=t?t:e}):e||""};e.exports=s}],s={},n.m=r,n.c=s,n.p="",n(0);function n(e){var t;return(s[e]||(t=s[e]={exports:{},id:e,loaded:!1},r[e].call(t.exports,t,t.exports,n),t.loaded=!0,t)).exports}var r,s},"object"==typeof exports&&"object"==typeof module?module.exports=t():"object"==typeof exports?exports.NIMUIKit=t():x.NIMUIKit=t();var Ie,we,Pe,Oe,Ae,_e,U=function(e){this.accid=e,this.initModule(),this.cache=new ae,this.needReconnect=!0,this.mysdk=new f(this,this.cache),this.totalUnread=0},Ee=(U.fn=U.prototype,U.fn.initModule=function(){this.initBase(),this.message(),this.session()},U.fn.initBase=function(){this.$mask=y("#mask"),this.$userName=y("#userName"),this.$chatContent=y("#chatContent"),this.$chatContentTemp=y("#chatContentTemp")},U.fn.initUI=function(){},U.fn.initInfo=function(){var e=m("_xhluchatobject");e&&this.mysdk.getUser(e,this.cbInitInfo.bind(this))},U.fn.cbInitInfo=function(e,t){e||(this.cache.setPersonlist(t),this.lockPerson=!1)},U.fn.getNick=function(e){return se(e,this.cache)},U.fn.infoProvider=function(e,t){var n={};if("session"===t){t=e.lastMsg;if(!t)return;var r=t.scene;n.scene=r,n.account=t.target,n.target=t.scene+"-"+t.target,n.time=Y(t.time),n.crtSession=this.crtSession,n.unread=99<e.unread?"99+":e.unread,n.text=void 0,"p2p"===r&&(t.target===b?n.nick="我的手机":(this.cache.getUserById(t.target),n.nick=this.getNick(t.target)))}return n},!0),Re=1,Ue=window.parent.document.title,je=[],Ne=!0,Fe=!0,Le=!0,De={name:100,email:100,WhatsApp:100};U.fn.message=function(){for(var e in this.$sendBtn=y("#sendBtn"),this.$messageText=y("#messageText"),this.$chooseFileBtn=y("#chooseFileBtn"),this.$fileInput=y("#uploadFile"),this.$test="",this.$sendBtn.on("click",this.sendTextMessage.bind(this)),this.$messageText.on("keydown",this.inputMessage.bind(this)),this.$chooseFileBtn.on("click","a",this.chooseFile.bind(this)),this.$fileInput.on("change",this.uploadFile.bind(this)),this.$sendPresetFormBtn=y("#xhl-preset-form-btn"),this.$sendPresetFormBtn.on("click",this.sendPresetForm.bind(this)),De)!function(t){y("#xhl-preset-form-"+t).each(function(){y(this).bind("change input propertychange",function(e){ze(this,t)})})}(e);this.$chatContent.delegate(".j-resend","click",this.doResend.bind(this)),this.$chatContent.delegate(".more-msgs","click",this.getMoreHistoryMsgs.bind(this)),we=Date.now();var t=[];(t=localStorage.timeStampList?JSON.parse(localStorage.timeStampList):t).push(we),localStorage.setItem("timeStampList",JSON.stringify(t)),this.$inputBox=y(".xhl-chat-input"),this.$inputBox.on("keyup",this.onVisitorInput.bind(this)),this.$inputBox.on("blur",this.stopVisitorInput.bind(this)),this.$messageText.bind("input propertychange","textarea",function(e){var t=y(e.target).val();800<t.length&&(y(e.target).val(t.substr(0,800)),t="",t=e.originalEvent&&"insertFromPaste"===e.originalEvent.inputType?_("输入框可输入上限是800，超出部分无法保留"):_("输入框可输入上限是800"),g(t,"xhl-tip-warning"))})},U.fn.onVisitorInput=(Oe=function(){Le=!1;var e=m("_xhluchatobject");e&&(U.fn.sendCustomSysMsgForVisitorInput(e,y("#messageText").val()),Fe=!0),clearTimeout(Pe),Pe=setTimeout(function(){e&&!Le&&U.fn.sendCustomSysMsgForVisitorInput(e,y("#messageText").val())},1e3)},Ae=600,_e=Date.now(),function(){var e=Date.now();Ae<e-_e&&(Oe(),_e=Date.now())}),U.fn.stopVisitorInput=function(e){var t=m("_xhluchatobject");Le=!0,t&&this.sendCustomSysMsgForVisitorStopInput(t,Fe?y("#messageText").val():"")},window.addEventListener("pagehide",function(){var e=m("_xhluchatobject");e&&U.fn.sendCustomSysMsgForVisitorStopInput(e,""),Fe=!0}),U.fn.isFirstDoMsg=!0,U.fn.doMsg=function(t){"in"===t.flow&&(this.cache.currSessionId=t.sessionId,this.isFirstDoMsg&&(U.fn.isFirstDoMsg=!1),oe(t,this.cache.Nick,"out",4),V(t),Ne&&y(".xhl-launch-button").hasClass("xhl-hidden")||function e(){Re=1===Re?(window.parent.document.title="[new message]",2):(window.parent.document.title=Ue,1);clearTimeout(Ie);Ie=setTimeout(function(){e()},500)}(),Be(t));function n(){"in"===t.flow&&(y(".xhl-launch-button").hasClass("xhl-hidden")?(T.mysdk.resetSessionUnread(),Ne&&localStorage.setItem("xhlWindowClick","Msg_"+t.time)):-1<(e=localStorage.getItem("xhlWindowClick")).indexOf("Msg_")&&+e.split("Msg_")[1]===t.time?(We(),Xe()):(Ve(),He(t)),(e=m("_xhluchatobject"))!=t.from&&t.from!=m("_xhlusdkid")&&t.from!=t.to&&v("_xhluchatobject",t.from),e&&e!=t.from&&window.nim.unSubscribeEventsByAccounts({type:1,accounts:[e],done:function(e,t){}}),e==t.from&&!r.needReconnect||Je(t.from),r.needReconnect=!1,r.sendCustomSysMsgForTrack([s]),r.sendMsgRead(s,t.scene));var e=C.updateChatContentUI(t,r.cache);r.$chatContent.append(e),r.$chatContentTemp.scrollTop(99999)}var e,r=this,s=t.to===b?t.from:t.to;/text|image|file|audio|video|geo|custom|tip|robot/i.test(t.type)&&(this.cache.addMsgs(t),e="p2p"===t.scene?s:t.from,this.cache.getUserById(e)?n():this.mysdk.getUser(e,function(e,t){e||(r.cache.updatePersonlist(t),n())}))},U.fn.uploadFile=function(){m("_xhluchatobject");var e=this.$fileInput.get(0);if(0==e.files[0].size)return!1;this.sendContentTemp(e,"file")},U.fn.chooseFile=function(){this.$fileInput.click()},U.fn.sendTextMessage=function(e){if(U.fn.onVisitorInput=null,e&&e.preventDefault(),0<!y.trim(this.$messageText.val()).length)return!1;this.crtSessionType;var t,e=this.$messageText.val().trim();if(e){if(800<e.length)return t=_("输入框可输入上限是800"),g(t,"xhl-tip-warning"),!1}else if(0===e.length)return;this.sendContentTemp(e,"text")},U.fn.sendPresetForm=function(){function e(e,t){y(".preset-form-tips").stop(!0,!0).addClass("alert "+t).html(e).show().delay(1500).fadeOut()}var t=y("#presetName").text(),n=y("#presetEmail").text(),r=y("#presetWhatsApp").text(),s=_("姓名不能为空"),i=_("邮箱格式不正确"),o=_("WhatsApp 格式不正确"),a=_("请确保字段内容格式正确"),c=y("#xhl-preset-form-name").val(),u=y("#xhl-preset-form-email").val(),l=y("#xhl-preset-form-WhatsApp").val();if(y.trim(c).length<=0)return e(s,"xhl-tip-warning"),!1;if("11318"!=_XHL.a[0][1]&&"11349"!=_XHL.a[0][1]&&"10110"!=_XHL.a[0][1]){s=this.trimStr(u);if(!/\w+?@\S+?\.[A-Za-z\d]{2,4}/gm.test(s))return e(i,"xhl-tip-warning"),!1}if("11318"==_XHL.a[0][1]||"11349"==_XHL.a[0][1]||"10110"==_XHL.a[0][1]){s=this.trimStr(l);if(!/^[ \-_`~!@#$%^&*()+=|{}':;",\[\].<>/?~！@#￥%……&*（）——+\d]+$/.test(s))return e(o,"xhl-tip-warning"),!1}var m,d=0,p={name:c};for(m in"11318"==_XHL.a[0][1]||"11349"==_XHL.a[0][1]||"10110"==_XHL.a[0][1]?p.waNumber=l:p.email=u,De){!function(e){y("#xhl-preset-form-"+e).each(function(){ze(this,e)})}(m);var f=p[m],g=De[m];c&&g&&f&&f.length>g&&(d=1)}if(1===d)return e(a,"xhl-tip-warning"),!1;i="",i="11318"==_XHL.a[0][1]||"11349"==_XHL.a[0][1]||"10110"==_XHL.a[0][1]?t+":"+c+"\n"+r+":"+l:t+":"+c+"\n"+n+":"+u;if("10289"==_XHL.a[0][1]){s=y("#presetPhone").text(),o=y("#presetPhone").attr("name"),a=y("#xhl-preset-form-phone").val(),r=this.trimStr(a);if(!/^[ \\\-_`~!@#$%^&*()+=|{}':;",\[\].<>/?~！@#￥%……&*（）——+\d]+(( x| ext)[ \\\-_`~!@#$%^&*()+=|{}':;",\[\].<>/?~！@#￥%……&*（）——+\d]+)?$/i.test(r)||!/\d/.test(r))return e(o,"xhl-tip-warning"),!1;i+="\n"+s+":"+a}v("presetFormValue",i),this.sendContentTemp(i,"text"),y(".xhl-preset-form").addClass("xhl-display"),y("#xhl-preset-form-btn").addClass("xhl-display"),y(".xhl-conversation-container").removeClass("xhl-display"),y(".xhl-footer-form-container").removeClass("xhl-display"),y(".relenvance").removeClass("xhl-display")},U.fn.sendContentTemp=function(t,n,r){var e,s=m("_xhluchatobject"),i="p2p",o=this;Ee&&0,this.needReconnect?(e=s?{visitorServiceAcctId:s,enterpriseId:_XHL.a[0][1],visitorId:p(),visitorAcctid:m("_xhlusdkid")}:{enterpriseId:_XHL.a[0][1],visitorId:p(),visitorAcctid:m("_xhlusdkid")},this.$messageText.val(""),y.ajax({url:window._XHLURL.SERVERPORT+"/visitor/visitorStartChat",type:"post",dataType:"json",data:e,success:function(e){if(0!=e.code){if(1==e.code&&(s&&window.nim.unSubscribeEventsByAccounts({type:1,accounts:[s],done:function(e,t){}}),Je(e.data.acctid),o.needReconnect=!1,v("_xhluchatobject",s=e.data.acctid)),Ee=!1,r)o.mysdk.forwardMessage(r,i,s,o.sendMsgDone.bind(o));else if(s&&t){if("text"===n)return 800<t.length?(e=_("输入框可输入上限是800"),g(e,"xhl-tip-warning"),!1):0!==t.length&&void o.mysdk.sendTextMessage(i,s,t,!1,o.sendMsgDone.bind(o));o.mysdk.sendFileMessage(i,s,t,o.sendMsgDone.bind(o))}}else ke()},error:function(){ke()}})):r?this.mysdk.forwardMessage(r,i,s,this.sendMsgDone.bind(this)):s&&("text"===n?this.mysdk.sendTextMessage(i,s,t,!1,this.sendMsgDone.bind(this)):this.mysdk.sendFileMessage(i,s,t,this.sendMsgDone.bind(this)))},U.fn.sendCustomSysMsgForTrack=function(e){for(var t=0;t<e.length;t++)window.nim.sendCustomSysMsg({scene:"p2p",to:e[t],needPushNick:!0,cc:!1,content:JSON.stringify({id:100,xUserInfo:JSON.parse(localStorage.getItem("_xUserInfo")||'""')}),isPushable:!0,sendToOnlineUsersOnly:!1,done:function(e,t){}})},U.fn.sendCustomSysMsgForSubscribesLogin=function(e){for(var t=0;t<e.length;t++)window.nim.sendCustomSysMsg({scene:"p2p",to:e[t],cc:!1,needPushNick:!0,content:JSON.stringify({id:101,login:!0}),isPushable:!0,sendToOnlineUsersOnly:!0,done:function(e,t){}})},U.fn.sendCustomSysMsgForVisitorStopInput=function(e,t){window.nim.sendCustomSysMsg({scene:"p2p",to:e,cc:!1,needPushNick:!0,content:JSON.stringify({id:104,login:!0,visitorId:p(),inputContent:t}),isPushable:!0,sendToOnlineUsersOnly:!0,done:function(e,t){}})},U.fn.sendCustomSysMsgForVisitorInput=function(e,t){window.nim.sendCustomSysMsg({scene:"p2p",to:e,cc:!1,needPushNick:!0,content:JSON.stringify({id:103,login:!0,visitorId:p(),inputContent:t}),isPushable:!0,sendToOnlineUsersOnly:!0,done:function(e,t){}})},U.fn.sendMsgDone=function(e,c){var n,u=this,t=!1;e||("text"==c.type?(c.from,c.to,c.text):(c.from,c.to,c.url),t=y.Deferred(),u.cache.getUserById(c.to)?(e=ie(c.to),oe(c,e,"in",1,t)):(n=t,u.mysdk.getUser(c.to,function(e,t){e||u.cache.updatePersonlist(t);e=ie(c.to);oe(c,e,"in",1,n)})),V(c)),y.when(t).then(function(e){var t,n,r,s,i,o,a;e?(u.needReconnect=!0,u.sendContentTemp(null,null,c)):(e=c.to,t=c,n=new Date,r=n.getFullYear(),s=n.getMonth()+1,i=n.getDate(),o=n.getHours(),a=n.getMinutes(),n=n.getSeconds(),r=r+"-"+j(s)+"-"+j(i)+" "+j(o)+":"+j(a)+":"+j(n),s={accId:e,data:r,thing:t.fromNick},y.ajax({url:window._XHLURL.cn_SERVERPORT+"/cuss-login/mini_project/weChatSubscribeSend",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(s),success:function(e){}}),u.cache.addMsgs(c),i=C.updateChatContentUI(c,u.cache),u.$chatContent.append(i),u.$chatContentTemp.scrollTop(99999),y("#uploadForm").get(0).reset())})},U.fn.inputMessage=function(e){e=e||window.event;0<y.trim(this.$messageText.val()).length?13===e.keyCode&&e.ctrlKey?this.$messageText.val(this.$messageText.val()+"\r\n"):13!==e.keyCode||e.ctrlKey||(e.preventDefault(),this.sendTextMessage()):0==y.trim(this.$messageText.val())&&13===e.keyCode&&e.preventDefault()},U.fn.doResend=function(e){var e="span"===e.target.tagName.toLowerCase()?y(e.target):y(e.target.parentNode),n=e.data("session"),r=e.data("id"),e=this.cache.findMsg(n,r);this.mysdk.resendMsg(e,function(e,t){e?ke():(this.cache.setMsg(n,r,t),e=C.buildChatContentUI(n,this.cache),this.$chatContent.html(e),this.$chatContentTemp.scrollTop(99999),y("#uploadForm").get(0).reset())}.bind(this))},U.fn.getMoreHistoryMsgs=function(){var e=m("_xhluchatobject");this.getHistoryMsgs("p2p",e)},U.fn.getHistoryMsgs=function(e,t){var n,r={lastMsgId:!1,endTime:!1},s="init",i=e+"-"+t,o=(this.cache.getHistoryMsgCount+=1,1===this.cache.getHistoryMsgCount?(y(".xhl-preset-form").addClass("xhl-display"),y("#xhl-preset-form-btn").addClass("xhl-display"),y(".xhl-conversation-container").removeClass("xhl-display"),y(".xhl-footer-form-container").removeClass("xhl-display"),y(".relenvance").removeClass("xhl-display")):(s="contact",0<(n=this.cache.getMsgs(i)).length&&(r.endTime=n[0].time,r.lastMsgId=n[0].idServer)),this.sendMsgRead(t,e),this);this.mysdk.getWebHistoryMsgs(e,t,r,function(e,n){e||(o.cache.msgs[i]=[],o.cache.addMsgsByReverse(n.msgs,i),e=function(e){if(e){for(var t=[],n=(e=Array.isArray(e)?e:[e]).length-1;0<=n;n--)if(t.push(e[n].from),e[n].attach&&e[n].attach.accounts)for(var r=e[n].attach.accounts.length-1;0<=r;r--)t.push(e[n].attach.accounts[r]);return t}}(n.msgs),o.checkUserInfo(e,function(){var e,t;"init"===s?o.doChatUI(i):(t=C.contactChatContentUI(n.msgs.reverse(),o.cache),e=o.$chatContent.height(),o.$chatContent.find(".more-msgs").remove(),o.$chatContent.prepend(t),t=o.$chatContent.height(),o.$chatContentTemp.scrollTop(t-e))}))})},U.fn.doChatUI=function(e){e=C.buildChatContentUI(e,this.cache);this.$chatContent.html(e),this.$chatContentTemp.scrollTop(99999)},U.fn.checkUserInfo=function(e,n){for(var t=[],r=this,s=e.length-1;0<=s;s--)this.cache.getUserById(e[s])||t.push(e[s]);0<t.length?this.mysdk.getUsers(t,function(e,t){e||(r.cache.setPersonlist(t),n())}):n()},U.fn.sendMsgRead=function(e,t){},U.fn.sendCustomMessage=function(t){var n=this,e=(t.list=t.list||[],this.cache.getTeamMemberInfo(t.caller,t.teamId));t.nick=e.nickInTeam||se(t.caller),t.list.forEach(function(e){n.nim.sendCustomSysMsg({scene:"p2p",to:e,cc:!1,enablePushNick:!1,content:JSON.stringify({id:3,members:t.list,teamId:t.teamId,room:t.channelName,type:t.type}),isPushable:!0,sendToOnlineUsersOnly:!1,apnsText:t.nick+"正在呼叫您",done:function(e,t){}})})},U.fn.trimStr=function(e){for(var t="",n=0;n<e.length;n++){var r=e.charAt(n);new RegExp("^[a-zA-Z0-9@.]+$").test(r)&&(t+=r)}return t};var Be=function(t){var e,n=!0;if((n=localStorage.timeStampList&&(e=JSON.parse(localStorage.timeStampList),we!==e[e.length-1])?!1:n)&&window.Notification)if("granted"===Notification.permission)r(t);else try{Notification.requestPermission().then(function(e){Notification.permission!==e&&(Notification.permission=e),"granted"===e&&r(t)})}catch(e){}function r(e){var t=je,n=qe(e,"notice"),e={body:e.fromNick+":\n"+n,icon:"../../../static/img/xpylogo.png"};try{var r=new Notification("消息提醒",e);r.onclick=function(){for(window.focus();0<t.length;)t[0].close(),t.shift()},t.push(r)}catch(e){}}};function He(e){var e=qe(e,"tip"),e=(y(".xhl-poptip-content-inner").html(e),y(".xhl-launch-button").width()+68),t=y(".xhl-launch-button").height()/2+55-y(".xhl-chat-poptip").height()/2;y("#xhl-launch-button-div").offset().left<80?(y(".xhl-poptip-arrow").hasClass("xhl-poptip-arrow-left")||y(".xhl-poptip-arrow").addClass("xhl-poptip-arrow-left").removeClass("xhl-poptip-arrow-right"),y(".xhl-chat-poptip").css({left:e+"px",bottom:t+"px",display:"block",right:"unset"})):(y(".xhl-poptip-arrow").hasClass("xhl-poptip-arrow-right")||y(".xhl-poptip-arrow").addClass("xhl-poptip-arrow-right").removeClass("xhl-poptip-arrow-left"),y(".xhl-chat-poptip").css({right:e+"px",bottom:t+"px",display:"block",left:"unset"}))}function qe(e,t){var n="",r="",s=e.file?i(e.file.url):"";switch(e.type){case"text":n=(n=i(e.text)).replace(/(http:\/\/[\w.\/]+)(?![^<]+>)/gi,"<a href='$1' target='_blank'>$1</a>"),r=e.text;break;case"image":n="<p>[图片]</p>",r="[图片]";break;case"file":r=-1===e.status?(n="<p>[文件]</p>","[文件]"):/png|jpg|bmp|jpeg|gif/i.test(e.file.ext)?(n="<p>[图片]</p>","[图片]"):(n='<a href="'+(s+=e.file?"&download="+encodeURI(i(e.file.name)):"")+'" target="_blank" class="download-file f-maxWid"><span class="icon icon-file2"></span>'+i(e.file.name)+"</a>","[文件]");break;case"tip":n=e.tip,r=e.tip;break;default:r=n="收到一条[未知消息类型]消息"}return"tip"===t?n:r}function Xe(){window.parent.document.title=Ue,clearTimeout(Ie)}function We(){y(".xhl-chat-poptip").hide(),T.mysdk.resetSessionUnread(),y(".xhl-notification-badge").addClass("xhl-hidden"),y(".xhl-notification-badge-text").attr("name",0).text("")}function Ve(){y(".xhl-notification-badge").removeClass("xhl-hidden");var e=+y(".xhl-notification-badge-text").attr("name")+1;y(".xhl-notification-badge-text").text(e).attr("name",e)}function j(e){return e<10?"0"+e:e}function Je(e){e&&window.nim.subscribeEvent({type:1,accounts:[e],subscribeTime:86400,sync:!0,done:function(e,t){}})}function g(e,t){y(".preset-form-tips").stop(!0,!0).addClass("alert "+t).html(e).show().delay(1500).fadeOut()}function ze(e,t){var n,r,t=De[t];t&&(n=0<y(e).siblings(".xhl-error-tip").length,r=(r=_("最大字数限制 000 字")).replace("000",t),e.value&&e.value.length>t?n||y(e).after('<div class="xhl-error-tip" title="'+r+'">'+r+"</div>"):n&&y(e).siblings(".xhl-error-tip").remove())}window.onblur=function(){Ne=!1,U.fn.stopVisitorInput("页面失焦。。。")},window.onclick=function(){var e=(new Date).getTime();y(".xhl-launch-button").hasClass("xhl-hidden")?localStorage.setItem("xhlWindowClick","reset"+e):localStorage.setItem("xhlWindowClick",e),Ne=!0,Xe()},window.addEventListener("storage",function(e){"xhlWindowClick"===e.key&&"0"!==e.newValue&&(Xe(),-1<e.newValue.indexOf("reset")||-1<e.newValue.indexOf("Msg_")||-1<e.newValue.indexOf("Click_"))&&We()}),U.fn.session=function(){},U.fn.buildSessions=function(e){this.showUnread()},U.fn.showUnread=function(){var e=y("#sessions .panel_count");if((this.totalUnread=0)!==e.length&&"99+"!==this.totalUnread)for(var t=e.length-1;0<=t;t--){if("99+"===y(e[t]).text()){this.totalUnread="99+";break}this.totalUnread+=parseInt(y(e[t]).text(),10)}var n=y(".m-unread .u-unread");n.text(this.totalUnread),this.totalUnread?n.removeClass("hide"):n.addClass("hide")}}(_XHLJQ);